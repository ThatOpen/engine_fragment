import{C as ye,W as xe,fq as Pe,fr as Me,fs as Ie,ft as Se,fu as ve,fv as Ce,fw as Te,fx as re,fy as ke,fz as ze,cb as Le,fA as Ee,fB as Q,fC as Ge,fD as Re,fE as ie,fF as ae,V as u,fG as _e,c as ce,fH as Ae,cr as De,fI as Ue,cv as z}from"./virtual-memory-controller-uf_sHEwD.js";import{s as Fe,S as je}from"./index-C5O8t_P8.js";import{a as Be,R as le,m as de}from"./index-CWj6LyOo.js";import{S as Oe}from"./stats.min-Cj8wREqt.js";import{R as He}from"./RGBELoader-C-f4ls_8.js";import{G as We,P as Ne}from"./index-CDU6cxPJ.js";const $e=document.getElementById("container"),C=new ye,Ve=C.get(xe),n=Ve.create();n.scene=new Pe(C);n.renderer=new Fe(C,$e);n.camera=new Me(C);C.init();n.camera.controls.setLookAt(12,6,8,0,0,-10);n.renderer.three.shadowMap.enabled=!0;n.renderer.three.shadowMap.type=Ie;n.scene.setup({shadows:{cascade:1,resolution:1024}});await n.scene.updateShadows();n.camera.controls.addEventListener("rest",async()=>{await n.scene.updateShadows()});const qe=new Se(1);n.scene.three.add(qe);const o={length:30,lengthModules:5,columnWidth:.2,columnLength:.2,columnThickness:.03,columnFlangeThickness:.03,basePlateSize:.5,basePlateCrossHeight:.2,basePlateCornerSize:.1,basePlateThickness:.01,startPoints:[[0,0,0],[0,8,0],[0,8,0],[10,10,0],[10,10,0],[20,8,0],[20,8,0],[20,0,0],[20,4,0],[30,4,0],[30,4,0],[30,0,0]]},Ze="https://thatopen.github.io/engine_fragment/resources/worker.mjs",Je=await fetch(Ze),Ke=await Je.blob(),Qe=new File([Ke],"worker.mjs",{type:"text/javascript"}),Xe=URL.createObjectURL(Qe),r=C.get(ve);r.init(Xe);n.renderer.postproduction.enabled=!0;n.renderer.postproduction.style=je.COLOR_PEN;const Ye=e=>{e.wrapS=ae,e.wrapT=ae,e.repeat.set(.2,.2)},et=new Ce,me=et.load("https://thatopen.github.io/engine_fragment/resources/textures/concrete/Concrete012_2K-JPG_Roughness.jpg");Ye(me);r.core.models.materials.list.onItemSet.add(({key:e,value:t})=>{if("map"in t){const s=new Te({color:t.color,metalness:.9,roughnessMap:me,side:re});r.core.models.materials.list.set(e,s)}});r.core.models.materials.list.onItemSet.add(({value:e})=>{"isLodMaterial"in e&&e.isLodMaterial&&n.renderer.postproduction.basePass.isolatedMaterials.push(e)});r.core.settings.graphicsQuality=1;n.camera.controls.addEventListener("control",()=>{r.core.update()});r.core.models.list.onItemSet.add(({value:e})=>{e.tiles.onItemSet.add(({value:t})=>{if(!("isLODGeometry"in t.geometry)){const s=t.geometry;t.castShadow=!0,t.receiveShadow=!0;const a=s.index.array,d=s.attributes.position.array,m=s.attributes.normal.array,c=new Float32Array(d.length/3*2);for(let l=0;l<a.length;l++){const i=a[l],M=d[i*3],I=d[i*3+1],p=d[i*3+2],H=m[i*3],y=m[i*3+1],x=m[i*3+2],f=Math.abs(H),g=Math.abs(y),R=Math.abs(x);f>g&&f>R?(c[i*2]=I,c[i*2+1]=p):g>f&&g>R?(c[i*2]=M,c[i*2+1]=p):(c[i*2]=M,c[i*2+1]=I)}const b=new ke(c,2);b.onUpload(function(){delete this.array}),s.setAttribute("uv",b)}})});r.core.models.list.onItemSet.add(({value:e})=>{e.tiles.onItemSet.add(({value:t})=>{"isMesh"in t&&t.material[0].opacity===1&&(t.castShadow=!0,t.receiveShadow=!0)}),e.getClippingPlanesEvent=()=>Array.from(n.renderer.three.clippingPlanes)||[]});const tt=ze.newModel({raw:!0}),h=await r.core.load(tt,{modelId:"example",camera:n.camera.three,raw:!0});n.scene.three.add(h.object);await r.core.update(!0);const X=new Le;X.SetWasmPath("https://unpkg.com/web-ifc@0.0.75/",!0);await X.Init();const E=new We(X),ot=new He;ot.load("https://thatopen.github.io/engine_fragment/resources/textures/envmaps/san_giuseppe_bridge_2k.hdr",e=>{e.mapping=Ee,n.scene.three.environment=e});const G=new Q,st=new Ge({color:16711680}),at=new Re(G,st);n.scene.three.add(at);let J=!1;const ne=new Q,nt=new ie({color:"white",side:2}),rt=e=>{const t=new Ae(e,nt);return t.receiveShadow=!0,t.castShadow=!0,t.frustumCulled=!1,t},pe=(e,t,s)=>{const a=new Q;return E.getExtrusion(a,{profilePoints:e,direction:t,length:s}),rt(a)},it=(e,t)=>{const s=new _e(e,t),a=[],d=s.index.array,m=s.attributes.position.array;for(let l=0;l<d.length;l++){const i=d[l];a.push(m[i*3]),a.push(m[i*3+1]),a.push(m[i*3+2])}const c=new ce().makeRotationX(Math.PI/2);return E.transformPoints(a,c)},Y=(e,t,s)=>pe([-e/2,0,-t/2,-e/2,0,t/2,e/2,0,t/2,e/2,0,-t/2],[0,1,0],s),ct=(e,t,s)=>{const a=it(e,s);return pe(a,[0,1,0],t)},j=Y(o.basePlateSize,o.basePlateSize,o.basePlateThickness),B=Y(o.basePlateThickness*2,o.basePlateSize/2,o.basePlateCrossHeight),L=Y(o.basePlateCornerSize,o.basePlateCornerSize,o.basePlateThickness),v=ct(o.basePlateSize/15,o.basePlateSize/15,6),lt=async()=>{if(!G.attributes.position){console.log("No wire geometry");return}const e=new De,t=[];await r.core.editor.reset(h.modelId);const s=r.core.editor.createMaterial(h.modelId,new ie({color:new Ue(1,1,1),side:re})),a=r.core.editor.createLocalTransform(h.modelId,new ce().identity()),d=j.geometry,m=r.core.editor.createShell(h.modelId,d),c=B.geometry,b=r.core.editor.createShell(h.modelId,c),l=L.geometry,i=r.core.editor.createShell(h.modelId,l),M=v.geometry,I=r.core.editor.createShell(h.modelId,M),p=o.basePlateSize/10,H=o.basePlateThickness,y=new u(1,0,0),x=new u(0,1,0),f=new u(1,0,0),g=new u(0,1,0);e.position.set(0,0,0),e.rotation.set(0,0,0),e.rotation.y=-Math.PI/2,e.updateMatrix(),y.applyMatrix4(e.matrix),x.applyMatrix4(e.matrix),e.rotation.set(0,0,0),e.rotation.z=Math.PI/2,e.updateMatrix(),y.applyMatrix4(e.matrix),x.applyMatrix4(e.matrix),e.rotation.set(0,0,0),e.rotation.y=Math.PI/2,e.updateMatrix(),f.applyMatrix4(e.matrix),g.applyMatrix4(e.matrix),e.rotation.set(0,0,0),e.rotation.z=-Math.PI/2,e.updateMatrix(),f.applyMatrix4(e.matrix),g.applyMatrix4(e.matrix);const R=r.core.editor.createCircleExtrusion(h.modelId,{radius:[H],axes:[{wires:[[0,.06,0,0,-.6+p,0],[p,-.6,0,.15-p,-.6,0],[.15,-.6+p,0,.15,-.5,0]],wireSets:[],circleCurves:[{aperture:Math.PI/2,position:[p,-.6+p,0],radius:p,xDirection:[y.x,y.y,y.z],yDirection:[x.x,x.y,x.z]},{aperture:Math.PI/2,position:[.15-p,-.6+p,0],radius:p,xDirection:[f.x,f.y,f.z],yDirection:[g.x,g.y,g.z]}],order:[0,1,2,0,1],parts:[z.WIRE,z.WIRE,z.WIRE,z.CIRCLE_CURVE,z.CIRCLE_CURVE]}]}),ue=E.getProfilePoints({type:Ne.H,width:o.columnWidth,depth:o.columnLength,thickness:o.columnThickness,flangeThickness:o.columnFlangeThickness}),k=new u,_=new u,P=G.attributes.position.array;for(let w=0;w<P.length;w+=6){const ee=P[w],A=P[w+1],te=P[w+2],oe=P[w+3],W=P[w+4],se=P[w+5];if(k.set(ee,A,te),_.set(oe,W,se),A===0||W===0){const $=A===0,D=$?ee:oe,V=$?A:W,U=$?te:se;j.position.set(D,V,U),j.updateMatrix(),t.push({attributes:{_category:{value:"test"}},globalTransform:j.matrix.clone(),samples:[{localTransform:a,representation:m,material:s}]});const fe=.1;for(let S=0;S<2;S++){const we=S===0?-.1:fe;B.position.set(D+we,-.2,U),B.updateMatrix(),t.push({attributes:{_category:{value:"test"}},globalTransform:B.matrix.clone(),samples:[{localTransform:a,representation:b,material:s}]})}const F=o.basePlateSize/2-o.basePlateCornerSize/2,ge=[new u(F,0,F),new u(-.2,0,F),new u(F,0,-.2),new u(-.2,0,-.2)];let q=0;for(const S of ge)L.position.set(D,V+o.basePlateThickness,U),L.position.add(S),L.updateMatrix(),t.push({attributes:{_category:{value:"test"}},globalTransform:L.matrix.clone(),samples:[{localTransform:a,representation:i,material:s}]}),v.position.set(D,V+o.basePlateThickness,U),v.position.add(S),v.updateMatrix(),t.push({attributes:{_category:{value:"test"}},globalTransform:v.matrix.clone(),samples:[{localTransform:a,representation:I,material:s}]}),e.position.copy(v.position),e.rotation.set(0,0,0),(q===0||q===2)&&(e.rotation.y=Math.PI),e.updateMatrix(),t.push({attributes:{_category:{value:"test"}},globalTransform:e.matrix.clone(),samples:[{localTransform:a,representation:R,material:s}]}),q++}const N=_.clone().sub(k).normalize();e.position.copy(k),e.lookAt(_),e.position.set(0,0,0),e.updateMatrix();const he=E.transformPoints([...ue],e.matrix.clone());E.getExtrusion(ne,{profilePoints:he,direction:[N.x,N.y,N.z],length:k.distanceTo(_)});const be=r.core.editor.createShell(h.modelId,ne);e.position.copy(k),e.rotation.set(0,0,0),e.updateMatrix(),t.push({attributes:{_category:{value:"test"}},globalTransform:e.matrix.clone(),samples:[{localTransform:a,representation:be,material:s}]})}await r.core.editor.createElements(h.modelId,t),await r.core.update(!0),J=!1};let Z=null;const dt=1e3,mt=()=>{J||(J=!0,Z&&clearTimeout(Z),Z=setTimeout(()=>{lt()},dt))},K=()=>{const e=[],t=o.length/o.lengthModules;for(let s=0;s<o.lengthModules;s++)for(let a=0;a<o.startPoints.length;a++){const d=o.startPoints[a],[m,c,b]=d,l=b+t*s;e.push(new u(m,c,l))}for(let s=0;s<o.lengthModules-1;s++)for(let a=0;a<o.startPoints.length;a++){const d=o.startPoints[a],[m,c,b]=d;if(c===0)continue;const l=b+t*s,i=m,M=c,I=l+t;e.push(new u(m,c,l)),e.push(new u(i,M,I))}G.deleteAttribute("position"),G.setFromPoints(e),mt()};K();Be.init();const[O]=le.create(e=>de`
    <bim-panel style="min-width: 25rem;" id="controls-panel" active label="Element Editor" class="options-menu">

      <bim-panel-section label="Controls">

      <bim-number-input label="Length Modules" slider min=2 max=10 step=1 value=${o.lengthModules} @change=${t=>{o.lengthModules=t.target.value,K()}}></bim-number-input>

      <bim-number-input label="Length" slider min=10 max=100 step=1 value=${o.length} @change=${t=>{o.length=t.target.value,K()}}></bim-number-input>
      

      </bim-panel-section>

    </bim-panel>
  `,{});document.body.append(O);const pt=le.create(()=>de`
    <bim-button class="phone-menu-toggler" icon="solar:settings-bold"
      @click=${()=>{O.classList.contains("options-menu-visible")?O.classList.remove("options-menu-visible"):O.classList.add("options-menu-visible")}}>
    </bim-button>
  `);document.body.append(pt);const T=new Oe;T.showPanel(2);document.body.append(T.dom);T.dom.style.left="0px";T.dom.style.zIndex="unset";n.renderer.onBeforeUpdate.add(()=>T.begin());n.renderer.onAfterUpdate.add(()=>T.end());
