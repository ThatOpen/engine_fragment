import{C as Ue,W as Ne,fq as Re,fr as ze,fs as Ve,ft as Ye,fu as qe,gy as Xe,fY as Qe,V as c,fz as Ze,cb as Je,fE as Te,fx as ve,fH as y,fB as h,fI as Ke,c as pe,cr as et}from"./virtual-memory-controller-CejF-vhY.js";import{s as tt,S as q,a as ot}from"./index-Bt7oLB9d.js";import{a as nt,R as ke,m as X}from"./index-CWj6LyOo.js";import{S as rt}from"./stats.min-Cj8wREqt.js";import{G as it,P as st}from"./index-BVn1wLSv.js";const at=document.getElementById("container"),x=new Ue,lt=x.get(Ne),o=lt.create();o.scene=new Re(x);o.renderer=new tt(x,at);o.camera=new ze(x);x.init();o.camera.controls.setLookAt(50,50,50,0,0,0);o.renderer.three.shadowMap.enabled=!0;o.renderer.three.shadowMap.type=Ve;o.scene.setup({shadows:{cascade:1,resolution:1024}});const ct=o.scene.three.background;await o.scene.updateShadows();o.camera.controls.addEventListener("rest",async()=>{await o.scene.updateShadows()});const dt=new Ye(1);o.scene.three.add(dt);const e={width:20,length:30,columnLengthDistance:5,columnWidthDistance:5,floorHeight:4,exteriorColumnWidth:.5,exteriorColumnLength:.5,interiorColumnWidth:.25,interiorColumnLength:.25,floorThickness:.3,numberOfFloors:10,clipPlaneHeight:13.5,windowHeight:2,windowWidth:1},mt="https://thatopen.github.io/engine_fragment/resources/worker.mjs",ut=await fetch(mt),pt=await ut.blob(),ht=new File([pt],"worker.mjs",{type:"text/javascript"}),gt=URL.createObjectURL(ht),a=x.get(qe);a.init(gt);a.core.models.materials.list.onItemSet.add(({value:r})=>{"isLodMaterial"in r&&r.isLodMaterial||(r.polygonOffset=!0,r.polygonOffsetUnits=1,r.polygonOffsetFactor=Math.random())});a.core.settings.graphicsQuality=1;o.camera.controls.addEventListener("control",()=>{a.core.update()});a.core.models.list.onItemSet.add(({value:r})=>{r.tiles.onItemSet.add(({value:i})=>{"isMesh"in i&&i.material[0].opacity===1&&(i.castShadow=!0,i.receiveShadow=!0)}),r.getClippingPlanesEvent=()=>Array.from(o.renderer.three.clippingPlanes)||[]});o.renderer.postproduction.enabled=!0;o.renderer.postproduction.style=q.PEN_COLOR;const Ie=x.get(Xe),k=x.get(ot);k.world=o;const We=new Qe({color:2236962,side:2});o.renderer.postproduction.excludedObjectsEnabled=!0;o.renderer.postproduction.excludedObjectsPass.addExcludedMaterial(We);k.styles.set("BlackFill",{fillsMaterial:We});const He=Ie.createFromNormalAndCoplanarPoint(o,new c(0,-1,0),new c(0,e.clipPlaneHeight,0)),F=Ie.list.get(He);F.visible=!1;let O=null;const ft=()=>{const r=[...k.list.keys()];for(const i of r)k.list.delete(i);k.list.clear(),O=k.createFromClipping(He,{items:{All:{style:"BlackFill"}}})};let A=null;const wt=1e3,bt=()=>{F.setFromNormalAndCoplanarPoint(new c(0,-1,0),new c(0,e.clipPlaneHeight,0)),F.update(),A&&clearTimeout(A),A=setTimeout(()=>{if(F.onDraggingEnded.trigger(),O){O.three.frustumCulled=!1;for(const r of O.three.children)r.frustumCulled=!1}},wt)},yt=Ze.newModel({raw:!0}),m=await a.core.load(yt,{modelId:"example",camera:o.camera.three,raw:!0});o.scene.three.add(m.object);await a.core.update(!0);const Z=new Je;Z.SetWasmPath("https://unpkg.com/web-ifc@0.0.75/",!0);await Z.Init();const d=new it(Z),Se=new Te({color:"white",side:ve}),v=new y(new h,Se);o.scene.three.add(v);const I=new h,he=new h,ge=new h,fe=new h,we=new h,be=new h,Le=new h,B=new h,Ee=new h,ye=new h,xe=new h;let Q=!1;const Ce=new y(Le),U=new y(I),N=new y(I),R=new y(I),z=new y(I),V=new y(Ee),Fe=async()=>{const r=[];await a.core.editor.reset(m.modelId);const i=10,H=e.width+i*2,J=e.length+i*2;d.getExtrusion(v.geometry,{profilePoints:[0,0,0,0,0,J,H,0,J,H,0,0,0,0,0],direction:[0,1,0],cap:!0,length:e.floorThickness}),v.position.y=-.3,v.position.x=-10,v.position.z=-10,v.geometry.computeBoundingBox();const u=a.core.editor.createMaterial(m.modelId,new Te({color:new Ke(1,1,1),side:ve})),p=a.core.editor.createLocalTransform(m.modelId,new pe().identity()),K=e.width,ee=e.length,f=[new c(0,0,0),new c(e.width,0,0),new c(e.width,0,e.length),new c(0,0,e.length),new c(0,0,0)],te=e.width-e.exteriorColumnWidth,oe=e.length-e.exteriorColumnLength,S=[new c(0,0,0),new c(te,0,0),new c(te,0,oe),new c(0,0,oe)],ne=e.exteriorColumnLength,$=e.exteriorColumnWidth;d.getExtrusion(I,{profilePoints:[0,0,0,0,0,ne,$,0,ne,$,0,0],direction:[0,1,0],cap:!0,length:e.floorHeight});const Oe=a.core.editor.createShell(m.modelId,I),re=e.exteriorColumnLength*2,D=1-$;d.getExtrusion(ge,{profilePoints:[0,0,0,0,0,re,D,0,re,D,0,0,0,0,0],direction:[0,1,0],length:e.floorHeight});const ie=a.core.editor.createShell(m.modelId,ge),Ge=d.getProfilePoints({type:st.H,width:e.interiorColumnWidth,depth:e.interiorColumnLength,thickness:.03,flangeThickness:.02}),$e=d.transformPoints(Ge,new pe().makeRotationX(Math.PI/2));d.getExtrusion(he,{profilePoints:$e,direction:[0,1,0],length:e.floorHeight-e.floorThickness});const De=a.core.editor.createShell(m.modelId,he),P=3,L=5;d.getExtrusion(Ee,{profilePoints:[0,0,0,0,0,L,P,0,L,P,0,0],direction:[0,1,0],length:1}),V.position.set(0,-.5,0);const E=.2;d.getWall(ye,{start:[P,0,e.windowWidth],end:[P,e.floorHeight-e.floorThickness,L+E/2],direction:[0,1,0],elevation:0,offset:0,thickness:E,cuttingPlaneNormal:[0,0,0],cuttingPlanePosition:[0,0,0],height:e.floorHeight-e.floorThickness});const _e=a.core.editor.createShell(m.modelId,ye);d.getWall(xe,{start:[0,0,L],end:[P-E/2,0,L],direction:[0,1,0],elevation:0,offset:0,thickness:E,cuttingPlaneNormal:[0,0,0],cuttingPlanePosition:[0,0,0],height:e.floorHeight-e.floorThickness});const je=a.core.editor.createShell(m.modelId,xe);d.getExtrusion(Le,{profilePoints:[0,0,0,0,0,ee,K,0,ee,K,0,0],direction:[0,1,0],cap:!0,length:e.floorThickness}),U.position.copy(S[0]),N.position.copy(S[1]),R.position.copy(S[2]),z.position.copy(S[3]),Ce.updateMatrixWorld(!0),U.updateMatrixWorld(!0),N.updateMatrixWorld(!0),R.updateMatrixWorld(!0),z.updateMatrixWorld(!0),V.updateMatrixWorld(!0),d.getBooleanOperation(B,{target:Ce,operands:[U,N,R,z,V],type:"DIFFERENCE"});const se=new y(B,Se);o.scene.three.add(se),se.position.y+=10;const Ae=a.core.editor.createShell(m.modelId,B);d.getSweep(fe,{profilePoints:[0,0,0,.1,0,0,.1,.1,0,0,.1,0,0,0,0],curvePoints:[0,0,0,0,e.windowHeight,0,e.windowWidth,e.windowHeight,0,e.windowWidth,0,0,0,0,0]});const ae=a.core.editor.createShell(m.modelId,fe),le=e.floorHeight-e.windowHeight;d.getExtrusion(we,{profilePoints:[0,0,0,0,le,0,e.windowWidth,le,0,e.windowWidth,0,0],direction:[0,0,1],cap:!0,length:e.floorThickness});const ce=a.core.editor.createShell(m.modelId,we),de=.15,me=.2;d.getSweep(be,{profilePoints:[0,0,0,1,0,0,1,de,0,0,de,0,0,0,0],curvePoints:[0,0,0,0,0,me,0,e.windowHeight,me,0,e.windowHeight,0]});const Be=a.core.editor.createShell(m.modelId,be),t=new et;for(const n of S)for(let s=0;s<e.numberOfFloors;s++)t.position.copy(n),t.position.y=s*e.floorHeight,t.updateMatrix(),r.push({attributes:{_category:{value:"test"}},globalTransform:t.matrix.clone(),samples:[{localTransform:p,representation:Oe,material:u}]});const ue=[],_=Math.floor(e.length/e.columnLengthDistance),j=Math.floor(e.width/e.columnWidthDistance);for(let n=0;n<=_;n++){const s=n*e.columnLengthDistance;for(let l=0;l<=j;l++){if(n===0&&l===0||n===0&&l===j||n===_&&l===0||n===_&&l===j)continue;const M=l*e.columnWidthDistance;ue.push(new c(M,0,s))}}for(const n of ue)for(let s=0;s<e.numberOfFloors;s++)t.position.copy(n),t.position.y=s*e.floorHeight,t.updateMatrix(),r.push({attributes:{_category:{value:"test"}},globalTransform:t.matrix.clone(),samples:[{localTransform:p,representation:De,material:u}]});for(let n=0;n<e.numberOfFloors;n++){const s=(n+1)*e.floorHeight-e.floorThickness;t.position.set(0,s,0),t.updateMatrix(),r.push({attributes:{_category:{value:"test"}},globalTransform:t.matrix.clone(),samples:[{localTransform:p,representation:Ae,material:u}]})}for(let n=0;n<e.numberOfFloors;n++)t.position.set(0,n*e.floorHeight,0),t.rotation.set(0,0,0),t.updateMatrix(),r.push({attributes:{_category:{value:"test"}},globalTransform:t.matrix.clone(),samples:[{localTransform:p,representation:_e,material:u}]}),r.push({attributes:{_category:{value:"test"}},globalTransform:t.matrix.clone(),samples:[{localTransform:p,representation:je,material:u}]}),t.position.set(P,n*e.floorHeight,e.windowWidth),t.rotation.y=Math.PI/2,t.updateMatrix(),r.push({attributes:{_category:{value:"test"}},globalTransform:t.matrix.clone(),samples:[{localTransform:p,representation:ae,material:u}]}),t.position.y+=e.windowHeight,t.position.x-=.1,t.updateMatrix(),r.push({attributes:{_category:{value:"test"}},globalTransform:t.matrix.clone(),samples:[{localTransform:p,representation:ce,material:u}]});for(let n=0;n<e.numberOfFloors;n++)for(let s=0;s<f.length-1;s++){const l=f[s],g=f[s+1],b=g.clone().sub(l).normalize(),w=l.distanceTo(g),C=new c;C.crossVectors(b,new c(0,1,0)),t.position.copy(l),t.lookAt(g),t.rotateY(-Math.PI/2),t.position.add(b.clone().multiplyScalar(e.exteriorColumnLength)),t.position.add(C.clone().multiplyScalar(-.5/2)),t.position.y=n*e.floorHeight,t.updateMatrix(),r.push({attributes:{_category:{value:"test"}},globalTransform:t.matrix.clone(),samples:[{localTransform:p,representation:ie,material:u}]});const M=w-2+D;t.position.add(b.clone().multiplyScalar(M)),t.updateMatrix(),r.push({attributes:{_category:{value:"test"}},globalTransform:t.matrix.clone(),samples:[{localTransform:p,representation:ie,material:u}]})}for(let n=0;n<e.numberOfFloors;n++)for(let s=0;s<f.length-1;s++){const l=f[s],g=f[s+1],b=l.distanceTo(g),w=g.clone().sub(l).normalize();for(let C=1;C<b-1;C++){t.position.copy(l),t.lookAt(g),t.rotateY(-Math.PI/2),t.position.add(w.clone().multiplyScalar(C)),t.position.y=n*e.floorHeight,t.updateMatrix();const M=new c;M.crossVectors(w,new c(0,1,0)),r.push({attributes:{_category:{value:"test"}},globalTransform:t.matrix.clone(),samples:[{localTransform:p,representation:ae,material:u}]}),t.position.y+=e.windowHeight,t.position.add(M.clone().multiplyScalar(-.3)),t.updateMatrix(),r.push({attributes:{_category:{value:"test"}},globalTransform:t.matrix.clone(),samples:[{localTransform:p,representation:ce,material:u}]})}}for(let n=0;n<f.length-1;n++){const s=f[n],l=f[n+1],g=s.distanceTo(l),b=l.clone().sub(s).normalize();for(let w=0;w<g;w++)t.position.copy(s),t.lookAt(l),t.rotateY(Math.PI/2),t.position.add(b.clone().multiplyScalar(w)),t.position.y=e.floorHeight*e.numberOfFloors,t.updateMatrix(),r.push({attributes:{_category:{value:"test"}},globalTransform:t.matrix.clone(),samples:[{localTransform:p,representation:Be,material:u}]})}await a.core.editor.createElements(m.modelId,r),ft(),await a.core.update(!0),Q=!1};await Fe();let Y=null;const xt=1e3,T=async()=>{Q||(Q=!0,Y&&clearTimeout(Y),Y=setTimeout(()=>{Fe()},xt))},Ct=[[0,"Model"],[1,"Plan"]],Pe=r=>{for(const[,i]of a.core.models.list)i.useCamera(r);o.renderer.postproduction.updateCamera()};let Me=0;const Pt=async r=>{Me=r,Me===0?(o.camera.controls.setLookAt(50,50,50,0,0,0),await o.camera.projection.set("Perspective"),await o.camera.set("Orbit"),o.scene.three.background=ct,o.renderer.postproduction.style=q.COLOR_PEN,o.scene.shadowsEnabled=!0,Pe(o.camera.three)):(o.camera.controls.setLookAt(5,5,5,5,0,5),await o.camera.projection.set("Orthographic"),await o.camera.set("Plan"),o.renderer.postproduction.style=q.PEN,o.scene.three.background=null,o.scene.shadowsEnabled=!1,Pe(o.camera.three))};nt.init();const[G]=ke.create(r=>X`
    <bim-panel style="min-width: 25rem;" id="controls-panel" active label="Element Editor" class="options-menu">

      <bim-panel-section label="Controls">

      <bim-dropdown label="View mode" @change=${i=>{Pt(i.target.value[0])}}>
        ${Ct.map(([i,H])=>X`<bim-option label=${H} ?checked=${i===0} value=${i}></bim-option>`)}
      </bim-dropdown>

      <bim-number-input label="Width" slider min=20 max=50 step=1 value=${e.width} @change=${i=>{e.width=i.target.value,T()}}></bim-number-input>

      <bim-number-input label="Length" slider min=20 max=50 step=1 value=${e.length} @change=${i=>{e.length=i.target.value,T()}}></bim-number-input>

      <bim-number-input label="Floor Height" slider min=3 max=5 step=0.1 value=${e.floorHeight} @change=${i=>{e.floorHeight=i.target.value,T()}}></bim-number-input>

      <bim-number-input label="Number of floors" slider min=2 max=40 step=1 value=${e.numberOfFloors} @change=${i=>{e.numberOfFloors=i.target.value,T()}}></bim-number-input>

      <bim-number-input label="Column Length Distance" slider min=5 max=10 step=1 value=${e.columnLengthDistance} @change=${i=>{e.columnLengthDistance=i.target.value,T()}}></bim-number-input>
      
      <bim-number-input label="Column Width Distance" slider min=5 max=10 step=1 value=${e.columnWidthDistance} @change=${i=>{e.columnWidthDistance=i.target.value,T()}}></bim-number-input>

      <bim-number-input label="Clip Plane Height" slider min=0 max=100 step=0.1 value=${e.clipPlaneHeight} @change=${i=>{e.clipPlaneHeight=i.target.value,bt()}}></bim-number-input>

      </bim-panel-section>

    </bim-panel>
  `,{});document.body.append(G);const Mt=ke.create(()=>X`
    <bim-button class="phone-menu-toggler" icon="solar:settings-bold"
      @click=${()=>{G.classList.contains("options-menu-visible")?G.classList.remove("options-menu-visible"):G.classList.add("options-menu-visible")}}>
    </bim-button>
  `);document.body.append(Mt);const W=new rt;W.showPanel(2);document.body.append(W.dom);W.dom.style.left="0px";W.dom.style.zIndex="unset";o.renderer.onBeforeUpdate.add(()=>W.begin());o.renderer.onAfterUpdate.add(()=>W.end());
