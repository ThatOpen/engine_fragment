import{C as B,W as F,cu as G,a as N,cv as O,cx as P,cw as k,V as D,cM as z,cQ as J,cE as U,cz as q,cR as K,cA as x,cC as V,cS as v,cJ as A}from"./virtual-memory-controller-ZSRKHGNY.js";import{R as W}from"./RGBELoader-Dncwvf9Q.js";import{F as H}from"./index-CqDgYQyW.js";const Q=document.getElementById("container"),l=new B,X=l.get(F),e=X.create();e.scene=new G(l);e.renderer=new N(l,Q);e.camera=new O(l);l.init();const Y=new P(10);e.scene.three.add(Y);e.camera.controls.setLookAt(12,6,8,0,0,-10);e.renderer.three.shadowMap.enabled=!0;e.renderer.three.shadowMap.type=k;e.scene.setup({directionalLight:{color:new z(1,1,1),position:new D(5,10,5),intensity:4},shadows:{cascade:1,resolution:1024}});e.renderer.three.toneMapping=J;e.renderer.three.toneMappingExposure=1;await e.scene.updateShadows();e.camera.controls.addEventListener("rest",async()=>{await e.scene.updateShadows()});const Z=new W;Z.load("/resources/textures/envmaps/san_giuseppe_bridge_2k.hdr",t=>{t.mapping=U,e.scene.three.environment=t});const $="../../src/multithreading/fragments-thread.ts",r=new H($);e.camera.controls.addEventListener("control",()=>r.update());const g=t=>{t.wrapS=A,t.wrapT=A,t.repeat.set(.1,.1)},h=new q,y=h.load("/resources/textures/concrete/Concrete012_2K-JPG_Color.jpg");y.colorSpace=K;g(y);const T=h.load("/resources/textures/concrete/Concrete012_2K-JPG_NormalGL.jpg");g(T);const f=h.load("/resources/textures/concrete/Concrete012_2K-JPG_Roughness.jpg");g(f);r.models.materials.list.onItemSet.add(({key:t,value:a})=>{if("map"in a){if(a.color.r===1&&a.color.g===0&&a.color.b===0){const d=new x({color:a.color,metalness:.9,roughnessMap:f,roughness:1});r.models.materials.list.set(t,d);return}const o=new x({color:a.color,map:y,normalMap:T,roughnessMap:f,roughness:1});r.models.materials.list.set(t,o)}});r.models.list.onItemSet.add(({value:t})=>{t.tiles.onItemSet.add(({value:a})=>{if(!("isLODGeometry"in a.geometry)){const o=a.geometry;a.castShadow=!0,a.receiveShadow=!0;const d=o.index.array,i=o.attributes.position.array,m=o.attributes.normal.array,n=new Float32Array(i.length/3*2);for(let p=0;p<d.length;p++){const s=d[p],S=i[s*3],I=i[s*3+1],C=i[s*3+2],R=m[s*3],_=m[s*3+1],j=m[s*3+2],u=Math.abs(R),w=Math.abs(_),E=Math.abs(j);u>w&&u>E?(n[s*2]=I,n[s*2+1]=C):w>u&&w>E?(n[s*2]=S,n[s*2+1]=C):(n[s*2]=S,n[s*2+1]=I)}const M=new V(n,2);M.onUpload(function(){delete this.array}),o.setAttribute("uv",M)}})});const ee=await fetch("/resources/frags/school_str.frag"),te=await ee.arrayBuffer(),c=await r.load(te,{modelId:"test",camera:e.camera.three});e.scene.three.add(c.object);const ae=await c.getItemsOfCategories([/IFCCOLUMN/,/IFCBEAM/,/IFCMEMBER/]),se=Object.values(ae).flat(),L=new Set;for(const t of se)(await c.getItemsData([t],{attributes:["Name","NominalValue"],relations:{IsDefinedBy:{attributes:!0,relations:!0},DefinesOcurrence:{attributes:!1,relations:!1}}}))[0].ObjectType.value.includes("Concrete")||L.add(t);const b=[],re={r:255,g:0,b:0,a:255,renderedFaces:0,stroke:0};b.push({type:v.CREATE_MATERIAL,tempId:"new-material",data:re});const oe=new Set(await c.getGlobalTranformsIdsOfItems(Array.from(L))),ne=await c.getSamples();for(const[t,a]of ne)oe.has(a.item)&&b.push({type:v.UPDATE_SAMPLE,localId:t,data:{...a,material:"new-material"}});await r.editor.edit(c.modelId,b);await r.update(!0);
