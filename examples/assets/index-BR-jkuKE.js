import{V as N,cN as ze,da as at,dn as pt,d9 as Le,c$ as gr,j as Te,dC as un,dl as Ji,dk as lt,dj as $i,dm as Ns,dh as ds,dD as Is,dE as ol,I as Ir,dF as al,dG as Ve,dH as Me,T as ii,dI as Wo,cF as st,cL as ie,cM as fe,d0 as us,cB as Nt,dJ as ll,dK as hl,cC as Lt,d3 as qt,dL as Xo,dr as cl,dp as dl,cH as Zo,cG as Yo,cI as rn,L as ul,d7 as vr,di as Xe,du as pl,dt as qo,d1 as Ke,O as hi,dM as fl,dN as kr,dq as pi,dO as ml,db as gl,dd as vl,de as Qn,df as Ms,dg as _l,dP as yl,dQ as wl,d2 as qe,cO as Ct,cs as Go,dR as bl,Q as yt,dS as xl,dy as Lr,c_ as El,d4 as gi,d5 as Vs,cP as Sl,d6 as Tl,dT as Cl,dU as _r,dV as Nr,dW as Ut,cU as ci,dX as Mt,dY as Al,dZ as vi,d_ as _i,d$ as Ur,e0 as Br,e1 as Pl,e2 as Ol,e3 as Dl,e4 as Ml,e5 as on,e6 as Qo,e7 as di,e8 as Ko,cJ as an,e9 as Rr,cY as It,ea as zl,eb as Il,ec as kl,ed as Ll,ee as Nl,ef as Ul,eg as Bl,eh as Rl,cQ as Fl,ei as Vl}from"./virtual-memory-controller-ZSRKHGNY.js";var jl=Object.defineProperty,Hl=(a,e,t)=>e in a?jl(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,T=(a,e,t)=>(Hl(a,typeof e!="symbol"?e+"":e,t),t),Wl=Object.defineProperty,Xl=(a,e,t)=>e in a?Wl(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,x=(a,e,t)=>(Xl(a,typeof e!="symbol"?e+"":e,t),t);let Q=class{constructor(){x(this,"enabled",!0),x(this,"trigger",a=>{if(!this.enabled)return;const e=this.handlers.slice(0);for(const t of e)t(a)}),x(this,"handlers",[])}add(a){this.handlers.push(a)}remove(a){this.handlers=this.handlers.filter(e=>e!==a)}reset(){this.handlers.length=0}};class yr{constructor(e){x(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),x(this,"isResizeable",()=>"resize"in this&&"getSize"in this),x(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),x(this,"isHideable",()=>"visible"in this),x(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),x(this,"isSerializable",()=>"import"in this&&"export"in this),this.components=e}}class Ee extends yr{}class Jo extends yr{constructor(e){super(e),x(this,"worlds",new Me),x(this,"onWorldChanged",new Q),x(this,"_currentWorld",null),this.onWorldChanged.add(({world:t,action:s})=>{s==="removed"&&this.worlds.delete(t.uuid)})}set currentWorld(e){this._currentWorld=e}get currentWorld(){return this._currentWorld}}class Zl extends Jo{constructor(){super(...arguments),x(this,"hasCameraControls",()=>"controls"in this)}}class Yl extends Jo{constructor(){super(...arguments),x(this,"onAfterUpdate",new Q),x(this,"onBeforeUpdate",new Q),x(this,"onDisposed",new Q),x(this,"onResize",new Q),x(this,"onClippingPlanesUpdated",new Q),x(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(e,t,s){t.isLocal=s;const i=this.clippingPlanes.indexOf(t);e&&i===-1?this.clippingPlanes.push(t):!e&&i>-1&&this.clippingPlanes.splice(i,1),this.three.clippingPlanes=this.clippingPlanes.filter(n=>!n.isLocal)}}const $o=class Kn extends Ee{constructor(e){super(e),x(this,"_disposedComponents",new Set),x(this,"enabled",!0),e.add(Kn.uuid,this)}get(){return this._disposedComponents}destroy(e,t=!0,s=!0){e.removeFromParent();const i=e;i.dispose&&i.dispose(),this.disposeGeometryAndMaterials(e,t),s&&i.children&&i.children.length&&this.disposeChildren(i),e.children.length=0}disposeGeometry(e){e.boundsTree&&e.disposeBoundsTree&&e.disposeBoundsTree(),e.dispose()}disposeGeometryAndMaterials(e,t){const s=e;s.geometry&&this.disposeGeometry(s.geometry),t&&s.material&&Kn.disposeMaterial(s),s.material=[],s.geometry=null}disposeChildren(e){for(const t of e.children)this.destroy(t)}static disposeMaterial(e){if(e.material)if(Array.isArray(e.material))for(const t of e.material)t.dispose();else e.material.dispose()}};x($o,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let Ot=$o;class wn extends Set{constructor(e){super(e),x(this,"onItemAdded",new Q),x(this,"onItemDeleted",new Q),x(this,"onCleared",new Q),x(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}add(...e){for(const t of e)this.has(t)||!this.guard(t)||(super.add(t),this.onItemAdded||(this.onItemAdded=new Q),this.onItemAdded.trigger(t));return this}delete(e){const t=super.delete(e);return t&&this.onItemDeleted.trigger(),t}dispose(){this.clear(),this.onItemAdded.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}}const wr=class Re{static create(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return`${Re._lut[e&255]+Re._lut[e>>8&255]+Re._lut[e>>16&255]+Re._lut[e>>24&255]}-${Re._lut[t&255]}${Re._lut[t>>8&255]}-${Re._lut[t>>16&15|64]}${Re._lut[t>>24&255]}-${Re._lut[s&63|128]}${Re._lut[s>>8&255]}-${Re._lut[s>>16&255]}${Re._lut[s>>24&255]}${Re._lut[i&255]}${Re._lut[i>>8&255]}${Re._lut[i>>16&255]}${Re._lut[i>>24&255]}`.toLowerCase()}static validate(e){if(!Re._pattern.test(e))throw new Error(`${e} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};x(wr,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/);x(wr,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let Ze=wr;var yi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ql(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var ea={},pn={};(function(a){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",t=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",s="["+e+"]["+t+"]*",i=new RegExp("^"+s+"$"),n=function(o,l){const h=[];let c=l.exec(o);for(;c;){const u=[];u.startIndex=l.lastIndex-c[0].length;const f=c.length;for(let d=0;d<f;d++)u.push(c[d]);h.push(u),c=l.exec(o)}return h},r=function(o){const l=i.exec(o);return!(l===null||typeof l>"u")};a.isExist=function(o){return typeof o<"u"},a.isEmptyObject=function(o){return Object.keys(o).length===0},a.merge=function(o,l,h){if(l){const c=Object.keys(l),u=c.length;for(let f=0;f<u;f++)h==="strict"?o[c[f]]=[l[c[f]]]:o[c[f]]=l[c[f]]}},a.getValue=function(o){return a.isExist(o)?o:""},a.isName=r,a.getAllMatches=n,a.nameRegexp=s})(pn);const br=pn,Gl={allowBooleanAttributes:!1,unpairedTags:[]};ea.validate=function(a,e){e=Object.assign({},Gl,e);const t=[];let s=!1,i=!1;a[0]==="\uFEFF"&&(a=a.substr(1));for(let n=0;n<a.length;n++)if(a[n]==="<"&&a[n+1]==="?"){if(n+=2,n=Vr(a,n),n.err)return n}else if(a[n]==="<"){let r=n;if(n++,a[n]==="!"){n=jr(a,n);continue}else{let o=!1;a[n]==="/"&&(o=!0,n++);let l="";for(;n<a.length&&a[n]!==">"&&a[n]!==" "&&a[n]!=="	"&&a[n]!==`
`&&a[n]!=="\r";n++)l+=a[n];if(l=l.trim(),l[l.length-1]==="/"&&(l=l.substring(0,l.length-1),n--),!ih(l)){let u;return l.trim().length===0?u="Invalid space after '<'.":u="Tag '"+l+"' is an invalid name.",ke("InvalidTag",u,Je(a,n))}const h=Jl(a,n);if(h===!1)return ke("InvalidAttr","Attributes for '"+l+"' have open quote.",Je(a,n));let c=h.value;if(n=h.index,c[c.length-1]==="/"){const u=n-c.length;c=c.substring(0,c.length-1);const f=Hr(c,e);if(f===!0)s=!0;else return ke(f.err.code,f.err.msg,Je(a,u+f.err.line))}else if(o)if(h.tagClosed){if(c.trim().length>0)return ke("InvalidTag","Closing tag '"+l+"' can't have attributes or invalid starting.",Je(a,r));if(t.length===0)return ke("InvalidTag","Closing tag '"+l+"' has not been opened.",Je(a,r));{const u=t.pop();if(l!==u.tagName){let f=Je(a,u.tagStartPos);return ke("InvalidTag","Expected closing tag '"+u.tagName+"' (opened in line "+f.line+", col "+f.col+") instead of closing tag '"+l+"'.",Je(a,r))}t.length==0&&(i=!0)}}else return ke("InvalidTag","Closing tag '"+l+"' doesn't have proper closing.",Je(a,n));else{const u=Hr(c,e);if(u!==!0)return ke(u.err.code,u.err.msg,Je(a,n-c.length+u.err.line));if(i===!0)return ke("InvalidXml","Multiple possible root nodes found.",Je(a,n));e.unpairedTags.indexOf(l)!==-1||t.push({tagName:l,tagStartPos:r}),s=!0}for(n++;n<a.length;n++)if(a[n]==="<")if(a[n+1]==="!"){n++,n=jr(a,n);continue}else if(a[n+1]==="?"){if(n=Vr(a,++n),n.err)return n}else break;else if(a[n]==="&"){const u=th(a,n);if(u==-1)return ke("InvalidChar","char '&' is not expected.",Je(a,n));n=u}else if(i===!0&&!Fr(a[n]))return ke("InvalidXml","Extra text at the end",Je(a,n));a[n]==="<"&&n--}}else{if(Fr(a[n]))continue;return ke("InvalidChar","char '"+a[n]+"' is not expected.",Je(a,n))}if(s){if(t.length==1)return ke("InvalidTag","Unclosed tag '"+t[0].tagName+"'.",Je(a,t[0].tagStartPos));if(t.length>0)return ke("InvalidXml","Invalid '"+JSON.stringify(t.map(n=>n.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return ke("InvalidXml","Start tag expected.",1);return!0};function Fr(a){return a===" "||a==="	"||a===`
`||a==="\r"}function Vr(a,e){const t=e;for(;e<a.length;e++)if(a[e]=="?"||a[e]==" "){const s=a.substr(t,e-t);if(e>5&&s==="xml")return ke("InvalidXml","XML declaration allowed only at the start of the document.",Je(a,e));if(a[e]=="?"&&a[e+1]==">"){e++;break}else continue}return e}function jr(a,e){if(a.length>e+5&&a[e+1]==="-"&&a[e+2]==="-"){for(e+=3;e<a.length;e++)if(a[e]==="-"&&a[e+1]==="-"&&a[e+2]===">"){e+=2;break}}else if(a.length>e+8&&a[e+1]==="D"&&a[e+2]==="O"&&a[e+3]==="C"&&a[e+4]==="T"&&a[e+5]==="Y"&&a[e+6]==="P"&&a[e+7]==="E"){let t=1;for(e+=8;e<a.length;e++)if(a[e]==="<")t++;else if(a[e]===">"&&(t--,t===0))break}else if(a.length>e+9&&a[e+1]==="["&&a[e+2]==="C"&&a[e+3]==="D"&&a[e+4]==="A"&&a[e+5]==="T"&&a[e+6]==="A"&&a[e+7]==="["){for(e+=8;e<a.length;e++)if(a[e]==="]"&&a[e+1]==="]"&&a[e+2]===">"){e+=2;break}}return e}const Ql='"',Kl="'";function Jl(a,e){let t="",s="",i=!1;for(;e<a.length;e++){if(a[e]===Ql||a[e]===Kl)s===""?s=a[e]:s!==a[e]||(s="");else if(a[e]===">"&&s===""){i=!0;break}t+=a[e]}return s!==""?!1:{value:t,index:e,tagClosed:i}}const $l=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function Hr(a,e){const t=br.getAllMatches(a,$l),s={};for(let i=0;i<t.length;i++){if(t[i][1].length===0)return ke("InvalidAttr","Attribute '"+t[i][2]+"' has no space in starting.",js(t[i]));if(t[i][3]!==void 0&&t[i][4]===void 0)return ke("InvalidAttr","Attribute '"+t[i][2]+"' is without value.",js(t[i]));if(t[i][3]===void 0&&!e.allowBooleanAttributes)return ke("InvalidAttr","boolean attribute '"+t[i][2]+"' is not allowed.",js(t[i]));const n=t[i][2];if(!sh(n))return ke("InvalidAttr","Attribute '"+n+"' is an invalid name.",js(t[i]));if(!s.hasOwnProperty(n))s[n]=1;else return ke("InvalidAttr","Attribute '"+n+"' is repeated.",js(t[i]))}return!0}function eh(a,e){let t=/\d/;for(a[e]==="x"&&(e++,t=/[\da-fA-F]/);e<a.length;e++){if(a[e]===";")return e;if(!a[e].match(t))break}return-1}function th(a,e){if(e++,a[e]===";")return-1;if(a[e]==="#")return e++,eh(a,e);let t=0;for(;e<a.length;e++,t++)if(!(a[e].match(/\w/)&&t<20)){if(a[e]===";")break;return-1}return e}function ke(a,e,t){return{err:{code:a,msg:e,line:t.line||t,col:t.col}}}function sh(a){return br.isName(a)}function ih(a){return br.isName(a)}function Je(a,e){const t=a.substring(0,e).split(/\r?\n/);return{line:t.length,col:t[t.length-1].length+1}}function js(a){return a.startIndex+a[1].length}var xr={};const ta={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(a,e){return e},attributeValueProcessor:function(a,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(a,e,t){return a}},nh=function(a){return Object.assign({},ta,a)};xr.buildOptions=nh;xr.defaultOptions=ta;class rh{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}var oh=rh;const ah=pn;function lh(a,e){const t={};if(a[e+3]==="O"&&a[e+4]==="C"&&a[e+5]==="T"&&a[e+6]==="Y"&&a[e+7]==="P"&&a[e+8]==="E"){e=e+9;let s=1,i=!1,n=!1,r="";for(;e<a.length;e++)if(a[e]==="<"&&!n){if(i&&dh(a,e))e+=7,[entityName,val,e]=hh(a,e+1),val.indexOf("&")===-1&&(t[mh(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(i&&uh(a,e))e+=8;else if(i&&ph(a,e))e+=8;else if(i&&fh(a,e))e+=9;else if(ch)n=!0;else throw new Error("Invalid DOCTYPE");s++,r=""}else if(a[e]===">"){if(n?a[e-1]==="-"&&a[e-2]==="-"&&(n=!1,s--):s--,s===0)break}else a[e]==="["?i=!0:r+=a[e];if(s!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:t,i:e}}function hh(a,e){let t="";for(;e<a.length&&a[e]!=="'"&&a[e]!=='"';e++)t+=a[e];if(t=t.trim(),t.indexOf(" ")!==-1)throw new Error("External entites are not supported");const s=a[e++];let i="";for(;e<a.length&&a[e]!==s;e++)i+=a[e];return[t,i,e]}function ch(a,e){return a[e+1]==="!"&&a[e+2]==="-"&&a[e+3]==="-"}function dh(a,e){return a[e+1]==="!"&&a[e+2]==="E"&&a[e+3]==="N"&&a[e+4]==="T"&&a[e+5]==="I"&&a[e+6]==="T"&&a[e+7]==="Y"}function uh(a,e){return a[e+1]==="!"&&a[e+2]==="E"&&a[e+3]==="L"&&a[e+4]==="E"&&a[e+5]==="M"&&a[e+6]==="E"&&a[e+7]==="N"&&a[e+8]==="T"}function ph(a,e){return a[e+1]==="!"&&a[e+2]==="A"&&a[e+3]==="T"&&a[e+4]==="T"&&a[e+5]==="L"&&a[e+6]==="I"&&a[e+7]==="S"&&a[e+8]==="T"}function fh(a,e){return a[e+1]==="!"&&a[e+2]==="N"&&a[e+3]==="O"&&a[e+4]==="T"&&a[e+5]==="A"&&a[e+6]==="T"&&a[e+7]==="I"&&a[e+8]==="O"&&a[e+9]==="N"}function mh(a){if(ah.isName(a))return a;throw new Error(`Invalid entity name ${a}`)}var gh=lh;const vh=/^[-+]?0x[a-fA-F0-9]+$/,_h=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,yh={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function wh(a,e={}){if(e=Object.assign({},yh,e),!a||typeof a!="string")return a;let t=a.trim();if(e.skipLike!==void 0&&e.skipLike.test(t))return a;if(a==="0")return 0;if(e.hex&&vh.test(t))return xh(t,16);if(t.search(/[eE]/)!==-1){const s=t.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(s){if(e.leadingZeros)t=(s[1]||"")+s[3];else if(!(s[2]==="0"&&s[3][0]==="."))return a;return e.eNotation?Number(t):a}else return a}else{const s=_h.exec(t);if(s){const i=s[1],n=s[2];let r=bh(s[3]);if(!e.leadingZeros&&n.length>0&&i&&t[2]!=="."||!e.leadingZeros&&n.length>0&&!i&&t[1]!==".")return a;if(e.leadingZeros&&n===a)return 0;{const o=Number(t),l=""+o;return l.search(/[eE]/)!==-1?e.eNotation?o:a:t.indexOf(".")!==-1?l==="0"&&r===""||l===r||i&&l==="-"+r?o:a:n?r===l||i+r===l?o:a:t===l||t===i+l?o:a}}else return a}}function bh(a){return a&&a.indexOf(".")!==-1&&(a=a.replace(/0+$/,""),a==="."?a="0":a[0]==="."?a="0"+a:a[a.length-1]==="."&&(a=a.substr(0,a.length-1))),a}function xh(a,e){if(parseInt)return parseInt(a,e);if(Number.parseInt)return Number.parseInt(a,e);if(window&&window.parseInt)return window.parseInt(a,e);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}var Eh=wh;const sa=pn,Hs=oh,Sh=gh,Th=Eh;let Ch=class{constructor(a){this.options=a,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,16))}},this.addExternalEntities=Ah,this.parseXml=zh,this.parseTextData=Ph,this.resolveNameSpace=Oh,this.buildAttributesMap=Mh,this.isItStopNode=Nh,this.replaceEntitiesValue=kh,this.readStopNodeData=Bh,this.saveTextToParentTag=Lh,this.addChild=Ih}};function Ah(a){const e=Object.keys(a);for(let t=0;t<e.length;t++){const s=e[t];this.lastEntities[s]={regex:new RegExp("&"+s+";","g"),val:a[s]}}}function Ph(a,e,t,s,i,n,r){if(a!==void 0&&(this.options.trimValues&&!s&&(a=a.trim()),a.length>0)){r||(a=this.replaceEntitiesValue(a));const o=this.options.tagValueProcessor(e,a,t,i,n);return o==null?a:typeof o!=typeof a||o!==a?o:this.options.trimValues?$n(a,this.options.parseTagValue,this.options.numberParseOptions):a.trim()===a?$n(a,this.options.parseTagValue,this.options.numberParseOptions):a}}function Oh(a){if(this.options.removeNSPrefix){const e=a.split(":"),t=a.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(a=t+e[1])}return a}const Dh=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function Mh(a,e,t){if(!this.options.ignoreAttributes&&typeof a=="string"){const s=sa.getAllMatches(a,Dh),i=s.length,n={};for(let r=0;r<i;r++){const o=this.resolveNameSpace(s[r][1]);let l=s[r][4],h=this.options.attributeNamePrefix+o;if(o.length)if(this.options.transformAttributeName&&(h=this.options.transformAttributeName(h)),h==="__proto__"&&(h="#__proto__"),l!==void 0){this.options.trimValues&&(l=l.trim()),l=this.replaceEntitiesValue(l);const c=this.options.attributeValueProcessor(o,l,e);c==null?n[h]=l:typeof c!=typeof l||c!==l?n[h]=c:n[h]=$n(l,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(n[h]=!0)}if(!Object.keys(n).length)return;if(this.options.attributesGroupName){const r={};return r[this.options.attributesGroupName]=n,r}return n}}const zh=function(a){a=a.replace(/\r\n?/g,`
`);const e=new Hs("!xml");let t=e,s="",i="";for(let n=0;n<a.length;n++)if(a[n]==="<")if(a[n+1]==="/"){const r=as(a,">",n,"Closing Tag is not closed.");let o=a.substring(n+2,r).trim();if(this.options.removeNSPrefix){const c=o.indexOf(":");c!==-1&&(o=o.substr(c+1))}this.options.transformTagName&&(o=this.options.transformTagName(o)),t&&(s=this.saveTextToParentTag(s,t,i));const l=i.substring(i.lastIndexOf(".")+1);if(o&&this.options.unpairedTags.indexOf(o)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${o}>`);let h=0;l&&this.options.unpairedTags.indexOf(l)!==-1?(h=i.lastIndexOf(".",i.lastIndexOf(".")-1),this.tagsNodeStack.pop()):h=i.lastIndexOf("."),i=i.substring(0,h),t=this.tagsNodeStack.pop(),s="",n=r}else if(a[n+1]==="?"){let r=Jn(a,n,!1,"?>");if(!r)throw new Error("Pi Tag is not closed.");if(s=this.saveTextToParentTag(s,t,i),!(this.options.ignoreDeclaration&&r.tagName==="?xml"||this.options.ignorePiTags)){const o=new Hs(r.tagName);o.add(this.options.textNodeName,""),r.tagName!==r.tagExp&&r.attrExpPresent&&(o[":@"]=this.buildAttributesMap(r.tagExp,i,r.tagName)),this.addChild(t,o,i)}n=r.closeIndex+1}else if(a.substr(n+1,3)==="!--"){const r=as(a,"-->",n+4,"Comment is not closed.");if(this.options.commentPropName){const o=a.substring(n+4,r-2);s=this.saveTextToParentTag(s,t,i),t.add(this.options.commentPropName,[{[this.options.textNodeName]:o}])}n=r}else if(a.substr(n+1,2)==="!D"){const r=Sh(a,n);this.docTypeEntities=r.entities,n=r.i}else if(a.substr(n+1,2)==="!["){const r=as(a,"]]>",n,"CDATA is not closed.")-2,o=a.substring(n+9,r);s=this.saveTextToParentTag(s,t,i);let l=this.parseTextData(o,t.tagname,i,!0,!1,!0,!0);l==null&&(l=""),this.options.cdataPropName?t.add(this.options.cdataPropName,[{[this.options.textNodeName]:o}]):t.add(this.options.textNodeName,l),n=r+2}else{let r=Jn(a,n,this.options.removeNSPrefix),o=r.tagName;const l=r.rawTagName;let h=r.tagExp,c=r.attrExpPresent,u=r.closeIndex;this.options.transformTagName&&(o=this.options.transformTagName(o)),t&&s&&t.tagname!=="!xml"&&(s=this.saveTextToParentTag(s,t,i,!1));const f=t;if(f&&this.options.unpairedTags.indexOf(f.tagname)!==-1&&(t=this.tagsNodeStack.pop(),i=i.substring(0,i.lastIndexOf("."))),o!==e.tagname&&(i+=i?"."+o:o),this.isItStopNode(this.options.stopNodes,i,o)){let d="";if(h.length>0&&h.lastIndexOf("/")===h.length-1)o[o.length-1]==="/"?(o=o.substr(0,o.length-1),i=i.substr(0,i.length-1),h=o):h=h.substr(0,h.length-1),n=r.closeIndex;else if(this.options.unpairedTags.indexOf(o)!==-1)n=r.closeIndex;else{const m=this.readStopNodeData(a,l,u+1);if(!m)throw new Error(`Unexpected end of ${l}`);n=m.i,d=m.tagContent}const g=new Hs(o);o!==h&&c&&(g[":@"]=this.buildAttributesMap(h,i,o)),d&&(d=this.parseTextData(d,o,i,!0,c,!0,!0)),i=i.substr(0,i.lastIndexOf(".")),g.add(this.options.textNodeName,d),this.addChild(t,g,i)}else{if(h.length>0&&h.lastIndexOf("/")===h.length-1){o[o.length-1]==="/"?(o=o.substr(0,o.length-1),i=i.substr(0,i.length-1),h=o):h=h.substr(0,h.length-1),this.options.transformTagName&&(o=this.options.transformTagName(o));const d=new Hs(o);o!==h&&c&&(d[":@"]=this.buildAttributesMap(h,i,o)),this.addChild(t,d,i),i=i.substr(0,i.lastIndexOf("."))}else{const d=new Hs(o);this.tagsNodeStack.push(t),o!==h&&c&&(d[":@"]=this.buildAttributesMap(h,i,o)),this.addChild(t,d,i),t=d}s="",n=u}}else s+=a[n];return e.child};function Ih(a,e,t){const s=this.options.updateTag(e.tagname,t,e[":@"]);s===!1||(typeof s=="string"&&(e.tagname=s),a.addChild(e))}const kh=function(a){if(this.options.processEntities){for(let e in this.docTypeEntities){const t=this.docTypeEntities[e];a=a.replace(t.regx,t.val)}for(let e in this.lastEntities){const t=this.lastEntities[e];a=a.replace(t.regex,t.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){const t=this.htmlEntities[e];a=a.replace(t.regex,t.val)}a=a.replace(this.ampEntity.regex,this.ampEntity.val)}return a};function Lh(a,e,t,s){return a&&(s===void 0&&(s=Object.keys(e.child).length===0),a=this.parseTextData(a,e.tagname,t,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,s),a!==void 0&&a!==""&&e.add(this.options.textNodeName,a),a=""),a}function Nh(a,e,t){const s="*."+t;for(const i in a){const n=a[i];if(s===n||e===n)return!0}return!1}function Uh(a,e,t=">"){let s,i="";for(let n=e;n<a.length;n++){let r=a[n];if(s)r===s&&(s="");else if(r==='"'||r==="'")s=r;else if(r===t[0])if(t[1]){if(a[n+1]===t[1])return{data:i,index:n}}else return{data:i,index:n};else r==="	"&&(r=" ");i+=r}}function as(a,e,t,s){const i=a.indexOf(e,t);if(i===-1)throw new Error(s);return i+e.length-1}function Jn(a,e,t,s=">"){const i=Uh(a,e+1,s);if(!i)return;let n=i.data;const r=i.index,o=n.search(/\s/);let l=n,h=!0;o!==-1&&(l=n.substring(0,o),n=n.substring(o+1).trimStart());const c=l;if(t){const u=l.indexOf(":");u!==-1&&(l=l.substr(u+1),h=l!==i.data.substr(u+1))}return{tagName:l,tagExp:n,closeIndex:r,attrExpPresent:h,rawTagName:c}}function Bh(a,e,t){const s=t;let i=1;for(;t<a.length;t++)if(a[t]==="<")if(a[t+1]==="/"){const n=as(a,">",t,`${e} is not closed`);if(a.substring(t+2,n).trim()===e&&(i--,i===0))return{tagContent:a.substring(s,t),i:n};t=n}else if(a[t+1]==="?")t=as(a,"?>",t+1,"StopNode is not closed.");else if(a.substr(t+1,3)==="!--")t=as(a,"-->",t+3,"StopNode is not closed.");else if(a.substr(t+1,2)==="![")t=as(a,"]]>",t,"StopNode is not closed.")-2;else{const n=Jn(a,t,">");n&&((n&&n.tagName)===e&&n.tagExp[n.tagExp.length-1]!=="/"&&i++,t=n.closeIndex)}}function $n(a,e,t){if(e&&typeof a=="string"){const s=a.trim();return s==="true"?!0:s==="false"?!1:Th(a,t)}else return sa.isExist(a)?a:""}var Rh=Ch,ia={};function Fh(a,e){return na(a,e)}function na(a,e,t){let s;const i={};for(let n=0;n<a.length;n++){const r=a[n],o=Vh(r);let l="";if(t===void 0?l=o:l=t+"."+o,o===e.textNodeName)s===void 0?s=r[o]:s+=""+r[o];else{if(o===void 0)continue;if(r[o]){let h=na(r[o],e,l);const c=Hh(h,e);r[":@"]?jh(h,r[":@"],l,e):Object.keys(h).length===1&&h[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?h=h[e.textNodeName]:Object.keys(h).length===0&&(e.alwaysCreateTextNode?h[e.textNodeName]="":h=""),i[o]!==void 0&&i.hasOwnProperty(o)?(Array.isArray(i[o])||(i[o]=[i[o]]),i[o].push(h)):e.isArray(o,l,c)?i[o]=[h]:i[o]=h}}}return typeof s=="string"?s.length>0&&(i[e.textNodeName]=s):s!==void 0&&(i[e.textNodeName]=s),i}function Vh(a){const e=Object.keys(a);for(let t=0;t<e.length;t++){const s=e[t];if(s!==":@")return s}}function jh(a,e,t,s){if(e){const i=Object.keys(e),n=i.length;for(let r=0;r<n;r++){const o=i[r];s.isArray(o,t+"."+o,!0,!0)?a[o]=[e[o]]:a[o]=e[o]}}}function Hh(a,e){const{textNodeName:t}=e,s=Object.keys(a).length;return!!(s===0||s===1&&(a[t]||typeof a[t]=="boolean"||a[t]===0))}ia.prettify=Fh;const{buildOptions:Wh}=xr,Xh=Rh,{prettify:Zh}=ia,Yh=ea;let qh=class{constructor(a){this.externalEntities={},this.options=Wh(a)}parse(a,e){if(typeof a!="string")if(a.toString)a=a.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(e){e===!0&&(e={});const i=Yh.validate(a,e);if(i!==!0)throw Error(`${i.err.msg}:${i.err.line}:${i.err.col}`)}const t=new Xh(this.options);t.addExternalEntities(this.externalEntities);const s=t.parseXml(a);return this.options.preserveOrder||s===void 0?s:Zh(s,this.options)}addEntity(a,e){if(e.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(a.indexOf("&")!==-1||a.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(e==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[a]=e}};var Gh=qh;const Qh=`
`;function Kh(a,e){let t="";return e.format&&e.indentBy.length>0&&(t=Qh),ra(a,e,"",t)}function ra(a,e,t,s){let i="",n=!1;for(let r=0;r<a.length;r++){const o=a[r],l=Jh(o);if(l===void 0)continue;let h="";if(t.length===0?h=l:h=`${t}.${l}`,l===e.textNodeName){let g=o[l];$h(h,e)||(g=e.tagValueProcessor(l,g),g=oa(g,e)),n&&(i+=s),i+=g,n=!1;continue}else if(l===e.cdataPropName){n&&(i+=s),i+=`<![CDATA[${o[l][0][e.textNodeName]}]]>`,n=!1;continue}else if(l===e.commentPropName){i+=s+`<!--${o[l][0][e.textNodeName]}-->`,n=!0;continue}else if(l[0]==="?"){const g=Wr(o[":@"],e),m=l==="?xml"?"":s;let v=o[l][0][e.textNodeName];v=v.length!==0?" "+v:"",i+=m+`<${l}${v}${g}?>`,n=!0;continue}let c=s;c!==""&&(c+=e.indentBy);const u=Wr(o[":@"],e),f=s+`<${l}${u}`,d=ra(o[l],e,h,c);e.unpairedTags.indexOf(l)!==-1?e.suppressUnpairedNode?i+=f+">":i+=f+"/>":(!d||d.length===0)&&e.suppressEmptyNode?i+=f+"/>":d&&d.endsWith(">")?i+=f+`>${d}${s}</${l}>`:(i+=f+">",d&&s!==""&&(d.includes("/>")||d.includes("</"))?i+=s+e.indentBy+d+s:i+=d,i+=`</${l}>`),n=!0}return i}function Jh(a){const e=Object.keys(a);for(let t=0;t<e.length;t++){const s=e[t];if(a.hasOwnProperty(s)&&s!==":@")return s}}function Wr(a,e){let t="";if(a&&!e.ignoreAttributes)for(let s in a){if(!a.hasOwnProperty(s))continue;let i=e.attributeValueProcessor(s,a[s]);i=oa(i,e),i===!0&&e.suppressBooleanAttributes?t+=` ${s.substr(e.attributeNamePrefix.length)}`:t+=` ${s.substr(e.attributeNamePrefix.length)}="${i}"`}return t}function $h(a,e){a=a.substr(0,a.length-e.textNodeName.length-1);let t=a.substr(a.lastIndexOf(".")+1);for(let s in e.stopNodes)if(e.stopNodes[s]===a||e.stopNodes[s]==="*."+t)return!0;return!1}function oa(a,e){if(a&&a.length>0&&e.processEntities)for(let t=0;t<e.entities.length;t++){const s=e.entities[t];a=a.replace(s.regex,s.val)}return a}var ec=Kh;const tc=ec,sc={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(a,e){return e},attributeValueProcessor:function(a,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function Jt(a){this.options=Object.assign({},sc,a),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=rc),this.processTextOrObjNode=ic,this.options.format?(this.indentate=nc,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}Jt.prototype.build=function(a){return this.options.preserveOrder?tc(a,this.options):(Array.isArray(a)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(a={[this.options.arrayNodeName]:a}),this.j2x(a,0).val)};Jt.prototype.j2x=function(a,e){let t="",s="";for(let i in a)if(Object.prototype.hasOwnProperty.call(a,i))if(typeof a[i]>"u")this.isAttribute(i)&&(s+="");else if(a[i]===null)this.isAttribute(i)?s+="":i[0]==="?"?s+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:s+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(a[i]instanceof Date)s+=this.buildTextValNode(a[i],i,"",e);else if(typeof a[i]!="object"){const n=this.isAttribute(i);if(n)t+=this.buildAttrPairStr(n,""+a[i]);else if(i===this.options.textNodeName){let r=this.options.tagValueProcessor(i,""+a[i]);s+=this.replaceEntitiesValue(r)}else s+=this.buildTextValNode(a[i],i,"",e)}else if(Array.isArray(a[i])){const n=a[i].length;let r="",o="";for(let l=0;l<n;l++){const h=a[i][l];if(!(typeof h>"u"))if(h===null)i[0]==="?"?s+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:s+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(typeof h=="object")if(this.options.oneListGroup){const c=this.j2x(h,e+1);r+=c.val,this.options.attributesGroupName&&h.hasOwnProperty(this.options.attributesGroupName)&&(o+=c.attrStr)}else r+=this.processTextOrObjNode(h,i,e);else if(this.options.oneListGroup){let c=this.options.tagValueProcessor(i,h);c=this.replaceEntitiesValue(c),r+=c}else r+=this.buildTextValNode(h,i,"",e)}this.options.oneListGroup&&(r=this.buildObjectNode(r,i,o,e)),s+=r}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const n=Object.keys(a[i]),r=n.length;for(let o=0;o<r;o++)t+=this.buildAttrPairStr(n[o],""+a[i][n[o]])}else s+=this.processTextOrObjNode(a[i],i,e);return{attrStr:t,val:s}};Jt.prototype.buildAttrPairStr=function(a,e){return e=this.options.attributeValueProcessor(a,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+a:" "+a+'="'+e+'"'};function ic(a,e,t){const s=this.j2x(a,t+1);return a[this.options.textNodeName]!==void 0&&Object.keys(a).length===1?this.buildTextValNode(a[this.options.textNodeName],e,s.attrStr,t):this.buildObjectNode(s.val,e,s.attrStr,t)}Jt.prototype.buildObjectNode=function(a,e,t,s){if(a==="")return e[0]==="?"?this.indentate(s)+"<"+e+t+"?"+this.tagEndChar:this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar;{let i="</"+e+this.tagEndChar,n="";return e[0]==="?"&&(n="?",i=""),(t||t==="")&&a.indexOf("<")===-1?this.indentate(s)+"<"+e+t+n+">"+a+i:this.options.commentPropName!==!1&&e===this.options.commentPropName&&n.length===0?this.indentate(s)+`<!--${a}-->`+this.newLine:this.indentate(s)+"<"+e+t+n+this.tagEndChar+a+this.indentate(s)+i}};Jt.prototype.closeTag=function(a){let e="";return this.options.unpairedTags.indexOf(a)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e=`></${a}`,e};Jt.prototype.buildTextValNode=function(a,e,t,s){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(s)+`<![CDATA[${a}]]>`+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(s)+`<!--${a}-->`+this.newLine;if(e[0]==="?")return this.indentate(s)+"<"+e+t+"?"+this.tagEndChar;{let i=this.options.tagValueProcessor(e,a);return i=this.replaceEntitiesValue(i),i===""?this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar:this.indentate(s)+"<"+e+t+">"+i+"</"+e+this.tagEndChar}};Jt.prototype.replaceEntitiesValue=function(a){if(a&&a.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){const t=this.options.entities[e];a=a.replace(t.regex,t.val)}return a};function nc(a){return this.options.indentBy.repeat(a)}function rc(a){return a.startsWith(this.options.attributeNamePrefix)&&a!==this.options.textNodeName?a.substr(this.attrPrefixLen):!1}var oc=Jt;const ac=Gh,lc=oc;var fn={XMLParser:ac,XMLBuilder:lc};class mn{}x(mn,"parser",new fn.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));x(mn,"builder",new fn.XMLBuilder({attributeNamePrefix:"$",ignoreAttributes:!1,suppressBooleanAttributes:!1}));class ge{static join(e){const t={};for(const s of e)for(const i in s)if(!t[i])t[i]=new Set(s[i]);else for(const n of s[i])t[i].add(n);return t}static intersect(e){if(e.length===0)return{};let t=ge.clone(e[0]);for(let s=1;s<e.length;s++){const i=e[s],n={};for(const r in t)if(i[r]){const o=new Set;for(const l of t[r])i[r].has(l)&&o.add(l);o.size>0&&(n[r]=o)}t=n}return t}static clone(e){const t={};for(const s in e)t[s]=new Set(e[s]);return t}static remove(e,t,s=!1){s&&(e=ge.clone(e));for(const i in t)if(e[i]){for(const n of t[i])e[i].delete(n);e[i].size===0&&delete e[i]}}static add(e,t,s=!1){s&&(e=ge.clone(e));for(const i in t)if(!e[i])e[i]=new Set(t[i]);else for(const n of t[i])e[i].add(n)}static append(e,t,...s){let i=e[t];i||(i=new Set,e[t]=i);for(const n of s)i.add(n)}static isEqual(e,t){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const n of s){if(!t[n]||e[n].size!==t[n].size)return!1;for(const r of e[n])if(!t[n].has(r))return!1}return!0}static isEmpty(e){return Object.values(e).reduce((t,s)=>t+s.size,0)===0}static toRaw(e){const t={};for(const s in e)t[s]=Array.from(e[s]);return t}static fromRaw(e){const t={};for(const s in e)t[s]=new Set(e[s]);return t}}class ks extends Map{constructor(e){super(e),x(this,"onItemSet",new Q),x(this,"onItemUpdated",new Q),x(this,"onItemDeleted",new Q),x(this,"onCleared",new Q),x(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}set(e,t){const s=this.has(e);if(!(this.guard??(()=>!0))(e,t))return this;const i=super.set(e,t);return s?(this.onItemUpdated||(this.onItemUpdated=new Q),this.onItemUpdated.trigger({key:e,value:t})):(this.onItemSet||(this.onItemSet=new Q),this.onItemSet.trigger({key:e,value:t})),i}add(e){const t=Ze.create();return this.set(t,e),t}delete(e){const t=super.delete(e);return t&&this.onItemDeleted.trigger(e),t}dispose(){this.clear(),this.onItemSet.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}}class bn{static isEntry(e){return new Set(["Boolean","Color","Text","Number","Select","Vector3","TextSet","None"]).has(e.type)}static copySchema(e,t={}){for(const s in e){const i=e[s];this.isEntry(i)?t[s]=this.copyEntry(i):(t[s]={},this.copySchema(i,t[s]))}return t}static copyEntry(e){if(e.type==="Boolean"){const t=e;return{type:t.type,value:t.value}}if(e.type==="Color"){const t=e;return{type:t.type,value:t.value.clone()}}if(e.type==="Text"){const t=e;return{type:t.type,value:t.value}}if(e.type==="Number"){const t=e;return{type:t.type,value:t.value,min:t.min,max:t.max,interpolable:t.interpolable}}if(e.type==="Select"){const t=e;return{type:t.type,value:t.value,multiple:t.multiple,options:new Set(t.options)}}if(e.type==="Vector3"){const t=e;return{type:t.type,value:t.value.clone()}}if(e.type==="TextSet"){const t=e;return{type:t.type,value:new Set(t.value)}}if(e.type==="None"){const t=e;return{type:t.type,value:t.value}}throw new Error("Invalid entry!")}}class hc{constructor(){x(this,"list",new Set)}add(e){for(const t of e)this.list.add(t)}remove(e){for(const t of e)this.list.delete(t)}set(e){for(const t of this.list)t.enabled=e}reset(){for(const e of this.list)e.reset()}}class gn{constructor(e,t,s,i){x(this,"_component"),x(this,"name"),x(this,"uuid"),this._component=e,this.name=s,this.uuid=i??Ze.create(),t.get(Er).list.set(this.uuid,this)}get controls(){return bn.copySchema(this._config)}set(e){for(const t in e)if(t in this){const s=t;this[s]=e[t].value}}export(e=this._config,t={}){for(const s in e){const i=e[s];if(bn.isEntry(i))if(i.type==="Color"){const{r:n,g:r,b:o}=i.value;t[s]={...i,value:{r:n,g:r,b:o}}}else if(i.type==="Vector3"){const{x:n,y:r,z:o}=i.value;t[s]={...i,value:{x:n,y:r,z:o}}}else if(i.type==="TextSet"){const n=Array.from(i.value);t[s]={...i,value:n}}else if(i.type==="Select"){const n=Array.from(i.options);t[s]={...i,options:n}}else t[s]={...i};else t[s]={},this.export(i,t[s])}return t}import(e,t={},s=!0){for(const i in e){const n=e[i];if(bn.isEntry(n))if(n.type==="Color"){const{r,g:o,b:l}=n.value;t[i]={...n,value:new fe(r,o,l)}}else if(n.type==="Vector3"){const{x:r,y:o,z:l}=n.value;t[i]={...n,value:new N(r,o,l)}}else n.type==="TextSet"?t[i]={...n,value:new Set(n.value)}:n.type==="Select"?t[i]={...n,options:new Set(n.options)}:t[i]={...n};else t[i]={},this.import(n,t[i],!1)}s&&this.set(t)}}const aa=class la extends Ee{constructor(e){super(e),x(this,"list",new ks),x(this,"enabled",!0),e.add(la.uuid,this)}};x(aa,"uuid","b8c764e0-6b24-4e77-9a32-35fa728ee5b4");let Er=aa;class cc{constructor(e){x(this,"_event"),x(this,"_position",new ze),x(this,"onDisposed",new Q),x(this,"updateMouseInfo",t=>{this._event=t}),this.dom=e,this.setupEvents(!0)}get position(){return this.updatePosition(!1),this._position.clone()}get rawPosition(){return this.updatePosition(!0),this._position.clone()}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}updatePosition(e){if(this._event){const t=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(t,this._event,e),this._position.y=this.getPositionY(t,this._event,e)}}getPositionY(e,t,s){const i=this.getDataObject(t);return s?i.clientY:-((i.clientY-e.top)/(e.bottom-e.top))*2+1}getPositionX(e,t,s){const i=this.getDataObject(t);return s?i.clientX:(i.clientX-e.left)/(e.right-e.left)*2-1}getDataObject(e){return e instanceof MouseEvent?e:e.touches[0]}setupEvents(e){e?(this.dom.addEventListener("pointermove",this.updateMouseInfo),this.dom.addEventListener("touchstart",this.updateMouseInfo)):(this.dom.removeEventListener("pointermove",this.updateMouseInfo),this.dom.removeEventListener("touchstart",this.updateMouseInfo))}}const ha=class ca extends Ee{constructor(e){super(e),x(this,"onDisposed",new Q),x(this,"onBeforeDispose",new Q),x(this,"onFragmentsLoaded",new Q),x(this,"baseCoordinationModel",""),x(this,"baseCoordinationMatrix",new Te),x(this,"enabled",!0),x(this,"_core"),this.components.add(ca.uuid,this)}get initialized(){return!!this._core}get list(){return this.core.models.list}get core(){if(!this._core)throw new Error("FragmentsManager not initialized. Call init() first.");return this._core}get _hasCoordinationModel(){return this.baseCoordinationModel!==""}dispose(){this.onBeforeDispose.trigger(),this._core&&(this.core.dispose(),this._core=void 0),this.baseCoordinationModel="",this.onFragmentsLoaded.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}init(e){this._core=new ol(e),this.core.onModelLoaded.add(async()=>{if(this._hasCoordinationModel)return;const t=[...this.list.values()][0];t&&(this.baseCoordinationModel=t.modelId,this.baseCoordinationMatrix=await t.getCoordinationMatrix())}),this.list.onItemDeleted.add(()=>{this.list.size>0||(this.baseCoordinationModel="",this.baseCoordinationMatrix=new Te)})}async raycast(e){const t=[];for(const n of this.core.models.list.values())if(e.snappingClasses&&e.snappingClasses.length>0){const r=await n.raycastWithSnapping(e);if(r&&r.length>0)t.push(r[0]);else{const o=await n.raycast(e);o&&t.push(o)}}else{const r=await n.raycast(e);r&&t.push(r)}if(await Promise.all(t),t.length===0)return;let s=t[0],i=s.distance;for(let n=1;n<t.length;n++)t[n].distance<i&&(i=t[n].distance,s=t[n]);return s}async getPositions(e){const t=[],s=async(n,r)=>{const o=await n.getPositions(r);for(const l of o)t.push(l)},i=[];for(const n in e){const r=this.core.models.list.get(n);r&&i.push(s(r,Array.from(e[n])))}return await Promise.all(i),t}async getBBoxes(e){const t=[],s=async(n,r)=>{const o=await n.getBoxes(r);if(o)for(const l of o)t.push(l)},i=[];for(const n in e){const r=this.core.models.list.get(n);r&&i.push(s(r,Array.from(e[n])))}return await Promise.all(i),t}async highlight(e,t){await this.forEachModel(t,"highlight",e)}async getData(e,t){const s={};for(const[i,n]of Object.entries(e)){const r=this.list.get(i);if(!r)continue;const o=await r.getItemsData([...n],t);s[i]=o}return s}async resetHighlight(e){await this.forEachModel(e,"resetHighlight")}async forEachModel(e,t,...s){const i={};if(e)for(const r in e){const o=e[r];i[r]=Array.from(o)}else for(const r of this.core.models.list.keys())i[r]=void 0;const n=[];for(const r in i){const o=this.core.models.list.get(r);if(o){const l=i[r],h=o[t](l,...s);n.push(h)}}await Promise.all(n)}async guidsToModelIdMap(e){const t={};for(const[s,i]of this.list){const n=(await i.getLocalIdsByGuids([...e])).filter(r=>r!==null);t[s]=new Set(n)}return t}async modelIdMapToGuids(e){const t=[];for(const[s,i]of Object.entries(e)){const n=this.list.get(s);if(!n)continue;const r=(await n.getGuidsByLocalIds([...i])).filter(o=>o!==null);t.push(...r)}return t}applyBaseCoordinateSystem(e,t){const s=new Te;return t&&s.copy(t.clone()).invert(),s.multiply(this.baseCoordinationMatrix),e.applyMatrix4(s),s}};x(ha,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let le=ha;class dc{constructor(){x(this,"wasm",{path:"",absolute:!1,logLevel:ul.LOG_LEVEL_OFF}),x(this,"webIfc",{COORDINATE_TO_ORIGIN:!0}),x(this,"autoSetWasm",!0),x(this,"customLocateFileHandler",null)}}const uc=class er extends Ee{constructor(e){super(e),x(this,"onDisposed",new Q),x(this,"onIfcStartedLoading",new Q),x(this,"onSetup",new Q),x(this,"settings",new dc),x(this,"webIfc",new Ir),x(this,"enabled",!0),this.components.add(er.uuid,this)}dispose(){this.webIfc=null,this.onDisposed.trigger(er.uuid),this.onDisposed.reset()}async setup(e){this.settings={...this.settings,...e},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(e,t,s,i){const n=this.components.get(le);if(!n.initialized)throw new Error("You need to initialize fragments first.");this.settings.autoSetWasm&&await this.autoSetWasm(),n.core.settings.autoCoordinate=t;const r=new al;r.wasm.path=this.settings.wasm.path,r.wasm.absolute=this.settings.wasm.absolute,r.webIfcSettings=this.settings.webIfc,i!=null&&i.instanceCallback&&i.instanceCallback(r);const o=await r.process({...i==null?void 0:i.processData,bytes:e});return await n.core.load(o,{modelId:s,userData:i==null?void 0:i.userData})}async readIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;return this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(this.settings.customLocateFileHandler||void 0),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(e,this.settings.webIfc)}cleanUp(){try{this.webIfc.Dispose()}catch{console.log("Web-ifc wasn't disposed.")}this.webIfc=null,this.webIfc=new Ir}async autoSetWasm(){const e=await fetch(`https://unpkg.com/@thatopen/components@${Ma.release}/package.json`);if(!e.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const t=await e.json();if(!("web-ifc"in t.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const s=t.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${s}/`,this.settings.wasm.absolute=!0}}};x(uc,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");const da=class ua extends Ee{constructor(e){super(e),x(this,"enabled",!0),this.components.add(ua.uuid,this)}async set(e,t){const s=this.components.get(le),i=[];if(t)for(const[n,r]of Object.entries(t)){const o=s.list.get(n);o&&i.push(o.setVisible([...r],e))}else for(const n of s.list.values())i.push(n.setVisible(void 0,e));await Promise.all(i),await s.core.update(!0)}async isolate(e){await Promise.all([this.set(!1),this.set(!0,e)])}async toggle(e){const t=[],s=this.components.get(le);for(const[i,n]of Object.entries(e)){const r=s.list.get(i);r&&t.push(r.toggleVisible([...n]))}await Promise.all(t),await s.core.update(!0)}async getVisibilityMap(e,t){const s=[],i=[],n=this.components.get(le);if(t)for(const l of t){const h=n.list.get(l);h&&(s.push(h.modelId),i.push(h.getItemsByVisibility(e)))}else for(const l of n.list.values())s.push(l.modelId),i.push(l.getItemsByVisibility(e));const r=await Promise.all(i),o={};for(const[l,h]of s.entries())o[h]=r[l];return o}};x(da,"uuid","dd9ccf2d-8a21-4821-b7f6-2949add16a29");let pc=da;const pa=class tr extends Ee{constructor(e){super(e),x(this,"enabled",!0),x(this,"onDisposed",new Q),x(this,"list",new Ve),this.components.add(tr.uuid,this)}dispose(e=!0){this.list.clear(),this.onDisposed.trigger(tr.uuid),e&&(this.onDisposed.reset(),this.list.eventsEnabled=!1,this.list.dispose())}get(){const e=new Le;for(const t of this.list)e.union(t);return e}async addFromModelIdMap(e){const t=this.components.get(le),s=new Le;for(const[i,n]of Object.entries(e)){const r=t.list.get(i);if(!r)continue;const o=await r.getMergedBox([...n]);s.union(o)}this.list.add(s)}addFromModels(e){const t=this.components.get(le);for(const[s,i]of t.list)e&&!e.some(n=>n.test(s))||this.list.add(i.box)}async getCenter(e){this.list.clear(),await this.addFromModelIdMap(e);const t=this.get();this.list.clear();const s=new N;return t.getCenter(s),s}async getCameraOrientation(e,t=1){const s=this.components.get(le);this.list.clear();for(const[h,c]of s.list)this.list.add(c.box);const i=this.get();this.list.clear();const n=new N;i.getCenter(n);const r=new N;i.getSize(r);const o=Math.max(r.x,r.y,r.z)*t,l=new N;switch(e){case"front":l.set(n.x,n.y,n.z+o);break;case"back":l.set(n.x,n.y,n.z-o);break;case"left":l.set(n.x-o,n.y,n.z);break;case"right":l.set(n.x+o,n.y,n.z);break;case"top":l.set(n.x,n.y+o,n.z);break;case"bottom":l.set(n.x,n.y-o,n.z);break;default:l.set(n.x,n.y,n.z+o)}return{position:l,target:n}}};x(pa,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");let ln=pa;class fc{constructor(e,t){x(this,"customData",{}),x(this,"_components"),x(this,"_queries",[]),x(this,"_aggregation","exclusive"),x(this,"result",null),x(this,"cache",!0),x(this,"serializeQueryParameters",s=>{var i;return{categories:(i=s.categories)==null?void 0:i.map(n=>n.source),attributes:s.attributes?{aggregation:s.attributes.aggregation,queries:s.attributes.queries.map(this.serializeAttributeQuery)}:void 0,relation:s.relation?{name:s.relation.name,query:s.relation.query?this.serializeQueryParameters(s.relation.query):void 0}:void 0}}),x(this,"deserializeQueryParameters",s=>{var i;return{categories:(i=s.categories)==null?void 0:i.map(n=>new RegExp(n)),attributes:s.attributes?{aggregation:s.attributes.aggregation,queries:s.attributes.queries.map(this.deserializeAttributeQuery)}:void 0,relation:s.relation?{name:s.relation.name,query:s.relation.query?this.deserializeQueryParameters(s.relation.query):void 0}:void 0}}),this._components=e,this.queries=t}set queries(e){this._queries=e,this.clearCache()}get queries(){return this._queries}set aggregation(e){e!==this._aggregation&&this.clearCache(),this._aggregation=e}get aggregation(){return this._aggregation}async test(e){const{modelIds:t,force:s}={force:!1,...e};if(this.result&&!s)return this.result;const i=await this._components.get(ai).getItems(this.queries,{modelIds:t,aggregation:this.aggregation});return this.cache&&(this.result=i),i}clearCache(){this.result=null}serializeAttributeQuery(e){let t;return Array.isArray(e.value)?t=e.value.map(s=>s.source):e.value instanceof RegExp?t=e.value.source:t=e.value,{name:e.name.source,value:t,type:e.type instanceof RegExp?e.type.source:e.type,negate:e.negate,itemIds:e.itemIds}}toJSON(){return{name:this._components.get(ai).list.getKey(this)??"Finder Query",customData:this.customData,queries:this.queries.map(this.serializeQueryParameters),aggregation:this.aggregation,cache:this.cache}}deserializeAttributeQuery(e){let t;return Array.isArray(e.value)?t=e.value.map(s=>new RegExp(s)):typeof e.value=="string"?t=new RegExp(e.value):t=e.value,{name:new RegExp(e.name),value:t,type:e.type?new RegExp(e.type):void 0,negate:e.negate,itemIds:e.itemIds}}fromJSON(e){return this.customData=e.customData,this.aggregation=e.aggregation,this.cache=e.cache,this.queries=e.queries.map(this.deserializeQueryParameters),this}}const fa=class ma extends Ee{constructor(e){super(e),x(this,"enabled",!0),x(this,"list",new Me),e.add(ma.uuid,this)}async getItems(e,t){const{modelIds:s}=t??{},i=(t==null?void 0:t.aggregation)??"exclusive",n=this.components.get(le),r=await Promise.all(e.map(async o=>{const l={};return await Promise.all(Array.from(n.list).map(async([h,c])=>{if(s&&!s.some(f=>f.test(h)))return;const u=await c.getItemsByQuery(o);l[h]=new Set(u)})),l}));return i==="inclusive"?ge.join(r):ge.intersect(r)}create(e,t){const s=new fc(this.components,t);return this.list.set(e,s),s}async addFromCategories(e){const t=new Set,s=this.components.get(le);for(const[i,n]of s.list){if(e&&!e.some(l=>l.test(i)))continue;const r=(await n.getItemsWithGeometryCategories()).filter(l=>l!==null),o=new Set(r);for(const l of o)this.list.has(l)||(this.create(l,[{categories:[new RegExp(`^${l}$`)]}]),t.add(l))}return[...t]}import(e){const{data:t}=e,s=[];if(!t)return s;for(const i of t){const{name:n,customData:r,queries:o,aggregation:l,cache:h}=i,c=this.create(n,[]);c.fromJSON({customData:r,queries:o,aggregation:l,cache:h}),s.push(c)}return s}export(){const e=[];for(const[t,s]of this.list.entries()){const i={...s.toJSON(),name:t};e.push(i)}return{data:e}}};x(fa,"uuid","0da7ad77-f734-42ca-942f-a074adfd1e3a");let ai=fa;const ga=class va extends Ee{constructor(e){super(e),x(this,"enabled",!0),x(this,"onDisposed",new Q),x(this,"list",new Me),x(this,"defaultSaveFunction",t=>"value"in t.Name?t.Name.value:null),x(this,"onBeforeFragmentsDispose",async t=>{const{key:s,value:i}=t,n=await i.getLocalIds(),r={[s]:new Set(n)};this.removeItems(r)}),e.add(va.uuid,this),this.setupEvents(),e.get(le).list.onBeforeDelete.add(this.onBeforeFragmentsDispose)}setupEvents(){this.list.onBeforeDelete.add(({value:e})=>e.dispose())}getClassificationGroups(e){let t=this.list.get(e);return t||(t=new Me,this.list.set(e,t)),t}getModelItems(e,t,s){const{map:i}=this.getGroupData(e,t);let n=i[s];return n||(n=new Set,i[s]=n),n}getGroupData(e,t){const s=this.components.get(ai),i=this.getClassificationGroups(e);let n=i.get(t);return n||(n={map:{},get(){return new Promise(r=>{if(!n){r({});return}if(n.query){const{name:o,config:l}=n.query,h=s.list.get(o);if(!h)throw new Error("Classifier: the query name associated with the group doesn't exist in the ItemsFinder component");h.test(l).then(c=>{if(!n){r({});return}const u=ge.join([c,n.map]);r(u)})}else r(n.map)})}},i.set(t,n)),n}async aggregateItems(e,t,s){const i=(s==null?void 0:s.data)??void 0,n=(s==null?void 0:s.aggregationCallback)??this.defaultSaveFunction,r=this.components.get(le),o=await this.components.get(ai).getItems([t],{modelIds:s==null?void 0:s.modelIds});for(const[l,h]of Object.entries(o)){const c=r.list.get(l);if(!c)continue;const u=(d,...g)=>{const m=this.getModelItems(e,d,l);for(const v of g)m.add(v)},f=await c.getItemsData([...h],i);for(const d of f)n(d,u)}}addGroupItems(e,t,s){const{map:i}=this.getGroupData(e,t);ge.add(i,s)}setGroupQuery(e,t,s){const i=this.getGroupData(e,t);i.query=s}async find(e){const t=[];for(const[s,i]of Object.entries(e)){const n=[],r=this.list.get(s);if(!r)continue;for(const l of i){const h=r.get(l);if(!h)continue;const c=await h.get();n.push(c)}const o=ge.join(n);t.push(o)}return ge.intersect(t)}async aggregateItemRelations(e,t,s,i){const n=(i==null?void 0:i.attribute)??"Name",r={relations:{[s]:{attributes:!0,relations:!1}}};await this.aggregateItems(e,t,{modelIds:i==null?void 0:i.modelIds,data:r,aggregationCallback:(o,l)=>{if(!(o!=null&&o[n]))return;const h=o[n];if(!("value"in h))return;const c=o[s];if(Array.isArray(c))for(const u of c)"value"in u._localId&&l(h.value,u._localId.value)}})}async byIfcBuildingStorey(e){await this.aggregateItemRelations((e==null?void 0:e.classificationName)??"Storeys",{categories:[/BUILDINGSTOREY/]},"ContainsElements",{modelIds:e==null?void 0:e.modelIds})}async byCategory(e){const t=await this.components.get(ai).addFromCategories(e==null?void 0:e.modelIds);for(const s of t)this.setGroupQuery((e==null?void 0:e.classificationName)??"Categories",s,{name:s})}dispose(){this.list.clear(),this.components.get(le).list.onBeforeDelete.remove(this.onBeforeFragmentsDispose),this.onDisposed.trigger()}removeItems(e,t){if(t&&t.classificationName){const s=this.list.get(t.classificationName);if(!s||t.groupName&&!s.get(t.groupName))return;for(const[,i]of s)ge.remove(i.map,e);return}for(const[,s]of this.list.entries())for(const[,i]of s)ge.remove(i.map,e)}async byModel(e){const t=this.components.get(le),s=(e==null?void 0:e.classificationName)??"Models";for(const[i,n]of t.list){if(e&&e.modelIds&&!e.modelIds.some(l=>l.test(i)))continue;const r=await n.getItemsIdsWithGeometry(),o={[i]:new Set(r)};this.getGroupData(s,i),this.addGroupItems(s,i,o)}}};x(ga,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");let mc=ga;class gc{constructor(e,t){x(this,"enabled",!0),x(this,"components"),x(this,"onDisposed",new Q),x(this,"mouse"),x(this,"three",new gr),x(this,"world");const s=t.renderer;if(!s)throw new Error("A renderer is needed for the raycaster to work!");this.world=t,this.mouse=new cc(s.three.domElement),this.components=e}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRayToObjects(e=Array.from(this.world.meshes),t=this.mouse.position){if(!this.world)throw new Error("A world is needed to cast rays!");const s=this.world.camera.three;return this.three.setFromCamera(t,s),this.intersect(e)}async castRay(e){const t=e==null?void 0:e.snappingClasses,s=(e==null?void 0:e.items)??Array.from(this.world.meshes),i=(e==null?void 0:e.position)??this.mouse.position;if(!this.world)throw new Error("A world is needed to cast rays!");const n=this.world.camera.three,r=this.components.get(le),o=this.world.renderer.three.domElement,l=this.mouse.rawPosition;let h=null;if(r.initialized&&(h=await r.raycast({camera:n,dom:o,mouse:l,snappingClasses:t}),s.length===0))return h;this.three.setFromCamera(i,n);const c=this.intersect(s);return h?c&&c.distance<h.distance?c:h:c}intersect(e=Array.from(this.world.meshes)){const t=this.three.intersectObjects(e),s=this.filterClippingPlanes(t);return s.length>0?s[0]:null}filterClippingPlanes(e){if(!this.world.renderer)throw new Error("Renderer not found!");const t=this.world.renderer.three;if(!t.clippingPlanes)return e;const s=t.clippingPlanes;return e.length<=0||!s||(s==null?void 0:s.length)<=0?e:e.filter(i=>s.every(n=>n.distanceToPoint(i.point)>0))}}const _a=class ya extends Ee{constructor(e){super(e),x(this,"enabled",!0),x(this,"list",new Map),x(this,"onDisposed",new Q),e.add(ya.uuid,this)}get(e){if(this.list.has(e.uuid))return this.list.get(e.uuid);const t=new gc(this.components,e);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}};x(_a,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let it=_a;class vc extends yr{constructor(){super(...arguments),x(this,"onCameraChanged",new Q),x(this,"meshes",new Set),x(this,"onAfterUpdate",new Q),x(this,"onBeforeUpdate",new Q),x(this,"onDisposed",new Q),x(this,"isDisposing",!1),x(this,"enabled",!0),x(this,"_dynamicAnchor",!1),x(this,"uuid",Ze.create()),x(this,"name"),x(this,"_scene"),x(this,"_camera"),x(this,"_renderer",null),x(this,"onPointerDown",async e=>{if(!this.camera.hasCameraControls())throw new Error("World: can't set dynamic anchor if the camera doesn't have controls.");const t=await this.components.get(it).get(this).castRay();t&&t.point&&e.button===0&&this.camera.controls.setOrbitPoint(t.point.x,t.point.y,t.point.z)}),x(this,"_defaultCamera")}set dynamicAnchor(e){var t;const s=(t=this.renderer)==null?void 0:t.three.domElement.parentElement;if(!s)throw new Error("World: the renderer must have a parentElement to set dynamic anchoring.");e?(this.camera.controls&&(this.camera.controls.minDistance=.01),s.addEventListener("pointerdown",this.onPointerDown)):s.removeEventListener("pointerdown",this.onPointerDown)}get dynamicAnchor(){return this._dynamicAnchor}get defaultCamera(){if(!this._defaultCamera)throw new Error("World: there is no default camera defined.");return this._defaultCamera}set defaultCamera(e){this._defaultCamera=e}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(e){this._scene=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(e){this._camera||(this.defaultCamera=e),this._camera=e,e.currentWorld=this,this.onCameraChanged.trigger(e)}get renderer(){return this._renderer}set renderer(e){this._renderer=e,e&&(e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"}))}useDefaultCamera(){this.camera=this.defaultCamera}update(e){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(e),this.camera.isUpdateable()&&this.camera.update(e),this.renderer&&this.renderer.update(e),this.onAfterUpdate.trigger()))}dispose(e=!0){if(this.enabled=!1,this.isDisposing=!0,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),e){const t=this.components.get(Ot);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const s of this.meshes)t.destroy(s);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.components.get(Ea).list.delete(this.uuid),this.onDisposed.trigger(),this.onDisposed.reset()}}class _c extends Yl{constructor(e,t,s){super(e),x(this,"enabled",!0),x(this,"container"),x(this,"three"),x(this,"_canvas"),x(this,"_parameters"),x(this,"_resizeObserver",null),x(this,"onContainerUpdated",new Q),x(this,"_resizing",!1),x(this,"resize",r=>{if(this._resizing)return;this._resizing=!0,this.onContainerUpdated.trigger();const o=r?r.x:this.container.clientWidth,l=r?r.y:this.container.clientHeight;this.three.setSize(o,l),this.onResize.trigger(new ze(o,l)),this._resizing=!1}),x(this,"resizeEvent",()=>{this.resize()}),x(this,"onContextLost",r=>{r.preventDefault(),this.enabled=!1}),x(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new Nr({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.enabled=!0}),this.container=t,this._parameters=s,this.three=new Nr({antialias:!0,alpha:!0,...s}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const i=this.three.getContext(),{canvas:n}=i;n.addEventListener("webglcontextlost",this.onContextLost,!1),n.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);const e=this.currentWorld.scene.three,t=this.currentWorld.camera.three;this.three.render(e,t),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.forceContextLoss(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new ze(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(e){const t=this.three.domElement.parentElement;if(!t)throw new Error("This renderer needs to have an HTML container!");this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),window.removeEventListener("resize",this.resizeEvent),e&&(this._resizeObserver=new ResizeObserver(this.resizeEvent),this._resizeObserver.observe(t),window.addEventListener("resize",this.resizeEvent))}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.onContainerUpdated.trigger()}}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Oe={LEFT:1,RIGHT:2,MIDDLE:4},j=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),fs={NONE:0,IN:1,OUT:-1};function is(a){return a.isPerspectiveCamera}function Ht(a){return a.isOrthographicCamera}const ms=Math.PI*2,Xr=Math.PI/2,wa=1e-5,Ws=Math.PI/180;function vt(a,e,t){return Math.max(e,Math.min(t,a))}function Se(a,e=wa){return Math.abs(a)<e}function ye(a,e,t=wa){return Se(a-e,t)}function Zr(a,e){return Math.round(a/e)*e}function Xs(a){return isFinite(a)?a:a<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Zs(a){return Math.abs(a)<Number.MAX_VALUE?a:a*(1/0)}function wi(a,e,t,s,i=1/0,n){s=Math.max(1e-4,s);const r=2/s,o=r*n,l=1/(1+o+.48*o*o+.235*o*o*o);let h=a-e;const c=e,u=i*s;h=vt(h,-u,u),e=a-h;const f=(t.value+r*h)*n;t.value=(t.value-r*f)*l;let d=e+(h+f)*l;return c-a>0==d>c&&(d=c,t.value=(d-c)/n),d}function Yr(a,e,t,s,i=1/0,n,r){s=Math.max(1e-4,s);const o=2/s,l=o*n,h=1/(1+l+.48*l*l+.235*l*l*l);let c=e.x,u=e.y,f=e.z,d=a.x-c,g=a.y-u,m=a.z-f;const v=c,p=u,_=f,b=i*s,E=b*b,S=d*d+g*g+m*m;if(S>E){const B=Math.sqrt(S);d=d/B*b,g=g/B*b,m=m/B*b}c=a.x-d,u=a.y-g,f=a.z-m;const A=(t.x+o*d)*n,P=(t.y+o*g)*n,D=(t.z+o*m)*n;t.x=(t.x-o*A)*h,t.y=(t.y-o*P)*h,t.z=(t.z-o*D)*h,r.x=c+(d+A)*h,r.y=u+(g+P)*h,r.z=f+(m+D)*h;const I=v-a.x,k=p-a.y,V=_-a.z,C=r.x-v,z=r.y-p,w=r.z-_;return I*C+k*z+V*w>0&&(r.x=v,r.y=p,r.z=_,t.x=(r.x-v)/n,t.y=(r.y-p)/n,t.z=(r.z-_)/n),r}function xn(a,e){e.set(0,0),a.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=a.length,e.y/=a.length}function En(a,e){return Ht(a)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class yc{constructor(){this._listeners={}}addEventListener(e,t){const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){const s=this._listeners[e];if(s!==void 0){const i=s.indexOf(t);i!==-1&&s.splice(i,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const t=this._listeners[e.type];if(t!==void 0){e.target=this;const s=t.slice(0);for(let i=0,n=s.length;i<n;i++)s[i].call(this,e)}}}var Sn;const wc="2.10.1",bi=1/8,bc=/Mac/.test((Sn=globalThis==null?void 0:globalThis.navigator)===null||Sn===void 0?void 0:Sn.platform);let he,qr,xi,Tn,et,de,me,gs,Ys,bt,xt,ns,Gr,Qr,ot,qs,vs,Kr,Cn,Jr,An,Pn,Ei;class Qe extends yc{static install(e){he=e.THREE,qr=Object.freeze(new he.Vector3(0,0,0)),xi=Object.freeze(new he.Vector3(0,1,0)),Tn=Object.freeze(new he.Vector3(0,0,1)),et=new he.Vector2,de=new he.Vector3,me=new he.Vector3,gs=new he.Vector3,Ys=new he.Vector3,bt=new he.Vector3,xt=new he.Vector3,ns=new he.Vector3,Gr=new he.Vector3,Qr=new he.Vector3,ot=new he.Spherical,qs=new he.Spherical,vs=new he.Box3,Kr=new he.Box3,Cn=new he.Sphere,Jr=new he.Quaternion,An=new he.Quaternion,Pn=new he.Matrix4,Ei=new he.Raycaster}static get ACTION(){return j}set verticalDragToForward(e){console.warn("camera-controls: `verticalDragToForward` was removed. Use `mouseButtons.left = CameraControls.ACTION.SCREEN_PAN` instead.")}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=j.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=fs.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new he.Vector3,this._focalOffsetVelocity=new he.Vector3,this._zoomVelocity={value:0},this._truckInternal=(p,_,b,E)=>{let S,A;if(is(this._camera)){const P=de.copy(this._camera.position).sub(this._target),D=this._camera.getEffectiveFOV()*Ws,I=P.length()*Math.tan(D*.5);S=this.truckSpeed*p*I/this._elementRect.height,A=this.truckSpeed*_*I/this._elementRect.height}else if(Ht(this._camera)){const P=this._camera;S=this.truckSpeed*p*(P.right-P.left)/P.zoom/this._elementRect.width,A=this.truckSpeed*_*(P.top-P.bottom)/P.zoom/this._elementRect.height}else return;E?(b?this.setFocalOffset(this._focalOffsetEnd.x+S,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(S,0,!0),this.forward(-A,!0)):b?this.setFocalOffset(this._focalOffsetEnd.x+S,this._focalOffsetEnd.y+A,this._focalOffsetEnd.z,!0):this.truck(S,A,!0)},this._rotateInternal=(p,_)=>{const b=ms*this.azimuthRotateSpeed*p/this._elementRect.height,E=ms*this.polarRotateSpeed*_/this._elementRect.height;this.rotate(b,E,!0)},this._dollyInternal=(p,_,b)=>{const E=Math.pow(.95,-p*this.dollySpeed),S=this._sphericalEnd.radius,A=this._sphericalEnd.radius*E,P=vt(A,this.minDistance,this.maxDistance),D=P-A;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(A,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(D,!0),this._dollyToNoClamp(P,!0)):this._dollyToNoClamp(P,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?A:P)-S,this._dollyControlCoord.set(_,b)),this._lastDollyDirection=Math.sign(-p)},this._zoomInternal=(p,_,b)=>{const E=Math.pow(.95,p*this.dollySpeed),S=this._zoom,A=this._zoom*E;this.zoomTo(A,!0),this.dollyToCursor&&(this._changedZoom+=A-S,this._dollyControlCoord.set(_,b))},typeof he>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new he.Quaternion().setFromUnitVectors(this._camera.up,xi),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=j.NONE,this._target=new he.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new he.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new he.Spherical().setFromVector3(de.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new he.Vector3,new he.Vector3,new he.Vector3,new he.Vector3],this._updateNearPlaneCorners(),this._boundary=new he.Box3(new he.Vector3(-1/0,-1/0,-1/0),new he.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new he.Vector2,this.mouseButtons={left:j.ROTATE,middle:j.DOLLY,right:j.TRUCK,wheel:is(this._camera)?j.DOLLY:Ht(this._camera)?j.ZOOM:j.NONE},this.touches={one:j.TOUCH_ROTATE,two:is(this._camera)?j.TOUCH_DOLLY_TRUCK:Ht(this._camera)?j.TOUCH_ZOOM_TRUCK:j.NONE,three:j.TOUCH_TRUCK};const s=new he.Vector2,i=new he.Vector2,n=new he.Vector2,r=p=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const E=this._domElement.getBoundingClientRect(),S=p.clientX/E.width,A=p.clientY/E.height;if(S<this._interactiveArea.left||S>this._interactiveArea.right||A<this._interactiveArea.top||A>this._interactiveArea.bottom)return}const _=p.pointerType!=="mouse"?null:(p.buttons&Oe.LEFT)===Oe.LEFT?Oe.LEFT:(p.buttons&Oe.MIDDLE)===Oe.MIDDLE?Oe.MIDDLE:(p.buttons&Oe.RIGHT)===Oe.RIGHT?Oe.RIGHT:null;if(_!==null){const E=this._findPointerByMouseButton(_);E&&this._disposePointer(E)}if((p.buttons&Oe.LEFT)===Oe.LEFT&&this._lockedPointer)return;const b={pointerId:p.pointerId,clientX:p.clientX,clientY:p.clientY,deltaX:0,deltaY:0,mouseButton:_};this._activePointers.push(b),this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.addEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),this._isDragging=!0,f(p)},o=p=>{p.cancelable&&p.preventDefault();const _=p.pointerId,b=this._lockedPointer||this._findPointerById(_);if(b){if(b.clientX=p.clientX,b.clientY=p.clientY,b.deltaX=p.movementX,b.deltaY=p.movementY,this._state=0,p.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(p.buttons&Oe.LEFT)===Oe.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(p.buttons&Oe.MIDDLE)===Oe.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(p.buttons&Oe.RIGHT)===Oe.RIGHT&&(this._state=this._state|this.mouseButtons.right);d()}},l=p=>{const _=this._findPointerById(p.pointerId);if(!(_&&_===this._lockedPointer)){if(_&&this._disposePointer(_),p.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=j.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=j.NONE;g()}};let h=-1;const c=p=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===j.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const A=this._domElement.getBoundingClientRect(),P=p.clientX/A.width,D=p.clientY/A.height;if(P<this._interactiveArea.left||P>this._interactiveArea.right||D<this._interactiveArea.top||D>this._interactiveArea.bottom)return}if(p.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===j.ROTATE||this.mouseButtons.wheel===j.TRUCK){const A=performance.now();h-A<1e3&&this._getClientRect(this._elementRect),h=A}const _=bc?-1:-3,b=p.deltaMode===1||p.ctrlKey?p.deltaY/_:p.deltaY/(_*10),E=this.dollyToCursor?(p.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,S=this.dollyToCursor?(p.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case j.ROTATE:{this._rotateInternal(p.deltaX,p.deltaY),this._isUserControllingRotate=!0;break}case j.TRUCK:{this._truckInternal(p.deltaX,p.deltaY,!1,!1),this._isUserControllingTruck=!0;break}case j.SCREEN_PAN:{this._truckInternal(p.deltaX,p.deltaY,!1,!0),this._isUserControllingTruck=!0;break}case j.OFFSET:{this._truckInternal(p.deltaX,p.deltaY,!0,!1),this._isUserControllingOffset=!0;break}case j.DOLLY:{this._dollyInternal(-b,E,S),this._isUserControllingDolly=!0;break}case j.ZOOM:{this._zoomInternal(-b,E,S),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},u=p=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===Qe.ACTION.NONE){const _=p instanceof PointerEvent?p.pointerId:0,b=this._findPointerById(_);b&&this._disposePointer(b),this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l);return}p.preventDefault()}},f=p=>{if(this._enabled){if(xn(this._activePointers,et),this._getClientRect(this._elementRect),s.copy(et),i.copy(et),this._activePointers.length>=2){const _=et.x-this._activePointers[1].clientX,b=et.y-this._activePointers[1].clientY,E=Math.sqrt(_*_+b*b);n.set(0,E);const S=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,A=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(S,A)}if(this._state=0,!p)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in p&&p.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(p.buttons&Oe.LEFT)===Oe.LEFT&&(this._state=this._state|this.mouseButtons.left),(p.buttons&Oe.MIDDLE)===Oe.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(p.buttons&Oe.RIGHT)===Oe.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&j.ROTATE)===j.ROTATE||(this._state&j.TOUCH_ROTATE)===j.TOUCH_ROTATE||(this._state&j.TOUCH_DOLLY_ROTATE)===j.TOUCH_DOLLY_ROTATE||(this._state&j.TOUCH_ZOOM_ROTATE)===j.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&j.TRUCK)===j.TRUCK||(this._state&j.SCREEN_PAN)===j.SCREEN_PAN||(this._state&j.TOUCH_TRUCK)===j.TOUCH_TRUCK||(this._state&j.TOUCH_SCREEN_PAN)===j.TOUCH_SCREEN_PAN||(this._state&j.TOUCH_DOLLY_TRUCK)===j.TOUCH_DOLLY_TRUCK||(this._state&j.TOUCH_DOLLY_SCREEN_PAN)===j.TOUCH_DOLLY_SCREEN_PAN||(this._state&j.TOUCH_ZOOM_TRUCK)===j.TOUCH_ZOOM_TRUCK||(this._state&j.TOUCH_ZOOM_SCREEN_PAN)===j.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&j.DOLLY)===j.DOLLY||(this._state&j.TOUCH_DOLLY)===j.TOUCH_DOLLY||(this._state&j.TOUCH_DOLLY_TRUCK)===j.TOUCH_DOLLY_TRUCK||(this._state&j.TOUCH_DOLLY_SCREEN_PAN)===j.TOUCH_DOLLY_SCREEN_PAN||(this._state&j.TOUCH_DOLLY_OFFSET)===j.TOUCH_DOLLY_OFFSET||(this._state&j.TOUCH_DOLLY_ROTATE)===j.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&j.ZOOM)===j.ZOOM||(this._state&j.TOUCH_ZOOM)===j.TOUCH_ZOOM||(this._state&j.TOUCH_ZOOM_TRUCK)===j.TOUCH_ZOOM_TRUCK||(this._state&j.TOUCH_ZOOM_SCREEN_PAN)===j.TOUCH_ZOOM_SCREEN_PAN||(this._state&j.TOUCH_ZOOM_OFFSET)===j.TOUCH_ZOOM_OFFSET||(this._state&j.TOUCH_ZOOM_ROTATE)===j.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&j.OFFSET)===j.OFFSET||(this._state&j.TOUCH_OFFSET)===j.TOUCH_OFFSET||(this._state&j.TOUCH_DOLLY_OFFSET)===j.TOUCH_DOLLY_OFFSET||(this._state&j.TOUCH_ZOOM_OFFSET)===j.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},d=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,xn(this._activePointers,et);const p=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,_=p?-p.deltaX:i.x-et.x,b=p?-p.deltaY:i.y-et.y;if(i.copy(et),((this._state&j.ROTATE)===j.ROTATE||(this._state&j.TOUCH_ROTATE)===j.TOUCH_ROTATE||(this._state&j.TOUCH_DOLLY_ROTATE)===j.TOUCH_DOLLY_ROTATE||(this._state&j.TOUCH_ZOOM_ROTATE)===j.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(_,b),this._isUserControllingRotate=!0),(this._state&j.DOLLY)===j.DOLLY||(this._state&j.ZOOM)===j.ZOOM){const E=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,S=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,A=this.dollyDragInverted?-1:1;(this._state&j.DOLLY)===j.DOLLY?(this._dollyInternal(A*b*bi,E,S),this._isUserControllingDolly=!0):(this._zoomInternal(A*b*bi,E,S),this._isUserControllingZoom=!0)}if((this._state&j.TOUCH_DOLLY)===j.TOUCH_DOLLY||(this._state&j.TOUCH_ZOOM)===j.TOUCH_ZOOM||(this._state&j.TOUCH_DOLLY_TRUCK)===j.TOUCH_DOLLY_TRUCK||(this._state&j.TOUCH_ZOOM_TRUCK)===j.TOUCH_ZOOM_TRUCK||(this._state&j.TOUCH_DOLLY_SCREEN_PAN)===j.TOUCH_DOLLY_SCREEN_PAN||(this._state&j.TOUCH_ZOOM_SCREEN_PAN)===j.TOUCH_ZOOM_SCREEN_PAN||(this._state&j.TOUCH_DOLLY_OFFSET)===j.TOUCH_DOLLY_OFFSET||(this._state&j.TOUCH_ZOOM_OFFSET)===j.TOUCH_ZOOM_OFFSET||(this._state&j.TOUCH_DOLLY_ROTATE)===j.TOUCH_DOLLY_ROTATE||(this._state&j.TOUCH_ZOOM_ROTATE)===j.TOUCH_ZOOM_ROTATE){const E=et.x-this._activePointers[1].clientX,S=et.y-this._activePointers[1].clientY,A=Math.sqrt(E*E+S*S),P=n.y-A;n.set(0,A);const D=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,I=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&j.TOUCH_DOLLY)===j.TOUCH_DOLLY||(this._state&j.TOUCH_DOLLY_ROTATE)===j.TOUCH_DOLLY_ROTATE||(this._state&j.TOUCH_DOLLY_TRUCK)===j.TOUCH_DOLLY_TRUCK||(this._state&j.TOUCH_DOLLY_SCREEN_PAN)===j.TOUCH_DOLLY_SCREEN_PAN||(this._state&j.TOUCH_DOLLY_OFFSET)===j.TOUCH_DOLLY_OFFSET?(this._dollyInternal(P*bi,D,I),this._isUserControllingDolly=!0):(this._zoomInternal(P*bi,D,I),this._isUserControllingZoom=!0)}((this._state&j.TRUCK)===j.TRUCK||(this._state&j.TOUCH_TRUCK)===j.TOUCH_TRUCK||(this._state&j.TOUCH_DOLLY_TRUCK)===j.TOUCH_DOLLY_TRUCK||(this._state&j.TOUCH_ZOOM_TRUCK)===j.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(_,b,!1,!1),this._isUserControllingTruck=!0),((this._state&j.SCREEN_PAN)===j.SCREEN_PAN||(this._state&j.TOUCH_SCREEN_PAN)===j.TOUCH_SCREEN_PAN||(this._state&j.TOUCH_DOLLY_SCREEN_PAN)===j.TOUCH_DOLLY_SCREEN_PAN||(this._state&j.TOUCH_ZOOM_SCREEN_PAN)===j.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(_,b,!1,!0),this._isUserControllingTruck=!0),((this._state&j.OFFSET)===j.OFFSET||(this._state&j.TOUCH_OFFSET)===j.TOUCH_OFFSET||(this._state&j.TOUCH_DOLLY_OFFSET)===j.TOUCH_DOLLY_OFFSET||(this._state&j.TOUCH_ZOOM_OFFSET)===j.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(_,b,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},g=()=>{xn(this._activePointers,et),i.copy(et),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",m),this._domElement.ownerDocument.addEventListener("pointerlockerror",v),this._domElement.ownerDocument.addEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),f())},this.unlockPointer=()=>{var p,_,b;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(p=this._domElement)===null||p===void 0||p.ownerDocument.exitPointerLock(),(_=this._domElement)===null||_===void 0||_.ownerDocument.removeEventListener("pointerlockchange",m),(b=this._domElement)===null||b===void 0||b.ownerDocument.removeEventListener("pointerlockerror",v),this.cancel()};const m=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},v=()=>{this.unlockPointer()};this._addAllEventListeners=p=>{this._domElement=p,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",r),this._domElement.addEventListener("pointercancel",l),this._domElement.addEventListener("wheel",c,{passive:!1}),this._domElement.addEventListener("contextmenu",u)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",r),this._domElement.removeEventListener("pointercancel",l),this._domElement.removeEventListener("wheel",c,{passive:!1}),this._domElement.removeEventListener("contextmenu",u),this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.removeEventListener("pointerlockchange",m),this._domElement.ownerDocument.removeEventListener("pointerlockerror",v))},this.cancel=()=>{this._state!==j.NONE&&(this._state=j.NONE,this._activePointers.length=0,g())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=vt(e.width,0,1),this._interactiveArea.height=vt(e.height,0,1),this._interactiveArea.x=vt(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=vt(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,s=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,s)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,s=!1){this._isUserControllingRotate=!1;const i=vt(e,this.minAzimuthAngle,this.maxAzimuthAngle),n=vt(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=n,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const r=!s||ye(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ye(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(r)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=fs.NONE,this._changedDolly=0,this._dollyToNoClamp(vt(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const n=this._collisionTest(),r=ye(n,this._spherical.radius);if(!(s>e)&&r)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,n)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const i=!t||ye(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(i)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(Ys).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const s=!t||ye(this._target.x,this._targetEnd.x,this.restThreshold)&&ye(this._target.y,this._targetEnd.y,this.restThreshold)&&ye(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=vt(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const s=!t||ye(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(e,t,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,s)}truck(e,t,s=!1){this._camera.updateMatrix(),bt.setFromMatrixColumn(this._camera.matrix,0),xt.setFromMatrixColumn(this._camera.matrix,1),bt.multiplyScalar(e),xt.multiplyScalar(-t);const i=de.copy(bt).add(xt),n=me.copy(this._targetEnd).add(i);return this.moveTo(n.x,n.y,n.z,s)}forward(e,t=!1){de.setFromMatrixColumn(this._camera.matrix,0),de.crossVectors(this._camera.up,de),de.multiplyScalar(e);const s=me.copy(this._targetEnd).add(de);return this.moveTo(s.x,s.y,s.z,t)}elevate(e,t=!1){return de.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+de.x,this._targetEnd.y+de.y,this._targetEnd.z+de.z,t)}moveTo(e,t,s,i=!1){this._isUserControllingTruck=!1;const n=de.set(e,t,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,n,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);const r=!i||ye(this._target.x,this._targetEnd.x,this.restThreshold)&&ye(this._target.y,this._targetEnd.y,this.restThreshold)&&ye(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}lookInDirectionOf(e,t,s,i=!1){const n=de.set(e,t,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(n.x,n.y,n.z,i)}fitToBox(e,t,{cover:s=!1,paddingLeft:i=0,paddingRight:n=0,paddingBottom:r=0,paddingTop:o=0}={}){const l=[],h=e.isBox3?vs.copy(e):vs.setFromObject(e);h.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const c=Zr(this._sphericalEnd.theta,Xr),u=Zr(this._sphericalEnd.phi,Xr);l.push(this.rotateTo(c,u,t));const f=de.setFromSpherical(this._sphericalEnd).normalize(),d=Jr.setFromUnitVectors(f,Tn),g=ye(Math.abs(f.y),1);g&&d.multiply(An.setFromAxisAngle(xi,c)),d.multiply(this._yAxisUpSpaceInverse);const m=Kr.makeEmpty();me.copy(h.min).applyQuaternion(d),m.expandByPoint(me),me.copy(h.min).setX(h.max.x).applyQuaternion(d),m.expandByPoint(me),me.copy(h.min).setY(h.max.y).applyQuaternion(d),m.expandByPoint(me),me.copy(h.max).setZ(h.min.z).applyQuaternion(d),m.expandByPoint(me),me.copy(h.min).setZ(h.max.z).applyQuaternion(d),m.expandByPoint(me),me.copy(h.max).setY(h.min.y).applyQuaternion(d),m.expandByPoint(me),me.copy(h.max).setX(h.min.x).applyQuaternion(d),m.expandByPoint(me),me.copy(h.max).applyQuaternion(d),m.expandByPoint(me),m.min.x-=i,m.min.y-=r,m.max.x+=n,m.max.y+=o,d.setFromUnitVectors(Tn,f),g&&d.premultiply(An.invert()),d.premultiply(this._yAxisUpSpace);const v=m.getSize(de),p=m.getCenter(me).applyQuaternion(d);if(is(this._camera)){const _=this.getDistanceToFitBox(v.x,v.y,v.z,s);l.push(this.moveTo(p.x,p.y,p.z,t)),l.push(this.dollyTo(_,t)),l.push(this.setFocalOffset(0,0,0,t))}else if(Ht(this._camera)){const _=this._camera,b=_.right-_.left,E=_.top-_.bottom,S=s?Math.max(b/v.x,E/v.y):Math.min(b/v.x,E/v.y);l.push(this.moveTo(p.x,p.y,p.z,t)),l.push(this.zoomTo(S,t)),l.push(this.setFocalOffset(0,0,0,t))}return Promise.all(l)}fitToSphere(e,t){const s=[],i="isObject3D"in e?Qe.createBoundingSphere(e,Cn):Cn.copy(e);if(s.push(this.moveTo(i.center.x,i.center.y,i.center.z,t)),is(this._camera)){const n=this.getDistanceToFitSphere(i.radius);s.push(this.dollyTo(n,t))}else if(Ht(this._camera)){const n=this._camera.right-this._camera.left,r=this._camera.top-this._camera.bottom,o=2*i.radius,l=Math.min(n/o,r/o);s.push(this.zoomTo(l,t))}return s.push(this.setFocalOffset(0,0,0,t)),Promise.all(s)}setLookAt(e,t,s,i,n,r,o=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=fs.NONE,this._changedDolly=0;const l=me.set(i,n,r),h=de.set(e,t,s);this._targetEnd.copy(l),this._sphericalEnd.setFromVector3(h.sub(l).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const c=!o||ye(this._target.x,this._targetEnd.x,this.restThreshold)&&ye(this._target.y,this._targetEnd.y,this.restThreshold)&&ye(this._target.z,this._targetEnd.z,this.restThreshold)&&ye(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ye(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&ye(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(c)}lerpLookAt(e,t,s,i,n,r,o,l,h,c,u,f,d,g=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=fs.NONE,this._changedDolly=0;const m=de.set(i,n,r),v=me.set(e,t,s);ot.setFromVector3(v.sub(m).applyQuaternion(this._yAxisUpSpace));const p=gs.set(c,u,f),_=me.set(o,l,h);qs.setFromVector3(_.sub(p).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(m.lerp(p,d));const b=qs.theta-ot.theta,E=qs.phi-ot.phi,S=qs.radius-ot.radius;this._sphericalEnd.set(ot.radius+S*d,ot.phi+E*d,ot.theta+b*d),this.normalizeRotations(),this._needsUpdate=!0,g||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const A=!g||ye(this._target.x,this._targetEnd.x,this.restThreshold)&&ye(this._target.y,this._targetEnd.y,this.restThreshold)&&ye(this._target.z,this._targetEnd.z,this.restThreshold)&&ye(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ye(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&ye(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(A)}setPosition(e,t,s,i=!1){return this.setLookAt(e,t,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(e,t,s,i=!1){const n=this.getPosition(de),r=this.setLookAt(n.x,n.y,n.z,e,t,s,i);return this._sphericalEnd.phi=vt(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),r}setFocalOffset(e,t,s,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,s),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);const n=!i||ye(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&ye(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&ye(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}setOrbitPoint(e,t,s){this._camera.updateMatrixWorld(),bt.setFromMatrixColumn(this._camera.matrixWorldInverse,0),xt.setFromMatrixColumn(this._camera.matrixWorldInverse,1),ns.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const i=de.set(e,t,s),n=i.distanceTo(this._camera.position),r=i.sub(this._camera.position);bt.multiplyScalar(r.x),xt.multiplyScalar(r.y),ns.multiplyScalar(r.z),de.copy(bt).add(xt).add(ns),de.z=de.z+n,this.dollyTo(n,!1),this.setFocalOffset(-de.x,de.y,-de.z,!1),this.moveTo(e,t,s,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,s,i){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new he.Vector4,typeof e=="number"?this._viewport.set(e,t,s,i):this._viewport.copy(e)}getDistanceToFitBox(e,t,s,i=!1){if(En(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const n=e/t,r=this._camera.getEffectiveFOV()*Ws,o=this._camera.aspect;return((i?n>o:n<o)?t:e/o)*.5/Math.tan(r*.5)+s*.5}getDistanceToFitSphere(e){if(En(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*Ws,s=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,i=1<this._camera.aspect?t:s;return e/Math.sin(i*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new he.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new he.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new he.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new he.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%ms,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=ms),this._spherical.theta+=ms*Math.round((this._sphericalEnd.theta-this._spherical.theta)/ms)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!ye(this._camera.up.x,this._cameraUp0.x)||!ye(this._camera.up.y,this._cameraUp0.y)||!ye(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(de);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,xi),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=de.subVectors(this._target,this._camera.position).normalize(),t=me.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(de);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,n=Gr.subVectors(this._targetEnd,this._target),r=Qr.subVectors(this._focalOffsetEnd,this._focalOffset),o=this._zoomEnd-this._zoom;if(Se(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const c=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=wi(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,c,1/0,e),this._needsUpdate=!0}if(Se(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const c=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=wi(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,c,1/0,e),this._needsUpdate=!0}if(Se(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const c=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=wi(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,c,this.maxSpeed,e),this._needsUpdate=!0}if(Se(n.x)&&Se(n.y)&&Se(n.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const c=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;Yr(this._target,this._targetEnd,this._targetVelocity,c,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(Se(r.x)&&Se(r.y)&&Se(r.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const c=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;Yr(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,c,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(Se(o))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const c=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=wi(this._zoom,this._zoomEnd,this._zoomVelocity,c,1/0,e)}if(this.dollyToCursor){if(is(this._camera)&&this._changedDolly!==0){const c=this._spherical.radius-this._lastDistance,u=this._camera,f=this._getCameraDirection(Ys),d=de.copy(f).cross(u.up).normalize();d.lengthSq()===0&&(d.x=1);const g=me.crossVectors(d,f),m=this._sphericalEnd.radius*Math.tan(u.getEffectiveFOV()*Ws*.5),v=(this._sphericalEnd.radius-c-this._sphericalEnd.radius)/this._sphericalEnd.radius,p=gs.copy(this._targetEnd).add(d.multiplyScalar(this._dollyControlCoord.x*m*u.aspect)).add(g.multiplyScalar(this._dollyControlCoord.y*m)),_=de.copy(this._targetEnd).lerp(p,v),b=this._lastDollyDirection===fs.IN&&this._spherical.radius<=this.minDistance,E=this._lastDollyDirection===fs.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(b||E)){this._sphericalEnd.radius-=c,this._spherical.radius-=c;const A=me.copy(f).multiplyScalar(-c);_.add(A)}this._boundary.clampPoint(_,_);const S=me.subVectors(_,this._targetEnd);this._targetEnd.copy(_),this._target.add(S),this._changedDolly-=c,Se(this._changedDolly)&&(this._changedDolly=0)}else if(Ht(this._camera)&&this._changedZoom!==0){const c=this._zoom-this._lastZoom,u=this._camera,f=de.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(u.near+u.far)/(u.near-u.far)).unproject(u),d=me.set(0,0,-1).applyQuaternion(u.quaternion),g=gs.copy(f).add(d.multiplyScalar(-f.dot(u.up))),m=-(this._zoom-c-this._zoom)/this._zoom,v=this._getCameraDirection(Ys),p=this._targetEnd.dot(v),_=de.copy(this._targetEnd).lerp(g,m),b=_.dot(v),E=v.multiplyScalar(b-p);_.sub(E),this._boundary.clampPoint(_,_);const S=me.subVectors(_,this._targetEnd);this._targetEnd.copy(_),this._target.add(S),this._changedZoom-=c,Se(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const l=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,l),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!Se(this._focalOffset.x)||!Se(this._focalOffset.y)||!Se(this._focalOffset.z))&&(bt.setFromMatrixColumn(this._camera.matrix,0),xt.setFromMatrixColumn(this._camera.matrix,1),ns.setFromMatrixColumn(this._camera.matrix,2),bt.multiplyScalar(this._focalOffset.x),xt.multiplyScalar(-this._focalOffset.y),ns.multiplyScalar(this._focalOffset.z),de.copy(bt).add(xt).add(ns),this._camera.position.add(de),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),de.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const h=this._needsUpdate;return h&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):h?(this.dispatchEvent({type:"update"}),Se(t,this.restThreshold)&&Se(s,this.restThreshold)&&Se(i,this.restThreshold)&&Se(n.x,this.restThreshold)&&Se(n.y,this.restThreshold)&&Se(n.z,this.restThreshold)&&Se(r.x,this.restThreshold)&&Se(r.y,this.restThreshold)&&Se(r.z,this.restThreshold)&&Se(o,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!h&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=h,this._needsUpdate=!1,h}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Xs(this.maxDistance),minZoom:this.minZoom,maxZoom:Xs(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Xs(this.maxPolarAngle),minAzimuthAngle:Xs(this.minAzimuthAngle),maxAzimuthAngle:Xs(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:de.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const s=JSON.parse(e);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=Zs(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=Zs(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=Zs(s.maxPolarAngle),this.minAzimuthAngle=Zs(s.minAzimuthAngle),this.maxAzimuthAngle=Zs(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],t),ot.setFromVector3(de.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(ot.theta,ot.phi,t),this.dollyTo(ot.radius,t),this.zoomTo(s.zoom,t),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",wc),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,s){const i=t.lengthSq();if(i===0)return e;const n=me.copy(t).add(e),r=this._boundary.clampPoint(n,gs).sub(n),o=r.lengthSq();if(o===0)return e.add(t);if(o===i)return e;if(s===0)return e.add(t).add(r);{const l=1+s*o/t.dot(r);return e.add(me.copy(t).multiplyScalar(l)).add(r.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(is(this._camera)){const e=this._camera,t=e.near,s=e.getEffectiveFOV()*Ws,i=Math.tan(s*.5)*t,n=i*e.aspect;this._nearPlaneCorners[0].set(-n,-i,0),this._nearPlaneCorners[1].set(n,-i,0),this._nearPlaneCorners[2].set(n,i,0),this._nearPlaneCorners[3].set(-n,i,0)}else if(Ht(this._camera)){const e=this._camera,t=1/e.zoom,s=e.left*t,i=e.right*t,n=e.top*t,r=e.bottom*t;this._nearPlaneCorners[0].set(s,n,0),this._nearPlaneCorners[1].set(i,n,0),this._nearPlaneCorners[2].set(i,r,0),this._nearPlaneCorners[3].set(s,r,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||En(this._camera,"_collisionTest"))return e;const t=this._getTargetDirection(Ys);Pn.lookAt(qr,t,this._camera.up);for(let s=0;s<4;s++){const i=me.copy(this._nearPlaneCorners[s]);i.applyMatrix4(Pn);const n=gs.addVectors(this._target,i);Ei.set(n,t),Ei.far=this._spherical.radius+1;const r=Ei.intersectObjects(this.colliderMeshes);r.length!==0&&r[0].distance<e&&(e=r[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const s=()=>{this.removeEventListener("rest",s),t()};this.addEventListener("rest",s)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new he.Sphere){const s=t,i=s.center;vs.makeEmpty(),e.traverseVisible(r=>{r.isMesh&&vs.expandByObject(r)}),vs.getCenter(i);let n=0;return e.traverseVisible(r=>{if(!r.isMesh)return;const o=r;if(!o.geometry)return;const l=o.geometry.clone();l.applyMatrix4(o.matrixWorld);const h=l.attributes.position;for(let c=0,u=h.count;c<u;c++)de.fromBufferAttribute(h,c),n=Math.max(n,i.distanceToSquared(de))}),s.radius=Math.sqrt(n),s}}class ui extends Zl{constructor(e){super(e),x(this,"onBeforeUpdate",new Q),x(this,"onAfterUpdate",new Q),x(this,"onAspectUpdated",new Q),x(this,"onDisposed",new Q),x(this,"three"),x(this,"_allControls",new Map),x(this,"updateAspect",()=>{var t;if(!(!this.currentWorld||!this.currentWorld.renderer)){if(this.three instanceof un){this.onAspectUpdated.trigger();return}if((t=this.currentWorld.renderer)!=null&&t.isResizeable()){const s=this.currentWorld.renderer.getSize();this.three.aspect=s.width/s.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}}),this.three=this.setupCamera(),this.setupEvents(!0),this.worlds.onItemSet.add(({value:t})=>{const s=this.newCameraControls();this._allControls.set(t.uuid,s)}),this.worlds.onBeforeDelete.add(({value:t})=>{const s=this._allControls.get(t.uuid);s&&(s.dispose(),this._allControls.delete(t.uuid))})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const e=this._allControls.get(this.currentWorld.uuid);if(!e)throw new Error("Controls not found!");return e}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(e){this.currentWorld!==null&&(this.controls.enabled=e)}set currentWorld(e){super.currentWorld=e,e&&(this.worlds.get(e.uuid)||this.worlds.set(e.uuid,e))}get currentWorld(){return this._currentWorld}dispose(){this.setupEvents(!1),this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[e,t]of this._allControls)t.dispose();this.worlds.clear()}async fitToItems(e){const t=await this.getItemsBounding(e);await this.controls.fitToSphere(t,!0)}async setOrbitToItems(e){const t=await this.getItemsBounding(e);this.controls.setOrbitPoint(t.center.x,t.center.y,t.center.z)}update(e){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(e),this.onAfterUpdate.trigger(this))}async getItemsBounding(e){const t=this.components.get(le),s=this.components.get(ln);s.list.clear();const i=new ds;if(e)await s.addFromModelIdMap(e);else for(const[,n]of t.list)s.list.add(n.box);return s.get().getBoundingSphere(i),s.list.clear(),i}setupCamera(){const e=window.innerWidth/window.innerHeight,t=new qo(60,e,1,1e3);return t.position.set(50,50,50),t.lookAt(new N(0,0,0)),t}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");Qe.install({THREE:ui.getSubsetOfThree()});const{domElement:e}=this.currentWorld.renderer.three,t=new Qe(this.three,e);return t.smoothTime=.2,t.dollyToCursor=!0,t.infinityDolly=!0,t.minDistance=6,t}setupEvents(e){e?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:xl,Vector2:ze,Vector3:N,Vector4:Ns,Quaternion:yt,Matrix4:Te,Spherical:bl,Box3:Le,Sphere:ds,Raycaster:gr,MathUtils:Go}}}const ba=class xa extends Ee{constructor(e){super(e),x(this,"onAfterUpdate",new Q),x(this,"onBeforeUpdate",new Q),x(this,"onDisposed",new Q),x(this,"list",new ks),x(this,"enabled",!0),e.add(xa.uuid,this)}create(){const e=new vc(this.components),t=e.uuid;if(this.list.has(t))throw new Error("There is already a world with this name!");return this.list.set(t,e),e}delete(e){if(!this.list.has(e.uuid))throw new Error("The provided world is not found in the list!");this.list.delete(e.uuid),e.dispose()}dispose(){this.enabled=!1;for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}update(e){if(this.enabled)for(const[t,s]of this.list)s.update(e)}};x(ba,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let Ea=ba;class xc extends gn{constructor(){super(...arguments),x(this,"_config",{visible:{value:!0,type:"Boolean"},color:{value:new fe,type:"Color"},primarySize:{type:"Number",interpolable:!0,value:1,min:0,max:1e3},secondarySize:{type:"Number",interpolable:!0,value:10,min:0,max:1e3},distance:{type:"Number",interpolable:!0,value:500,min:0,max:500}})}get visible(){return this._config.visible.value}set visible(e){this._config.visible.value=e,this._component.visible=e}get color(){return this._config.color.value}set color(e){this._config.color.value=e,this._component.material.uniforms.uColor.value=e,this._component.material.uniformsNeedUpdate=!0}get primarySize(){return this._config.primarySize.value}set primarySize(e){this._config.primarySize.value=e,this._component.material.uniforms.uSize1.value=e,this._component.material.uniformsNeedUpdate=!0}get secondarySize(){return this._config.secondarySize.value}set secondarySize(e){this._config.secondarySize.value=e,this._component.material.uniforms.uSize2.value=e,this._component.material.uniformsNeedUpdate=!0}get distance(){return this._config.distance.value}set distance(e){this._config.distance.value=e,this._component.material.uniforms.uDistance.value=e,this._component.material.uniformsNeedUpdate=!0}}class Ec{constructor(e,t){x(this,"onDisposed",new Q),x(this,"onSetup",new Q),x(this,"isSetup",!1),x(this,"world"),x(this,"components"),x(this,"config"),x(this,"_defaultConfig",{visible:!0,color:new fe(12303291),primarySize:1,secondarySize:10,distance:500}),x(this,"three"),x(this,"_fade",3),x(this,"updateZoom",()=>{this.world.camera instanceof ui&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=t;const{color:s,primarySize:i,secondarySize:n,distance:r}=this._defaultConfig;this.components=e,this.config=new xc(this,this.components,"Grid");const o=new vr(2,2,1,1),l=new Xe({side:Nt,uniforms:{uSize1:{value:i},uSize2:{value:n},uColor:{value:s},uDistance:{value:r},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this.three=new ie(o,l),this.three.frustumCulled=!1,t.scene.three.add(this.three),this.setupEvents(!0)}get visible(){return this.three.visible}set visible(e){this.three.visible=e,e?this.world.scene.three.add(this.three):this.three.removeFromParent()}get material(){return this.three.material}get fade(){return this._fade===3}set fade(e){this._fade=e?3:0,this.material.uniforms.uFade.value=this._fade}setup(e){const t={...this._defaultConfig,...e};this.config.visible=!0,this.config.color=t.color,this.config.primarySize=t.primarySize,this.config.secondarySize=t.secondarySize,this.config.distance=t.distance,this.isSetup=!0,this.onSetup.trigger()}dispose(){this.setupEvents(!1),this.components.get(Er).list.delete(this.config.uuid),this.components.get(Ot).destroy(this.three),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(e){if(this.world.isDisposing||!(this.world.camera instanceof ui))return;const t=this.world.camera.controls;e?t.addEventListener("update",this.updateZoom):t.removeEventListener("update",this.updateZoom)}}const Sc=class Sa extends Ee{constructor(e){super(e),x(this,"list",new Map),x(this,"onDisposed",new Q),x(this,"enabled",!0),e.add(Sa.uuid,this)}create(e){if(this.list.has(e.uuid))throw new Error("This world already has a grid!");const t=new Ec(this.components,e);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}};x(Sc,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");const Ta=0,Tc=1,Cc=2,$r=2,On=1.25,eo=1,en=6*4+4+4,vn=65535,Ac=Math.pow(2,-24),Dn=Symbol("SKIP_GENERATION");function Pc(a){return a.index?a.index.count:a.attributes.position.count}function Us(a){return Pc(a)/3}function Oc(a,e=ArrayBuffer){return a>65535?new Uint32Array(new e(4*a)):new Uint16Array(new e(2*a))}function Dc(a,e){if(!a.index){const t=a.attributes.position.count,s=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=Oc(t,s);a.setIndex(new Lt(i,1));for(let n=0;n<t;n++)i[n]=n}}function Ca(a){const e=Us(a),t=a.drawRange,s=t.start/3,i=(t.start+t.count)/3,n=Math.max(0,s),r=Math.min(e,i)-n;return[{offset:Math.floor(n),count:Math.floor(r)}]}function Aa(a){if(!a.groups||!a.groups.length)return Ca(a);const e=[],t=new Set,s=a.drawRange,i=s.start/3,n=(s.start+s.count)/3;for(const o of a.groups){const l=o.start/3,h=(o.start+o.count)/3;t.add(Math.max(i,l)),t.add(Math.min(n,h))}const r=Array.from(t.values()).sort((o,l)=>o-l);for(let o=0;o<r.length-1;o++){const l=r[o],h=r[o+1];e.push({offset:Math.floor(l),count:Math.floor(h-l)})}return e}function Mc(a){if(a.groups.length===0)return!1;const e=Us(a),t=Aa(a).sort((n,r)=>n.offset-r.offset),s=t[t.length-1];s.count=Math.min(e-s.offset,s.count);let i=0;return t.forEach(({count:n})=>i+=n),e!==i}function De(a,e,t){return t.min.x=e[a],t.min.y=e[a+1],t.min.z=e[a+2],t.max.x=e[a+3],t.max.y=e[a+4],t.max.z=e[a+5],t}function zc(a){a[0]=a[1]=a[2]=1/0,a[3]=a[4]=a[5]=-1/0}function to(a){let e=-1,t=-1/0;for(let s=0;s<3;s++){const i=a[s+3]-a[s];i>t&&(t=i,e=s)}return e}function so(a,e){e.set(a)}function io(a,e,t){let s,i;for(let n=0;n<3;n++){const r=n+3;s=a[n],i=e[n],t[n]=s<i?s:i,s=a[r],i=e[r],t[r]=s>i?s:i}}function Si(a,e,t){for(let s=0;s<3;s++){const i=e[a+2*s],n=e[a+2*s+1],r=i-n,o=i+n;r<t[s]&&(t[s]=r),o>t[s+3]&&(t[s+3]=o)}}function Gs(a){const e=a[3]-a[0],t=a[4]-a[1],s=a[5]-a[2];return 2*(e*t+t*s+s*e)}function Mn(a,e,t,s,i=null){let n=1/0,r=1/0,o=1/0,l=-1/0,h=-1/0,c=-1/0,u=1/0,f=1/0,d=1/0,g=-1/0,m=-1/0,v=-1/0;const p=i!==null;for(let _=e*6,b=(e+t)*6;_<b;_+=6){const E=a[_+0],S=a[_+1],A=E-S,P=E+S;A<n&&(n=A),P>l&&(l=P),p&&E<u&&(u=E),p&&E>g&&(g=E);const D=a[_+2],I=a[_+3],k=D-I,V=D+I;k<r&&(r=k),V>h&&(h=V),p&&D<f&&(f=D),p&&D>m&&(m=D);const C=a[_+4],z=a[_+5],w=C-z,B=C+z;w<o&&(o=w),B>c&&(c=B),p&&C<d&&(d=C),p&&C>v&&(v=C)}s[0]=n,s[1]=r,s[2]=o,s[3]=l,s[4]=h,s[5]=c,p&&(i[0]=u,i[1]=f,i[2]=d,i[3]=g,i[4]=m,i[5]=v)}function Ic(a,e,t,s){let i=1/0,n=1/0,r=1/0,o=-1/0,l=-1/0,h=-1/0;for(let c=e*6,u=(e+t)*6;c<u;c+=6){const f=a[c+0];f<i&&(i=f),f>o&&(o=f);const d=a[c+2];d<n&&(n=d),d>l&&(l=d);const g=a[c+4];g<r&&(r=g),g>h&&(h=g)}s[0]=i,s[1]=n,s[2]=r,s[3]=o,s[4]=l,s[5]=h}function kc(a,e){zc(e);const t=a.attributes.position,s=a.index?a.index.array:null,i=Us(a),n=new Float32Array(i*6),r=t.normalized,o=t.array,l=t.offset||0;let h=3;t.isInterleavedBufferAttribute&&(h=t.data.stride);const c=["getX","getY","getZ"];for(let u=0;u<i;u++){const f=u*3,d=u*6;let g=f+0,m=f+1,v=f+2;s&&(g=s[g],m=s[m],v=s[v]),r||(g=g*h+l,m=m*h+l,v=v*h+l);for(let p=0;p<3;p++){let _,b,E;r?(_=t[c[p]](g),b=t[c[p]](m),E=t[c[p]](v)):(_=o[g+p],b=o[m+p],E=o[v+p]);let S=_;b<S&&(S=b),E<S&&(S=E);let A=_;b>A&&(A=b),E>A&&(A=E);const P=(A-S)/2,D=p*2;n[d+D+0]=S+P,n[d+D+1]=P+(Math.abs(S)+P)*Ac,S<e[p]&&(e[p]=S),A>e[p+3]&&(e[p+3]=A)}}return n}const zt=32,Lc=(a,e)=>a.candidate-e.candidate,Vt=new Array(zt).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Ti=new Float32Array(6);function Nc(a,e,t,s,i,n){let r=-1,o=0;if(n===Ta)r=to(e),r!==-1&&(o=(e[r]+e[r+3])/2);else if(n===Tc)r=to(a),r!==-1&&(o=Uc(t,s,i,r));else if(n===Cc){const l=Gs(a);let h=On*i;const c=s*6,u=(s+i)*6;for(let f=0;f<3;f++){const d=e[f],g=(e[f+3]-d)/zt;if(i<zt/4){const m=[...Vt];m.length=i;let v=0;for(let _=c;_<u;_+=6,v++){const b=m[v];b.candidate=t[_+2*f],b.count=0;const{bounds:E,leftCacheBounds:S,rightCacheBounds:A}=b;for(let P=0;P<3;P++)A[P]=1/0,A[P+3]=-1/0,S[P]=1/0,S[P+3]=-1/0,E[P]=1/0,E[P+3]=-1/0;Si(_,t,E)}m.sort(Lc);let p=i;for(let _=0;_<p;_++){const b=m[_];for(;_+1<p&&m[_+1].candidate===b.candidate;)m.splice(_+1,1),p--}for(let _=c;_<u;_+=6){const b=t[_+2*f];for(let E=0;E<p;E++){const S=m[E];b>=S.candidate?Si(_,t,S.rightCacheBounds):(Si(_,t,S.leftCacheBounds),S.count++)}}for(let _=0;_<p;_++){const b=m[_],E=b.count,S=i-b.count,A=b.leftCacheBounds,P=b.rightCacheBounds;let D=0;E!==0&&(D=Gs(A)/l);let I=0;S!==0&&(I=Gs(P)/l);const k=eo+On*(D*E+I*S);k<h&&(r=f,h=k,o=b.candidate)}}else{for(let p=0;p<zt;p++){const _=Vt[p];_.count=0,_.candidate=d+g+p*g;const b=_.bounds;for(let E=0;E<3;E++)b[E]=1/0,b[E+3]=-1/0}for(let p=c;p<u;p+=6){let _=~~((t[p+2*f]-d)/g);_>=zt&&(_=zt-1);const b=Vt[_];b.count++,Si(p,t,b.bounds)}const m=Vt[zt-1];so(m.bounds,m.rightCacheBounds);for(let p=zt-2;p>=0;p--){const _=Vt[p],b=Vt[p+1];io(_.bounds,b.rightCacheBounds,_.rightCacheBounds)}let v=0;for(let p=0;p<zt-1;p++){const _=Vt[p],b=_.count,E=_.bounds,S=Vt[p+1].rightCacheBounds;b!==0&&(v===0?so(E,Ti):io(E,Ti,Ti)),v+=b;let A=0,P=0;v!==0&&(A=Gs(Ti)/l);const D=i-v;D!==0&&(P=Gs(S)/l);const I=eo+On*(A*v+P*D);I<h&&(r=f,h=I,o=_.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${n} used.`);return{axis:r,pos:o}}function Uc(a,e,t,s){let i=0;for(let n=e,r=e+t;n<r;n++)i+=a[n*6+s*2];return i/t}class Ci{constructor(){}}function Bc(a,e,t,s,i,n){let r=s,o=s+i-1;const l=n.pos,h=n.axis*2;for(;;){for(;r<=o&&t[r*6+h]<l;)r++;for(;r<=o&&t[o*6+h]>=l;)o--;if(r<o){for(let c=0;c<3;c++){let u=e[r*3+c];e[r*3+c]=e[o*3+c],e[o*3+c]=u}for(let c=0;c<6;c++){let u=t[r*6+c];t[r*6+c]=t[o*6+c],t[o*6+c]=u}r++,o--}else return r}}function Rc(a,e,t,s,i,n){let r=s,o=s+i-1;const l=n.pos,h=n.axis*2;for(;;){for(;r<=o&&t[r*6+h]<l;)r++;for(;r<=o&&t[o*6+h]>=l;)o--;if(r<o){let c=a[r];a[r]=a[o],a[o]=c;for(let u=0;u<6;u++){let f=t[r*6+u];t[r*6+u]=t[o*6+u],t[o*6+u]=f}r++,o--}else return r}}function Fc(a,e){const t=(a.index?a.index.count:a.attributes.position.count)/3,s=t>2**16,i=s?4:2,n=e?new SharedArrayBuffer(t*i):new ArrayBuffer(t*i),r=s?new Uint32Array(n):new Uint16Array(n);for(let o=0,l=r.length;o<l;o++)r[o]=o;return r}function Vc(a,e){const t=a.geometry,s=t.index?t.index.array:null,i=e.maxDepth,n=e.verbose,r=e.maxLeafTris,o=e.strategy,l=e.onProgress,h=Us(t),c=a._indirectBuffer;let u=!1;const f=new Float32Array(6),d=new Float32Array(6),g=kc(t,f),m=e.indirect?Rc:Bc,v=[],p=e.indirect?Ca(t):Aa(t);if(p.length===1){const E=p[0],S=new Ci;S.boundingData=f,Ic(g,E.offset,E.count,d),b(S,E.offset,E.count,d),v.push(S)}else for(let E of p){const S=new Ci;S.boundingData=new Float32Array(6),Mn(g,E.offset,E.count,S.boundingData,d),b(S,E.offset,E.count,d),v.push(S)}return v;function _(E){l&&l(E/h)}function b(E,S,A,P=null,D=0){if(!u&&D>=i&&(u=!0,n&&(console.warn(`MeshBVH: Max depth of ${i} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),A<=r||D>=i)return _(S+A),E.offset=S,E.count=A,E;const I=Nc(E.boundingData,P,g,S,A,o);if(I.axis===-1)return _(S+A),E.offset=S,E.count=A,E;const k=m(c,s,g,S,A,I);if(k===S||k===S+A)_(S+A),E.offset=S,E.count=A;else{E.splitAxis=I.axis;const V=new Ci,C=S,z=k-S;E.left=V,V.boundingData=new Float32Array(6),Mn(g,C,z,V.boundingData,d),b(V,C,z,d,D+1);const w=new Ci,B=k,G=A-z;E.right=w,w.boundingData=new Float32Array(6),Mn(g,B,G,w.boundingData,d),b(w,B,G,d,D+1)}return E}}function jc(a,e){const t=a.geometry;e.indirect&&(a._indirectBuffer=Fc(t,e.useSharedArrayBuffer),Mc(t)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),a._indirectBuffer||Dc(t,e);const s=Vc(a,e);let i,n,r;const o=[],l=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let u=0;u<s.length;u++){const f=s[u];let d=h(f);const g=new l(en*d);i=new Float32Array(g),n=new Uint32Array(g),r=new Uint16Array(g),c(0,f),o.push(g)}a._roots=o;return;function h(u){return u.count?1:1+h(u.left)+h(u.right)}function c(u,f){const d=u/4,g=u/2,m=!!f.count,v=f.boundingData;for(let p=0;p<6;p++)i[d+p]=v[p];if(m){const p=f.offset,_=f.count;return n[d+6]=p,r[g+14]=_,r[g+15]=vn,u+en}else{const p=f.left,_=f.right,b=f.splitAxis;let E;if(E=c(u+en,p),E/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[d+6]=E/4,E=c(E,_),n[d+7]=b,E}}}class Bt{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let s=1/0,i=-1/0;for(let n=0,r=e.length;n<r;n++){const o=e[n][t];s=o<s?o:s,i=o>i?o:i}this.min=s,this.max=i}setFromPoints(e,t){let s=1/0,i=-1/0;for(let n=0,r=t.length;n<r;n++){const o=t[n],l=e.dot(o);s=l<s?l:s,i=l>i?l:i}this.min=s,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}}Bt.prototype.setFromBox=function(){const a=new N;return function(e,t){const s=t.min,i=t.max;let n=1/0,r=-1/0;for(let o=0;o<=1;o++)for(let l=0;l<=1;l++)for(let h=0;h<=1;h++){a.x=s.x*o+i.x*(1-o),a.y=s.y*l+i.y*(1-l),a.z=s.z*h+i.z*(1-h);const c=e.dot(a);n=Math.min(c,n),r=Math.max(c,r)}this.min=n,this.max=r}}();const Hc=function(){const a=new N,e=new N,t=new N;return function(s,i,n){const r=s.start,o=a,l=i.start,h=e;t.subVectors(r,l),a.subVectors(s.end,s.start),e.subVectors(i.end,i.start);const c=t.dot(h),u=h.dot(o),f=h.dot(h),d=t.dot(o),g=o.dot(o)*f-u*u;let m,v;g!==0?m=(c*u-d*f)/g:m=0,v=(c+m*u)/f,n.x=m,n.y=v}}(),Sr=function(){const a=new ze,e=new N,t=new N;return function(s,i,n,r){Hc(s,i,a);let o=a.x,l=a.y;if(o>=0&&o<=1&&l>=0&&l<=1){s.at(o,n),i.at(l,r);return}else if(o>=0&&o<=1){l<0?i.at(0,r):i.at(1,r),s.closestPointToPoint(r,!0,n);return}else if(l>=0&&l<=1){o<0?s.at(0,n):s.at(1,n),i.closestPointToPoint(n,!0,r);return}else{let h;o<0?h=s.start:h=s.end;let c;l<0?c=i.start:c=i.end;const u=e,f=t;if(s.closestPointToPoint(c,!0,e),i.closestPointToPoint(h,!0,t),u.distanceToSquared(c)<=f.distanceToSquared(h)){n.copy(u),r.copy(c);return}else{n.copy(h),r.copy(f);return}}}}(),Wc=function(){const a=new N,e=new N,t=new at,s=new pt;return function(i,n){const{radius:r,center:o}=i,{a:l,b:h,c}=n;if(s.start=l,s.end=h,s.closestPointToPoint(o,!0,a).distanceTo(o)<=r||(s.start=l,s.end=c,s.closestPointToPoint(o,!0,a).distanceTo(o)<=r)||(s.start=h,s.end=c,s.closestPointToPoint(o,!0,a).distanceTo(o)<=r))return!0;const u=n.getPlane(t);if(Math.abs(u.distanceToPoint(o))<=r){const f=u.projectPoint(o,e);if(n.containsPoint(f))return!0}return!1}}(),Xc=1e-15;function zn(a){return Math.abs(a)<Xc}class wt extends ii{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new N),this.satBounds=new Array(4).fill().map(()=>new Bt),this.points=[this.a,this.b,this.c],this.sphere=new ds,this.plane=new at,this.needsUpdate=!0}intersectsSphere(e){return Wc(e,this)}update(){const e=this.a,t=this.b,s=this.c,i=this.points,n=this.satAxes,r=this.satBounds,o=n[0],l=r[0];this.getNormal(o),l.setFromPoints(o,i);const h=n[1],c=r[1];h.subVectors(e,t),c.setFromPoints(h,i);const u=n[2],f=r[2];u.subVectors(t,s),f.setFromPoints(u,i);const d=n[3],g=r[3];d.subVectors(s,e),g.setFromPoints(d,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}wt.prototype.closestPointToSegment=function(){const a=new N,e=new N,t=new pt;return function(s,i=null,n=null){const{start:r,end:o}=s,l=this.points;let h,c=1/0;for(let u=0;u<3;u++){const f=(u+1)%3;t.start.copy(l[u]),t.end.copy(l[f]),Sr(t,s,a,e),h=a.distanceToSquared(e),h<c&&(c=h,i&&i.copy(a),n&&n.copy(e))}return this.closestPointToPoint(r,a),h=r.distanceToSquared(a),h<c&&(c=h,i&&i.copy(a),n&&n.copy(r)),this.closestPointToPoint(o,a),h=o.distanceToSquared(a),h<c&&(c=h,i&&i.copy(a),n&&n.copy(o)),Math.sqrt(c)}}();wt.prototype.intersectsTriangle=function(){const a=new wt,e=new Array(3),t=new Array(3),s=new Bt,i=new Bt,n=new N,r=new N,o=new N,l=new N,h=new N,c=new pt,u=new pt,f=new pt,d=new N;function g(m,v,p){const _=m.points;let b=0,E=-1;for(let S=0;S<3;S++){const{start:A,end:P}=c;A.copy(_[S]),P.copy(_[(S+1)%3]),c.delta(r);const D=zn(v.distanceToPoint(A));if(zn(v.normal.dot(r))&&D){p.copy(c),b=2;break}const I=v.intersectLine(c,d);if(!I&&D&&d.copy(A),(I||D)&&!zn(d.distanceTo(P))){if(b<=1)(b===1?p.start:p.end).copy(d),D&&(E=b);else if(b>=2){(E===1?p.start:p.end).copy(d),b=2;break}if(b++,b===2&&E===-1)break}}return b}return function(m,v=null,p=!1){this.needsUpdate&&this.update(),m.isExtendedTriangle?m.needsUpdate&&m.update():(a.copy(m),a.update(),m=a);const _=this.plane,b=m.plane;if(Math.abs(_.normal.dot(b.normal))>1-1e-10){const E=this.satBounds,S=this.satAxes;t[0]=m.a,t[1]=m.b,t[2]=m.c;for(let D=0;D<4;D++){const I=E[D],k=S[D];if(s.setFromPoints(k,t),I.isSeparated(s))return!1}const A=m.satBounds,P=m.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let D=0;D<4;D++){const I=A[D],k=P[D];if(s.setFromPoints(k,e),I.isSeparated(s))return!1}for(let D=0;D<4;D++){const I=S[D];for(let k=0;k<4;k++){const V=P[k];if(n.crossVectors(I,V),s.setFromPoints(n,e),i.setFromPoints(n,t),s.isSeparated(i))return!1}}return v&&(p||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),v.start.set(0,0,0),v.end.set(0,0,0)),!0}else{const E=g(this,b,u);if(E===1&&m.containsPoint(u.end))return v&&(v.start.copy(u.end),v.end.copy(u.end)),!0;if(E!==2)return!1;const S=g(m,_,f);if(S===1&&this.containsPoint(f.end))return v&&(v.start.copy(f.end),v.end.copy(f.end)),!0;if(S!==2)return!1;if(u.delta(o),f.delta(l),o.dot(l)<0){let C=f.start;f.start=f.end,f.end=C}const A=u.start.dot(o),P=u.end.dot(o),D=f.start.dot(o),I=f.end.dot(o),k=P<D,V=A<I;return A!==I&&D!==P&&k===V?!1:(v&&(h.subVectors(u.start,f.start),h.dot(o)>0?v.start.copy(u.start):v.start.copy(f.start),h.subVectors(u.end,f.end),h.dot(o)<0?v.end.copy(u.end):v.end.copy(f.end)),!0)}}}();wt.prototype.distanceToPoint=function(){const a=new N;return function(e){return this.closestPointToPoint(e,a),e.distanceTo(a)}}();wt.prototype.distanceToTriangle=function(){const a=new N,e=new N,t=["a","b","c"],s=new pt,i=new pt;return function(n,r=null,o=null){const l=r||o?s:null;if(this.intersectsTriangle(n,l))return(r||o)&&(r&&l.getCenter(r),o&&l.getCenter(o)),0;let h=1/0;for(let c=0;c<3;c++){let u;const f=t[c],d=n[f];this.closestPointToPoint(d,a),u=d.distanceToSquared(a),u<h&&(h=u,r&&r.copy(a),o&&o.copy(d));const g=this[f];n.closestPointToPoint(g,a),u=g.distanceToSquared(a),u<h&&(h=u,r&&r.copy(g),o&&o.copy(a))}for(let c=0;c<3;c++){const u=t[c],f=t[(c+1)%3];s.set(this[u],this[f]);for(let d=0;d<3;d++){const g=t[d],m=t[(d+1)%3];i.set(n[g],n[m]),Sr(s,i,a,e);const v=a.distanceToSquared(e);v<h&&(h=v,r&&r.copy(a),o&&o.copy(e))}}return Math.sqrt(h)}}();class $e{constructor(e,t,s){this.isOrientedBox=!0,this.min=new N,this.max=new N,this.matrix=new Te,this.invMatrix=new Te,this.points=new Array(8).fill().map(()=>new N),this.satAxes=new Array(3).fill().map(()=>new N),this.satBounds=new Array(3).fill().map(()=>new Bt),this.alignedSatBounds=new Array(3).fill().map(()=>new Bt),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),s&&this.matrix.copy(s)}set(e,t,s){this.min.copy(e),this.max.copy(t),this.matrix.copy(s),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}$e.prototype.update=function(){return function(){const a=this.matrix,e=this.min,t=this.max,s=this.points;for(let l=0;l<=1;l++)for(let h=0;h<=1;h++)for(let c=0;c<=1;c++){const u=1*l|2*h|4*c,f=s[u];f.x=l?t.x:e.x,f.y=h?t.y:e.y,f.z=c?t.z:e.z,f.applyMatrix4(a)}const i=this.satBounds,n=this.satAxes,r=s[0];for(let l=0;l<3;l++){const h=n[l],c=i[l],u=1<<l,f=s[u];h.subVectors(r,f),c.setFromPoints(h,s)}const o=this.alignedSatBounds;o[0].setFromPointsField(s,"x"),o[1].setFromPointsField(s,"y"),o[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();$e.prototype.intersectsBox=function(){const a=new Bt;return function(e){this.needsUpdate&&this.update();const t=e.min,s=e.max,i=this.satBounds,n=this.satAxes,r=this.alignedSatBounds;if(a.min=t.x,a.max=s.x,r[0].isSeparated(a)||(a.min=t.y,a.max=s.y,r[1].isSeparated(a))||(a.min=t.z,a.max=s.z,r[2].isSeparated(a)))return!1;for(let o=0;o<3;o++){const l=n[o],h=i[o];if(a.setFromBox(l,e),h.isSeparated(a))return!1}return!0}}();$e.prototype.intersectsTriangle=function(){const a=new wt,e=new Array(3),t=new Bt,s=new Bt,i=new N;return function(n){this.needsUpdate&&this.update(),n.isExtendedTriangle?n.needsUpdate&&n.update():(a.copy(n),a.update(),n=a);const r=this.satBounds,o=this.satAxes;e[0]=n.a,e[1]=n.b,e[2]=n.c;for(let u=0;u<3;u++){const f=r[u],d=o[u];if(t.setFromPoints(d,e),f.isSeparated(t))return!1}const l=n.satBounds,h=n.satAxes,c=this.points;for(let u=0;u<3;u++){const f=l[u],d=h[u];if(t.setFromPoints(d,c),f.isSeparated(t))return!1}for(let u=0;u<3;u++){const f=o[u];for(let d=0;d<4;d++){const g=h[d];if(i.crossVectors(f,g),t.setFromPoints(i,e),s.setFromPoints(i,c),t.isSeparated(s))return!1}}return!0}}();$e.prototype.closestPointToPoint=function(){return function(a,e){return this.needsUpdate&&this.update(),e.copy(a).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}();$e.prototype.distanceToPoint=function(){const a=new N;return function(e){return this.closestPointToPoint(e,a),e.distanceTo(a)}}();$e.prototype.distanceToBox=function(){const a=["x","y","z"],e=new Array(12).fill().map(()=>new pt),t=new Array(12).fill().map(()=>new pt),s=new N,i=new N;return function(n,r=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(n))return(o||l)&&(n.getCenter(i),this.closestPointToPoint(i,s),n.closestPointToPoint(s,i),o&&o.copy(s),l&&l.copy(i)),0;const h=r*r,c=n.min,u=n.max,f=this.points;let d=1/0;for(let m=0;m<8;m++){const v=f[m];i.copy(v).clamp(c,u);const p=v.distanceToSquared(i);if(p<d&&(d=p,o&&o.copy(v),l&&l.copy(i),p<h))return Math.sqrt(p)}let g=0;for(let m=0;m<3;m++)for(let v=0;v<=1;v++)for(let p=0;p<=1;p++){const _=(m+1)%3,b=(m+2)%3,E=v<<_|p<<b,S=1<<m|v<<_|p<<b,A=f[E],P=f[S];e[g].set(A,P);const D=a[m],I=a[_],k=a[b],V=t[g],C=V.start,z=V.end;C[D]=c[D],C[I]=v?c[I]:u[I],C[k]=p?c[k]:u[I],z[D]=u[D],z[I]=v?c[I]:u[I],z[k]=p?c[k]:u[I],g++}for(let m=0;m<=1;m++)for(let v=0;v<=1;v++)for(let p=0;p<=1;p++){i.x=m?u.x:c.x,i.y=v?u.y:c.y,i.z=p?u.z:c.z,this.closestPointToPoint(i,s);const _=i.distanceToSquared(s);if(_<d&&(d=_,o&&o.copy(s),l&&l.copy(i),_<h))return Math.sqrt(_)}for(let m=0;m<12;m++){const v=e[m];for(let p=0;p<12;p++){const _=t[p];Sr(v,_,s,i);const b=s.distanceToSquared(i);if(b<d&&(d=b,o&&o.copy(s),l&&l.copy(i),b<h))return Math.sqrt(b)}}return Math.sqrt(d)}}();class Tr{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class Zc extends Tr{constructor(){super(()=>new wt)}}const ht=new Zc;function nt(a,e){return e[a+15]===65535}function rt(a,e){return e[a+6]}function ct(a,e){return e[a+14]}function dt(a){return a+8}function ut(a,e){return e[a+6]}function Pa(a,e){return e[a+7]}class Yc{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=s=>{t&&e.push(t),t=s,this.float32Array=new Float32Array(s),this.uint16Array=new Uint16Array(s),this.uint32Array=new Uint32Array(s)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const Ce=new Yc;let Yt,zs;const _s=[],Ai=new Tr(()=>new Le);function qc(a,e,t,s,i,n){Yt=Ai.getPrimitive(),zs=Ai.getPrimitive(),_s.push(Yt,zs),Ce.setBuffer(a._roots[e]);const r=sr(0,a.geometry,t,s,i,n);Ce.clearBuffer(),Ai.releasePrimitive(Yt),Ai.releasePrimitive(zs),_s.pop(),_s.pop();const o=_s.length;return o>0&&(zs=_s[o-1],Yt=_s[o-2]),r}function sr(a,e,t,s,i=null,n=0,r=0){const{float32Array:o,uint16Array:l,uint32Array:h}=Ce;let c=a*2;if(nt(c,l)){const u=rt(a,h),f=ct(c,l);return De(a,o,Yt),s(u,f,!1,r,n+a,Yt)}else{let u=function(V){const{uint16Array:C,uint32Array:z}=Ce;let w=V*2;for(;!nt(w,C);)V=dt(V),w=V*2;return rt(V,z)},f=function(V){const{uint16Array:C,uint32Array:z}=Ce;let w=V*2;for(;!nt(w,C);)V=ut(V,z),w=V*2;return rt(V,z)+ct(w,C)};const d=dt(a),g=ut(a,h);let m=d,v=g,p,_,b,E;if(i&&(b=Yt,E=zs,De(m,o,b),De(v,o,E),p=i(b),_=i(E),_<p)){m=g,v=d;const V=p;p=_,_=V,b=E}b||(b=Yt,De(m,o,b));const S=nt(m*2,l),A=t(b,S,p,r+1,n+m);let P;if(A===$r){const V=u(m),C=f(m)-V;P=s(V,C,!0,r+1,n+m,b)}else P=A&&sr(m,e,t,s,i,n,r+1);if(P)return!0;E=zs,De(v,o,E);const D=nt(v*2,l),I=t(E,D,_,r+1,n+v);let k;if(I===$r){const V=u(v),C=f(v)-V;k=s(V,C,!0,r+1,n+v,E)}else k=I&&sr(v,e,t,s,i,n,r+1);return!!k}}const Qs=new N,In=new N;function Gc(a,e,t={},s=0,i=1/0){const n=s*s,r=i*i;let o=1/0,l=null;if(a.shapecast({boundsTraverseOrder:c=>(Qs.copy(e).clamp(c.min,c.max),Qs.distanceToSquared(e)),intersectsBounds:(c,u,f)=>f<o&&f<r,intersectsTriangle:(c,u)=>{c.closestPointToPoint(e,Qs);const f=e.distanceToSquared(Qs);return f<o&&(In.copy(Qs),o=f,l=u),f<n}}),o===1/0)return null;const h=Math.sqrt(o);return t.point?t.point.copy(In):t.point=In.clone(),t.distance=h,t.faceIndex=l,t}const ys=new N,ws=new N,bs=new N,Pi=new ze,Oi=new ze,Di=new ze,no=new N,ro=new N,oo=new N,Mi=new N;function Qc(a,e,t,s,i,n){let r;return n===Cl?r=a.intersectTriangle(s,t,e,!0,i):r=a.intersectTriangle(e,t,s,n!==Nt,i),r===null?null:{distance:a.origin.distanceTo(i),point:i.clone()}}function Kc(a,e,t,s,i,n,r,o,l){ys.fromBufferAttribute(e,n),ws.fromBufferAttribute(e,r),bs.fromBufferAttribute(e,o);const h=Qc(a,ys,ws,bs,Mi,l);if(h){s&&(Pi.fromBufferAttribute(s,n),Oi.fromBufferAttribute(s,r),Di.fromBufferAttribute(s,o),h.uv=ii.getInterpolation(Mi,ys,ws,bs,Pi,Oi,Di,new ze)),i&&(Pi.fromBufferAttribute(i,n),Oi.fromBufferAttribute(i,r),Di.fromBufferAttribute(i,o),h.uv1=ii.getInterpolation(Mi,ys,ws,bs,Pi,Oi,Di,new ze)),t&&(no.fromBufferAttribute(t,n),ro.fromBufferAttribute(t,r),oo.fromBufferAttribute(t,o),h.normal=ii.getInterpolation(Mi,ys,ws,bs,no,ro,oo,new N),h.normal.dot(a.direction)>0&&h.normal.multiplyScalar(-1));const c={a:n,b:r,c:o,normal:new N,materialIndex:0};ii.getNormal(ys,ws,bs,c.normal),h.face=c,h.faceIndex=n}return h}function _n(a,e,t,s,i){const n=s*3;let r=n+0,o=n+1,l=n+2;const h=a.index;a.index&&(r=h.getX(r),o=h.getX(o),l=h.getX(l));const{position:c,normal:u,uv:f,uv1:d}=a.attributes,g=Kc(t,c,u,f,d,r,o,l,e);return g?(g.faceIndex=s,i&&i.push(g),g):null}function Ne(a,e,t,s){const i=a.a,n=a.b,r=a.c;let o=e,l=e+1,h=e+2;t&&(o=t.getX(o),l=t.getX(l),h=t.getX(h)),i.x=s.getX(o),i.y=s.getY(o),i.z=s.getZ(o),n.x=s.getX(l),n.y=s.getY(l),n.z=s.getZ(l),r.x=s.getX(h),r.y=s.getY(h),r.z=s.getZ(h)}function Jc(a,e,t,s,i,n){const{geometry:r,_indirectBuffer:o}=a;for(let l=s,h=s+i;l<h;l++)_n(r,e,t,l,n)}function $c(a,e,t,s,i){const{geometry:n,_indirectBuffer:r}=a;let o=1/0,l=null;for(let h=s,c=s+i;h<c;h++){let u;u=_n(n,e,t,h),u&&u.distance<o&&(l=u,o=u.distance)}return l}function ed(a,e,t,s,i,n,r){const{geometry:o}=t,{index:l}=o,h=o.attributes.position;for(let c=a,u=e+a;c<u;c++){let f;if(f=c,Ne(r,f*3,l,h),r.needsUpdate=!0,s(r,f,i,n))return!0}return!1}function td(a,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=a.geometry,s=t.index?t.index.array:null,i=t.attributes.position;let n,r,o,l,h=0;const c=a._roots;for(let f=0,d=c.length;f<d;f++)n=c[f],r=new Uint32Array(n),o=new Uint16Array(n),l=new Float32Array(n),u(0,h),h+=n.byteLength;function u(f,d,g=!1){const m=f*2;if(o[m+15]===vn){const v=r[f+6],p=o[m+14];let _=1/0,b=1/0,E=1/0,S=-1/0,A=-1/0,P=-1/0;for(let D=3*v,I=3*(v+p);D<I;D++){let k=s[D];const V=i.getX(k),C=i.getY(k),z=i.getZ(k);V<_&&(_=V),V>S&&(S=V),C<b&&(b=C),C>A&&(A=C),z<E&&(E=z),z>P&&(P=z)}return l[f+0]!==_||l[f+1]!==b||l[f+2]!==E||l[f+3]!==S||l[f+4]!==A||l[f+5]!==P?(l[f+0]=_,l[f+1]=b,l[f+2]=E,l[f+3]=S,l[f+4]=A,l[f+5]=P,!0):!1}else{const v=f+8,p=r[f+6],_=v+d,b=p+d;let E=g,S=!1,A=!1;e?E||(S=e.has(_),A=e.has(b),E=!S&&!A):(S=!0,A=!0);const P=E||S,D=E||A;let I=!1;P&&(I=u(v,d,E));let k=!1;D&&(k=u(p,d,E));const V=I||k;if(V)for(let C=0;C<3;C++){const z=v+C,w=p+C,B=l[z],G=l[z+3],X=l[w],te=l[w+3];l[f+C]=B<X?B:X,l[f+C+3]=G>te?G:te}return V}}}const ao=new Le;function Gt(a,e,t,s){return De(a,e,ao),t.intersectBox(ao,s)}function sd(a,e,t,s,i,n){const{geometry:r,_indirectBuffer:o}=a;for(let l=s,h=s+i;l<h;l++){let c=o?o[l]:l;_n(r,e,t,c,n)}}function id(a,e,t,s,i){const{geometry:n,_indirectBuffer:r}=a;let o=1/0,l=null;for(let h=s,c=s+i;h<c;h++){let u;u=_n(n,e,t,r?r[h]:h),u&&u.distance<o&&(l=u,o=u.distance)}return l}function nd(a,e,t,s,i,n,r){const{geometry:o}=t,{index:l}=o,h=o.attributes.position;for(let c=a,u=e+a;c<u;c++){let f;if(f=t.resolveTriangleIndex(c),Ne(r,f*3,l,h),r.needsUpdate=!0,s(r,f,i,n))return!0}return!1}const lo=new N;function rd(a,e,t,s,i){Ce.setBuffer(a._roots[e]),ir(0,a,t,s,i),Ce.clearBuffer()}function ir(a,e,t,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=Ce,l=a*2;if(nt(l,r)){const h=rt(a,o),c=ct(l,r);Jc(e,t,s,h,c,i)}else{const h=dt(a);Gt(h,n,s,lo)&&ir(h,e,t,s,i);const c=ut(a,o);Gt(c,n,s,lo)&&ir(c,e,t,s,i)}}const ho=new N,od=["x","y","z"];function ad(a,e,t,s){Ce.setBuffer(a._roots[e]);const i=nr(0,a,t,s);return Ce.clearBuffer(),i}function nr(a,e,t,s){const{float32Array:i,uint16Array:n,uint32Array:r}=Ce;let o=a*2;if(nt(o,n)){const l=rt(a,r),h=ct(o,n);return $c(e,t,s,l,h)}else{const l=Pa(a,r),h=od[l],c=s.direction[h]>=0;let u,f;c?(u=dt(a),f=ut(a,r)):(u=ut(a,r),f=dt(a));const d=Gt(u,i,s,ho)?nr(u,e,t,s):null;if(d){const m=d.point[h];if(c?m<=i[f+l]:m>=i[f+l+3])return d}const g=Gt(f,i,s,ho)?nr(f,e,t,s):null;return d&&g?d.distance<=g.distance?d:g:d||g||null}}const zi=new Le,xs=new wt,Es=new wt,Ks=new Te,co=new $e,Ii=new $e;function ld(a,e,t,s){Ce.setBuffer(a._roots[e]);const i=rr(0,a,t,s);return Ce.clearBuffer(),i}function rr(a,e,t,s,i=null){const{float32Array:n,uint16Array:r,uint32Array:o}=Ce;let l=a*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),co.set(t.boundingBox.min,t.boundingBox.max,s),i=co),nt(l,r)){const h=e.geometry,c=h.index,u=h.attributes.position,f=t.index,d=t.attributes.position,g=rt(a,o),m=ct(l,r);if(Ks.copy(s).invert(),t.boundsTree)return De(a,n,Ii),Ii.matrix.copy(Ks),Ii.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:v=>Ii.intersectsBox(v),intersectsTriangle:v=>{v.a.applyMatrix4(s),v.b.applyMatrix4(s),v.c.applyMatrix4(s),v.needsUpdate=!0;for(let p=g*3,_=(m+g)*3;p<_;p+=3)if(Ne(Es,p,c,u),Es.needsUpdate=!0,v.intersectsTriangle(Es))return!0;return!1}});for(let v=g*3,p=(m+g)*3;v<p;v+=3){Ne(xs,v,c,u),xs.a.applyMatrix4(Ks),xs.b.applyMatrix4(Ks),xs.c.applyMatrix4(Ks),xs.needsUpdate=!0;for(let _=0,b=f.count;_<b;_+=3)if(Ne(Es,_,f,d),Es.needsUpdate=!0,xs.intersectsTriangle(Es))return!0}}else{const h=a+8,c=o[a+6];return De(h,n,zi),!!(i.intersectsBox(zi)&&rr(h,e,t,s,i)||(De(c,n,zi),i.intersectsBox(zi)&&rr(c,e,t,s,i)))}}const ki=new Te,kn=new $e,Js=new $e,hd=new N,cd=new N,dd=new N,ud=new N;function pd(a,e,t,s={},i={},n=0,r=1/0){e.boundingBox||e.computeBoundingBox(),kn.set(e.boundingBox.min,e.boundingBox.max,t),kn.needsUpdate=!0;const o=a.geometry,l=o.attributes.position,h=o.index,c=e.attributes.position,u=e.index,f=ht.getPrimitive(),d=ht.getPrimitive();let g=hd,m=cd,v=null,p=null;i&&(v=dd,p=ud);let _=1/0,b=null,E=null;return ki.copy(t).invert(),Js.matrix.copy(ki),a.shapecast({boundsTraverseOrder:S=>kn.distanceToBox(S),intersectsBounds:(S,A,P)=>P<_&&P<r?(A&&(Js.min.copy(S.min),Js.max.copy(S.max),Js.needsUpdate=!0),!0):!1,intersectsRange:(S,A)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:P=>Js.distanceToBox(P),intersectsBounds:(P,D,I)=>I<_&&I<r,intersectsRange:(P,D)=>{for(let I=P,k=P+D;I<k;I++){Ne(d,3*I,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let V=S,C=S+A;V<C;V++){Ne(f,3*V,h,l),f.needsUpdate=!0;const z=f.distanceToTriangle(d,g,v);if(z<_&&(m.copy(g),p&&p.copy(v),_=z,b=V,E=I),z<n)return!0}}}});{const P=Us(e);for(let D=0,I=P;D<I;D++){Ne(d,3*D,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let k=S,V=S+A;k<V;k++){Ne(f,3*k,h,l),f.needsUpdate=!0;const C=f.distanceToTriangle(d,g,v);if(C<_&&(m.copy(g),p&&p.copy(v),_=C,b=k,E=D),C<n)return!0}}}}}),ht.releasePrimitive(f),ht.releasePrimitive(d),_===1/0?null:(s.point?s.point.copy(m):s.point=m.clone(),s.distance=_,s.faceIndex=b,i&&(i.point?i.point.copy(p):i.point=p.clone(),i.point.applyMatrix4(ki),m.applyMatrix4(ki),i.distance=m.sub(i.point).length(),i.faceIndex=E),s)}function fd(a,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=a.geometry,s=t.index?t.index.array:null,i=t.attributes.position;let n,r,o,l,h=0;const c=a._roots;for(let f=0,d=c.length;f<d;f++)n=c[f],r=new Uint32Array(n),o=new Uint16Array(n),l=new Float32Array(n),u(0,h),h+=n.byteLength;function u(f,d,g=!1){const m=f*2;if(o[m+15]===vn){const v=r[f+6],p=o[m+14];let _=1/0,b=1/0,E=1/0,S=-1/0,A=-1/0,P=-1/0;for(let D=v,I=v+p;D<I;D++){const k=3*a.resolveTriangleIndex(D);for(let V=0;V<3;V++){let C=k+V;C=s?s[C]:C;const z=i.getX(C),w=i.getY(C),B=i.getZ(C);z<_&&(_=z),z>S&&(S=z),w<b&&(b=w),w>A&&(A=w),B<E&&(E=B),B>P&&(P=B)}}return l[f+0]!==_||l[f+1]!==b||l[f+2]!==E||l[f+3]!==S||l[f+4]!==A||l[f+5]!==P?(l[f+0]=_,l[f+1]=b,l[f+2]=E,l[f+3]=S,l[f+4]=A,l[f+5]=P,!0):!1}else{const v=f+8,p=r[f+6],_=v+d,b=p+d;let E=g,S=!1,A=!1;e?E||(S=e.has(_),A=e.has(b),E=!S&&!A):(S=!0,A=!0);const P=E||S,D=E||A;let I=!1;P&&(I=u(v,d,E));let k=!1;D&&(k=u(p,d,E));const V=I||k;if(V)for(let C=0;C<3;C++){const z=v+C,w=p+C,B=l[z],G=l[z+3],X=l[w],te=l[w+3];l[f+C]=B<X?B:X,l[f+C+3]=G>te?G:te}return V}}}const uo=new N;function md(a,e,t,s,i){Ce.setBuffer(a._roots[e]),or(0,a,t,s,i),Ce.clearBuffer()}function or(a,e,t,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=Ce,l=a*2;if(nt(l,r)){const h=rt(a,o),c=ct(l,r);sd(e,t,s,h,c,i)}else{const h=dt(a);Gt(h,n,s,uo)&&or(h,e,t,s,i);const c=ut(a,o);Gt(c,n,s,uo)&&or(c,e,t,s,i)}}const po=new N,gd=["x","y","z"];function vd(a,e,t,s){Ce.setBuffer(a._roots[e]);const i=ar(0,a,t,s);return Ce.clearBuffer(),i}function ar(a,e,t,s){const{float32Array:i,uint16Array:n,uint32Array:r}=Ce;let o=a*2;if(nt(o,n)){const l=rt(a,r),h=ct(o,n);return id(e,t,s,l,h)}else{const l=Pa(a,r),h=gd[l],c=s.direction[h]>=0;let u,f;c?(u=dt(a),f=ut(a,r)):(u=ut(a,r),f=dt(a));const d=Gt(u,i,s,po)?ar(u,e,t,s):null;if(d){const m=d.point[h];if(c?m<=i[f+l]:m>=i[f+l+3])return d}const g=Gt(f,i,s,po)?ar(f,e,t,s):null;return d&&g?d.distance<=g.distance?d:g:d||g||null}}const Li=new Le,Ss=new wt,Ts=new wt,$s=new Te,fo=new $e,Ni=new $e;function _d(a,e,t,s){Ce.setBuffer(a._roots[e]);const i=lr(0,a,t,s);return Ce.clearBuffer(),i}function lr(a,e,t,s,i=null){const{float32Array:n,uint16Array:r,uint32Array:o}=Ce;let l=a*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),fo.set(t.boundingBox.min,t.boundingBox.max,s),i=fo),nt(l,r)){const h=e.geometry,c=h.index,u=h.attributes.position,f=t.index,d=t.attributes.position,g=rt(a,o),m=ct(l,r);if($s.copy(s).invert(),t.boundsTree)return De(a,n,Ni),Ni.matrix.copy($s),Ni.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:v=>Ni.intersectsBox(v),intersectsTriangle:v=>{v.a.applyMatrix4(s),v.b.applyMatrix4(s),v.c.applyMatrix4(s),v.needsUpdate=!0;for(let p=g,_=m+g;p<_;p++)if(Ne(Ts,3*e.resolveTriangleIndex(p),c,u),Ts.needsUpdate=!0,v.intersectsTriangle(Ts))return!0;return!1}});for(let v=g,p=m+g;v<p;v++){const _=e.resolveTriangleIndex(v);Ne(Ss,3*_,c,u),Ss.a.applyMatrix4($s),Ss.b.applyMatrix4($s),Ss.c.applyMatrix4($s),Ss.needsUpdate=!0;for(let b=0,E=f.count;b<E;b+=3)if(Ne(Ts,b,f,d),Ts.needsUpdate=!0,Ss.intersectsTriangle(Ts))return!0}}else{const h=a+8,c=o[a+6];return De(h,n,Li),!!(i.intersectsBox(Li)&&lr(h,e,t,s,i)||(De(c,n,Li),i.intersectsBox(Li)&&lr(c,e,t,s,i)))}}const Ui=new Te,Ln=new $e,ei=new $e,yd=new N,wd=new N,bd=new N,xd=new N;function Ed(a,e,t,s={},i={},n=0,r=1/0){e.boundingBox||e.computeBoundingBox(),Ln.set(e.boundingBox.min,e.boundingBox.max,t),Ln.needsUpdate=!0;const o=a.geometry,l=o.attributes.position,h=o.index,c=e.attributes.position,u=e.index,f=ht.getPrimitive(),d=ht.getPrimitive();let g=yd,m=wd,v=null,p=null;i&&(v=bd,p=xd);let _=1/0,b=null,E=null;return Ui.copy(t).invert(),ei.matrix.copy(Ui),a.shapecast({boundsTraverseOrder:S=>Ln.distanceToBox(S),intersectsBounds:(S,A,P)=>P<_&&P<r?(A&&(ei.min.copy(S.min),ei.max.copy(S.max),ei.needsUpdate=!0),!0):!1,intersectsRange:(S,A)=>{if(e.boundsTree){const P=e.boundsTree;return P.shapecast({boundsTraverseOrder:D=>ei.distanceToBox(D),intersectsBounds:(D,I,k)=>k<_&&k<r,intersectsRange:(D,I)=>{for(let k=D,V=D+I;k<V;k++){const C=P.resolveTriangleIndex(k);Ne(d,3*C,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let z=S,w=S+A;z<w;z++){const B=a.resolveTriangleIndex(z);Ne(f,3*B,h,l),f.needsUpdate=!0;const G=f.distanceToTriangle(d,g,v);if(G<_&&(m.copy(g),p&&p.copy(v),_=G,b=z,E=k),G<n)return!0}}}})}else{const P=Us(e);for(let D=0,I=P;D<I;D++){Ne(d,3*D,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let k=S,V=S+A;k<V;k++){const C=a.resolveTriangleIndex(k);Ne(f,3*C,h,l),f.needsUpdate=!0;const z=f.distanceToTriangle(d,g,v);if(z<_&&(m.copy(g),p&&p.copy(v),_=z,b=k,E=D),z<n)return!0}}}}}),ht.releasePrimitive(f),ht.releasePrimitive(d),_===1/0?null:(s.point?s.point.copy(m):s.point=m.clone(),s.distance=_,s.faceIndex=b,i&&(i.point?i.point.copy(p):i.point=p.clone(),i.point.applyMatrix4(Ui),m.applyMatrix4(Ui),i.distance=m.sub(i.point).length(),i.faceIndex=E),s)}function Sd(){return typeof SharedArrayBuffer<"u"}const li=new Ce.constructor,hn=new Ce.constructor,Xt=new Tr(()=>new Le),Cs=new Le,As=new Le,Nn=new Le,Un=new Le;let Bn=!1;function Td(a,e,t,s){if(Bn)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Bn=!0;const i=a._roots,n=e._roots;let r,o=0,l=0;const h=new Te().copy(t).invert();for(let c=0,u=i.length;c<u;c++){li.setBuffer(i[c]),l=0;const f=Xt.getPrimitive();De(0,li.float32Array,f),f.applyMatrix4(h);for(let d=0,g=n.length;d<g&&(hn.setBuffer(n[c]),r=_t(0,0,t,h,s,o,l,0,0,f),hn.clearBuffer(),l+=n[d].length,!r);d++);if(Xt.releasePrimitive(f),li.clearBuffer(),o+=i[c].length,r)break}return Bn=!1,r}function _t(a,e,t,s,i,n=0,r=0,o=0,l=0,h=null,c=!1){let u,f;c?(u=hn,f=li):(u=li,f=hn);const d=u.float32Array,g=u.uint32Array,m=u.uint16Array,v=f.float32Array,p=f.uint32Array,_=f.uint16Array,b=a*2,E=e*2,S=nt(b,m),A=nt(E,_);let P=!1;if(A&&S)c?P=i(rt(e,p),ct(e*2,_),rt(a,g),ct(a*2,m),l,r+e,o,n+a):P=i(rt(a,g),ct(a*2,m),rt(e,p),ct(e*2,_),o,n+a,l,r+e);else if(A){const D=Xt.getPrimitive();De(e,v,D),D.applyMatrix4(t);const I=dt(a),k=ut(a,g);De(I,d,Cs),De(k,d,As);const V=D.intersectsBox(Cs),C=D.intersectsBox(As);P=V&&_t(e,I,s,t,i,r,n,l,o+1,D,!c)||C&&_t(e,k,s,t,i,r,n,l,o+1,D,!c),Xt.releasePrimitive(D)}else{const D=dt(e),I=ut(e,p);De(D,v,Nn),De(I,v,Un);const k=h.intersectsBox(Nn),V=h.intersectsBox(Un);if(k&&V)P=_t(a,D,t,s,i,n,r,o,l+1,h,c)||_t(a,I,t,s,i,n,r,o,l+1,h,c);else if(k)if(S)P=_t(a,D,t,s,i,n,r,o,l+1,h,c);else{const C=Xt.getPrimitive();C.copy(Nn).applyMatrix4(t);const z=dt(a),w=ut(a,g);De(z,d,Cs),De(w,d,As);const B=C.intersectsBox(Cs),G=C.intersectsBox(As);P=B&&_t(D,z,s,t,i,r,n,l,o+1,C,!c)||G&&_t(D,w,s,t,i,r,n,l,o+1,C,!c),Xt.releasePrimitive(C)}else if(V)if(S)P=_t(a,I,t,s,i,n,r,o,l+1,h,c);else{const C=Xt.getPrimitive();C.copy(Un).applyMatrix4(t);const z=dt(a),w=ut(a,g);De(z,d,Cs),De(w,d,As);const B=C.intersectsBox(Cs),G=C.intersectsBox(As);P=B&&_t(I,z,s,t,i,r,n,l,o+1,C,!c)||G&&_t(I,w,s,t,i,r,n,l,o+1,C,!c),Xt.releasePrimitive(C)}}return P}const Bi=new $e,mo=new Le;class Cr{static serialize(e,t={}){t={cloneBuffers:!0,...t};const s=e.geometry,i=e._roots,n=e._indirectBuffer,r=s.getIndex();let o;return t.cloneBuffers?o={roots:i.map(l=>l.slice()),index:r.array.slice(),indirectBuffer:n?n.slice():null}:o={roots:i,index:r.array,indirectBuffer:n},o}static deserialize(e,t,s={}){s={setIndex:!0,indirect:!!e.indirectBuffer,...s};const{index:i,roots:n,indirectBuffer:r}=e,o=new Cr(t,{...s,[Dn]:!0});if(o._roots=n,o._indirectBuffer=r||null,s.setIndex){const l=t.getIndex();if(l===null){const h=new Lt(e.index,1,!1);t.setIndex(h)}else l.array!==i&&(l.array.set(i),l.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:Ta,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[Dn]:!1},t),t.useSharedArrayBuffer&&!Sd())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[Dn]||(jc(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Le)));const{_indirectBuffer:s}=this;this.resolveTriangleIndex=t.indirect?i=>s[i]:i=>i}refit(e=null){return(this.indirect?fd:td)(this,e)}traverse(e,t=0){const s=this._roots[t],i=new Uint32Array(s),n=new Uint16Array(s);r(0);function r(o,l=0){const h=o*2,c=n[h+15]===vn;if(c){const u=i[o+6],f=n[h+14];e(l,c,new Float32Array(s,o*4,6),u,f)}else{const u=o+en/4,f=i[o+6],d=i[o+7];e(l,c,new Float32Array(s,o*4,6),d)||(r(u,l+1),r(f,l+1))}}}raycast(e,t=Lr){const s=this._roots,i=this.geometry,n=[],r=t.isMaterial,o=Array.isArray(t),l=i.groups,h=r?t.side:t,c=this.indirect?md:rd;for(let u=0,f=s.length;u<f;u++){const d=o?t[l[u].materialIndex].side:h,g=n.length;if(c(this,u,d,e,n),o){const m=l[u].materialIndex;for(let v=g,p=n.length;v<p;v++)n[v].face.materialIndex=m}}return n}raycastFirst(e,t=Lr){const s=this._roots,i=this.geometry,n=t.isMaterial,r=Array.isArray(t);let o=null;const l=i.groups,h=n?t.side:t,c=this.indirect?vd:ad;for(let u=0,f=s.length;u<f;u++){const d=r?t[l[u].materialIndex].side:h,g=c(this,u,d,e);g!=null&&(o==null||g.distance<o.distance)&&(o=g,r&&(g.face.materialIndex=l[u].materialIndex))}return o}intersectsGeometry(e,t){let s=!1;const i=this._roots,n=this.indirect?_d:ld;for(let r=0,o=i.length;r<o&&(s=n(this,r,e,t),!s);r++);return s}shapecast(e){const t=ht.getPrimitive(),s=this.indirect?nd:ed;let{boundsTraverseOrder:i,intersectsBounds:n,intersectsRange:r,intersectsTriangle:o}=e;if(r&&o){const u=r;r=(f,d,g,m,v)=>u(f,d,g,m,v)?!0:s(f,d,this,o,g,m,t)}else r||(o?r=(u,f,d,g)=>s(u,f,this,o,d,g,t):r=(u,f,d)=>d);let l=!1,h=0;const c=this._roots;for(let u=0,f=c.length;u<f;u++){const d=c[u];if(l=qc(this,u,n,r,i,h),l)break;h+=d.byteLength}return ht.releasePrimitive(t),l}bvhcast(e,t,s){let{intersectsRanges:i,intersectsTriangles:n}=s;const r=ht.getPrimitive(),o=this.geometry.index,l=this.geometry.attributes.position,h=this.indirect?g=>{const m=this.resolveTriangleIndex(g);Ne(r,m*3,o,l)}:g=>{Ne(r,g*3,o,l)},c=ht.getPrimitive(),u=e.geometry.index,f=e.geometry.attributes.position,d=e.indirect?g=>{const m=e.resolveTriangleIndex(g);Ne(c,m*3,u,f)}:g=>{Ne(c,g*3,u,f)};if(n){const g=(m,v,p,_,b,E,S,A)=>{for(let P=p,D=p+_;P<D;P++){d(P),c.a.applyMatrix4(t),c.b.applyMatrix4(t),c.c.applyMatrix4(t),c.needsUpdate=!0;for(let I=m,k=m+v;I<k;I++)if(h(I),r.needsUpdate=!0,n(r,c,I,P,b,E,S,A))return!0}return!1};if(i){const m=i;i=function(v,p,_,b,E,S,A,P){return m(v,p,_,b,E,S,A,P)?!0:g(v,p,_,b,E,S,A,P)}}else i=g}return Td(this,e,t,i)}intersectsBox(e,t){return Bi.set(e.min,e.max,t),Bi.needsUpdate=!0,this.shapecast({intersectsBounds:s=>Bi.intersectsBox(s),intersectsTriangle:s=>Bi.intersectsTriangle(s)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,s={},i={},n=0,r=1/0){return(this.indirect?Ed:pd)(this,e,t,s,i,n,r)}closestPointToPoint(e,t={},s=0,i=1/0){return Gc(this,e,t,s,i)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{De(0,new Float32Array(t),mo),e.union(mo)}),e}}function go(a,e,t){return a===null||(a.point.applyMatrix4(e.matrixWorld),a.distance=a.point.distanceTo(t.ray.origin),a.object=e,a.distance<t.near||a.distance>t.far)?null:a}const Rn=new pl,vo=new Te,Cd=ie.prototype.raycast;function Ad(a,e){if(this.geometry.boundsTree){if(this.material===void 0)return;vo.copy(this.matrixWorld).invert(),Rn.copy(a.ray).applyMatrix4(vo);const t=this.geometry.boundsTree;if(a.firstHitOnly===!0){const s=go(t.raycastFirst(Rn,this.material),this,a);s&&e.push(s)}else{const s=t.raycast(Rn,this.material);for(let i=0,n=s.length;i<n;i++){const r=go(s[i],this,a);r&&e.push(r)}}}else Cd.call(this,a,e)}function Pd(a){return this.boundsTree=new Cr(this,a),this.boundsTree}function Od(){this.boundsTree=null}const Oa=class Da{constructor(){x(this,"onDisposed",new Q),x(this,"list",new Me),x(this,"enabled",!1),x(this,"_clock"),x(this,"onInit",new Q),x(this,"update",()=>{if(!this.enabled)return;const e=this._clock.getDelta();for(const[t,s]of this.list)s.enabled&&s.isUpdateable()&&s.update(e);requestAnimationFrame(this.update)}),this._clock=new Wo,Da.setupBVH()}add(e,t){if(this.list.has(e))throw new Error("You're trying to add a component that already exists in the components instance. Use Components.get() instead.");Ze.validate(e),this.list.set(e,t)}get(e){const t=e.uuid;if(!this.list.has(t)){const s=new e(this);return s.isDisposeable()&&s.onDisposed.add(()=>this.list.delete(t)),this.list.has(t)||this.add(t,s),s}return this.list.get(t)}init(){this.enabled=!0;for(const[e,t]of this.list.entries())t.enabled=!0;this._clock.start(),this.update(),this.onInit.trigger()}dispose(){this.enabled=!1;let e;for(const[t,s]of this.list){if(s.enabled=!1,t===le.uuid){e=s;continue}s.isDisposeable()&&s.dispose()}e==null||e.dispose(),this._clock.stop(),this.onDisposed.trigger()}static setupBVH(){st.prototype.computeBoundsTree=Pd,st.prototype.disposeBoundsTree=Od,ie.prototype.raycast=Ad}};x(Oa,"release","2.4.3");let Ma=Oa;class Dd{constructor(e){x(this,"enabled",!1),x(this,"id","FirstPerson"),this.camera=e}set(e){if(this.enabled=e,e){if(this.camera.projection.current!=="Perspective"){this.camera.set("Orbit");return}this.setupFirstPersonCamera()}}setupFirstPersonCamera(){const e=this.camera.controls,t=new N;e.distance--,e.getPosition(t),e.minDistance=1,e.maxDistance=1,e.distance=1,e.moveTo(t.x,t.y,t.z),e.truckSpeed=50,e.mouseButtons.wheel=Qe.ACTION.DOLLY,e.touches.two=Qe.ACTION.TOUCH_ZOOM_TRUCK}}class Md{constructor(e){x(this,"enabled",!0),x(this,"id","Orbit"),this.camera=e,this.activateOrbitControls()}set(e){this.enabled=e,e&&this.activateOrbitControls()}activateOrbitControls(){const e=this.camera.controls;e.minDistance=1,e.maxDistance=300;const t=new N;e.getPosition(t);const s=t.length();e.distance=s,e.truckSpeed=2;const{rotation:i}=this.camera.three,n=new N(0,0,-1).applyEuler(i),r=t.addScaledVector(n,s);e.moveTo(r.x,r.y,r.z)}}class zd{constructor(e){x(this,"enabled",!1),x(this,"id","Plan"),x(this,"mouseAction1"),x(this,"mouseAction2"),x(this,"mouseInitialized",!1),x(this,"defaultAzimuthSpeed"),x(this,"defaultPolarSpeed"),this.camera=e,this.defaultAzimuthSpeed=e.controls.azimuthRotateSpeed,this.defaultPolarSpeed=e.controls.polarRotateSpeed}set(e){this.enabled=e;const t=this.camera.controls;t.azimuthRotateSpeed=e?0:this.defaultAzimuthSpeed,t.polarRotateSpeed=e?0:this.defaultPolarSpeed,this.mouseInitialized||(this.mouseAction1=t.touches.one,this.mouseAction2=t.touches.two,this.mouseInitialized=!0),e?(t.mouseButtons.left=Qe.ACTION.TRUCK,t.touches.one=Qe.ACTION.TOUCH_TRUCK,t.touches.two=Qe.ACTION.TOUCH_ZOOM):(t.mouseButtons.left=Qe.ACTION.ROTATE,t.touches.one=this.mouseAction1,t.touches.two=this.mouseAction2)}}class Id{constructor(e){x(this,"onChanged",new Q),x(this,"current","Perspective"),x(this,"camera"),x(this,"matchOrthoDistanceEnabled",!1),x(this,"_component"),x(this,"_previousDistance",-1),this._component=e,this.camera=e.three}async set(e){this.current!==e&&(e==="Orthographic"?this.setOrthoCamera():await this.setPerspectiveCamera(),this.onChanged.trigger(this.camera))}async toggle(){const e=this.current==="Perspective"?"Orthographic":"Perspective";await this.set(e)}setOrthoCamera(){if(this._component.mode===null||this._component.mode.id==="FirstPerson")return;this._previousDistance=this._component.controls.distance,this._component.controls.distance=200;const e=this.getPerspectiveDims();if(!e)return;const{width:t,height:s}=e;this.setupOrthoCamera(s,t),this.camera=this._component.threeOrtho,this.current="Orthographic"}getPerspectiveDims(){const e=this._component.currentWorld;if(!e||!e.renderer)return null;const t=new N;this._component.threePersp.getWorldDirection(t);const s=new N;this._component.controls.getTarget(s);const i=s.clone().sub(this._component.threePersp.position).dot(t),n=e.renderer.getSize(),r=n.x/n.y,o=this._component.threePersp,l=i*2*Math.atan(o.fov*(Math.PI/180)/2);return{width:l*r,height:l}}setupOrthoCamera(e,t){this._component.controls.mouseButtons.wheel=Qe.ACTION.ZOOM,this._component.controls.mouseButtons.middle=Qe.ACTION.ZOOM;const s=this._component.threePersp,i=this._component.threeOrtho;i.zoom=1,i.left=t/-2,i.right=t/2,i.top=e/2,i.bottom=e/-2,i.updateProjectionMatrix(),i.position.copy(s.position),i.quaternion.copy(s.quaternion),this._component.controls.camera=i}getDistance(){const e=this._component.threePersp,t=this._component.threeOrtho;return(t.top-t.bottom)/t.zoom/(2*Math.atan(e.fov*(Math.PI/180)/2))}async setPerspectiveCamera(){this._component.controls.mouseButtons.wheel=Qe.ACTION.DOLLY,this._component.controls.mouseButtons.middle=Qe.ACTION.DOLLY;const e=this._component.threePersp,t=this._component.threeOrtho;e.position.copy(t.position),e.quaternion.copy(t.quaternion),this._component.controls.mouseButtons.wheel=Qe.ACTION.DOLLY,this.matchOrthoDistanceEnabled?this._component.controls.distance=this.getDistance():this._component.controls.distance=this._previousDistance,await this._component.controls.zoomTo(1),e.updateProjectionMatrix(),this._component.controls.camera=e,this.camera=e,this.current="Perspective"}}class za extends ui{constructor(e){super(e),x(this,"projection"),x(this,"threeOrtho"),x(this,"threePersp"),x(this,"_userInputButtons",{}),x(this,"_frustumSize",50),x(this,"_navigationModes",new Map),x(this,"_mode",null),x(this,"previousSize",null),this.threePersp=this.three,this.threeOrtho=this.newOrthoCamera(),this.projection=new Id(this),this.onAspectUpdated.add(()=>{this.setOrthoPerspCameraAspect()}),this.projection.onChanged.add(t=>{this.three=t,this.updateAspect()}),this.worlds.onItemSet.add(()=>{this._navigationModes.clear(),this._navigationModes.set("Orbit",new Md(this)),this._navigationModes.set("FirstPerson",new Dd(this)),this._navigationModes.set("Plan",new zd(this)),this._mode=this._navigationModes.get("Orbit"),this.mode.set(!0,{preventTargetAdjustment:!0}),this.currentWorld&&this.currentWorld.renderer&&(this.previousSize=this.currentWorld.renderer.getSize().clone())}),this.worlds.onItemDeleted.add(()=>{this._navigationModes.clear()})}get mode(){if(!this._mode)throw new Error("Mode not found, camera not initialized");return this._mode}dispose(){super.dispose(),this.threeOrtho.removeFromParent()}set(e){if(this.mode!==null&&this.mode.id!==e){if(this.mode.set(!1),!this._navigationModes.has(e))throw new Error("The specified mode does not exist!");this._mode=this._navigationModes.get(e),this.mode.set(!0)}}async fit(e,t=1.5){if(!this.enabled)return;const s=Number.MAX_VALUE,i=Number.MIN_VALUE,n=new N(s,s,s),r=new N(i,i,i);for(const d of e){const g=new Le().setFromObject(d);g.min.x<n.x&&(n.x=g.min.x),g.min.y<n.y&&(n.y=g.min.y),g.min.z<n.z&&(n.z=g.min.z),g.max.x>r.x&&(r.x=g.max.x),g.max.y>r.y&&(r.y=g.max.y),g.max.z>r.z&&(r.z=g.max.z)}const o=new Le(n,r),l=this.components.get(le);if(l.initialized)for(const[,d]of l.list){const g=d.box;g.min.x<n.x&&(n.x=g.min.x),g.min.y<n.y&&(n.y=g.min.y),g.min.z<n.z&&(n.z=g.min.z),g.max.x>r.x&&(r.x=g.max.x),g.max.y>r.y&&(r.y=g.max.y),g.max.z>r.z&&(r.z=g.max.z)}const h=new N;o.getSize(h);const c=new N;o.getCenter(c);const u=Math.max(h.x,h.y,h.z)*t,f=new ds(c,u);await this.controls.fitToSphere(f,!0)}setUserInput(e){e?this.enableUserInput():this.disableUserInput()}disableUserInput(){this._userInputButtons.left=this.controls.mouseButtons.left,this._userInputButtons.right=this.controls.mouseButtons.right,this._userInputButtons.middle=this.controls.mouseButtons.middle,this._userInputButtons.wheel=this.controls.mouseButtons.wheel,this.controls.mouseButtons.left=0,this.controls.mouseButtons.right=0,this.controls.mouseButtons.middle=0,this.controls.mouseButtons.wheel=0}enableUserInput(){Object.keys(this._userInputButtons).length!==0&&(this.controls.mouseButtons.left=this._userInputButtons.left,this.controls.mouseButtons.right=this._userInputButtons.right,this.controls.mouseButtons.middle=this._userInputButtons.middle,this.controls.mouseButtons.wheel=this._userInputButtons.wheel)}newOrthoCamera(){const e=window.innerWidth/window.innerHeight;return new un(this._frustumSize*e/-2,this._frustumSize*e/2,this._frustumSize/2,this._frustumSize/-2,.1,1e3)}setOrthoPerspCameraAspect(){if(!this.currentWorld||!this.currentWorld.renderer||!this.previousSize)return;const e=this.currentWorld.renderer.getSize(),t=this.threeOrtho.top,s=this.threeOrtho.right,i=e.y/this.previousSize.y,n=e.x/this.previousSize.x,r=t*i,o=s*n;this.threeOrtho.left=-o,this.threeOrtho.right=o,this.threeOrtho.top=r,this.threeOrtho.bottom=-r,this.threeOrtho.updateProjectionMatrix(),this.previousSize.copy(e)}}function Ri(a){throw new Error('Could not dynamically require "'+a+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ia={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(a,e){(function(t){a.exports=t()})(function(){return function t(s,i,n){function r(h,c){if(!i[h]){if(!s[h]){var u=typeof Ri=="function"&&Ri;if(!c&&u)return u(h,!0);if(o)return o(h,!0);var f=new Error("Cannot find module '"+h+"'");throw f.code="MODULE_NOT_FOUND",f}var d=i[h]={exports:{}};s[h][0].call(d.exports,function(g){var m=s[h][1][g];return r(m||g)},d,d.exports,t,s,i,n)}return i[h].exports}for(var o=typeof Ri=="function"&&Ri,l=0;l<n.length;l++)r(n[l]);return r}({1:[function(t,s,i){var n=t("./utils"),r=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(l){for(var h,c,u,f,d,g,m,v=[],p=0,_=l.length,b=_,E=n.getTypeOf(l)!=="string";p<l.length;)b=_-p,u=E?(h=l[p++],c=p<_?l[p++]:0,p<_?l[p++]:0):(h=l.charCodeAt(p++),c=p<_?l.charCodeAt(p++):0,p<_?l.charCodeAt(p++):0),f=h>>2,d=(3&h)<<4|c>>4,g=1<b?(15&c)<<2|u>>6:64,m=2<b?63&u:64,v.push(o.charAt(f)+o.charAt(d)+o.charAt(g)+o.charAt(m));return v.join("")},i.decode=function(l){var h,c,u,f,d,g,m=0,v=0,p="data:";if(l.substr(0,p.length)===p)throw new Error("Invalid base64 input, it looks like a data url.");var _,b=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&b--,l.charAt(l.length-2)===o.charAt(64)&&b--,b%1!=0)throw new Error("Invalid base64 input, bad content length.");for(_=r.uint8array?new Uint8Array(0|b):new Array(0|b);m<l.length;)h=o.indexOf(l.charAt(m++))<<2|(f=o.indexOf(l.charAt(m++)))>>4,c=(15&f)<<4|(d=o.indexOf(l.charAt(m++)))>>2,u=(3&d)<<6|(g=o.indexOf(l.charAt(m++))),_[v++]=h,d!==64&&(_[v++]=c),g!==64&&(_[v++]=u);return _}},{"./support":30,"./utils":32}],2:[function(t,s,i){var n=t("./external"),r=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function h(c,u,f,d,g){this.compressedSize=c,this.uncompressedSize=u,this.crc32=f,this.compression=d,this.compressedContent=g}h.prototype={getContentWorker:function(){var c=new r(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),u=this;return c.on("end",function(){if(this.streamInfo.data_length!==u.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},getCompressedWorker:function(){return new r(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(c,u,f){return c.pipe(new o).pipe(new l("uncompressedSize")).pipe(u.compressWorker(f)).pipe(new l("compressedSize")).withStreamInfo("compression",u)},s.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,s,i){var n=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,s,i){var n=t("./utils"),r=function(){for(var o,l=[],h=0;h<256;h++){o=h;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;l[h]=o}return l}();s.exports=function(o,l){return o!==void 0&&o.length?n.getTypeOf(o)!=="string"?function(h,c,u,f){var d=r,g=f+u;h^=-1;for(var m=f;m<g;m++)h=h>>>8^d[255&(h^c[m])];return-1^h}(0|l,o,o.length,0):function(h,c,u,f){var d=r,g=f+u;h^=-1;for(var m=f;m<g;m++)h=h>>>8^d[255&(h^c.charCodeAt(m))];return-1^h}(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(t,s,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,s,i){var n=null;n=typeof Promise<"u"?Promise:t("lie"),s.exports={Promise:n}},{lie:37}],7:[function(t,s,i){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=t("pako"),o=t("./utils"),l=t("./stream/GenericWorker"),h=n?"uint8array":"array";function c(u,f){l.call(this,"FlateWorker/"+u),this._pako=null,this._pakoAction=u,this._pakoOptions=f,this.meta={}}i.magic="\b\0",o.inherits(c,l),c.prototype.processChunk=function(u){this.meta=u.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(h,u.data),!1)},c.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var u=this;this._pako.onData=function(f){u.push({data:f,meta:u.meta})}},i.compressWorker=function(u){return new c("Deflate",u)},i.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,s,i){function n(d,g){var m,v="";for(m=0;m<g;m++)v+=String.fromCharCode(255&d),d>>>=8;return v}function r(d,g,m,v,p,_){var b,E,S=d.file,A=d.compression,P=_!==h.utf8encode,D=o.transformTo("string",_(S.name)),I=o.transformTo("string",h.utf8encode(S.name)),k=S.comment,V=o.transformTo("string",_(k)),C=o.transformTo("string",h.utf8encode(k)),z=I.length!==S.name.length,w=C.length!==k.length,B="",G="",X="",te=S.dir,W=S.date,se={crc32:0,compressedSize:0,uncompressedSize:0};g&&!m||(se.crc32=d.crc32,se.compressedSize=d.compressedSize,se.uncompressedSize=d.uncompressedSize);var R=0;g&&(R|=8),P||!z&&!w||(R|=2048);var U=0,ne=0;te&&(U|=16),p==="UNIX"?(ne=798,U|=function(J,pe){var ve=J;return J||(ve=pe?16893:33204),(65535&ve)<<16}(S.unixPermissions,te)):(ne=20,U|=function(J){return 63&(J||0)}(S.dosPermissions)),b=W.getUTCHours(),b<<=6,b|=W.getUTCMinutes(),b<<=5,b|=W.getUTCSeconds()/2,E=W.getUTCFullYear()-1980,E<<=4,E|=W.getUTCMonth()+1,E<<=5,E|=W.getUTCDate(),z&&(G=n(1,1)+n(c(D),4)+I,B+="up"+n(G.length,2)+G),w&&(X=n(1,1)+n(c(V),4)+C,B+="uc"+n(X.length,2)+X);var ee="";return ee+=`
\0`,ee+=n(R,2),ee+=A.magic,ee+=n(b,2),ee+=n(E,2),ee+=n(se.crc32,4),ee+=n(se.compressedSize,4),ee+=n(se.uncompressedSize,4),ee+=n(D.length,2),ee+=n(B.length,2),{fileRecord:u.LOCAL_FILE_HEADER+ee+D+B,dirRecord:u.CENTRAL_FILE_HEADER+n(ne,2)+ee+n(V.length,2)+"\0\0\0\0"+n(U,4)+n(v,4)+D+B+V}}var o=t("../utils"),l=t("../stream/GenericWorker"),h=t("../utf8"),c=t("../crc32"),u=t("../signature");function f(d,g,m,v){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=m,this.encodeFileName=v,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(f,l),f.prototype.push=function(d){var g=d.meta.percent||0,m=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,l.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:m?(g+100*(m-v-1))/m:100}}))},f.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var g=this.streamFiles&&!d.file.dir;if(g){var m=r(d,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(d){this.accumulate=!1;var g=this.streamFiles&&!d.file.dir,m=r(d,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),g)this.push({data:function(v){return u.DATA_DESCRIPTOR+n(v.crc32,4)+n(v.compressedSize,4)+n(v.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var d=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var m=this.bytesWritten-d,v=function(p,_,b,E,S){var A=o.transformTo("string",S(E));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(p,2)+n(p,2)+n(_,4)+n(b,4)+n(A.length,2)+A}(this.dirRecords.length,m,d,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(d){this._sources.push(d);var g=this;return d.on("data",function(m){g.processChunk(m)}),d.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),d.on("error",function(m){g.error(m)}),this},f.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(d){var g=this._sources;if(!l.prototype.error.call(this,d))return!1;for(var m=0;m<g.length;m++)try{g[m].error(d)}catch{}return!0},f.prototype.lock=function(){l.prototype.lock.call(this);for(var d=this._sources,g=0;g<d.length;g++)d[g].lock()},s.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,s,i){var n=t("../compressions"),r=t("./ZipFileWorker");i.generateWorker=function(o,l,h){var c=new r(l.streamFiles,h,l.platform,l.encodeFileName),u=0;try{o.forEach(function(f,d){u++;var g=function(_,b){var E=_||b,S=n[E];if(!S)throw new Error(E+" is not a valid compression method !");return S}(d.options.compression,l.compression),m=d.options.compressionOptions||l.compressionOptions||{},v=d.dir,p=d.date;d._compressWorker(g,m).withStreamInfo("file",{name:f,dir:v,date:p,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(c)}),c.entriesCount=u}catch(f){c.error(f)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,s,i){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new n;for(var o in this)typeof this[o]!="function"&&(r[o]=this[o]);return r}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.10.1",n.loadAsync=function(r,o){return new n().loadAsync(r,o)},n.external=t("./external"),s.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,s,i){var n=t("./utils"),r=t("./external"),o=t("./utf8"),l=t("./zipEntries"),h=t("./stream/Crc32Probe"),c=t("./nodejsUtils");function u(f){return new r.Promise(function(d,g){var m=f.decompressed.getContentWorker().pipe(new h);m.on("error",function(v){g(v)}).on("end",function(){m.streamInfo.crc32!==f.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}s.exports=function(f,d){var g=this;return d=n.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),c.isNode&&c.isStream(f)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",f,!0,d.optimizedBinaryString,d.base64).then(function(m){var v=new l(d);return v.load(m),v}).then(function(m){var v=[r.Promise.resolve(m)],p=m.files;if(d.checkCRC32)for(var _=0;_<p.length;_++)v.push(u(p[_]));return r.Promise.all(v)}).then(function(m){for(var v=m.shift(),p=v.files,_=0;_<p.length;_++){var b=p[_],E=b.fileNameStr,S=n.resolve(b.fileNameStr);g.file(S,b.decompressed,{binary:!0,optimizedBinaryString:!0,date:b.date,dir:b.dir,comment:b.fileCommentStr.length?b.fileCommentStr:null,unixPermissions:b.unixPermissions,dosPermissions:b.dosPermissions,createFolders:d.createFolders}),b.dir||(g.file(S).unsafeOriginalName=E)}return v.zipComment.length&&(g.comment=v.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,s,i){var n=t("../utils"),r=t("../stream/GenericWorker");function o(l,h){r.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(h)}n.inherits(o,r),o.prototype._bindStream=function(l){var h=this;(this._stream=l).pause(),l.on("data",function(c){h.push({data:c,meta:{percent:0}})}).on("error",function(c){h.isPaused?this.generatedError=c:h.error(c)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},o.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,s,i){var n=t("readable-stream").Readable;function r(o,l,h){n.call(this,l),this._helper=o;var c=this;o.on("data",function(u,f){c.push(u)||c._helper.pause(),h&&h(f)}).on("error",function(u){c.emit("error",u)}).on("end",function(){c.push(null)})}t("../utils").inherits(r,n),r.prototype._read=function(){this._helper.resume()},s.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,s,i){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,r);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,r)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var r=new Buffer(n);return r.fill(0),r},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(t,s,i){function n(S,A,P){var D,I=o.getTypeOf(A),k=o.extend(P||{},c);k.date=k.date||new Date,k.compression!==null&&(k.compression=k.compression.toUpperCase()),typeof k.unixPermissions=="string"&&(k.unixPermissions=parseInt(k.unixPermissions,8)),k.unixPermissions&&16384&k.unixPermissions&&(k.dir=!0),k.dosPermissions&&16&k.dosPermissions&&(k.dir=!0),k.dir&&(S=p(S)),k.createFolders&&(D=v(S))&&_.call(this,D,!0);var V=I==="string"&&k.binary===!1&&k.base64===!1;P&&P.binary!==void 0||(k.binary=!V),(A instanceof u&&A.uncompressedSize===0||k.dir||!A||A.length===0)&&(k.base64=!1,k.binary=!0,A="",k.compression="STORE",I="string");var C=null;C=A instanceof u||A instanceof l?A:g.isNode&&g.isStream(A)?new m(S,A):o.prepareContent(S,A,k.binary,k.optimizedBinaryString,k.base64);var z=new f(S,C,k);this.files[S]=z}var r=t("./utf8"),o=t("./utils"),l=t("./stream/GenericWorker"),h=t("./stream/StreamHelper"),c=t("./defaults"),u=t("./compressedObject"),f=t("./zipObject"),d=t("./generate"),g=t("./nodejsUtils"),m=t("./nodejs/NodejsStreamInputAdapter"),v=function(S){S.slice(-1)==="/"&&(S=S.substring(0,S.length-1));var A=S.lastIndexOf("/");return 0<A?S.substring(0,A):""},p=function(S){return S.slice(-1)!=="/"&&(S+="/"),S},_=function(S,A){return A=A!==void 0?A:c.createFolders,S=p(S),this.files[S]||n.call(this,S,null,{dir:!0,createFolders:A}),this.files[S]};function b(S){return Object.prototype.toString.call(S)==="[object RegExp]"}var E={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(S){var A,P,D;for(A in this.files)D=this.files[A],(P=A.slice(this.root.length,A.length))&&A.slice(0,this.root.length)===this.root&&S(P,D)},filter:function(S){var A=[];return this.forEach(function(P,D){S(P,D)&&A.push(D)}),A},file:function(S,A,P){if(arguments.length!==1)return S=this.root+S,n.call(this,S,A,P),this;if(b(S)){var D=S;return this.filter(function(k,V){return!V.dir&&D.test(k)})}var I=this.files[this.root+S];return I&&!I.dir?I:null},folder:function(S){if(!S)return this;if(b(S))return this.filter(function(I,k){return k.dir&&S.test(I)});var A=this.root+S,P=_.call(this,A),D=this.clone();return D.root=P.name,D},remove:function(S){S=this.root+S;var A=this.files[S];if(A||(S.slice(-1)!=="/"&&(S+="/"),A=this.files[S]),A&&!A.dir)delete this.files[S];else for(var P=this.filter(function(I,k){return k.name.slice(0,S.length)===S}),D=0;D<P.length;D++)delete this.files[P[D].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(S){var A,P={};try{if((P=o.extend(S||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=P.type.toLowerCase(),P.compression=P.compression.toUpperCase(),P.type==="binarystring"&&(P.type="string"),!P.type)throw new Error("No output type specified.");o.checkSupport(P.type),P.platform!=="darwin"&&P.platform!=="freebsd"&&P.platform!=="linux"&&P.platform!=="sunos"||(P.platform="UNIX"),P.platform==="win32"&&(P.platform="DOS");var D=P.comment||this.comment||"";A=d.generateWorker(this,P,D)}catch(I){(A=new l("error")).error(I)}return new h(A,P.type||"string",P.mimeType)},generateAsync:function(S,A){return this.generateInternalStream(S).accumulate(A)},generateNodeStream:function(S,A){return(S=S||{}).type||(S.type="nodebuffer"),this.generateInternalStream(S).toNodejsStream(A)}};s.exports=E},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,s,i){s.exports=t("stream")},{stream:void 0}],17:[function(t,s,i){var n=t("./DataReader");function r(o){n.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}t("../utils").inherits(r,n),r.prototype.byteAt=function(o){return this.data[this.zero+o]},r.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),h=o.charCodeAt(1),c=o.charCodeAt(2),u=o.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===l&&this.data[f+1]===h&&this.data[f+2]===c&&this.data[f+3]===u)return f-this.zero;return-1},r.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),h=o.charCodeAt(1),c=o.charCodeAt(2),u=o.charCodeAt(3),f=this.readData(4);return l===f[0]&&h===f[1]&&c===f[2]&&u===f[3]},r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,s,i){var n=t("../utils");function r(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,h=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)h=(h<<8)+this.byteAt(l);return this.index+=o,h},readString:function(o){return n.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},s.exports=r},{"../utils":32}],19:[function(t,s,i){var n=t("./Uint8ArrayReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,s,i){var n=t("./DataReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},r.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},r.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},r.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,s,i){var n=t("./ArrayReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,s,i){var n=t("../utils"),r=t("../support"),o=t("./ArrayReader"),l=t("./StringReader"),h=t("./NodeBufferReader"),c=t("./Uint8ArrayReader");s.exports=function(u){var f=n.getTypeOf(u);return n.checkSupport(f),f!=="string"||r.uint8array?f==="nodebuffer"?new h(u):r.uint8array?new c(n.transformTo("uint8array",u)):new o(n.transformTo("array",u)):new l(u)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,s,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,s,i){var n=t("./GenericWorker"),r=t("../utils");function o(l){n.call(this,"ConvertWorker to "+l),this.destType=l}r.inherits(o,n),o.prototype.processChunk=function(l){this.push({data:r.transformTo(this.destType,l.data),meta:l.meta})},s.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,s,i){var n=t("./GenericWorker"),r=t("../crc32");function o(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,n),o.prototype.processChunk=function(l){this.streamInfo.crc32=r(l.data,this.streamInfo.crc32||0),this.push(l)},s.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,s,i){var n=t("../utils"),r=t("./GenericWorker");function o(l){r.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}n.inherits(o,r),o.prototype.processChunk=function(l){if(l){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+l.data.length}r.prototype.processChunk.call(this,l)},s.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,s,i){var n=t("../utils"),r=t("./GenericWorker");function o(l){r.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(c){h.dataIsReady=!0,h.data=c,h.max=c&&c.length||0,h.type=n.getTypeOf(c),h.isPaused||h._tickAndRepeat()},function(c){h.error(c)})}n.inherits(o,r),o.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,h);break;case"uint8array":l=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":l=this.data.slice(this.index,h)}return this.index=h,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,s,i){function n(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,o){return this._listeners[r].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,o){if(this._listeners[r])for(var l=0;l<this._listeners[r].length;l++)this._listeners[r][l].call(this,o)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var o=this;return r.on("data",function(l){o.processChunk(l)}),r.on("end",function(){o.end()}),r.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,o){return this.extraStreamInfo[r]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},s.exports=n},{}],29:[function(t,s,i){var n=t("../utils"),r=t("./ConvertWorker"),o=t("./GenericWorker"),l=t("../base64"),h=t("../support"),c=t("../external"),u=null;if(h.nodestream)try{u=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(g,m){return new c.Promise(function(v,p){var _=[],b=g._internalType,E=g._outputType,S=g._mimeType;g.on("data",function(A,P){_.push(A),m&&m(P)}).on("error",function(A){_=[],p(A)}).on("end",function(){try{var A=function(P,D,I){switch(P){case"blob":return n.newBlob(n.transformTo("arraybuffer",D),I);case"base64":return l.encode(D);default:return n.transformTo(P,D)}}(E,function(P,D){var I,k=0,V=null,C=0;for(I=0;I<D.length;I++)C+=D[I].length;switch(P){case"string":return D.join("");case"array":return Array.prototype.concat.apply([],D);case"uint8array":for(V=new Uint8Array(C),I=0;I<D.length;I++)V.set(D[I],k),k+=D[I].length;return V;case"nodebuffer":return Buffer.concat(D);default:throw new Error("concat : unsupported type '"+P+"'")}}(b,_),S);v(A)}catch(P){p(P)}_=[]}).resume()})}function d(g,m,v){var p=m;switch(m){case"blob":case"arraybuffer":p="uint8array";break;case"base64":p="string"}try{this._internalType=p,this._outputType=m,this._mimeType=v,n.checkSupport(p),this._worker=g.pipe(new r(p)),g.lock()}catch(_){this._worker=new o("error"),this._worker.error(_)}}d.prototype={accumulate:function(g){return f(this,g)},on:function(g,m){var v=this;return g==="data"?this._worker.on(g,function(p){m.call(v,p.data,p.meta)}):this._worker.on(g,function(){n.delay(m,arguments,v)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:this._outputType!=="nodebuffer"},g)}},s.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,s,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var n=new ArrayBuffer(0);try{i.blob=new Blob([n],{type:"application/zip"}).size===0}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(n),i.blob=r.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(t,s,i){for(var n=t("./utils"),r=t("./support"),o=t("./nodejsUtils"),l=t("./stream/GenericWorker"),h=new Array(256),c=0;c<256;c++)h[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;h[254]=h[254]=1;function u(){l.call(this,"utf-8 decode"),this.leftOver=null}function f(){l.call(this,"utf-8 encode")}i.utf8encode=function(d){return r.nodebuffer?o.newBufferFrom(d,"utf-8"):function(g){var m,v,p,_,b,E=g.length,S=0;for(_=0;_<E;_++)(64512&(v=g.charCodeAt(_)))==55296&&_+1<E&&(64512&(p=g.charCodeAt(_+1)))==56320&&(v=65536+(v-55296<<10)+(p-56320),_++),S+=v<128?1:v<2048?2:v<65536?3:4;for(m=r.uint8array?new Uint8Array(S):new Array(S),_=b=0;b<S;_++)(64512&(v=g.charCodeAt(_)))==55296&&_+1<E&&(64512&(p=g.charCodeAt(_+1)))==56320&&(v=65536+(v-55296<<10)+(p-56320),_++),v<128?m[b++]=v:(v<2048?m[b++]=192|v>>>6:(v<65536?m[b++]=224|v>>>12:(m[b++]=240|v>>>18,m[b++]=128|v>>>12&63),m[b++]=128|v>>>6&63),m[b++]=128|63&v);return m}(d)},i.utf8decode=function(d){return r.nodebuffer?n.transformTo("nodebuffer",d).toString("utf-8"):function(g){var m,v,p,_,b=g.length,E=new Array(2*b);for(m=v=0;m<b;)if((p=g[m++])<128)E[v++]=p;else if(4<(_=h[p]))E[v++]=65533,m+=_-1;else{for(p&=_===2?31:_===3?15:7;1<_&&m<b;)p=p<<6|63&g[m++],_--;1<_?E[v++]=65533:p<65536?E[v++]=p:(p-=65536,E[v++]=55296|p>>10&1023,E[v++]=56320|1023&p)}return E.length!==v&&(E.subarray?E=E.subarray(0,v):E.length=v),n.applyFromCharCode(E)}(d=n.transformTo(r.uint8array?"uint8array":"array",d))},n.inherits(u,l),u.prototype.processChunk=function(d){var g=n.transformTo(r.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var m=g;(g=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),g.set(m,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var v=function(_,b){var E;for((b=b||_.length)>_.length&&(b=_.length),E=b-1;0<=E&&(192&_[E])==128;)E--;return E<0||E===0?b:E+h[_[E]]>b?E:b}(g),p=g;v!==g.length&&(r.uint8array?(p=g.subarray(0,v),this.leftOver=g.subarray(v,g.length)):(p=g.slice(0,v),this.leftOver=g.slice(v,g.length))),this.push({data:i.utf8decode(p),meta:d.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=u,n.inherits(f,l),f.prototype.processChunk=function(d){this.push({data:i.utf8encode(d.data),meta:d.meta})},i.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,s,i){var n=t("./support"),r=t("./base64"),o=t("./nodejsUtils"),l=t("./external");function h(m){return m}function c(m,v){for(var p=0;p<m.length;++p)v[p]=255&m.charCodeAt(p);return v}t("setimmediate"),i.newBlob=function(m,v){i.checkSupport("blob");try{return new Blob([m],{type:v})}catch{try{var p=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return p.append(m),p.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(m,v,p){var _=[],b=0,E=m.length;if(E<=p)return String.fromCharCode.apply(null,m);for(;b<E;)v==="array"||v==="nodebuffer"?_.push(String.fromCharCode.apply(null,m.slice(b,Math.min(b+p,E)))):_.push(String.fromCharCode.apply(null,m.subarray(b,Math.min(b+p,E)))),b+=p;return _.join("")},stringifyByChar:function(m){for(var v="",p=0;p<m.length;p++)v+=String.fromCharCode(m[p]);return v},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function f(m){var v=65536,p=i.getTypeOf(m),_=!0;if(p==="uint8array"?_=u.applyCanBeUsed.uint8array:p==="nodebuffer"&&(_=u.applyCanBeUsed.nodebuffer),_)for(;1<v;)try{return u.stringifyByChunk(m,p,v)}catch{v=Math.floor(v/2)}return u.stringifyByChar(m)}function d(m,v){for(var p=0;p<m.length;p++)v[p]=m[p];return v}i.applyFromCharCode=f;var g={};g.string={string:h,array:function(m){return c(m,new Array(m.length))},arraybuffer:function(m){return g.string.uint8array(m).buffer},uint8array:function(m){return c(m,new Uint8Array(m.length))},nodebuffer:function(m){return c(m,o.allocBuffer(m.length))}},g.array={string:f,array:h,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return o.newBufferFrom(m)}},g.arraybuffer={string:function(m){return f(new Uint8Array(m))},array:function(m){return d(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:h,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return o.newBufferFrom(new Uint8Array(m))}},g.uint8array={string:f,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:h,nodebuffer:function(m){return o.newBufferFrom(m)}},g.nodebuffer={string:f,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return g.nodebuffer.uint8array(m).buffer},uint8array:function(m){return d(m,new Uint8Array(m.length))},nodebuffer:h},i.transformTo=function(m,v){if(v=v||"",!m)return v;i.checkSupport(m);var p=i.getTypeOf(v);return g[p][m](v)},i.resolve=function(m){for(var v=m.split("/"),p=[],_=0;_<v.length;_++){var b=v[_];b==="."||b===""&&_!==0&&_!==v.length-1||(b===".."?p.pop():p.push(b))}return p.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":n.nodebuffer&&o.isBuffer(m)?"nodebuffer":n.uint8array&&m instanceof Uint8Array?"uint8array":n.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!n[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var v,p,_="";for(p=0;p<(m||"").length;p++)_+="\\x"+((v=m.charCodeAt(p))<16?"0":"")+v.toString(16).toUpperCase();return _},i.delay=function(m,v,p){setImmediate(function(){m.apply(p||null,v||[])})},i.inherits=function(m,v){function p(){}p.prototype=v.prototype,m.prototype=new p},i.extend=function(){var m,v,p={};for(m=0;m<arguments.length;m++)for(v in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],v)&&p[v]===void 0&&(p[v]=arguments[m][v]);return p},i.prepareContent=function(m,v,p,_,b){return l.Promise.resolve(v).then(function(E){return n.blob&&(E instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(E))!==-1)&&typeof FileReader<"u"?new l.Promise(function(S,A){var P=new FileReader;P.onload=function(D){S(D.target.result)},P.onerror=function(D){A(D.target.error)},P.readAsArrayBuffer(E)}):E}).then(function(E){var S=i.getTypeOf(E);return S?(S==="arraybuffer"?E=i.transformTo("uint8array",E):S==="string"&&(b?E=r.decode(E):p&&_!==!0&&(E=function(A){return c(A,n.uint8array?new Uint8Array(A.length):new Array(A.length))}(E))),E):l.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,s,i){var n=t("./reader/readerFor"),r=t("./utils"),o=t("./signature"),l=t("./zipEntry"),h=t("./support");function c(u){this.files=[],this.loadOptions=u}c.prototype={checkSignature:function(u){if(!this.reader.readAndCheckSignature(u)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(f)+", expected "+r.pretty(u)+")")}},isSignature:function(u,f){var d=this.reader.index;this.reader.setIndex(u);var g=this.reader.readString(4)===f;return this.reader.setIndex(d),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var u=this.reader.readData(this.zipCommentLength),f=h.uint8array?"uint8array":"array",d=r.transformTo(f,u);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var u,f,d,g=this.zip64EndOfCentralSize-44;0<g;)u=this.reader.readInt(2),f=this.reader.readInt(4),d=this.reader.readData(f),this.zip64ExtensibleData[u]={id:u,length:f,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var u,f;for(u=0;u<this.files.length;u++)f=this.files[u],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var u;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(u=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(u);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var u=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(u<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(u);var f=u;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(u=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(u),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var g=f-d;if(0<g)this.isSignature(f,o.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(u){this.reader=n(u)},load:function(u){this.prepareReader(u),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,s,i){var n=t("./reader/readerFor"),r=t("./utils"),o=t("./compressedObject"),l=t("./crc32"),h=t("./utf8"),c=t("./compressions"),u=t("./support");function f(d,g){this.options=d,this.loadOptions=g}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var g,m;if(d.skip(22),this.fileNameLength=d.readInt(2),m=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((g=function(v){for(var p in c)if(Object.prototype.hasOwnProperty.call(c,p)&&c[p].magic===v)return c[p];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,g,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var g=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(g),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=n(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var g,m,v,p=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<p;)g=d.readInt(2),m=d.readInt(2),v=d.readData(m),this.extraFields[g]={id:g,length:m,value:v};d.setIndex(p)},handleUTF8:function(){var d=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(g!==null)this.fileNameStr=g;else{var m=r.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var p=r.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(p)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var g=n(d.value);return g.readInt(1)!==1||l(this.fileName)!==g.readInt(4)?null:h.utf8decode(g.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var g=n(d.value);return g.readInt(1)!==1||l(this.fileComment)!==g.readInt(4)?null:h.utf8decode(g.readData(d.length-5))}return null}},s.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,s,i){function n(g,m,v){this.name=g,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=m,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}var r=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),l=t("./utf8"),h=t("./compressedObject"),c=t("./stream/GenericWorker");n.prototype={internalStream:function(g){var m=null,v="string";try{if(!g)throw new Error("No output type specified.");var p=(v=g.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),m=this._decompressWorker();var _=!this._dataBinary;_&&!p&&(m=m.pipe(new l.Utf8EncodeWorker)),!_&&p&&(m=m.pipe(new l.Utf8DecodeWorker))}catch(b){(m=new c("error")).error(b)}return new r(m,v,"")},async:function(g,m){return this.internalStream(g).accumulate(m)},nodeStream:function(g,m){return this.internalStream(g||"nodebuffer").toNodejsStream(m)},_compressWorker:function(g,m){if(this._data instanceof h&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new l.Utf8EncodeWorker)),h.createWorkerFrom(v,g,m)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof c?this._data:new o(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<u.length;d++)n.prototype[u[d]]=f;s.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,s,i){(function(n){var r,o,l=n.MutationObserver||n.WebKitMutationObserver;if(l){var h=0,c=new l(g),u=n.document.createTextNode("");c.observe(u,{characterData:!0}),r=function(){u.data=h=++h%2}}else if(n.setImmediate||n.MessageChannel===void 0)r="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var m=n.document.createElement("script");m.onreadystatechange=function(){g(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},n.document.documentElement.appendChild(m)}:function(){setTimeout(g,0)};else{var f=new n.MessageChannel;f.port1.onmessage=g,r=function(){f.port2.postMessage(0)}}var d=[];function g(){var m,v;o=!0;for(var p=d.length;p;){for(v=d,d=[],m=-1;++m<p;)v[m]();p=d.length}o=!1}s.exports=function(m){d.push(m)!==1||o||r()}}).call(this,typeof yi<"u"?yi:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,s,i){var n=t("immediate");function r(){}var o={},l=["REJECTED"],h=["FULFILLED"],c=["PENDING"];function u(p){if(typeof p!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,p!==r&&m(this,p)}function f(p,_,b){this.promise=p,typeof _=="function"&&(this.onFulfilled=_,this.callFulfilled=this.otherCallFulfilled),typeof b=="function"&&(this.onRejected=b,this.callRejected=this.otherCallRejected)}function d(p,_,b){n(function(){var E;try{E=_(b)}catch(S){return o.reject(p,S)}E===p?o.reject(p,new TypeError("Cannot resolve promise with itself")):o.resolve(p,E)})}function g(p){var _=p&&p.then;if(p&&(typeof p=="object"||typeof p=="function")&&typeof _=="function")return function(){_.apply(p,arguments)}}function m(p,_){var b=!1;function E(P){b||(b=!0,o.reject(p,P))}function S(P){b||(b=!0,o.resolve(p,P))}var A=v(function(){_(S,E)});A.status==="error"&&E(A.value)}function v(p,_){var b={};try{b.value=p(_),b.status="success"}catch(E){b.status="error",b.value=E}return b}(s.exports=u).prototype.finally=function(p){if(typeof p!="function")return this;var _=this.constructor;return this.then(function(b){return _.resolve(p()).then(function(){return b})},function(b){return _.resolve(p()).then(function(){throw b})})},u.prototype.catch=function(p){return this.then(null,p)},u.prototype.then=function(p,_){if(typeof p!="function"&&this.state===h||typeof _!="function"&&this.state===l)return this;var b=new this.constructor(r);return this.state!==c?d(b,this.state===h?p:_,this.outcome):this.queue.push(new f(b,p,_)),b},f.prototype.callFulfilled=function(p){o.resolve(this.promise,p)},f.prototype.otherCallFulfilled=function(p){d(this.promise,this.onFulfilled,p)},f.prototype.callRejected=function(p){o.reject(this.promise,p)},f.prototype.otherCallRejected=function(p){d(this.promise,this.onRejected,p)},o.resolve=function(p,_){var b=v(g,_);if(b.status==="error")return o.reject(p,b.value);var E=b.value;if(E)m(p,E);else{p.state=h,p.outcome=_;for(var S=-1,A=p.queue.length;++S<A;)p.queue[S].callFulfilled(_)}return p},o.reject=function(p,_){p.state=l,p.outcome=_;for(var b=-1,E=p.queue.length;++b<E;)p.queue[b].callRejected(_);return p},u.resolve=function(p){return p instanceof this?p:o.resolve(new this(r),p)},u.reject=function(p){var _=new this(r);return o.reject(_,p)},u.all=function(p){var _=this;if(Object.prototype.toString.call(p)!=="[object Array]")return this.reject(new TypeError("must be an array"));var b=p.length,E=!1;if(!b)return this.resolve([]);for(var S=new Array(b),A=0,P=-1,D=new this(r);++P<b;)I(p[P],P);return D;function I(k,V){_.resolve(k).then(function(C){S[V]=C,++A!==b||E||(E=!0,o.resolve(D,S))},function(C){E||(E=!0,o.reject(D,C))})}},u.race=function(p){var _=this;if(Object.prototype.toString.call(p)!=="[object Array]")return this.reject(new TypeError("must be an array"));var b=p.length,E=!1;if(!b)return this.resolve([]);for(var S=-1,A=new this(r);++S<b;)P=p[S],_.resolve(P).then(function(D){E||(E=!0,o.resolve(A,D))},function(D){E||(E=!0,o.reject(A,D))});var P;return A}},{immediate:36}],38:[function(t,s,i){var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),s.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,s,i){var n=t("./zlib/deflate"),r=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/messages"),h=t("./zlib/zstream"),c=Object.prototype.toString,u=0,f=-1,d=0,g=8;function m(p){if(!(this instanceof m))return new m(p);this.options=r.assign({level:f,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},p||{});var _=this.options;_.raw&&0<_.windowBits?_.windowBits=-_.windowBits:_.gzip&&0<_.windowBits&&_.windowBits<16&&(_.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var b=n.deflateInit2(this.strm,_.level,_.method,_.windowBits,_.memLevel,_.strategy);if(b!==u)throw new Error(l[b]);if(_.header&&n.deflateSetHeader(this.strm,_.header),_.dictionary){var E;if(E=typeof _.dictionary=="string"?o.string2buf(_.dictionary):c.call(_.dictionary)==="[object ArrayBuffer]"?new Uint8Array(_.dictionary):_.dictionary,(b=n.deflateSetDictionary(this.strm,E))!==u)throw new Error(l[b]);this._dict_set=!0}}function v(p,_){var b=new m(_);if(b.push(p,!0),b.err)throw b.msg||l[b.err];return b.result}m.prototype.push=function(p,_){var b,E,S=this.strm,A=this.options.chunkSize;if(this.ended)return!1;E=_===~~_?_:_===!0?4:0,typeof p=="string"?S.input=o.string2buf(p):c.call(p)==="[object ArrayBuffer]"?S.input=new Uint8Array(p):S.input=p,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new r.Buf8(A),S.next_out=0,S.avail_out=A),(b=n.deflate(S,E))!==1&&b!==u)return this.onEnd(b),!(this.ended=!0);S.avail_out!==0&&(S.avail_in!==0||E!==4&&E!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(r.shrinkBuf(S.output,S.next_out))):this.onData(r.shrinkBuf(S.output,S.next_out)))}while((0<S.avail_in||S.avail_out===0)&&b!==1);return E===4?(b=n.deflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===u):E!==2||(this.onEnd(u),!(S.avail_out=0))},m.prototype.onData=function(p){this.chunks.push(p)},m.prototype.onEnd=function(p){p===u&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Deflate=m,i.deflate=v,i.deflateRaw=function(p,_){return(_=_||{}).raw=!0,v(p,_)},i.gzip=function(p,_){return(_=_||{}).gzip=!0,v(p,_)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,s,i){var n=t("./zlib/inflate"),r=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/constants"),h=t("./zlib/messages"),c=t("./zlib/zstream"),u=t("./zlib/gzheader"),f=Object.prototype.toString;function d(m){if(!(this instanceof d))return new d(m);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},m||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||m&&m.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&!(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var p=n.inflateInit2(this.strm,v.windowBits);if(p!==l.Z_OK)throw new Error(h[p]);this.header=new u,n.inflateGetHeader(this.strm,this.header)}function g(m,v){var p=new d(v);if(p.push(m,!0),p.err)throw p.msg||h[p.err];return p.result}d.prototype.push=function(m,v){var p,_,b,E,S,A,P=this.strm,D=this.options.chunkSize,I=this.options.dictionary,k=!1;if(this.ended)return!1;_=v===~~v?v:v===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof m=="string"?P.input=o.binstring2buf(m):f.call(m)==="[object ArrayBuffer]"?P.input=new Uint8Array(m):P.input=m,P.next_in=0,P.avail_in=P.input.length;do{if(P.avail_out===0&&(P.output=new r.Buf8(D),P.next_out=0,P.avail_out=D),(p=n.inflate(P,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&I&&(A=typeof I=="string"?o.string2buf(I):f.call(I)==="[object ArrayBuffer]"?new Uint8Array(I):I,p=n.inflateSetDictionary(this.strm,A)),p===l.Z_BUF_ERROR&&k===!0&&(p=l.Z_OK,k=!1),p!==l.Z_STREAM_END&&p!==l.Z_OK)return this.onEnd(p),!(this.ended=!0);P.next_out&&(P.avail_out!==0&&p!==l.Z_STREAM_END&&(P.avail_in!==0||_!==l.Z_FINISH&&_!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(b=o.utf8border(P.output,P.next_out),E=P.next_out-b,S=o.buf2string(P.output,b),P.next_out=E,P.avail_out=D-E,E&&r.arraySet(P.output,P.output,b,E,0),this.onData(S)):this.onData(r.shrinkBuf(P.output,P.next_out)))),P.avail_in===0&&P.avail_out===0&&(k=!0)}while((0<P.avail_in||P.avail_out===0)&&p!==l.Z_STREAM_END);return p===l.Z_STREAM_END&&(_=l.Z_FINISH),_===l.Z_FINISH?(p=n.inflateEnd(this.strm),this.onEnd(p),this.ended=!0,p===l.Z_OK):_!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(P.avail_out=0))},d.prototype.onData=function(m){this.chunks.push(m)},d.prototype.onEnd=function(m){m===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=d,i.inflate=g,i.inflateRaw=function(m,v){return(v=v||{}).raw=!0,g(m,v)},i.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,s,i){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(l){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var c=h.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var u in c)c.hasOwnProperty(u)&&(l[u]=c[u])}}return l},i.shrinkBuf=function(l,h){return l.length===h?l:l.subarray?l.subarray(0,h):(l.length=h,l)};var r={arraySet:function(l,h,c,u,f){if(h.subarray&&l.subarray)l.set(h.subarray(c,c+u),f);else for(var d=0;d<u;d++)l[f+d]=h[c+d]},flattenChunks:function(l){var h,c,u,f,d,g;for(h=u=0,c=l.length;h<c;h++)u+=l[h].length;for(g=new Uint8Array(u),h=f=0,c=l.length;h<c;h++)d=l[h],g.set(d,f),f+=d.length;return g}},o={arraySet:function(l,h,c,u,f){for(var d=0;d<u;d++)l[f+d]=h[c+d]},flattenChunks:function(l){return[].concat.apply([],l)}};i.setTyped=function(l){l?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,r)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(n)},{}],42:[function(t,s,i){var n=t("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new n.Buf8(256),h=0;h<256;h++)l[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function c(u,f){if(f<65537&&(u.subarray&&o||!u.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(u,f));for(var d="",g=0;g<f;g++)d+=String.fromCharCode(u[g]);return d}l[254]=l[254]=1,i.string2buf=function(u){var f,d,g,m,v,p=u.length,_=0;for(m=0;m<p;m++)(64512&(d=u.charCodeAt(m)))==55296&&m+1<p&&(64512&(g=u.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(g-56320),m++),_+=d<128?1:d<2048?2:d<65536?3:4;for(f=new n.Buf8(_),m=v=0;v<_;m++)(64512&(d=u.charCodeAt(m)))==55296&&m+1<p&&(64512&(g=u.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(g-56320),m++),d<128?f[v++]=d:(d<2048?f[v++]=192|d>>>6:(d<65536?f[v++]=224|d>>>12:(f[v++]=240|d>>>18,f[v++]=128|d>>>12&63),f[v++]=128|d>>>6&63),f[v++]=128|63&d);return f},i.buf2binstring=function(u){return c(u,u.length)},i.binstring2buf=function(u){for(var f=new n.Buf8(u.length),d=0,g=f.length;d<g;d++)f[d]=u.charCodeAt(d);return f},i.buf2string=function(u,f){var d,g,m,v,p=f||u.length,_=new Array(2*p);for(d=g=0;d<p;)if((m=u[d++])<128)_[g++]=m;else if(4<(v=l[m]))_[g++]=65533,d+=v-1;else{for(m&=v===2?31:v===3?15:7;1<v&&d<p;)m=m<<6|63&u[d++],v--;1<v?_[g++]=65533:m<65536?_[g++]=m:(m-=65536,_[g++]=55296|m>>10&1023,_[g++]=56320|1023&m)}return c(_,g)},i.utf8border=function(u,f){var d;for((f=f||u.length)>u.length&&(f=u.length),d=f-1;0<=d&&(192&u[d])==128;)d--;return d<0||d===0?f:d+l[u[d]]>f?d:f}},{"./common":41}],43:[function(t,s,i){s.exports=function(n,r,o,l){for(var h=65535&n|0,c=n>>>16&65535|0,u=0;o!==0;){for(o-=u=2e3<o?2e3:o;c=c+(h=h+r[l++]|0)|0,--u;);h%=65521,c%=65521}return h|c<<16|0}},{}],44:[function(t,s,i){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,s,i){var n=function(){for(var r,o=[],l=0;l<256;l++){r=l;for(var h=0;h<8;h++)r=1&r?3988292384^r>>>1:r>>>1;o[l]=r}return o}();s.exports=function(r,o,l,h){var c=n,u=h+l;r^=-1;for(var f=h;f<u;f++)r=r>>>8^c[255&(r^o[f])];return-1^r}},{}],46:[function(t,s,i){var n,r=t("../utils/common"),o=t("./trees"),l=t("./adler32"),h=t("./crc32"),c=t("./messages"),u=0,f=4,d=0,g=-2,m=-1,v=4,p=2,_=8,b=9,E=286,S=30,A=19,P=2*E+1,D=15,I=3,k=258,V=k+I+1,C=42,z=113,w=1,B=2,G=3,X=4;function te(y,Z){return y.msg=c[Z],Z}function W(y){return(y<<1)-(4<y?9:0)}function se(y){for(var Z=y.length;0<=--Z;)y[Z]=0}function R(y){var Z=y.state,H=Z.pending;H>y.avail_out&&(H=y.avail_out),H!==0&&(r.arraySet(y.output,Z.pending_buf,Z.pending_out,H,y.next_out),y.next_out+=H,Z.pending_out+=H,y.total_out+=H,y.avail_out-=H,Z.pending-=H,Z.pending===0&&(Z.pending_out=0))}function U(y,Z){o._tr_flush_block(y,0<=y.block_start?y.block_start:-1,y.strstart-y.block_start,Z),y.block_start=y.strstart,R(y.strm)}function ne(y,Z){y.pending_buf[y.pending++]=Z}function ee(y,Z){y.pending_buf[y.pending++]=Z>>>8&255,y.pending_buf[y.pending++]=255&Z}function J(y,Z){var H,M,O=y.max_chain_length,L=y.strstart,Y=y.prev_length,q=y.nice_match,F=y.strstart>y.w_size-V?y.strstart-(y.w_size-V):0,K=y.window,re=y.w_mask,$=y.prev,oe=y.strstart+k,_e=K[L+Y-1],ue=K[L+Y];y.prev_length>=y.good_match&&(O>>=2),q>y.lookahead&&(q=y.lookahead);do if(K[(H=Z)+Y]===ue&&K[H+Y-1]===_e&&K[H]===K[L]&&K[++H]===K[L+1]){L+=2,H++;do;while(K[++L]===K[++H]&&K[++L]===K[++H]&&K[++L]===K[++H]&&K[++L]===K[++H]&&K[++L]===K[++H]&&K[++L]===K[++H]&&K[++L]===K[++H]&&K[++L]===K[++H]&&L<oe);if(M=k-(oe-L),L=oe-k,Y<M){if(y.match_start=Z,q<=(Y=M))break;_e=K[L+Y-1],ue=K[L+Y]}}while((Z=$[Z&re])>F&&--O!=0);return Y<=y.lookahead?Y:y.lookahead}function pe(y){var Z,H,M,O,L,Y,q,F,K,re,$=y.w_size;do{if(O=y.window_size-y.lookahead-y.strstart,y.strstart>=$+($-V)){for(r.arraySet(y.window,y.window,$,$,0),y.match_start-=$,y.strstart-=$,y.block_start-=$,Z=H=y.hash_size;M=y.head[--Z],y.head[Z]=$<=M?M-$:0,--H;);for(Z=H=$;M=y.prev[--Z],y.prev[Z]=$<=M?M-$:0,--H;);O+=$}if(y.strm.avail_in===0)break;if(Y=y.strm,q=y.window,F=y.strstart+y.lookahead,K=O,re=void 0,re=Y.avail_in,K<re&&(re=K),H=re===0?0:(Y.avail_in-=re,r.arraySet(q,Y.input,Y.next_in,re,F),Y.state.wrap===1?Y.adler=l(Y.adler,q,re,F):Y.state.wrap===2&&(Y.adler=h(Y.adler,q,re,F)),Y.next_in+=re,Y.total_in+=re,re),y.lookahead+=H,y.lookahead+y.insert>=I)for(L=y.strstart-y.insert,y.ins_h=y.window[L],y.ins_h=(y.ins_h<<y.hash_shift^y.window[L+1])&y.hash_mask;y.insert&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[L+I-1])&y.hash_mask,y.prev[L&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=L,L++,y.insert--,!(y.lookahead+y.insert<I)););}while(y.lookahead<V&&y.strm.avail_in!==0)}function ve(y,Z){for(var H,M;;){if(y.lookahead<V){if(pe(y),y.lookahead<V&&Z===u)return w;if(y.lookahead===0)break}if(H=0,y.lookahead>=I&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+I-1])&y.hash_mask,H=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),H!==0&&y.strstart-H<=y.w_size-V&&(y.match_length=J(y,H)),y.match_length>=I)if(M=o._tr_tally(y,y.strstart-y.match_start,y.match_length-I),y.lookahead-=y.match_length,y.match_length<=y.max_lazy_match&&y.lookahead>=I){for(y.match_length--;y.strstart++,y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+I-1])&y.hash_mask,H=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart,--y.match_length!=0;);y.strstart++}else y.strstart+=y.match_length,y.match_length=0,y.ins_h=y.window[y.strstart],y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+1])&y.hash_mask;else M=o._tr_tally(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++;if(M&&(U(y,!1),y.strm.avail_out===0))return w}return y.insert=y.strstart<I-1?y.strstart:I-1,Z===f?(U(y,!0),y.strm.avail_out===0?G:X):y.last_lit&&(U(y,!1),y.strm.avail_out===0)?w:B}function ae(y,Z){for(var H,M,O;;){if(y.lookahead<V){if(pe(y),y.lookahead<V&&Z===u)return w;if(y.lookahead===0)break}if(H=0,y.lookahead>=I&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+I-1])&y.hash_mask,H=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),y.prev_length=y.match_length,y.prev_match=y.match_start,y.match_length=I-1,H!==0&&y.prev_length<y.max_lazy_match&&y.strstart-H<=y.w_size-V&&(y.match_length=J(y,H),y.match_length<=5&&(y.strategy===1||y.match_length===I&&4096<y.strstart-y.match_start)&&(y.match_length=I-1)),y.prev_length>=I&&y.match_length<=y.prev_length){for(O=y.strstart+y.lookahead-I,M=o._tr_tally(y,y.strstart-1-y.prev_match,y.prev_length-I),y.lookahead-=y.prev_length-1,y.prev_length-=2;++y.strstart<=O&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+I-1])&y.hash_mask,H=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),--y.prev_length!=0;);if(y.match_available=0,y.match_length=I-1,y.strstart++,M&&(U(y,!1),y.strm.avail_out===0))return w}else if(y.match_available){if((M=o._tr_tally(y,0,y.window[y.strstart-1]))&&U(y,!1),y.strstart++,y.lookahead--,y.strm.avail_out===0)return w}else y.match_available=1,y.strstart++,y.lookahead--}return y.match_available&&(M=o._tr_tally(y,0,y.window[y.strstart-1]),y.match_available=0),y.insert=y.strstart<I-1?y.strstart:I-1,Z===f?(U(y,!0),y.strm.avail_out===0?G:X):y.last_lit&&(U(y,!1),y.strm.avail_out===0)?w:B}function ce(y,Z,H,M,O){this.good_length=y,this.max_lazy=Z,this.nice_length=H,this.max_chain=M,this.func=O}function be(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*P),this.dyn_dtree=new r.Buf16(2*(2*S+1)),this.bl_tree=new r.Buf16(2*(2*A+1)),se(this.dyn_ltree),se(this.dyn_dtree),se(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(D+1),this.heap=new r.Buf16(2*E+1),se(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*E+1),se(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function we(y){var Z;return y&&y.state?(y.total_in=y.total_out=0,y.data_type=p,(Z=y.state).pending=0,Z.pending_out=0,Z.wrap<0&&(Z.wrap=-Z.wrap),Z.status=Z.wrap?C:z,y.adler=Z.wrap===2?0:1,Z.last_flush=u,o._tr_init(Z),d):te(y,g)}function Ue(y){var Z=we(y);return Z===d&&function(H){H.window_size=2*H.w_size,se(H.head),H.max_lazy_match=n[H.level].max_lazy,H.good_match=n[H.level].good_length,H.nice_match=n[H.level].nice_length,H.max_chain_length=n[H.level].max_chain,H.strstart=0,H.block_start=0,H.lookahead=0,H.insert=0,H.match_length=H.prev_length=I-1,H.match_available=0,H.ins_h=0}(y.state),Z}function Ie(y,Z,H,M,O,L){if(!y)return g;var Y=1;if(Z===m&&(Z=6),M<0?(Y=0,M=-M):15<M&&(Y=2,M-=16),O<1||b<O||H!==_||M<8||15<M||Z<0||9<Z||L<0||v<L)return te(y,g);M===8&&(M=9);var q=new be;return(y.state=q).strm=y,q.wrap=Y,q.gzhead=null,q.w_bits=M,q.w_size=1<<q.w_bits,q.w_mask=q.w_size-1,q.hash_bits=O+7,q.hash_size=1<<q.hash_bits,q.hash_mask=q.hash_size-1,q.hash_shift=~~((q.hash_bits+I-1)/I),q.window=new r.Buf8(2*q.w_size),q.head=new r.Buf16(q.hash_size),q.prev=new r.Buf16(q.w_size),q.lit_bufsize=1<<O+6,q.pending_buf_size=4*q.lit_bufsize,q.pending_buf=new r.Buf8(q.pending_buf_size),q.d_buf=1*q.lit_bufsize,q.l_buf=3*q.lit_bufsize,q.level=Z,q.strategy=L,q.method=H,Ue(y)}n=[new ce(0,0,0,0,function(y,Z){var H=65535;for(H>y.pending_buf_size-5&&(H=y.pending_buf_size-5);;){if(y.lookahead<=1){if(pe(y),y.lookahead===0&&Z===u)return w;if(y.lookahead===0)break}y.strstart+=y.lookahead,y.lookahead=0;var M=y.block_start+H;if((y.strstart===0||y.strstart>=M)&&(y.lookahead=y.strstart-M,y.strstart=M,U(y,!1),y.strm.avail_out===0)||y.strstart-y.block_start>=y.w_size-V&&(U(y,!1),y.strm.avail_out===0))return w}return y.insert=0,Z===f?(U(y,!0),y.strm.avail_out===0?G:X):(y.strstart>y.block_start&&(U(y,!1),y.strm.avail_out),w)}),new ce(4,4,8,4,ve),new ce(4,5,16,8,ve),new ce(4,6,32,32,ve),new ce(4,4,16,16,ae),new ce(8,16,32,32,ae),new ce(8,16,128,128,ae),new ce(8,32,128,256,ae),new ce(32,128,258,1024,ae),new ce(32,258,258,4096,ae)],i.deflateInit=function(y,Z){return Ie(y,Z,_,15,8,0)},i.deflateInit2=Ie,i.deflateReset=Ue,i.deflateResetKeep=we,i.deflateSetHeader=function(y,Z){return y&&y.state?y.state.wrap!==2?g:(y.state.gzhead=Z,d):g},i.deflate=function(y,Z){var H,M,O,L;if(!y||!y.state||5<Z||Z<0)return y?te(y,g):g;if(M=y.state,!y.output||!y.input&&y.avail_in!==0||M.status===666&&Z!==f)return te(y,y.avail_out===0?-5:g);if(M.strm=y,H=M.last_flush,M.last_flush=Z,M.status===C)if(M.wrap===2)y.adler=0,ne(M,31),ne(M,139),ne(M,8),M.gzhead?(ne(M,(M.gzhead.text?1:0)+(M.gzhead.hcrc?2:0)+(M.gzhead.extra?4:0)+(M.gzhead.name?8:0)+(M.gzhead.comment?16:0)),ne(M,255&M.gzhead.time),ne(M,M.gzhead.time>>8&255),ne(M,M.gzhead.time>>16&255),ne(M,M.gzhead.time>>24&255),ne(M,M.level===9?2:2<=M.strategy||M.level<2?4:0),ne(M,255&M.gzhead.os),M.gzhead.extra&&M.gzhead.extra.length&&(ne(M,255&M.gzhead.extra.length),ne(M,M.gzhead.extra.length>>8&255)),M.gzhead.hcrc&&(y.adler=h(y.adler,M.pending_buf,M.pending,0)),M.gzindex=0,M.status=69):(ne(M,0),ne(M,0),ne(M,0),ne(M,0),ne(M,0),ne(M,M.level===9?2:2<=M.strategy||M.level<2?4:0),ne(M,3),M.status=z);else{var Y=_+(M.w_bits-8<<4)<<8;Y|=(2<=M.strategy||M.level<2?0:M.level<6?1:M.level===6?2:3)<<6,M.strstart!==0&&(Y|=32),Y+=31-Y%31,M.status=z,ee(M,Y),M.strstart!==0&&(ee(M,y.adler>>>16),ee(M,65535&y.adler)),y.adler=1}if(M.status===69)if(M.gzhead.extra){for(O=M.pending;M.gzindex<(65535&M.gzhead.extra.length)&&(M.pending!==M.pending_buf_size||(M.gzhead.hcrc&&M.pending>O&&(y.adler=h(y.adler,M.pending_buf,M.pending-O,O)),R(y),O=M.pending,M.pending!==M.pending_buf_size));)ne(M,255&M.gzhead.extra[M.gzindex]),M.gzindex++;M.gzhead.hcrc&&M.pending>O&&(y.adler=h(y.adler,M.pending_buf,M.pending-O,O)),M.gzindex===M.gzhead.extra.length&&(M.gzindex=0,M.status=73)}else M.status=73;if(M.status===73)if(M.gzhead.name){O=M.pending;do{if(M.pending===M.pending_buf_size&&(M.gzhead.hcrc&&M.pending>O&&(y.adler=h(y.adler,M.pending_buf,M.pending-O,O)),R(y),O=M.pending,M.pending===M.pending_buf_size)){L=1;break}L=M.gzindex<M.gzhead.name.length?255&M.gzhead.name.charCodeAt(M.gzindex++):0,ne(M,L)}while(L!==0);M.gzhead.hcrc&&M.pending>O&&(y.adler=h(y.adler,M.pending_buf,M.pending-O,O)),L===0&&(M.gzindex=0,M.status=91)}else M.status=91;if(M.status===91)if(M.gzhead.comment){O=M.pending;do{if(M.pending===M.pending_buf_size&&(M.gzhead.hcrc&&M.pending>O&&(y.adler=h(y.adler,M.pending_buf,M.pending-O,O)),R(y),O=M.pending,M.pending===M.pending_buf_size)){L=1;break}L=M.gzindex<M.gzhead.comment.length?255&M.gzhead.comment.charCodeAt(M.gzindex++):0,ne(M,L)}while(L!==0);M.gzhead.hcrc&&M.pending>O&&(y.adler=h(y.adler,M.pending_buf,M.pending-O,O)),L===0&&(M.status=103)}else M.status=103;if(M.status===103&&(M.gzhead.hcrc?(M.pending+2>M.pending_buf_size&&R(y),M.pending+2<=M.pending_buf_size&&(ne(M,255&y.adler),ne(M,y.adler>>8&255),y.adler=0,M.status=z)):M.status=z),M.pending!==0){if(R(y),y.avail_out===0)return M.last_flush=-1,d}else if(y.avail_in===0&&W(Z)<=W(H)&&Z!==f)return te(y,-5);if(M.status===666&&y.avail_in!==0)return te(y,-5);if(y.avail_in!==0||M.lookahead!==0||Z!==u&&M.status!==666){var q=M.strategy===2?function(F,K){for(var re;;){if(F.lookahead===0&&(pe(F),F.lookahead===0)){if(K===u)return w;break}if(F.match_length=0,re=o._tr_tally(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++,re&&(U(F,!1),F.strm.avail_out===0))return w}return F.insert=0,K===f?(U(F,!0),F.strm.avail_out===0?G:X):F.last_lit&&(U(F,!1),F.strm.avail_out===0)?w:B}(M,Z):M.strategy===3?function(F,K){for(var re,$,oe,_e,ue=F.window;;){if(F.lookahead<=k){if(pe(F),F.lookahead<=k&&K===u)return w;if(F.lookahead===0)break}if(F.match_length=0,F.lookahead>=I&&0<F.strstart&&($=ue[oe=F.strstart-1])===ue[++oe]&&$===ue[++oe]&&$===ue[++oe]){_e=F.strstart+k;do;while($===ue[++oe]&&$===ue[++oe]&&$===ue[++oe]&&$===ue[++oe]&&$===ue[++oe]&&$===ue[++oe]&&$===ue[++oe]&&$===ue[++oe]&&oe<_e);F.match_length=k-(_e-oe),F.match_length>F.lookahead&&(F.match_length=F.lookahead)}if(F.match_length>=I?(re=o._tr_tally(F,1,F.match_length-I),F.lookahead-=F.match_length,F.strstart+=F.match_length,F.match_length=0):(re=o._tr_tally(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++),re&&(U(F,!1),F.strm.avail_out===0))return w}return F.insert=0,K===f?(U(F,!0),F.strm.avail_out===0?G:X):F.last_lit&&(U(F,!1),F.strm.avail_out===0)?w:B}(M,Z):n[M.level].func(M,Z);if(q!==G&&q!==X||(M.status=666),q===w||q===G)return y.avail_out===0&&(M.last_flush=-1),d;if(q===B&&(Z===1?o._tr_align(M):Z!==5&&(o._tr_stored_block(M,0,0,!1),Z===3&&(se(M.head),M.lookahead===0&&(M.strstart=0,M.block_start=0,M.insert=0))),R(y),y.avail_out===0))return M.last_flush=-1,d}return Z!==f?d:M.wrap<=0?1:(M.wrap===2?(ne(M,255&y.adler),ne(M,y.adler>>8&255),ne(M,y.adler>>16&255),ne(M,y.adler>>24&255),ne(M,255&y.total_in),ne(M,y.total_in>>8&255),ne(M,y.total_in>>16&255),ne(M,y.total_in>>24&255)):(ee(M,y.adler>>>16),ee(M,65535&y.adler)),R(y),0<M.wrap&&(M.wrap=-M.wrap),M.pending!==0?d:1)},i.deflateEnd=function(y){var Z;return y&&y.state?(Z=y.state.status)!==C&&Z!==69&&Z!==73&&Z!==91&&Z!==103&&Z!==z&&Z!==666?te(y,g):(y.state=null,Z===z?te(y,-3):d):g},i.deflateSetDictionary=function(y,Z){var H,M,O,L,Y,q,F,K,re=Z.length;if(!y||!y.state||(L=(H=y.state).wrap)===2||L===1&&H.status!==C||H.lookahead)return g;for(L===1&&(y.adler=l(y.adler,Z,re,0)),H.wrap=0,re>=H.w_size&&(L===0&&(se(H.head),H.strstart=0,H.block_start=0,H.insert=0),K=new r.Buf8(H.w_size),r.arraySet(K,Z,re-H.w_size,H.w_size,0),Z=K,re=H.w_size),Y=y.avail_in,q=y.next_in,F=y.input,y.avail_in=re,y.next_in=0,y.input=Z,pe(H);H.lookahead>=I;){for(M=H.strstart,O=H.lookahead-(I-1);H.ins_h=(H.ins_h<<H.hash_shift^H.window[M+I-1])&H.hash_mask,H.prev[M&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=M,M++,--O;);H.strstart=M,H.lookahead=I-1,pe(H)}return H.strstart+=H.lookahead,H.block_start=H.strstart,H.insert=H.lookahead,H.lookahead=0,H.match_length=H.prev_length=I-1,H.match_available=0,y.next_in=q,y.input=F,y.avail_in=Y,H.wrap=L,d},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,s,i){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,s,i){s.exports=function(n,r){var o,l,h,c,u,f,d,g,m,v,p,_,b,E,S,A,P,D,I,k,V,C,z,w,B;o=n.state,l=n.next_in,w=n.input,h=l+(n.avail_in-5),c=n.next_out,B=n.output,u=c-(r-n.avail_out),f=c+(n.avail_out-257),d=o.dmax,g=o.wsize,m=o.whave,v=o.wnext,p=o.window,_=o.hold,b=o.bits,E=o.lencode,S=o.distcode,A=(1<<o.lenbits)-1,P=(1<<o.distbits)-1;e:do{b<15&&(_+=w[l++]<<b,b+=8,_+=w[l++]<<b,b+=8),D=E[_&A];t:for(;;){if(_>>>=I=D>>>24,b-=I,(I=D>>>16&255)===0)B[c++]=65535&D;else{if(!(16&I)){if(!(64&I)){D=E[(65535&D)+(_&(1<<I)-1)];continue t}if(32&I){o.mode=12;break e}n.msg="invalid literal/length code",o.mode=30;break e}k=65535&D,(I&=15)&&(b<I&&(_+=w[l++]<<b,b+=8),k+=_&(1<<I)-1,_>>>=I,b-=I),b<15&&(_+=w[l++]<<b,b+=8,_+=w[l++]<<b,b+=8),D=S[_&P];s:for(;;){if(_>>>=I=D>>>24,b-=I,!(16&(I=D>>>16&255))){if(!(64&I)){D=S[(65535&D)+(_&(1<<I)-1)];continue s}n.msg="invalid distance code",o.mode=30;break e}if(V=65535&D,b<(I&=15)&&(_+=w[l++]<<b,(b+=8)<I&&(_+=w[l++]<<b,b+=8)),d<(V+=_&(1<<I)-1)){n.msg="invalid distance too far back",o.mode=30;break e}if(_>>>=I,b-=I,(I=c-u)<V){if(m<(I=V-I)&&o.sane){n.msg="invalid distance too far back",o.mode=30;break e}if(z=p,(C=0)===v){if(C+=g-I,I<k){for(k-=I;B[c++]=p[C++],--I;);C=c-V,z=B}}else if(v<I){if(C+=g+v-I,(I-=v)<k){for(k-=I;B[c++]=p[C++],--I;);if(C=0,v<k){for(k-=I=v;B[c++]=p[C++],--I;);C=c-V,z=B}}}else if(C+=v-I,I<k){for(k-=I;B[c++]=p[C++],--I;);C=c-V,z=B}for(;2<k;)B[c++]=z[C++],B[c++]=z[C++],B[c++]=z[C++],k-=3;k&&(B[c++]=z[C++],1<k&&(B[c++]=z[C++]))}else{for(C=c-V;B[c++]=B[C++],B[c++]=B[C++],B[c++]=B[C++],2<(k-=3););k&&(B[c++]=B[C++],1<k&&(B[c++]=B[C++]))}break}}break}}while(l<h&&c<f);l-=k=b>>3,_&=(1<<(b-=k<<3))-1,n.next_in=l,n.next_out=c,n.avail_in=l<h?h-l+5:5-(l-h),n.avail_out=c<f?f-c+257:257-(c-f),o.hold=_,o.bits=b}},{}],49:[function(t,s,i){var n=t("../utils/common"),r=t("./adler32"),o=t("./crc32"),l=t("./inffast"),h=t("./inftrees"),c=1,u=2,f=0,d=-2,g=1,m=852,v=592;function p(C){return(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24)}function _(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function b(C){var z;return C&&C.state?(z=C.state,C.total_in=C.total_out=z.total=0,C.msg="",z.wrap&&(C.adler=1&z.wrap),z.mode=g,z.last=0,z.havedict=0,z.dmax=32768,z.head=null,z.hold=0,z.bits=0,z.lencode=z.lendyn=new n.Buf32(m),z.distcode=z.distdyn=new n.Buf32(v),z.sane=1,z.back=-1,f):d}function E(C){var z;return C&&C.state?((z=C.state).wsize=0,z.whave=0,z.wnext=0,b(C)):d}function S(C,z){var w,B;return C&&C.state?(B=C.state,z<0?(w=0,z=-z):(w=1+(z>>4),z<48&&(z&=15)),z&&(z<8||15<z)?d:(B.window!==null&&B.wbits!==z&&(B.window=null),B.wrap=w,B.wbits=z,E(C))):d}function A(C,z){var w,B;return C?(B=new _,(C.state=B).window=null,(w=S(C,z))!==f&&(C.state=null),w):d}var P,D,I=!0;function k(C){if(I){var z;for(P=new n.Buf32(512),D=new n.Buf32(32),z=0;z<144;)C.lens[z++]=8;for(;z<256;)C.lens[z++]=9;for(;z<280;)C.lens[z++]=7;for(;z<288;)C.lens[z++]=8;for(h(c,C.lens,0,288,P,0,C.work,{bits:9}),z=0;z<32;)C.lens[z++]=5;h(u,C.lens,0,32,D,0,C.work,{bits:5}),I=!1}C.lencode=P,C.lenbits=9,C.distcode=D,C.distbits=5}function V(C,z,w,B){var G,X=C.state;return X.window===null&&(X.wsize=1<<X.wbits,X.wnext=0,X.whave=0,X.window=new n.Buf8(X.wsize)),B>=X.wsize?(n.arraySet(X.window,z,w-X.wsize,X.wsize,0),X.wnext=0,X.whave=X.wsize):(B<(G=X.wsize-X.wnext)&&(G=B),n.arraySet(X.window,z,w-B,G,X.wnext),(B-=G)?(n.arraySet(X.window,z,w-B,B,0),X.wnext=B,X.whave=X.wsize):(X.wnext+=G,X.wnext===X.wsize&&(X.wnext=0),X.whave<X.wsize&&(X.whave+=G))),0}i.inflateReset=E,i.inflateReset2=S,i.inflateResetKeep=b,i.inflateInit=function(C){return A(C,15)},i.inflateInit2=A,i.inflate=function(C,z){var w,B,G,X,te,W,se,R,U,ne,ee,J,pe,ve,ae,ce,be,we,Ue,Ie,y,Z,H,M,O=0,L=new n.Buf8(4),Y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!C||!C.state||!C.output||!C.input&&C.avail_in!==0)return d;(w=C.state).mode===12&&(w.mode=13),te=C.next_out,G=C.output,se=C.avail_out,X=C.next_in,B=C.input,W=C.avail_in,R=w.hold,U=w.bits,ne=W,ee=se,Z=f;e:for(;;)switch(w.mode){case g:if(w.wrap===0){w.mode=13;break}for(;U<16;){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}if(2&w.wrap&&R===35615){L[w.check=0]=255&R,L[1]=R>>>8&255,w.check=o(w.check,L,2,0),U=R=0,w.mode=2;break}if(w.flags=0,w.head&&(w.head.done=!1),!(1&w.wrap)||(((255&R)<<8)+(R>>8))%31){C.msg="incorrect header check",w.mode=30;break}if((15&R)!=8){C.msg="unknown compression method",w.mode=30;break}if(U-=4,y=8+(15&(R>>>=4)),w.wbits===0)w.wbits=y;else if(y>w.wbits){C.msg="invalid window size",w.mode=30;break}w.dmax=1<<y,C.adler=w.check=1,w.mode=512&R?10:12,U=R=0;break;case 2:for(;U<16;){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}if(w.flags=R,(255&w.flags)!=8){C.msg="unknown compression method",w.mode=30;break}if(57344&w.flags){C.msg="unknown header flags set",w.mode=30;break}w.head&&(w.head.text=R>>8&1),512&w.flags&&(L[0]=255&R,L[1]=R>>>8&255,w.check=o(w.check,L,2,0)),U=R=0,w.mode=3;case 3:for(;U<32;){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}w.head&&(w.head.time=R),512&w.flags&&(L[0]=255&R,L[1]=R>>>8&255,L[2]=R>>>16&255,L[3]=R>>>24&255,w.check=o(w.check,L,4,0)),U=R=0,w.mode=4;case 4:for(;U<16;){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}w.head&&(w.head.xflags=255&R,w.head.os=R>>8),512&w.flags&&(L[0]=255&R,L[1]=R>>>8&255,w.check=o(w.check,L,2,0)),U=R=0,w.mode=5;case 5:if(1024&w.flags){for(;U<16;){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}w.length=R,w.head&&(w.head.extra_len=R),512&w.flags&&(L[0]=255&R,L[1]=R>>>8&255,w.check=o(w.check,L,2,0)),U=R=0}else w.head&&(w.head.extra=null);w.mode=6;case 6:if(1024&w.flags&&(W<(J=w.length)&&(J=W),J&&(w.head&&(y=w.head.extra_len-w.length,w.head.extra||(w.head.extra=new Array(w.head.extra_len)),n.arraySet(w.head.extra,B,X,J,y)),512&w.flags&&(w.check=o(w.check,B,J,X)),W-=J,X+=J,w.length-=J),w.length))break e;w.length=0,w.mode=7;case 7:if(2048&w.flags){if(W===0)break e;for(J=0;y=B[X+J++],w.head&&y&&w.length<65536&&(w.head.name+=String.fromCharCode(y)),y&&J<W;);if(512&w.flags&&(w.check=o(w.check,B,J,X)),W-=J,X+=J,y)break e}else w.head&&(w.head.name=null);w.length=0,w.mode=8;case 8:if(4096&w.flags){if(W===0)break e;for(J=0;y=B[X+J++],w.head&&y&&w.length<65536&&(w.head.comment+=String.fromCharCode(y)),y&&J<W;);if(512&w.flags&&(w.check=o(w.check,B,J,X)),W-=J,X+=J,y)break e}else w.head&&(w.head.comment=null);w.mode=9;case 9:if(512&w.flags){for(;U<16;){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}if(R!==(65535&w.check)){C.msg="header crc mismatch",w.mode=30;break}U=R=0}w.head&&(w.head.hcrc=w.flags>>9&1,w.head.done=!0),C.adler=w.check=0,w.mode=12;break;case 10:for(;U<32;){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}C.adler=w.check=p(R),U=R=0,w.mode=11;case 11:if(w.havedict===0)return C.next_out=te,C.avail_out=se,C.next_in=X,C.avail_in=W,w.hold=R,w.bits=U,2;C.adler=w.check=1,w.mode=12;case 12:if(z===5||z===6)break e;case 13:if(w.last){R>>>=7&U,U-=7&U,w.mode=27;break}for(;U<3;){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}switch(w.last=1&R,U-=1,3&(R>>>=1)){case 0:w.mode=14;break;case 1:if(k(w),w.mode=20,z!==6)break;R>>>=2,U-=2;break e;case 2:w.mode=17;break;case 3:C.msg="invalid block type",w.mode=30}R>>>=2,U-=2;break;case 14:for(R>>>=7&U,U-=7&U;U<32;){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}if((65535&R)!=(R>>>16^65535)){C.msg="invalid stored block lengths",w.mode=30;break}if(w.length=65535&R,U=R=0,w.mode=15,z===6)break e;case 15:w.mode=16;case 16:if(J=w.length){if(W<J&&(J=W),se<J&&(J=se),J===0)break e;n.arraySet(G,B,X,J,te),W-=J,X+=J,se-=J,te+=J,w.length-=J;break}w.mode=12;break;case 17:for(;U<14;){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}if(w.nlen=257+(31&R),R>>>=5,U-=5,w.ndist=1+(31&R),R>>>=5,U-=5,w.ncode=4+(15&R),R>>>=4,U-=4,286<w.nlen||30<w.ndist){C.msg="too many length or distance symbols",w.mode=30;break}w.have=0,w.mode=18;case 18:for(;w.have<w.ncode;){for(;U<3;){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}w.lens[Y[w.have++]]=7&R,R>>>=3,U-=3}for(;w.have<19;)w.lens[Y[w.have++]]=0;if(w.lencode=w.lendyn,w.lenbits=7,H={bits:w.lenbits},Z=h(0,w.lens,0,19,w.lencode,0,w.work,H),w.lenbits=H.bits,Z){C.msg="invalid code lengths set",w.mode=30;break}w.have=0,w.mode=19;case 19:for(;w.have<w.nlen+w.ndist;){for(;ce=(O=w.lencode[R&(1<<w.lenbits)-1])>>>16&255,be=65535&O,!((ae=O>>>24)<=U);){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}if(be<16)R>>>=ae,U-=ae,w.lens[w.have++]=be;else{if(be===16){for(M=ae+2;U<M;){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}if(R>>>=ae,U-=ae,w.have===0){C.msg="invalid bit length repeat",w.mode=30;break}y=w.lens[w.have-1],J=3+(3&R),R>>>=2,U-=2}else if(be===17){for(M=ae+3;U<M;){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}U-=ae,y=0,J=3+(7&(R>>>=ae)),R>>>=3,U-=3}else{for(M=ae+7;U<M;){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}U-=ae,y=0,J=11+(127&(R>>>=ae)),R>>>=7,U-=7}if(w.have+J>w.nlen+w.ndist){C.msg="invalid bit length repeat",w.mode=30;break}for(;J--;)w.lens[w.have++]=y}}if(w.mode===30)break;if(w.lens[256]===0){C.msg="invalid code -- missing end-of-block",w.mode=30;break}if(w.lenbits=9,H={bits:w.lenbits},Z=h(c,w.lens,0,w.nlen,w.lencode,0,w.work,H),w.lenbits=H.bits,Z){C.msg="invalid literal/lengths set",w.mode=30;break}if(w.distbits=6,w.distcode=w.distdyn,H={bits:w.distbits},Z=h(u,w.lens,w.nlen,w.ndist,w.distcode,0,w.work,H),w.distbits=H.bits,Z){C.msg="invalid distances set",w.mode=30;break}if(w.mode=20,z===6)break e;case 20:w.mode=21;case 21:if(6<=W&&258<=se){C.next_out=te,C.avail_out=se,C.next_in=X,C.avail_in=W,w.hold=R,w.bits=U,l(C,ee),te=C.next_out,G=C.output,se=C.avail_out,X=C.next_in,B=C.input,W=C.avail_in,R=w.hold,U=w.bits,w.mode===12&&(w.back=-1);break}for(w.back=0;ce=(O=w.lencode[R&(1<<w.lenbits)-1])>>>16&255,be=65535&O,!((ae=O>>>24)<=U);){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}if(ce&&!(240&ce)){for(we=ae,Ue=ce,Ie=be;ce=(O=w.lencode[Ie+((R&(1<<we+Ue)-1)>>we)])>>>16&255,be=65535&O,!(we+(ae=O>>>24)<=U);){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}R>>>=we,U-=we,w.back+=we}if(R>>>=ae,U-=ae,w.back+=ae,w.length=be,ce===0){w.mode=26;break}if(32&ce){w.back=-1,w.mode=12;break}if(64&ce){C.msg="invalid literal/length code",w.mode=30;break}w.extra=15&ce,w.mode=22;case 22:if(w.extra){for(M=w.extra;U<M;){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}w.length+=R&(1<<w.extra)-1,R>>>=w.extra,U-=w.extra,w.back+=w.extra}w.was=w.length,w.mode=23;case 23:for(;ce=(O=w.distcode[R&(1<<w.distbits)-1])>>>16&255,be=65535&O,!((ae=O>>>24)<=U);){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}if(!(240&ce)){for(we=ae,Ue=ce,Ie=be;ce=(O=w.distcode[Ie+((R&(1<<we+Ue)-1)>>we)])>>>16&255,be=65535&O,!(we+(ae=O>>>24)<=U);){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}R>>>=we,U-=we,w.back+=we}if(R>>>=ae,U-=ae,w.back+=ae,64&ce){C.msg="invalid distance code",w.mode=30;break}w.offset=be,w.extra=15&ce,w.mode=24;case 24:if(w.extra){for(M=w.extra;U<M;){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}w.offset+=R&(1<<w.extra)-1,R>>>=w.extra,U-=w.extra,w.back+=w.extra}if(w.offset>w.dmax){C.msg="invalid distance too far back",w.mode=30;break}w.mode=25;case 25:if(se===0)break e;if(J=ee-se,w.offset>J){if((J=w.offset-J)>w.whave&&w.sane){C.msg="invalid distance too far back",w.mode=30;break}pe=J>w.wnext?(J-=w.wnext,w.wsize-J):w.wnext-J,J>w.length&&(J=w.length),ve=w.window}else ve=G,pe=te-w.offset,J=w.length;for(se<J&&(J=se),se-=J,w.length-=J;G[te++]=ve[pe++],--J;);w.length===0&&(w.mode=21);break;case 26:if(se===0)break e;G[te++]=w.length,se--,w.mode=21;break;case 27:if(w.wrap){for(;U<32;){if(W===0)break e;W--,R|=B[X++]<<U,U+=8}if(ee-=se,C.total_out+=ee,w.total+=ee,ee&&(C.adler=w.check=w.flags?o(w.check,G,ee,te-ee):r(w.check,G,ee,te-ee)),ee=se,(w.flags?R:p(R))!==w.check){C.msg="incorrect data check",w.mode=30;break}U=R=0}w.mode=28;case 28:if(w.wrap&&w.flags){for(;U<32;){if(W===0)break e;W--,R+=B[X++]<<U,U+=8}if(R!==(4294967295&w.total)){C.msg="incorrect length check",w.mode=30;break}U=R=0}w.mode=29;case 29:Z=1;break e;case 30:Z=-3;break e;case 31:return-4;case 32:default:return d}return C.next_out=te,C.avail_out=se,C.next_in=X,C.avail_in=W,w.hold=R,w.bits=U,(w.wsize||ee!==C.avail_out&&w.mode<30&&(w.mode<27||z!==4))&&V(C,C.output,C.next_out,ee-C.avail_out)?(w.mode=31,-4):(ne-=C.avail_in,ee-=C.avail_out,C.total_in+=ne,C.total_out+=ee,w.total+=ee,w.wrap&&ee&&(C.adler=w.check=w.flags?o(w.check,G,ee,C.next_out-ee):r(w.check,G,ee,C.next_out-ee)),C.data_type=w.bits+(w.last?64:0)+(w.mode===12?128:0)+(w.mode===20||w.mode===15?256:0),(ne==0&&ee===0||z===4)&&Z===f&&(Z=-5),Z)},i.inflateEnd=function(C){if(!C||!C.state)return d;var z=C.state;return z.window&&(z.window=null),C.state=null,f},i.inflateGetHeader=function(C,z){var w;return C&&C.state&&2&(w=C.state).wrap?((w.head=z).done=!1,f):d},i.inflateSetDictionary=function(C,z){var w,B=z.length;return C&&C.state?(w=C.state).wrap!==0&&w.mode!==11?d:w.mode===11&&r(1,z,B,0)!==w.check?-3:V(C,z,B,B)?(w.mode=31,-4):(w.havedict=1,f):d},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,s,i){var n=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(c,u,f,d,g,m,v,p){var _,b,E,S,A,P,D,I,k,V=p.bits,C=0,z=0,w=0,B=0,G=0,X=0,te=0,W=0,se=0,R=0,U=null,ne=0,ee=new n.Buf16(16),J=new n.Buf16(16),pe=null,ve=0;for(C=0;C<=15;C++)ee[C]=0;for(z=0;z<d;z++)ee[u[f+z]]++;for(G=V,B=15;1<=B&&ee[B]===0;B--);if(B<G&&(G=B),B===0)return g[m++]=20971520,g[m++]=20971520,p.bits=1,0;for(w=1;w<B&&ee[w]===0;w++);for(G<w&&(G=w),C=W=1;C<=15;C++)if(W<<=1,(W-=ee[C])<0)return-1;if(0<W&&(c===0||B!==1))return-1;for(J[1]=0,C=1;C<15;C++)J[C+1]=J[C]+ee[C];for(z=0;z<d;z++)u[f+z]!==0&&(v[J[u[f+z]]++]=z);if(P=c===0?(U=pe=v,19):c===1?(U=r,ne-=257,pe=o,ve-=257,256):(U=l,pe=h,-1),C=w,A=m,te=z=R=0,E=-1,S=(se=1<<(X=G))-1,c===1&&852<se||c===2&&592<se)return 1;for(;;){for(D=C-te,k=v[z]<P?(I=0,v[z]):v[z]>P?(I=pe[ve+v[z]],U[ne+v[z]]):(I=96,0),_=1<<C-te,w=b=1<<X;g[A+(R>>te)+(b-=_)]=D<<24|I<<16|k|0,b!==0;);for(_=1<<C-1;R&_;)_>>=1;if(_!==0?(R&=_-1,R+=_):R=0,z++,--ee[C]==0){if(C===B)break;C=u[f+v[z]]}if(G<C&&(R&S)!==E){for(te===0&&(te=G),A+=w,W=1<<(X=C-te);X+te<B&&!((W-=ee[X+te])<=0);)X++,W<<=1;if(se+=1<<X,c===1&&852<se||c===2&&592<se)return 1;g[E=R&S]=G<<24|X<<16|A-m|0}}return R!==0&&(g[A+R]=C-te<<24|64<<16|0),p.bits=G,0}},{"../utils/common":41}],51:[function(t,s,i){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,s,i){var n=t("../utils/common"),r=0,o=1;function l(O){for(var L=O.length;0<=--L;)O[L]=0}var h=0,c=29,u=256,f=u+1+c,d=30,g=19,m=2*f+1,v=15,p=16,_=7,b=256,E=16,S=17,A=18,P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],D=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],k=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],V=new Array(2*(f+2));l(V);var C=new Array(2*d);l(C);var z=new Array(512);l(z);var w=new Array(256);l(w);var B=new Array(c);l(B);var G,X,te,W=new Array(d);function se(O,L,Y,q,F){this.static_tree=O,this.extra_bits=L,this.extra_base=Y,this.elems=q,this.max_length=F,this.has_stree=O&&O.length}function R(O,L){this.dyn_tree=O,this.max_code=0,this.stat_desc=L}function U(O){return O<256?z[O]:z[256+(O>>>7)]}function ne(O,L){O.pending_buf[O.pending++]=255&L,O.pending_buf[O.pending++]=L>>>8&255}function ee(O,L,Y){O.bi_valid>p-Y?(O.bi_buf|=L<<O.bi_valid&65535,ne(O,O.bi_buf),O.bi_buf=L>>p-O.bi_valid,O.bi_valid+=Y-p):(O.bi_buf|=L<<O.bi_valid&65535,O.bi_valid+=Y)}function J(O,L,Y){ee(O,Y[2*L],Y[2*L+1])}function pe(O,L){for(var Y=0;Y|=1&O,O>>>=1,Y<<=1,0<--L;);return Y>>>1}function ve(O,L,Y){var q,F,K=new Array(v+1),re=0;for(q=1;q<=v;q++)K[q]=re=re+Y[q-1]<<1;for(F=0;F<=L;F++){var $=O[2*F+1];$!==0&&(O[2*F]=pe(K[$]++,$))}}function ae(O){var L;for(L=0;L<f;L++)O.dyn_ltree[2*L]=0;for(L=0;L<d;L++)O.dyn_dtree[2*L]=0;for(L=0;L<g;L++)O.bl_tree[2*L]=0;O.dyn_ltree[2*b]=1,O.opt_len=O.static_len=0,O.last_lit=O.matches=0}function ce(O){8<O.bi_valid?ne(O,O.bi_buf):0<O.bi_valid&&(O.pending_buf[O.pending++]=O.bi_buf),O.bi_buf=0,O.bi_valid=0}function be(O,L,Y,q){var F=2*L,K=2*Y;return O[F]<O[K]||O[F]===O[K]&&q[L]<=q[Y]}function we(O,L,Y){for(var q=O.heap[Y],F=Y<<1;F<=O.heap_len&&(F<O.heap_len&&be(L,O.heap[F+1],O.heap[F],O.depth)&&F++,!be(L,q,O.heap[F],O.depth));)O.heap[Y]=O.heap[F],Y=F,F<<=1;O.heap[Y]=q}function Ue(O,L,Y){var q,F,K,re,$=0;if(O.last_lit!==0)for(;q=O.pending_buf[O.d_buf+2*$]<<8|O.pending_buf[O.d_buf+2*$+1],F=O.pending_buf[O.l_buf+$],$++,q===0?J(O,F,L):(J(O,(K=w[F])+u+1,L),(re=P[K])!==0&&ee(O,F-=B[K],re),J(O,K=U(--q),Y),(re=D[K])!==0&&ee(O,q-=W[K],re)),$<O.last_lit;);J(O,b,L)}function Ie(O,L){var Y,q,F,K=L.dyn_tree,re=L.stat_desc.static_tree,$=L.stat_desc.has_stree,oe=L.stat_desc.elems,_e=-1;for(O.heap_len=0,O.heap_max=m,Y=0;Y<oe;Y++)K[2*Y]!==0?(O.heap[++O.heap_len]=_e=Y,O.depth[Y]=0):K[2*Y+1]=0;for(;O.heap_len<2;)K[2*(F=O.heap[++O.heap_len]=_e<2?++_e:0)]=1,O.depth[F]=0,O.opt_len--,$&&(O.static_len-=re[2*F+1]);for(L.max_code=_e,Y=O.heap_len>>1;1<=Y;Y--)we(O,K,Y);for(F=oe;Y=O.heap[1],O.heap[1]=O.heap[O.heap_len--],we(O,K,1),q=O.heap[1],O.heap[--O.heap_max]=Y,O.heap[--O.heap_max]=q,K[2*F]=K[2*Y]+K[2*q],O.depth[F]=(O.depth[Y]>=O.depth[q]?O.depth[Y]:O.depth[q])+1,K[2*Y+1]=K[2*q+1]=F,O.heap[1]=F++,we(O,K,1),2<=O.heap_len;);O.heap[--O.heap_max]=O.heap[1],function(ue,Be){var mt,Ye,$t,Pe,ps,Rs,gt=Be.dyn_tree,Rt=Be.max_code,es=Be.stat_desc.static_tree,ts=Be.stat_desc.has_stree,ss=Be.stat_desc.extra_bits,Ft=Be.stat_desc.extra_base,Fs=Be.stat_desc.max_length,mi=0;for(Pe=0;Pe<=v;Pe++)ue.bl_count[Pe]=0;for(gt[2*ue.heap[ue.heap_max]+1]=0,mt=ue.heap_max+1;mt<m;mt++)Fs<(Pe=gt[2*gt[2*(Ye=ue.heap[mt])+1]+1]+1)&&(Pe=Fs,mi++),gt[2*Ye+1]=Pe,Rt<Ye||(ue.bl_count[Pe]++,ps=0,Ft<=Ye&&(ps=ss[Ye-Ft]),Rs=gt[2*Ye],ue.opt_len+=Rs*(Pe+ps),ts&&(ue.static_len+=Rs*(es[2*Ye+1]+ps)));if(mi!==0){do{for(Pe=Fs-1;ue.bl_count[Pe]===0;)Pe--;ue.bl_count[Pe]--,ue.bl_count[Pe+1]+=2,ue.bl_count[Fs]--,mi-=2}while(0<mi);for(Pe=Fs;Pe!==0;Pe--)for(Ye=ue.bl_count[Pe];Ye!==0;)Rt<($t=ue.heap[--mt])||(gt[2*$t+1]!==Pe&&(ue.opt_len+=(Pe-gt[2*$t+1])*gt[2*$t],gt[2*$t+1]=Pe),Ye--)}}(O,L),ve(K,_e,O.bl_count)}function y(O,L,Y){var q,F,K=-1,re=L[1],$=0,oe=7,_e=4;for(re===0&&(oe=138,_e=3),L[2*(Y+1)+1]=65535,q=0;q<=Y;q++)F=re,re=L[2*(q+1)+1],++$<oe&&F===re||($<_e?O.bl_tree[2*F]+=$:F!==0?(F!==K&&O.bl_tree[2*F]++,O.bl_tree[2*E]++):$<=10?O.bl_tree[2*S]++:O.bl_tree[2*A]++,K=F,_e=($=0)===re?(oe=138,3):F===re?(oe=6,3):(oe=7,4))}function Z(O,L,Y){var q,F,K=-1,re=L[1],$=0,oe=7,_e=4;for(re===0&&(oe=138,_e=3),q=0;q<=Y;q++)if(F=re,re=L[2*(q+1)+1],!(++$<oe&&F===re)){if($<_e)for(;J(O,F,O.bl_tree),--$!=0;);else F!==0?(F!==K&&(J(O,F,O.bl_tree),$--),J(O,E,O.bl_tree),ee(O,$-3,2)):$<=10?(J(O,S,O.bl_tree),ee(O,$-3,3)):(J(O,A,O.bl_tree),ee(O,$-11,7));K=F,_e=($=0)===re?(oe=138,3):F===re?(oe=6,3):(oe=7,4)}}l(W);var H=!1;function M(O,L,Y,q){ee(O,(h<<1)+(q?1:0),3),function(F,K,re,$){ce(F),ne(F,re),ne(F,~re),n.arraySet(F.pending_buf,F.window,K,re,F.pending),F.pending+=re}(O,L,Y)}i._tr_init=function(O){H||(function(){var L,Y,q,F,K,re=new Array(v+1);for(F=q=0;F<c-1;F++)for(B[F]=q,L=0;L<1<<P[F];L++)w[q++]=F;for(w[q-1]=F,F=K=0;F<16;F++)for(W[F]=K,L=0;L<1<<D[F];L++)z[K++]=F;for(K>>=7;F<d;F++)for(W[F]=K<<7,L=0;L<1<<D[F]-7;L++)z[256+K++]=F;for(Y=0;Y<=v;Y++)re[Y]=0;for(L=0;L<=143;)V[2*L+1]=8,L++,re[8]++;for(;L<=255;)V[2*L+1]=9,L++,re[9]++;for(;L<=279;)V[2*L+1]=7,L++,re[7]++;for(;L<=287;)V[2*L+1]=8,L++,re[8]++;for(ve(V,f+1,re),L=0;L<d;L++)C[2*L+1]=5,C[2*L]=pe(L,5);G=new se(V,P,u+1,f,v),X=new se(C,D,0,d,v),te=new se(new Array(0),I,0,g,_)}(),H=!0),O.l_desc=new R(O.dyn_ltree,G),O.d_desc=new R(O.dyn_dtree,X),O.bl_desc=new R(O.bl_tree,te),O.bi_buf=0,O.bi_valid=0,ae(O)},i._tr_stored_block=M,i._tr_flush_block=function(O,L,Y,q){var F,K,re=0;0<O.level?(O.strm.data_type===2&&(O.strm.data_type=function($){var oe,_e=4093624447;for(oe=0;oe<=31;oe++,_e>>>=1)if(1&_e&&$.dyn_ltree[2*oe]!==0)return r;if($.dyn_ltree[18]!==0||$.dyn_ltree[20]!==0||$.dyn_ltree[26]!==0)return o;for(oe=32;oe<u;oe++)if($.dyn_ltree[2*oe]!==0)return o;return r}(O)),Ie(O,O.l_desc),Ie(O,O.d_desc),re=function($){var oe;for(y($,$.dyn_ltree,$.l_desc.max_code),y($,$.dyn_dtree,$.d_desc.max_code),Ie($,$.bl_desc),oe=g-1;3<=oe&&$.bl_tree[2*k[oe]+1]===0;oe--);return $.opt_len+=3*(oe+1)+5+5+4,oe}(O),F=O.opt_len+3+7>>>3,(K=O.static_len+3+7>>>3)<=F&&(F=K)):F=K=Y+5,Y+4<=F&&L!==-1?M(O,L,Y,q):O.strategy===4||K===F?(ee(O,2+(q?1:0),3),Ue(O,V,C)):(ee(O,4+(q?1:0),3),function($,oe,_e,ue){var Be;for(ee($,oe-257,5),ee($,_e-1,5),ee($,ue-4,4),Be=0;Be<ue;Be++)ee($,$.bl_tree[2*k[Be]+1],3);Z($,$.dyn_ltree,oe-1),Z($,$.dyn_dtree,_e-1)}(O,O.l_desc.max_code+1,O.d_desc.max_code+1,re+1),Ue(O,O.dyn_ltree,O.dyn_dtree)),ae(O),q&&ce(O)},i._tr_tally=function(O,L,Y){return O.pending_buf[O.d_buf+2*O.last_lit]=L>>>8&255,O.pending_buf[O.d_buf+2*O.last_lit+1]=255&L,O.pending_buf[O.l_buf+O.last_lit]=255&Y,O.last_lit++,L===0?O.dyn_ltree[2*Y]++:(O.matches++,L--,O.dyn_ltree[2*(w[Y]+u+1)]++,O.dyn_dtree[2*U(L)]++),O.last_lit===O.lit_bufsize-1},i._tr_align=function(O){ee(O,2,3),J(O,b,V),function(L){L.bi_valid===16?(ne(L,L.bi_buf),L.bi_buf=0,L.bi_valid=0):8<=L.bi_valid&&(L.pending_buf[L.pending++]=255&L.bi_buf,L.bi_buf>>=8,L.bi_valid-=8)}(O)}},{"../utils/common":41}],53:[function(t,s,i){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,s,i){(function(n){(function(r,o){if(!r.setImmediate){var l,h,c,u,f=1,d={},g=!1,m=r.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(r);v=v&&v.setTimeout?v:r,l={}.toString.call(r.process)==="[object process]"?function(E){process.nextTick(function(){_(E)})}:function(){if(r.postMessage&&!r.importScripts){var E=!0,S=r.onmessage;return r.onmessage=function(){E=!1},r.postMessage("","*"),r.onmessage=S,E}}()?(u="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",b,!1):r.attachEvent("onmessage",b),function(E){r.postMessage(u+E,"*")}):r.MessageChannel?((c=new MessageChannel).port1.onmessage=function(E){_(E.data)},function(E){c.port2.postMessage(E)}):m&&"onreadystatechange"in m.createElement("script")?(h=m.documentElement,function(E){var S=m.createElement("script");S.onreadystatechange=function(){_(E),S.onreadystatechange=null,h.removeChild(S),S=null},h.appendChild(S)}):function(E){setTimeout(_,0,E)},v.setImmediate=function(E){typeof E!="function"&&(E=new Function(""+E));for(var S=new Array(arguments.length-1),A=0;A<S.length;A++)S[A]=arguments[A+1];var P={callback:E,args:S};return d[f]=P,l(f),f++},v.clearImmediate=p}function p(E){delete d[E]}function _(E){if(g)setTimeout(_,0,E);else{var S=d[E];if(S){g=!0;try{(function(A){var P=A.callback,D=A.args;switch(D.length){case 0:P();break;case 1:P(D[0]);break;case 2:P(D[0],D[1]);break;case 3:P(D[0],D[1],D[2]);break;default:P.apply(o,D)}})(S)}finally{p(E),g=!1}}}}function b(E){E.source===r&&typeof E.data=="string"&&E.data.indexOf(u)===0&&_(+E.data.slice(u.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof yi<"u"?yi:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Ia);var kd=Ia.exports;const _o=ql(kd);class hr{constructor(e,t){x(this,"date",new Date),x(this,"author"),x(this,"guid",Ze.create()),x(this,"viewpoint"),x(this,"modifiedAuthor"),x(this,"modifiedDate"),x(this,"topic"),x(this,"_components"),x(this,"_comment",""),this._components=e,this._comment=t;const s=this._components.get(Fe);this.author=s.config.author}set comment(e){var t;const s=this._components.get(Fe);this._comment=e,this.modifiedDate=new Date,this.modifiedAuthor=s.config.author,(t=this.topic)==null||t.comments.set(this.guid,this)}get comment(){return this._comment}toJSON(){var e,t;const s={guid:this.guid,date:this.date.toISOString(),author:this.author,comment:this.comment,topic_guid:(e=this.topic)==null?void 0:e.guid,viewpoint_guid:this.viewpoint,modified_date:(t=this.modifiedDate)==null?void 0:t.toISOString(),modified_author:this.modifiedAuthor};for(const[i,n]of Object.entries(s))n===void 0&&delete s[i];return s}}const ka=class Wt{constructor(e){x(this,"guid",Ze.create()),x(this,"title",Wt.default.title),x(this,"creationDate",new Date),x(this,"creationAuthor",""),x(this,"viewpoints",new wn),x(this,"relatedTopics",new wn),x(this,"comments",new ks),x(this,"documentReferences",new wn),x(this,"customData",{}),x(this,"description"),x(this,"serverAssignedId"),x(this,"dueDate"),x(this,"modifiedAuthor"),x(this,"modifiedDate"),x(this,"index"),x(this,"_type",Wt.default.type),x(this,"_status",Wt.default.status),x(this,"_priority",Wt.default.priority),x(this,"_stage",Wt.default.stage),x(this,"_assignedTo",Wt.default.assignedTo),x(this,"_labels",Wt.default.labels??new Set),x(this,"_components"),this._components=e;const t=e.get(Fe);this.creationAuthor=t.config.author,this.relatedTopics.guard=s=>s!==this.guid}set type(e){const t=this._components.get(Fe),{strict:s,types:i}=t.config;(!s||i.has(e))&&(this._type=e)}get type(){return this._type}set status(e){const t=this._components.get(Fe),{strict:s,statuses:i}=t.config;(!s||i.has(e))&&(this._status=e)}get status(){return this._status}set priority(e){const t=this._components.get(Fe);if(e){const{strict:s,priorities:i}=t.config;if(!(!s||i.has(e)))return;this._priority=e}else this._priority=e}get priority(){return this._priority}set stage(e){const t=this._components.get(Fe);if(e){const{strict:s,stages:i}=t.config;if(!(!s||i.has(e)))return;this._stage=e}else this._stage=e}get stage(){return this._stage}set assignedTo(e){const t=this._components.get(Fe);if(e){const{strict:s,users:i}=t.config;if(!(!s||i.has(e)))return;this._assignedTo=e}else this._assignedTo=e}get assignedTo(){return this._assignedTo}set labels(e){const t=this._components.get(Fe),{strict:s,labels:i}=t.config;if(s){const n=new Set;for(const r of e)(!s||i.has(r))&&n.add(r);this._labels=n}else this._labels=e}get labels(){return this._labels}get _managerVersion(){return this._components.get(Fe).config.version}set(e){const t=e,s=this;for(const i in e){if(i==="guid")continue;const n=t[i];i in this&&(s[i]=n)}return this._components.get(Fe).list.set(this.guid,this),this}createComment(e,t){const s=new hr(this._components,e);return s.viewpoint=t,s.topic=this,this.comments.set(s.guid,s),s}createLabelTags(){const e=[...this.labels];if(this._components.get(Fe).config.exportCustomDataAsLabels)for(const t in this.customData){const s=this.customData[t];typeof s=="string"&&e.push(s)}return e}createCommentTags(){return[...this.comments.values()].map(e=>{var t;return{$Guid:e.guid,Date:e.date.toISOString(),Author:e.author,Comment:e.comment,ModifiedAuthor:e.modifiedAuthor,ModifiedDate:(t=e.modifiedDate)==null?void 0:t.toISOString(),Viewpoint:e.viewpoint?{$Guid:e.viewpoint}:void 0}})}createViewpointTags(){const e=this._components.get(kt);return[...this.viewpoints].map(t=>e.list.get(t)).filter(t=>t).map(t=>{const s={$Guid:t.guid,Viewpoint:`${t.title??t.guid}.bcfv`};if(e.snapshots.get(t.snapshot)){const i=e.getSnapshotExtension(t.snapshot);s.Snapshot=`${t.snapshot}.${i}`}return s})}createRelatedTopicTags(){return[...this.relatedTopics].map(e=>({$Guid:e}))}createDocumentReferencesTag(e=this._managerVersion){const t=[];if(!(e==="3"||e==="2.1"))return t;const s=this._components.get(Fe);for(const i of this.documentReferences){const n=s.documents.get(i);if(!n)continue;let r={$Guid:Ze.create(),Description:n.description};e==="2.1"&&(r={...r,$isExternal:n.type==="external"?!0:void 0,ReferencedDocument:n.type==="external"?n.url:`../${n.fileName}`}),e==="3"&&(r={...r,DocumentGuid:n.type==="internal"?i:void 0,Url:n.type==="external"?n.url:void 0}),Object.keys(r).length>0&&t.push(r)}return t}toJSON(){var e,t;const s={guid:this.guid,server_assigned_id:this.serverAssignedId,topic_type:this.type,topic_status:this.status,title:this.title,priority:this.priority,index:this.index,labels:[...this.labels],creation_date:this.creationDate.toISOString(),creation_author:this.creationAuthor,modified_date:(e=this.modifiedDate)==null?void 0:e.toISOString(),modified_author:this.modifiedAuthor,assigned_to:this.assignedTo,stage:this.stage,description:this.description,due_date:(t=this.dueDate)==null?void 0:t.toISOString(),comments:[...this.comments].map(([r,o])=>o.toJSON()),relatedTopics:[...this.relatedTopics].map(r=>({related_topic_guid:r}))},i=this._components.get(kt);for(const r of this.viewpoints){const o=i.list.get(r);o&&(s.viewpoints||(s.viewpoints=[]),s.viewpoints.push(o.toJSON()))}const n=this._components.get(Fe);for(const r of this.documentReferences){const o=n.documents.get(r);o&&(s.document_references||(s.document_references=[]),o.type==="external"?s.document_references.push({guid:Ze.create(),description:o.description,url:o.url}):s.document_references.push({guid:Ze.create(),description:o.description,document_guid:r}))}for(const[r,o]of Object.entries(s))(o===void 0||Array.isArray(o)&&o.length===0)&&delete s[r];return s}serialize(){var e,t;const s=this._managerVersion,i={$Guid:this.guid,$TopicType:this.type,$TopicStatus:this.status,$ServerAssignedId:this.serverAssignedId,Title:this.title,CreationAuthor:this.creationAuthor,CreationDate:this.creationDate.toISOString(),Priority:this.priority,Index:s==="2.1"?this.index:void 0,ModifiedDate:(e=this.modifiedDate)==null?void 0:e.toISOString(),ModifiedAuthor:this.modifiedAuthor,DueDate:(t=this.dueDate)==null?void 0:t.toISOString(),AssignedTo:this.assignedTo,Description:this.description,Stage:this.stage,DocumentReferences:s==="3"?{DocumentReference:this.createDocumentReferencesTag(s)}:void 0,RelatedTopics:s==="3"?{RelatedTopic:this.createRelatedTopicTags()}:void 0,RelatedTopic:s==="2.1"?this.createRelatedTopicTags():void 0,Labels:s==="3"?{Label:this.createLabelTags()}:void 0,Viewpoints:s==="3"?{ViewPoint:this.createViewpointTags()}:void 0,Comments:s==="3"?{Comment:this.createCommentTags()}:void 0};s==="2.1"&&(i.Labels=this.createLabelTags(),i.DocumentReference=this.createDocumentReferencesTag(s));const n={Markup:{Topic:i}};return s==="2.1"&&(n.Markup.Viewpoints=this.createViewpointTags(),n.Markup.Comment=this.createCommentTags()),`<?xml version="1.0" encoding="UTF-8"?>
    ${mn.builder.build(n)}`}};x(ka,"default",{title:"BCF Topic",type:"Issue",status:"Active"});let yo=ka;const Ld=(a,e)=>{if(e.trim()==="")return;const t=Fe.xmlParser.parse(e).Extensions;if(!t)return;const{Priorities:s,TopicStatuses:i,TopicTypes:n,Users:r}=t;if(s&&s.Priority){const o=Array.isArray(s.Priority)?s.Priority:[s.Priority];for(const l of o)a.config.priorities.add(l)}if(i&&i.TopicStatus){const o=Array.isArray(i.TopicStatus)?i.TopicStatus:[i.TopicStatus];for(const l of o)a.config.statuses.add(l)}if(n&&n.TopicType){const o=Array.isArray(n.TopicType)?n.TopicType:[n.TopicType];for(const l of o)a.config.types.add(l)}if(r&&r.User){const o=Array.isArray(r.User)?r.User:[r.User];for(const l of o)a.config.users.add(l)}};class Nd extends gn{constructor(){super(...arguments),x(this,"_config",{version:{type:"Select",options:new Set(["2.1","3"]),multiple:!1,value:""},author:{type:"Text",value:""},types:{type:"TextSet",value:new Set},statuses:{type:"TextSet",value:new Set},priorities:{type:"TextSet",value:new Set},labels:{type:"TextSet",value:new Set},stages:{type:"TextSet",value:new Set},users:{type:"TextSet",value:new Set},includeSelectionTag:{type:"Boolean",value:!1},updateExtensionsOnImport:{type:"Boolean",value:!1},strict:{type:"Boolean",value:!1},includeAllExtensionsOnExport:{type:"Boolean",value:!1},fallbackVersionOnImport:{type:"Select",multiple:!1,options:new Set(["2.1","3"]),value:""},ignoreIncompleteTopicsOnImport:{type:"Boolean",value:!1},exportCustomDataAsLabels:{type:"Boolean",value:!1}})}get version(){return this._config.version.value}set version(e){this._config.version.value=e}get author(){return this._config.author.value}set author(e){this._config.author.value=e}get types(){return this._config.types.value}set types(e){this._config.types.value=e}get statuses(){return this._config.statuses.value}set statuses(e){this._config.statuses.value=e}get priorities(){return this._config.priorities.value}set priorities(e){this._config.priorities.value=e}get labels(){return this._config.labels.value}set labels(e){this._config.labels.value=e}get stages(){return this._config.stages.value}set stages(e){this._config.stages.value=e}get users(){return this._config.users.value}set users(e){this._config.users.value=e}get includeSelectionTag(){return this._config.includeSelectionTag.value}set includeSelectionTag(e){this._config.includeSelectionTag.value=e}get updateExtensionsOnImport(){return this._config.updateExtensionsOnImport.value}set updateExtensionsOnImport(e){this._config.updateExtensionsOnImport.value=e}get strict(){return this._config.strict.value}set strict(e){this._config.strict.value=e}get includeAllExtensionsOnExport(){return this._config.includeAllExtensionsOnExport.value}set includeAllExtensionsOnExport(e){this._config.includeAllExtensionsOnExport.value=e}get fallbackVersionOnImport(){return this._config.fallbackVersionOnImport.value}set fallbackVersionOnImport(e){this._config.fallbackVersionOnImport.value=e}get ignoreIncompleteTopicsOnImport(){return this._config.ignoreIncompleteTopicsOnImport.value}set ignoreIncompleteTopicsOnImport(e){this._config.ignoreIncompleteTopicsOnImport.value=e}get exportCustomDataAsLabels(){return this._config.exportCustomDataAsLabels.value}set exportCustomDataAsLabels(e){this._config.exportCustomDataAsLabels.value=e}}const Ar=class ni extends Ee{constructor(){super(...arguments),x(this,"enabled",!1),x(this,"_defaultConfig",{author:"jhon.doe@example.com",version:"2.1",types:new Set(["Clash","Failure","Fault","Inquiry","Issue","Remark","Request"]),statuses:new Set(["Active","In Progress","Done","In Review","Closed"]),priorities:new Set(["On hold","Minor","Normal","Major","Critical"]),labels:new Set,stages:new Set,users:new Set,includeSelectionTag:!1,updateExtensionsOnImport:!0,strict:!1,includeAllExtensionsOnExport:!0,fallbackVersionOnImport:"2.1",ignoreIncompleteTopicsOnImport:!1,exportCustomDataAsLabels:!1}),x(this,"config",new Nd(this,this.components,"BCF Topics",ni.uuid)),x(this,"list",new ks),x(this,"documents",new ks),x(this,"onSetup",new Q),x(this,"isSetup",!1),x(this,"onBCFImported",new Q),x(this,"onDisposed",new Q)}setup(e){if(this.isSetup)return;const t={...this._defaultConfig,...e};this.config.version=t.version,this.config.author=t.author,this.config.types=t.types,this.config.statuses=t.statuses,this.config.priorities=t.priorities,this.config.labels=t.labels,this.config.stages=t.stages,this.config.users=t.users,this.config.includeSelectionTag=t.includeSelectionTag,this.config.updateExtensionsOnImport=t.updateExtensionsOnImport,this.config.strict=t.strict,this.config.includeAllExtensionsOnExport=t.includeAllExtensionsOnExport,this.config.fallbackVersionOnImport=t.fallbackVersionOnImport||"",this.config.ignoreIncompleteTopicsOnImport=t.ignoreIncompleteTopicsOnImport,this.isSetup=!0,this.enabled=!0,this.onSetup.trigger()}create(e){const t=new yo(this.components);return e?(t.guid=e.guid??t.guid,t.set(e)):this.list.set(t.guid,t),t}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get usedTypes(){const e=[...this.list].map(([t,s])=>s.type);return new Set(e)}get usedStatuses(){const e=[...this.list].map(([t,s])=>s.status);return new Set(e)}get usedPriorities(){const e=[...this.list].map(([t,s])=>s.priority).filter(t=>t);return new Set(e)}get usedStages(){const e=[...this.list].map(([t,s])=>s.stage).filter(t=>t);return new Set(e)}get usedUsers(){const e=[];for(const[t,s]of this.list){e.push(s.creationAuthor),s.assignedTo&&e.push(s.assignedTo),s.modifiedAuthor&&e.push(s.modifiedAuthor);for(const[i,n]of s.comments)e.push(n.author),n.modifiedAuthor&&e.push(n.modifiedAuthor)}return new Set(e)}get usedLabels(){const e=[];for(const[t,s]of this.list)e.push(...s.labels);return new Set(e)}updateExtensions(){for(const[e,t]of this.list){for(const s of t.labels)this.config.labels.add(s);this.config.types.add(t.type),t.priority&&this.config.priorities.add(t.priority),t.stage&&this.config.stages.add(t.stage),this.config.statuses.add(t.status),this.config.users.add(t.creationAuthor),t.assignedTo&&this.config.users.add(t.assignedTo),t.modifiedAuthor&&this.config.users.add(t.modifiedAuthor);for(const[s,i]of t.comments)this.config.users.add(i.author),i.modifiedAuthor&&this.config.users.add(i.modifiedAuthor)}}updateViewpointReferences(){const e=this.components.get(kt);for(const[t,s]of this.list)for(const i of s.viewpoints)e.list.has(i)||s.viewpoints.delete(i)}async export(e=this.list.values()){const t=new _o;t.file("bcf.version",`<?xml version="1.0" encoding="UTF-8"?>
    <Version VersionId="${this.config.version}" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/buildingSMART/BCF-XML/release_3_0/Schemas/version.xsd"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    </Version>`);for(const[i,n]of this.documents.entries())n.type!=="external"&&t.file(this.config.version==="2.1"?n.fileName:`documents/${i}`,n.data);if(this.config.version==="3"){const i=[];for(const[n,r]of this.documents.entries()){const{type:o,description:l}=r;o!=="external"&&i.push(`<Document Guid="${n}">
        <Filename>${r.fileName}</Filename>
        ${l?`<Description>${l}</Description>`:""}
      </Document>`)}i.length>0&&t.file("documents.xml",`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
  <DocumentInfo xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="documents.xsd">
    <Documents>
      ${i.join(`
`)}
    </Documents>
  </DocumentInfo>`)}t.file("bcf.extensions",this.serializeExtensions());const s=this.components.get(kt);for(const i of e){const n=t.folder(i.guid);n.file("markup.bcf",i.serialize());for(const r of i.viewpoints){const o=s.list.get(r);if(!o)continue;const l=o.title??o.guid;n.file(`${l}.bcfv`,await o.serialize());const h=s.snapshots.get(o.snapshot);if(!h)continue;const c=h?o.snapshot:o.guid,u=s.getSnapshotExtension(o.snapshot);n.file(`${c}.${u}`,h,{binary:!0})}}return await t.generateAsync({type:"blob"})}serializeExtensions(){const e=[...this.config.types].map(o=>`<TopicType>${o}</TopicType>`).join(`
`),t=[...this.config.statuses].map(o=>`<TopicStatus>${o}</TopicStatus>`).join(`
`),s=[...this.config.priorities].map(o=>`<Priority>${o}</Priority>`).join(`
`),i=[...this.config.labels].map(o=>`<TopicLabel>${o}</TopicLabel>`).join(`
`),n=[...this.config.stages].map(o=>`<Stage>${o}</Stage>`).join(`
`),r=[...this.config.users].map(o=>`<User>${o}</User>`).join(`
`);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Extensions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="your-schema-location.xsd">
        ${e.length!==0?`<TopicTypes>
${e}
</TopicTypes>`:""}
        ${t.length!==0?`<TopicStatuses>
${t}
</TopicStatuses>`:""}
        ${s.length!==0?`<Priorities>
${s}
</Priorities>`:""}
        ${i.length!==0?`<TopicLabels>
${i}
</TopicLabels>`:""}
        ${n.length!==0?`<Stages>
${n}
</Stages>`:""}
        ${r.length!==0?`<Users>
${r}
</Users>`:""}
      </Extensions>
    `}processMarkupComment(e){const{Guid:t,Date:s,Author:i,Comment:n,Viewpoint:r}=e;if(!(t&&s&&i&&(hr||r)))return null;const o=new hr(this.components,n??"");return o.guid=t,o.date=new Date(s),o.author=i,o.viewpoint=r==null?void 0:r.Guid,o.modifiedAuthor=e.ModifiedAuthor,o.modifiedDate=e.ModifiedDate?new Date(e.ModifiedDate):void 0,o}getMarkupComments(e,t){var s;let i;if(t==="2.1"&&(i=e.Comment),t==="3"&&(i=(s=e.Topic.Comments)==null?void 0:s.Comment),!i)return[];i=Array.isArray(i)?i:[i];const n=i.map(r=>this.processMarkupComment(r)).filter(r=>r);return Array.isArray(n)?n:[n]}getMarkupLabels(e,t){var s;let i;return t==="2.1"&&(i=e.Topic.Labels),t==="3"&&(i=(s=e.Topic.Labels)==null?void 0:s.Label),i?Array.isArray(i)?i:[i]:[]}getMarkupViewpoints(e,t){var s;let i;return t==="2.1"&&(i=e.Viewpoints),t==="3"&&(i=(s=e.Topic.Viewpoints)==null?void 0:s.ViewPoint),i?(i=Array.isArray(i)?i:[i],i):[]}getMarkupRelatedTopics(e,t){var s;let i;return t==="2.1"&&(i=e.Topic.RelatedTopic),t==="3"&&(i=(s=e.Topic.RelatedTopics)==null?void 0:s.RelatedTopic),i?(Array.isArray(i)?i:[i]).map(n=>n.Guid):[]}getMarkupDocumentReferences(e,t){var s;let i;return t==="2.1"&&(i=e.Topic.DocumentReference),t==="3"&&(i=(s=e.Topic.DocumentReferences)==null?void 0:s.DocumentReference),i?Array.isArray(i)?i:[i]:[]}async load(e){var t,s,i;const{fallbackVersionOnImport:n,ignoreIncompleteTopicsOnImport:r,updateExtensionsOnImport:o}=this.config,l=new _o;await l.loadAsync(e);const h=Object.values(l.files);let c=n;const u=h.find(b=>b.name.endsWith(".version"));if(u){const b=await u.async("string"),E=ni.xmlParser.parse(b).Version.VersionId;c=String(E)}if(!(c&&(c==="2.1"||c==="3")))throw new Error(`BCFTopics: ${c} is not supported.`);const f=h.find(b=>b.name.endsWith(".extensions"));if(o&&f){const b=await f.async("string");Ld(this,b)}const d=[],g=this.components.get(kt),m=h.filter(b=>b.name.endsWith(".bcfv"));for(const b of m){const E=await b.async("string"),S=ni.xmlParser.parse(E).VisualizationInfo;if(!S){console.warn("Missing VisualizationInfo in Viewpoint");continue}const A={},{Guid:P,ClippingPlanes:D,Components:I,OrthogonalCamera:k,PerspectiveCamera:V}=S;if(P&&(A.guid=P),I){const z={selection:[],coloring:[],visibility:{default_visibility:!1,exceptions:[],view_setup_hints:{spaces_visible:!1,space_boundaries_visible:!1,openings_visible:!1}}};A.components=z;const{Selection:w,Visibility:B}=I;if(w&&w.Component){const te=Array.isArray(w.Component)?w.Component:[w.Component];z.selection=te.map(W=>W.IfcGuid?{ifc_guid:W.IfcGuid}:null).filter(W=>W!==null)}if(B&&"DefaultVisibility"in B&&(z.visibility.default_visibility=B.DefaultVisibility),B&&B.Exceptions&&"Component"in B.Exceptions){const{Component:te}=B.Exceptions,W=Array.isArray(te)?te:[te];z.visibility.exceptions=W.map(se=>se.IfcGuid?{ifc_guid:se.IfcGuid}:null).filter(se=>se!==null)}let G;c==="2.1"&&(G=I.ViewSetupHints),c==="3"&&(G=(t=I.Visibility)==null?void 0:t.ViewSetupHints),G&&("OpeningsVisible"in G&&(z.visibility.view_setup_hints.openings_visible=G.OpeningsVisible),"SpacesVisible"in G&&(z.visibility.view_setup_hints.spaces_visible=G.SpacesVisible),"SpaceBoundariesVisible"in G&&(z.visibility.view_setup_hints.space_boundaries_visible=G.SpaceBoundariesVisible));const{Coloring:X}=I;if(X&&X.Color){const te=Array.isArray(X.Color)?X.Color:[X.Color];for(const W of te){const{Color:se,Component:R}=W;if(!(se.length===6||se.length===8))continue;const U=se.length===6?se:se.slice(2),ne=(Array.isArray(R)?R:[R]).map(ee=>ee.IfcGuid?{ifc_guid:ee.IfcGuid}:null).filter(ee=>ee!==null);z.coloring.push({color:U,components:ne})}}}if(k||V){const z=S.PerspectiveCamera??S.OrthogonalCamera,{CameraViewPoint:w,CameraDirection:B}=z,G=new N(Number(w.X),Number(w.Z),Number(-w.Y)),X=new N(Number(B.X),Number(B.Z),Number(-B.Y)),te={camera_view_point:{x:G.x,y:G.y,z:G.z},camera_direction:{x:X.x,y:X.y,z:X.z},aspect_ratio:"AspectRatio"in z?z.AspectRatio:1,camera_up_vector:{x:0,y:0,z:0}};"ViewToWorldScale"in z&&(A.orthogonal_camera={...te,view_to_world_scale:z.ViewToWorldScale}),"FieldOfView"in z&&(A.perspective_camera={...te,field_of_view:z.FieldOfView})}if(D){const z=(Array.isArray(D.ClippingPlane)?D.ClippingPlane:[D.ClippingPlane]).map(({Location:w,Direction:B})=>({location:{x:w.x,y:w.y,z:w.z},direction:{x:B.x,y:B.y,z:B.z}}));A.clipping_planes=z}const C=new Na(this.components,A);d.push(C)}const v={},p=[],_=h.filter(b=>b.name.endsWith(".bcf"));for(const b of _){const E=await b.async("string"),S=ni.xmlParser.parse(E).Markup,A=S.Topic,{Guid:P,TopicType:D,TopicStatus:I,Title:k,CreationDate:V,CreationAuthor:C}=A;if(r&&!(P&&D&&I&&k&&V&&C))continue;const z=new yo(this.components);z.guid=P??z.guid;const w=this.getMarkupRelatedTopics(S,c);v[z.guid]=new Set(w),z.type=D??z.type,z.status=I??z.status,z.title=k??z.title,z.creationDate=V?new Date(V):z.creationDate,z.creationAuthor=C??z.creationAuthor,z.serverAssignedId=A.ServerAssignedId,z.priority=A.Priority,z.index=A.Index,z.modifiedDate=A.ModifiedDate?new Date(A.ModifiedDate):void 0,z.modifiedAuthor=A.ModifiedAuthor,z.dueDate=A.DueDate?new Date(A.DueDate):void 0,z.assignedTo=A.AssignedTo,z.description=A.Description,z.stage=A.Stage;const B=this.getMarkupLabels(S,c);for(const U of B)z.labels.add(U);const G=this.getMarkupComments(S,c);for(const U of G)z.comments.set(U.guid,U);const X=this.getMarkupViewpoints(S,c);for(const U of X){if(!(U&&U.Guid))continue;const ne=g.list.get(U.Guid);if(!ne)continue;z.viewpoints.add(ne.guid);const ee=`${z.guid}/${U.Snapshot}`,J=h.find(({name:pe})=>pe===ee);if(J){const pe=await J.async("arraybuffer"),ve=new Uint8Array(pe);g.snapshots.set(ne.guid,ve),ne.snapshot=ne.guid??null}}const te=this.getMarkupDocumentReferences(S,c),W=h.find(U=>U.name==="documents.xml");let se=[];const R=await(W==null?void 0:W.async("string"));if(R){const U=(i=(s=mn.parser.parse(R).DocumentInfo)==null?void 0:s.Documents)==null?void 0:i.Document;se=Array.isArray(U)?U:[U]}for(const U of te){const{Description:ne,DocumentGuid:ee,Url:J,isExternal:pe,ReferencedDocument:ve}=U;if(ee&&se.length>0){const ae=se.find(({Guid:Ie})=>Ie===ee),ce=h.find(Ie=>Ie.name.endsWith(ee)),be=await(ce==null?void 0:ce.async("uint8array"));if(!(ae&&be))continue;const{Description:we,Filename:Ue}=ae;this.documents.set(ee,{type:"internal",fileName:Ue,description:we,data:be}),z.documentReferences.add(ee)}if(J){const ae=this.documents.add({type:"external",url:J,description:ne});z.documentReferences.add(ae)}if(ve){let ae=null;if(pe)ae=this.documents.add({type:"external",url:ve,description:ne});else{const ce=ve.split("/"),be=ce[ce.length-1],we=h.find(Ie=>Ie.name.endsWith(be)),Ue=await(we==null?void 0:we.async("uint8array"));if(!Ue)continue;ae=this.documents.add({type:"internal",fileName:be,data:Ue,description:ne})}z.documentReferences.add(ae)}}this.list.set(z.guid,z),p.push(z)}for(const b in v){const E=this.list.get(b);if(!E)continue;const S=v[b];for(const A of S)E.relatedTopics.add(A)}return this.onBCFImported.trigger(p),{viewpoints:d,topics:p}}};x(Ar,"uuid","de977976-e4f6-4e4f-a01a-204727839802");x(Ar,"xmlParser",new fn.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let Fe=Ar;const rs=new gr,Ge=new N,jt=new N,Ae=new yt,wo={X:new N(1,0,0),Y:new N(0,1,0),Z:new N(0,0,1)},Fn={type:"change"},bo={type:"mouseDown",mode:null},xo={type:"mouseUp",mode:null},Eo={type:"objectChange"};class Ud extends El{constructor(e,t=null){super(void 0,t);const s=new Hd(this);this._root=s;const i=new Wd;this._gizmo=i,s.add(i);const n=new Xd;this._plane=n,s.add(n);const r=this;function o(b,E){let S=E;Object.defineProperty(r,b,{get:function(){return S!==void 0?S:E},set:function(A){S!==A&&(S=A,n[b]=A,i[b]=A,r.dispatchEvent({type:b+"-changed",value:A}),r.dispatchEvent(Fn))}}),r[b]=E,n[b]=E,i[b]=E}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0),o("minX",-1/0),o("maxX",1/0),o("minY",-1/0),o("maxY",1/0),o("minZ",-1/0),o("maxZ",1/0);const l=new N,h=new N,c=new yt,u=new yt,f=new N,d=new yt,g=new N,m=new N,v=new N,p=0,_=new N;o("worldPosition",l),o("worldPositionStart",h),o("worldQuaternion",c),o("worldQuaternionStart",u),o("cameraPosition",f),o("cameraQuaternion",d),o("pointStart",g),o("pointEnd",m),o("rotationAxis",v),o("rotationAngle",p),o("eye",_),this._offset=new N,this._startNorm=new N,this._endNorm=new N,this._cameraScale=new N,this._parentPosition=new N,this._parentQuaternion=new yt,this._parentQuaternionInv=new yt,this._parentScale=new N,this._worldScaleStart=new N,this._worldQuaternionInv=new yt,this._worldScale=new N,this._positionStart=new N,this._quaternionStart=new yt,this._scaleStart=new N,this._getPointer=Bd.bind(this),this._onPointerDown=Fd.bind(this),this._onPointerHover=Rd.bind(this),this._onPointerMove=Vd.bind(this),this._onPointerUp=jd.bind(this),t!==null&&this.connect(t)}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&rs.setFromCamera(e,this.camera);const t=Vn(this._gizmo.picker[this.mode],rs);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&rs.setFromCamera(e,this.camera);const t=Vn(this._plane,rs,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,bo.mode=this.mode,this.dispatchEvent(bo)}}pointerMove(e){const t=this.axis,s=this.mode,i=this.object;let n=this.space;if(s==="scale"?n="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(n="world"),i===void 0||t===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&rs.setFromCamera(e,this.camera);const r=Vn(this._plane,rs,!0);if(r){if(this.pointEnd.copy(r.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),n==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),n==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(n==="local"&&(i.position.applyQuaternion(Ae.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),n==="world"&&(i.parent&&i.position.add(Ge.setFromMatrixPosition(i.parent.matrixWorld)),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(Ge.setFromMatrixPosition(i.parent.matrixWorld)))),i.position.x=Math.max(this.minX,Math.min(this.maxX,i.position.x)),i.position.y=Math.max(this.minY,Math.min(this.maxY,i.position.y)),i.position.z=Math.max(this.minZ,Math.min(this.maxZ,i.position.z));else if(s==="scale"){if(t.search("XYZ")!==-1){let o=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(o*=-1),jt.set(o,o,o)}else Ge.copy(this.pointStart),jt.copy(this.pointEnd),Ge.applyQuaternion(this._worldQuaternionInv),jt.applyQuaternion(this._worldQuaternionInv),jt.divide(Ge),t.search("X")===-1&&(jt.x=1),t.search("Y")===-1&&(jt.y=1),t.search("Z")===-1&&(jt.z=1);i.scale.copy(this._scaleStart).multiply(jt),this.scaleSnap&&(t.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const o=20/this.worldPosition.distanceTo(Ge.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Ge.copy(this.rotationAxis).cross(this.eye))*o):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(wo[t]),Ge.copy(wo[t]),n==="local"&&Ge.applyQuaternion(this.worldQuaternion),Ge.cross(this.eye),Ge.length()===0?l=!0:this.rotationAngle=this._offset.dot(Ge.normalize())*o),(t==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),n==="local"&&t!=="E"&&t!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(Ae.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(Ae.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Fn),this.dispatchEvent(Eo)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(xo.mode=this.mode,this.dispatchEvent(xo)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(e){return this.object=e,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Fn),this.dispatchEvent(Eo),this.pointStart.copy(this.pointEnd))}getRaycaster(){return rs}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function Bd(a){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:a.button};{const e=this.domElement.getBoundingClientRect();return{x:(a.clientX-e.left)/e.width*2-1,y:-(a.clientY-e.top)/e.height*2+1,button:a.button}}}function Rd(a){if(this.enabled)switch(a.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(a));break}}function Fd(a){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(a.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(a)),this.pointerDown(this._getPointer(a)))}function Vd(a){this.enabled&&this.pointerMove(this._getPointer(a))}function jd(a){this.enabled&&(this.domElement.releasePointerCapture(a.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(a)))}function Vn(a,e,t){const s=e.intersectObject(a,!0);for(let i=0;i<s.length;i++)if(s[i].object.visible||t)return s[i];return!1}const Fi=new Tl,xe=new N(0,1,0),So=new N(0,0,0),To=new Te,Vi=new yt,tn=new yt,Et=new N,Co=new Te,ri=new N(1,0,0),os=new N(0,1,0),oi=new N(0,0,1),ji=new N,ti=new N,si=new N;class Hd extends hi{constructor(e){super(),this.isTransformControlsRoot=!0,this.controls=e,this.visible=!1}updateMatrixWorld(e){const t=this.controls;t.object!==void 0&&(t.object.updateMatrixWorld(),t.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):t.object.parent.matrixWorld.decompose(t._parentPosition,t._parentQuaternion,t._parentScale),t.object.matrixWorld.decompose(t.worldPosition,t.worldQuaternion,t._worldScale),t._parentQuaternionInv.copy(t._parentQuaternion).invert(),t._worldQuaternionInv.copy(t.worldQuaternion).invert()),t.camera.updateMatrixWorld(),t.camera.matrixWorld.decompose(t.cameraPosition,t.cameraQuaternion,t._cameraScale),t.camera.isOrthographicCamera?t.camera.getWorldDirection(t.eye).negate():t.eye.copy(t.cameraPosition).sub(t.worldPosition).normalize(),super.updateMatrixWorld(e)}dispose(){this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}}class Wd extends hi{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new us({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new Yo({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const i=t.clone();i.opacity=.5;const n=e.clone();n.color.setHex(16711680);const r=e.clone();r.color.setHex(65280);const o=e.clone();o.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const h=e.clone();h.color.setHex(65280),h.opacity=.5;const c=e.clone();c.color.setHex(255),c.opacity=.5;const u=e.clone();u.opacity=.25;const f=e.clone();f.color.setHex(16776960),f.opacity=.25,e.clone().color.setHex(16776960);const d=e.clone();d.color.setHex(7895160);const g=new Ke(0,.04,.1,12);g.translate(0,.05,0);const m=new qe(.08,.08,.08);m.translate(0,.04,0);const v=new st;v.setAttribute("position",new qt([0,0,0,1,0,0],3));const p=new Ke(.0075,.0075,.5,3);p.translate(0,.25,0);function _(w,B){const G=new Vs(w,.0075,3,64,B*Math.PI*2);return G.rotateY(Math.PI/2),G.rotateX(Math.PI/2),G}function b(){const w=new st;return w.setAttribute("position",new qt([0,0,0,1,1,1],3)),w}const E={X:[[new ie(g,n),[.5,0,0],[0,0,-Math.PI/2]],[new ie(g,n),[-.5,0,0],[0,0,Math.PI/2]],[new ie(p,n),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new ie(g,r),[0,.5,0]],[new ie(g,r),[0,-.5,0],[Math.PI,0,0]],[new ie(p,r)]],Z:[[new ie(g,o),[0,0,.5],[Math.PI/2,0,0]],[new ie(g,o),[0,0,-.5],[-Math.PI/2,0,0]],[new ie(p,o),null,[Math.PI/2,0,0]]],XYZ:[[new ie(new gi(.1,0),u.clone()),[0,0,0]]],XY:[[new ie(new qe(.15,.15,.01),c.clone()),[.15,.15,0]]],YZ:[[new ie(new qe(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ie(new qe(.15,.15,.01),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},S={X:[[new ie(new Ke(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new ie(new Ke(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new ie(new Ke(.2,0,.6,4),s),[0,.3,0]],[new ie(new Ke(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new ie(new Ke(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new ie(new Ke(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new ie(new gi(.2,0),s)]],XY:[[new ie(new qe(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new ie(new qe(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ie(new qe(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},A={START:[[new ie(new gi(.01,2),i),null,null,null,"helper"]],END:[[new ie(new gi(.01,2),i),null,null,null,"helper"]],DELTA:[[new Ct(b(),i),null,null,null,"helper"]],X:[[new Ct(v,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ct(v,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ct(v,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},P={XYZE:[[new ie(_(.5,1),d),null,[0,Math.PI/2,0]]],X:[[new ie(_(.5,.5),n)]],Y:[[new ie(_(.5,.5),r),null,[0,0,-Math.PI/2]]],Z:[[new ie(_(.5,.5),o),null,[0,Math.PI/2,0]]],E:[[new ie(_(.75,1),f),null,[0,Math.PI/2,0]]]},D={AXIS:[[new Ct(v,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},I={XYZE:[[new ie(new Sl(.25,10,8),s)]],X:[[new ie(new Vs(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new ie(new Vs(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new ie(new Vs(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new ie(new Vs(.75,.1,2,24),s)]]},k={X:[[new ie(m,n),[.5,0,0],[0,0,-Math.PI/2]],[new ie(p,n),[0,0,0],[0,0,-Math.PI/2]],[new ie(m,n),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new ie(m,r),[0,.5,0]],[new ie(p,r)],[new ie(m,r),[0,-.5,0],[0,0,Math.PI]]],Z:[[new ie(m,o),[0,0,.5],[Math.PI/2,0,0]],[new ie(p,o),[0,0,0],[Math.PI/2,0,0]],[new ie(m,o),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new ie(new qe(.15,.15,.01),c),[.15,.15,0]]],YZ:[[new ie(new qe(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ie(new qe(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new ie(new qe(.1,.1,.1),u.clone())]]},V={X:[[new ie(new Ke(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new ie(new Ke(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new ie(new Ke(.2,0,.6,4),s),[0,.3,0]],[new ie(new Ke(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new ie(new Ke(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new ie(new Ke(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new ie(new qe(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new ie(new qe(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ie(new qe(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new ie(new qe(.2,.2,.2),s),[0,0,0]]]},C={X:[[new Ct(v,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ct(v,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ct(v,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function z(w){const B=new hi;for(const G in w)for(let X=w[G].length;X--;){const te=w[G][X][0].clone(),W=w[G][X][1],se=w[G][X][2],R=w[G][X][3],U=w[G][X][4];te.name=G,te.tag=U,W&&te.position.set(W[0],W[1],W[2]),se&&te.rotation.set(se[0],se[1],se[2]),R&&te.scale.set(R[0],R[1],R[2]),te.updateMatrix();const ne=te.geometry.clone();ne.applyMatrix4(te.matrix),te.geometry=ne,te.renderOrder=1/0,te.position.set(0,0,0),te.rotation.set(0,0,0),te.scale.set(1,1,1),B.add(te)}return B}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=z(E)),this.add(this.gizmo.rotate=z(P)),this.add(this.gizmo.scale=z(k)),this.add(this.picker.translate=z(S)),this.add(this.picker.rotate=z(I)),this.add(this.picker.scale=z(V)),this.add(this.helper.translate=z(A)),this.add(this.helper.rotate=z(D)),this.add(this.helper.scale=z(C)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:tn;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let i=0;i<s.length;i++){const n=s[i];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition);let r;if(this.camera.isOrthographicCamera?r=(this.camera.top-this.camera.bottom)/this.camera.zoom:r=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(r*this.size/4),n.tag==="helper"){n.visible=!1,n.name==="AXIS"?(n.visible=!!this.axis,this.axis==="X"&&(Ae.setFromEuler(Fi.set(0,0,0)),n.quaternion.copy(t).multiply(Ae),Math.abs(xe.copy(ri).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Y"&&(Ae.setFromEuler(Fi.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(Ae),Math.abs(xe.copy(os).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Z"&&(Ae.setFromEuler(Fi.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(Ae),Math.abs(xe.copy(oi).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="XYZE"&&(Ae.setFromEuler(Fi.set(0,Math.PI/2,0)),xe.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(To.lookAt(So,xe,os)),n.quaternion.multiply(Ae),n.visible=this.dragging),this.axis==="E"&&(n.visible=!1)):n.name==="START"?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):n.name==="END"?(n.position.copy(this.worldPosition),n.visible=this.dragging):n.name==="DELTA"?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),Ge.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Ge.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(Ge),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=this.axis.search(n.name)!==-1));continue}n.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(n.name==="X"&&Math.abs(xe.copy(ri).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Y"&&Math.abs(xe.copy(os).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Z"&&Math.abs(xe.copy(oi).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XY"&&Math.abs(xe.copy(oi).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="YZ"&&Math.abs(xe.copy(ri).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XZ"&&Math.abs(xe.copy(os).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1)):this.mode==="rotate"&&(Vi.copy(t),xe.copy(this.eye).applyQuaternion(Ae.copy(t).invert()),n.name.search("E")!==-1&&n.quaternion.setFromRotationMatrix(To.lookAt(this.eye,So,os)),n.name==="X"&&(Ae.setFromAxisAngle(ri,Math.atan2(-xe.y,xe.z)),Ae.multiplyQuaternions(Vi,Ae),n.quaternion.copy(Ae)),n.name==="Y"&&(Ae.setFromAxisAngle(os,Math.atan2(xe.x,xe.z)),Ae.multiplyQuaternions(Vi,Ae),n.quaternion.copy(Ae)),n.name==="Z"&&(Ae.setFromAxisAngle(oi,Math.atan2(xe.y,xe.x)),Ae.multiplyQuaternions(Vi,Ae),n.quaternion.copy(Ae))),n.visible=n.visible&&(n.name.indexOf("X")===-1||this.showX),n.visible=n.visible&&(n.name.indexOf("Y")===-1||this.showY),n.visible=n.visible&&(n.name.indexOf("Z")===-1||this.showZ),n.visible=n.visible&&(n.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),n.material._color=n.material._color||n.material.color.clone(),n.material._opacity=n.material._opacity||n.material.opacity,n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled&&this.axis&&(n.name===this.axis||this.axis.split("").some(function(o){return n.name===o}))&&(n.material.color.setHex(16776960),n.material.opacity=1)}super.updateMatrixWorld(e)}}class Xd extends ie{constructor(){super(new vr(1e5,1e5,2,2),new us({visible:!1,wireframe:!0,side:Nt,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),ji.copy(ri).applyQuaternion(t==="local"?this.worldQuaternion:tn),ti.copy(os).applyQuaternion(t==="local"?this.worldQuaternion:tn),si.copy(oi).applyQuaternion(t==="local"?this.worldQuaternion:tn),xe.copy(ti),this.mode){case"translate":case"scale":switch(this.axis){case"X":xe.copy(this.eye).cross(ji),Et.copy(ji).cross(xe);break;case"Y":xe.copy(this.eye).cross(ti),Et.copy(ti).cross(xe);break;case"Z":xe.copy(this.eye).cross(si),Et.copy(si).cross(xe);break;case"XY":Et.copy(si);break;case"YZ":Et.copy(ji);break;case"XZ":xe.copy(si),Et.copy(ti);break;case"XYZ":case"E":Et.set(0,0,0);break}break;case"rotate":default:Et.set(0,0,0)}Et.length()===0?this.quaternion.copy(this.cameraQuaternion):(Co.lookAt(Ge.set(0,0,0),Et,xe),this.quaternion.setFromRotationMatrix(Co)),super.updateMatrixWorld(e)}}class Pr{constructor(e,t,s,i,n,r=5,o=!0){if(x(this,"onDraggingStarted",new Q),x(this,"onDraggingEnded",new Q),x(this,"onDisposed",new Q),x(this,"normal"),x(this,"origin"),x(this,"three",new at),x(this,"components"),x(this,"world"),x(this,"type","default"),x(this,"_title","Clipping Plane"),x(this,"_helper"),x(this,"_visible",!0),x(this,"_enabled",!0),x(this,"_controlsActive",!1),x(this,"_arrowBoundBox",new ie),x(this,"_planeMesh"),x(this,"_controls"),x(this,"_hiddenMaterial",new us({visible:!1})),x(this,"_visibilityBeforeDisabled",!0),x(this,"notifyManager",()=>{const l=this.components.get(Zt),h=l.list.getKey(this);h&&l.list.set(h,this)}),x(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),x(this,"changeDrag",l=>{this._visible=!l.value,this.preventCameraMovement(),this.notifyDraggingChanged(l)}),this.components=e,this.world=t,!t.renderer)throw new Error("The given world must have a renderer!");this.normal=i,this.origin=s,t.renderer.setPlane(!0,this.three),this._planeMesh=Pr.newPlaneMesh(r,n),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(i,s),o&&this.toggleControls(!0)}set title(e){this._title=e,this.notifyManager()}get title(){return this._title}get enabled(){return this._enabled}set enabled(e){if(!this.world.isDisposing){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=e,e?this.visible=this._visibilityBeforeDisabled:(this._visibilityBeforeDisabled=this.visible,this.visible=!1),this.world.renderer.setPlane(e,this.three),this.notifyManager()}}get visible(){return this._visible}set visible(e){this._visible=e,this._controls.getHelper().visible=e,this._helper.visible=e,this.toggleControls(e),this.notifyManager()}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(e){this._planeMesh.material=e}get size(){return this._planeMesh.scale.x}set size(e){this._planeMesh.scale.set(e,e,e)}get helper(){return this._helper}setFromNormalAndCoplanarPoint(e,t){this.reset(),this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.getHelper().removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const e=new N(1,0,0),t=new N;this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix()}toggleControls(e){if(e){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=e}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const e=this.world.camera.three,t=this.world.renderer.three.domElement,s=new Ud(e,t);return this.initializeControls(s),this.world.scene.three.add(s.getHelper()),s}initializeControls(e){e.attach(this._helper),e.showX=!1,e.showY=!1,e.setSpace("local"),this.createArrowBoundingBox(),e.getHelper().children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new Ke(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(e){e.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const e=new hi;return e.lookAt(this.normal),e.position.copy(this.origin),this._planeMesh.position.z+=.01,e.add(this._planeMesh),this.world.scene.three.add(e),e}static newPlaneMesh(e,t){const s=new vr(1),i=new ie(s,t);return i.scale.set(e,e,e),i}}class Zd extends gn{constructor(){super(...arguments),x(this,"_config",{enabled:{value:!0,type:"Boolean"},visible:{value:!0,type:"Boolean"},color:{value:new fe,type:"Color"},opacity:{type:"Number",interpolable:!0,value:1,min:0,max:1},size:{type:"Number",interpolable:!0,value:2,min:0,max:100}})}get enabled(){return this._config.enabled.value}set enabled(e){this._config.enabled.value=e,this._component.enabled=e}get visible(){return this._config.visible.value}set visible(e){this._config.visible.value=e,this._component.visible=e}get color(){return this._config.color.value}set color(e){this._config.color.value=e,this._component.material.color.copy(e)}get opacity(){return this._config.opacity.value}set opacity(e){this._config.opacity.value=e,this._component.material.opacity=e}get size(){return this._config.size.value}set size(e){this._config.size.value=e,this._component.size=e}}const La=class sn extends Ee{constructor(e){super(e),x(this,"onSetup",new Q),x(this,"onBeforeDrag",new Q),x(this,"onAfterDrag",new Q),x(this,"onBeforeCreate",new Q),x(this,"onBeforeCancel",new Q),x(this,"onAfterCancel",new Q),x(this,"onBeforeDelete",new Q),x(this,"onAfterCreate",new Q),x(this,"onAfterDelete",new Q),x(this,"onDisposed",new Q),x(this,"isSetup",!1),x(this,"orthogonalY",!1),x(this,"toleranceOrthogonalY",.7),x(this,"Type",Pr),x(this,"list",new Me),x(this,"config",new Zd(this,this.components,"Clipper",sn.uuid)),x(this,"_defaultConfig",{color:new fe(12255487),opacity:.2,size:2}),x(this,"_material",new us({color:12255487,side:Nt,transparent:!0,opacity:.2})),x(this,"_size",5),x(this,"_enabled",!1),x(this,"_visible",!0),x(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),x(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add(sn.uuid,this),this.setEvents()}get enabled(){return this._enabled}set enabled(e){this._enabled=e}get visible(){return this._visible}set visible(e){this._visible=e;for(const[t,s]of this.list)s.visible=e}get material(){return this._material}set material(e){this._material=e;for(const[t,s]of this.list)s.planeMaterial=e}get size(){return this._size}set size(e){this._size=e;for(const[t,s]of this.list)s.size=e}setEvents(){this.list.onBeforeDelete.add(({value:e})=>{if(!e.world.renderer)throw new Error("Renderer not found for this plane's world!");e.world.renderer.setPlane(!1,e.three),e.dispose(),this.updateMaterialsAndPlanes()})}dispose(){this._enabled=!1,this.components.get(Er).list.delete(this.config.uuid),this.list.clear(),this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(sn.uuid),this.onDisposed.reset()}async create(e){const t=await this.components.get(it).get(e).castRay();return t?this.createPlaneFromIntersection(e,t):null}createFromNormalAndCoplanarPoint(e,t,s){const i=this.newPlane(e,s,t);return this.updateMaterialsAndPlanes(),i}async delete(e,t){if(!t){const s=await this.pickPlane(e);if(!s)return;t=this.list.getKey(s)}t&&this.list.delete(t)}deleteAll(e){for(const[t,s]of this.list)(!e||e.has(s.type))&&this.list.delete(t)}setup(e){const t={...this._defaultConfig,...e};this.config.color=t.color,this.config.opacity=t.opacity,this.config.size=t.size,this.isSetup=!0,this.onSetup.trigger()}async pickPlane(e){const t=this.components.get(it).get(e),s=this.getAllPlaneMeshes(),i=await t.castRay({items:s});if(i){const n=i.object;return[...this.list.values()].find(r=>r.meshes.includes(n))}}getAllPlaneMeshes(){const e=[];for(const[t,s]of this.list)e.push(...s.meshes);return e}createPlaneFromIntersection(e,t){var s;if(!e.renderer)throw new Error("The given world must have a renderer!");const i=t.point.distanceTo(new N(0,0,0)),n=t.normal||((s=t.face)==null?void 0:s.normal);if(!i||!n)return null;const r=this.getWorldNormal(t,n),o=this.newPlane(e,t.point,r.negate()),l=this.list.get(o);return l.visible=this._visible,l.size=this._size,e.renderer.setPlane(!0,l.three),this.updateMaterialsAndPlanes(),l}getWorldNormal(e,t){const s=e.object;let i=e.object.matrixWorld.clone();if(s instanceof ll&&e.instanceId!==void 0){const o=new Te;s.getMatrixAt(e.instanceId,o),i=o.multiply(i)}const n=new hl().getNormalMatrix(i),r=t.clone().applyMatrix3(n).normalize();return this.normalizePlaneDirectionY(r),r}normalizePlaneDirectionY(e){this.orthogonalY&&(e.y>this.toleranceOrthogonalY&&(e.x=0,e.y=1,e.z=0),e.y<-this.toleranceOrthogonalY&&(e.x=0,e.y=-1,e.z=0))}newPlane(e,t,s){const i=new this.Type(this.components,e,t,s,this._material);i.onDraggingStarted.add(this._onStartDragging),i.onDraggingEnded.add(this._onEndDragging);const n=Ze.create();return this.list.set(n,i),this.onAfterCreate.trigger(i),n}updateMaterialsAndPlanes(){const e=this.components.get(Ea);for(const[t,s]of e.list){if(!s.renderer)continue;s.renderer.updateClippingPlanes();const{clippingPlanes:i}=s.renderer;for(const n of s.meshes)if(n.material)if(Array.isArray(n.material))for(const r of n.material)r.clippingPlanes=i;else n.material.clippingPlanes=i}}};x(La,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");let Zt=La;class Na{constructor(e,t){x(this,"title"),x(this,"guid",Ze.create()),x(this,"clippingPlanes",new Ve),x(this,"camera",{aspect_ratio:1,field_of_view:60,camera_direction:{x:0,y:0,z:0},camera_view_point:{x:0,y:0,z:0},camera_up_vector:{x:0,y:1,z:0}}),x(this,"exceptionComponents",new Ve),x(this,"selectionComponents",new Ve),x(this,"componentColors",new Me),x(this,"spacesVisible",!1),x(this,"spaceBoundariesVisible",!1),x(this,"openingsVisible",!1),x(this,"defaultVisibility",!0),x(this,"snapshot",this.guid),x(this,"_components"),x(this,"_world",null),x(this,"notifyUpdate",()=>{this._components.get(kt).list.set(this.guid,this)}),this._components=e,t&&(this.guid=t.guid??this.guid,this.set(t)),this.setEvents()}async getSelectionMap(){return await this._components.get(le).guidsToModelIdMap([...this.selectionComponents])}async getExceptionMap(){return await this._components.get(le).guidsToModelIdMap([...this.exceptionComponents])}get projection(){return"field_of_view"in this.camera?"Perspective":"Orthographic"}get position(){const e=this._components.get(le),{camera_view_point:t}=this.camera,{x:s,y:i,z:n}=t,r=new N(s,i,n);return e.applyBaseCoordinateSystem(r,new Te),r}set position(e){const t=e.clone(),s=this._components.get(le);e.clone().applyMatrix4(s.baseCoordinationMatrix.clone().invert()),this.camera.camera_view_point={x:t.x,y:t.y,z:t.z}}get direction(){const{camera_direction:e}=this.camera,{x:t,y:s,z:i}=e;return new N(t,s,i)}set world(e){this._world=e}get world(){return this._world}get _managerVersion(){return this._components.get(Fe).config.version}get topics(){return[...this._components.get(Fe).list.values()].filter(e=>e.viewpoints.has(this.guid))}setEvents(){this.selectionComponents.onUpdated.add(this.notifyUpdate),this.exceptionComponents.onUpdated.add(this.notifyUpdate),this.clippingPlanes.onUpdated.add(this.notifyUpdate),this.componentColors.onItemSet.add(this.notifyUpdate),this.componentColors.onItemDeleted.add(this.notifyUpdate),this.componentColors.onItemUpdated.add(this.notifyUpdate),this.componentColors.onCleared.add(this.notifyUpdate)}set(e){this.title=e.title;const{components:t,perspective_camera:s,orthogonal_camera:i,clipping_planes:n}=e;if(t){const{selection:r,visibility:o,coloring:l}=t;if(r){this.selectionComponents.clear();for(const{ifc_guid:h}of r)h&&this.selectionComponents.add(h)}if(o){const{default_visibility:h,exceptions:c,view_setup_hints:u}=o;if(h!==void 0&&(this.defaultVisibility=h),c){this.exceptionComponents.clear();for(const{ifc_guid:f}of c)f&&this.exceptionComponents.add(f)}if(u){const{spaces_visible:f,space_boundaries_visible:d,openings_visible:g}=u;f!==void 0&&(this.spacesVisible=f),d!==void 0&&(this.spaceBoundariesVisible=d),g!==void 0&&(this.openingsVisible=g)}}if(l){this.componentColors.clear();for(const h of l){const{color:c,components:u}=h,f=u.map(d=>d.ifc_guid).filter(d=>d!==null);this.componentColors.set(c,f)}}}if((s||i)&&(this.camera=s??i),n&&this.world){const r=this._components.get(Zt);for(const o of n){const{location:l,direction:h}=o,c=new N(l.x,l.z,-l.y),u=new N(h.x,h.z,-h.y),f=r.createFromNormalAndCoplanarPoint(this.world,u,c);this.clippingPlanes.add(f),r.list.get(f).enabled=!1,r.list.get(f).visible=!1}}this.notifyUpdate()}async go(e){if(!this.world)return;const{camera:t}=this.world;if(!(t instanceof za))throw new Error("Viewpoint: the world's camera component must be of type OrthoPerspectiveCamera to switch between perspective and orthographic projections.");const{transition:s,applyClippings:i,applyVisibility:n,clippingsVisibility:r}={transition:!0,applyClippings:!0,applyVisibility:!0,clippingsVisibility:!0,...e};t.projection.set(this.projection);const o=new N(this.camera.camera_view_point.x,this.camera.camera_view_point.y,this.camera.camera_view_point.z),l=new N(this.camera.camera_direction.x,this.camera.camera_direction.y,this.camera.camera_direction.z);if(o.equals(new N)&&l.equals(new N))return;const h=this.position,c=this.direction,u=80,f={x:h.x+c.x*u,y:h.y+c.y*u,z:h.z+c.z*u},d=[];i&&this.setClippingState(!0),n&&d.push(this.applyVisibility()),this.setClippingVisibility(r),d.push(t.controls.setLookAt(h.x,h.y,h.z,f.x,f.y,f.z,s)),await Promise.all(d)}async updateCamera(e=!0){return new Promise(t=>{if(!this.world){t(!1);return}const{camera:s,renderer:i}=this.world;if(!i)throw new Error("Viewpoint: the world needs to have a renderer!");if(!s.hasCameraControls())throw new Error("Viewpoint: world's camera need camera controls!");const n=new N;s.controls.getPosition(n);const r=s.three,o=new N(0,0,-1).applyEuler(r.rotation),{width:l,height:h}=i.getSize();let c=l/h;Number.isNaN(c)&&(c=1);const u=this._components.get(le);n.applyMatrix4(u.baseCoordinationMatrix.clone().invert());const f={aspect_ratio:c,camera_view_point:{x:n.x,y:n.y,z:n.z},camera_direction:{x:o.x,y:o.y,z:o.z},camera_up_vector:{x:0,y:1,z:0}};if(r instanceof qo?this.camera={...f,field_of_view:r.fov}:r instanceof un&&(this.camera={...f,view_to_world_scale:r.top-r.bottom}),e){const d=this._components.get(kt),g=i.three.domElement;i.three.render(this.world.scene.three,s.three),g.toBlob(async m=>{if(m){const v=await m.arrayBuffer(),p=new Uint8Array(v);d.snapshots.set(this.guid,p)}this.notifyUpdate(),t(!0)})}else this.notifyUpdate(),t(!0)})}takeSnapshot(){return new Promise(e=>{if(!this.world){e(!1);return}const{camera:t,renderer:s}=this.world;if(!s)throw new Error("Viewpoint: the world needs to have a renderer!");const i=this._components.get(kt),n=s.three.domElement;s.three.render(this.world.scene.three,t.three),n.toBlob(async r=>{if(r){const o=await r.arrayBuffer(),l=new Uint8Array(o);i.snapshots.set(this.guid,l)}this.notifyUpdate(),e(!0)})})}updateClippingPlanes(){this.clippingPlanes.clear();const e=this._components.get(Zt);for(const[t,s]of e.list)s.enabled&&this.clippingPlanes.add(t)}async applyVisibility(){const e=this._components.get(pc);e.set(this.defaultVisibility);const t=await this.getExceptionMap();e.set(!this.defaultVisibility,t);const s=await this.getSelectionMap();e.set(!0,s)}async setColorizationState(e){const t=this._components.get(le),s=[];if(e)for(const[i,n]of this.componentColors){const r=`#${i}`,o=await t.guidsToModelIdMap(n);for(const[l,h]of Object.entries(o)){const c=t.list.get(l);c&&s.push(c.highlight([...h],{customId:r,color:new fe(r),renderedFaces:Xo.ONE,opacity:1,transparent:!1}))}}else for(const[i,n]of this.componentColors){const r=await t.guidsToModelIdMap(n);for(const[o,l]of Object.entries(r)){const h=t.list.get(o);h&&s.push(h.resetHighlight([...l]))}}s.push(t.core.update(!0)),await Promise.all(s)}setClippingState(e){const t=this._components.get(Zt);for(const[s,i]of t.list)i.enabled=e&&this.clippingPlanes.has(s)}setClippingVisibility(e){const t=this._components.get(Zt);for(const s of this.clippingPlanes){const i=t.list.get(s);i&&(i.visible=e)}}async createComponentTags(e){var t;const s=this._components.get(le),i=this._components.get(Fe);let n="";if(i.config.includeSelectionTag){const r=e==="selection"?await this.getSelectionMap():await this.getExceptionMap();for(const o in r){const l=s.list.get(o);if(!l)continue;const h=r[o];for(const c of h){const u=l.getItem(c),f=await u.getGuid();if(!f)continue;const d=(t=await u.getAttributes())==null?void 0:t.getValue("Tag");let g=null;d&&(g=`AuthoringToolId="${d}"`),n+=`
<Component IfcGuid="${f}" ${g??""} />`}}}else n=[...this.selectionComponents].map(r=>`<Component IfcGuid="${r}" />`).join(`
`);return n}createColorTags(){let e="";for(const[t,s]of this.componentColors.entries()){const i=s.map(n=>`
<Component IfcGuid="${n}" />`).join(`
`);e+=`<Color Color="${t}">
${i}
</Color>`}return e.length!==0?`<Coloring>
${e}
</Coloring>`:"<Coloring />"}toJSON(){const e=this._components.get(Zt),t={guid:this.guid,components:{selection:[...this.selectionComponents].map(n=>({ifc_guid:n,authoring_tool_id:null})),coloring:[...this.componentColors].map(([n,r])=>({color:n,components:r.map(o=>({ifc_guid:o,authoring_tool_id:null}))})),visibility:{default_visibility:this.defaultVisibility,exceptions:[...this.exceptionComponents].map(n=>({ifc_guid:n,authoring_tool_id:null})),view_setup_hints:{spaces_visible:this.spacesVisible,space_boundaries_visible:this.spaceBoundariesVisible,openings_visible:this.openingsVisible}}},clipping_planes:[...this.clippingPlanes].map(n=>{const r=e.list.get(n);if(!r)return null;const o=r._controls.worldPosition??r.origin,{normal:l}=r;return{location:{x:o.x,y:-o.z,z:o.y},direction:{x:l.x,y:-l.z,z:l.y}}}).filter(n=>n!==null)};"field_of_view"in this.camera?t.perspective_camera=this.camera:t.orthogonal_camera=this.camera;const s=this._components.get(kt),i=s.snapshots.get(this.snapshot);if(i){const n=i.toString(),r=btoa(n),o=s.getSnapshotExtension(this.snapshot);t.snapshot={snapshot_type:o,snapshot_data:r}}return t}async serialize(e=this._managerVersion){const t=this._components.get(le),s=this.position;s.applyMatrix4(t.baseCoordinationMatrix.clone().invert());const i=this.direction;i.normalize();const n=new Te().makeRotationX(Math.PI/2),r=i.clone().applyMatrix4(n);r.normalize();const o=`<CameraViewPoint>
      <X>${s.x}</X>
      <Y>${-s.z}</Y>
      <Z>${s.y}</Z>
    </CameraViewPoint>`,l=`<CameraDirection>
      <X>${i.x}</X>
      <Y>${-i.z}</Y>
      <Z>${i.y}</Z>
    </CameraDirection>`,h=`<CameraUpVector>
      <X>${r.x}</X>
      <Y>${-r.z}</Y>
      <Z>${r.y}</Z>
    </CameraUpVector>`,c=`<AspectRatio>${this.camera.aspect_ratio}</AspectRatio>`;let u="";"view_to_world_scale"in this.camera?u=`<OrthogonalCamera>
        ${o}
        ${l}
        ${h}
        ${c}
        <ViewToWorldScale>${this.camera.view_to_world_scale}</ViewToWorldScale>
      </OrthogonalCamera>`:"field_of_view"in this.camera&&(u=`<PerspectiveCamera>
        ${o}
        ${l}
        ${h}
        ${c}
        <FieldOfView>${this.camera.field_of_view}</FieldOfView>
      </PerspectiveCamera>`);const f=`<ViewSetupHints SpacesVisible="${this.spacesVisible??!1}" SpaceBoundariesVisible="${this.spaceBoundariesVisible??!1}" OpeningsVisible="${this.openingsVisible??!1}" />`,d=(await this.createComponentTags("selection")).trim(),g=(await this.createComponentTags("exception")).trim(),m=this.createColorTags();return`<?xml version="1.0" encoding="UTF-8"?>
    <VisualizationInfo Guid="${this.guid}">
      <Components>
        ${e==="2.1"?f:""}
        ${d.length!==0?`<Selection>${d}</Selection>`:""}
        <Visibility DefaultVisibility="${this.defaultVisibility}">
          ${e==="3"?f:""}
          ${g.length!==0?`<Exceptions>${g}</Exceptions>`:""}
        </Visibility>
        ${m}
      </Components>
      ${u}
    </VisualizationInfo>`}}class Yd extends gn{constructor(){super(...arguments),x(this,"_config",{overwriteColors:{value:!1,type:"Boolean"}})}get overwriteColors(){return this._config.overwriteColors.value}set overwriteColors(e){this._config.overwriteColors.value=e}}const Ua=class cr extends Ee{constructor(e){super(e),x(this,"enabled",!0),x(this,"world",null),x(this,"list",new Me),x(this,"snapshots",new Me),x(this,"isSetup",!1),x(this,"onSetup",new Q),x(this,"config",new Yd(this,this.components,"Viewpoints",cr.uuid)),x(this,"onDisposed",new Q),e.add(cr.uuid,this)}create(e){const t=new Na(this.components,e);return t.world=this.world,e||this.list.set(t.guid,t),t}getSnapshotExtension(e){let t="jpeg";const s=this.snapshots.get(e);if(!s)return t;const i=s.subarray(0,4);let n="";for(let r=0;r<i.length;r++)n+=i[r].toString(16);return n.startsWith("89504e47")&&(t="png"),n.startsWith("ffd8ffe")&&(t="jpeg"),t}setup(){}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}};x(Ua,"uuid","ee867824-a796-408d-8aa0-4e5962a83c66");let kt=Ua;class Ao{constructor(e,t){x(this,"_components"),x(this,"_cameraOffset",10),x(this,"_planeHelper"),x(this,"_farPlaneHelper"),x(this,"_cameraHelper"),x(this,"onStateChanged",new Q),x(this,"onUpdated",new Q),x(this,"onDisposed",new Q),x(this,"camera"),x(this,"plane",new at),x(this,"farPlane",new at),x(this,"id",Ze.create()),x(this,"_open",!1),x(this,"_range",qd.defaultRange),x(this,"_world",null),x(this,"_helpersVisible",!1),x(this,"_planesEnabled",!1),this._components=e,this.camera=new za(this._components);const{threeOrtho:s}=this.camera;if(t!=null&&t.id&&(this.id=t.id),t!=null&&t.normal&&t!=null&&t.point){const{normal:i,point:n}=t;this.plane.setFromNormalAndCoplanarPoint(i,n)}this._cameraHelper=new fl(s),this._planeHelper=new kr(this.plane,50),this._farPlaneHelper=new kr(this.farPlane,50),this.farPlaneHelperColor=new fe("blue"),this.update()}get _planeNormalOpposite(){return this.plane.normal.clone().negate()}get _planePosition(){return this.plane.normal.clone().multiplyScalar(-this.plane.constant)}get _cameraPosition(){return this._planePosition.addScaledVector(this._planeNormalOpposite,this._cameraOffset)}set open(e){this._open=e,this.onStateChanged.trigger(["open"])}get open(){return this._open}set planeHelperColor(e){!Array.isArray(this._planeHelper.material)&&"color"in this._planeHelper.material&&this._planeHelper.material.color instanceof fe&&(this._planeHelper.material.color=e)}set farPlaneHelperColor(e){!Array.isArray(this._farPlaneHelper.material)&&"color"in this._farPlaneHelper.material&&this._farPlaneHelper.material.color instanceof fe&&(this._farPlaneHelper.material.color=e)}set range(e){this._range=e,this.update()}get range(){return this._range}set distance(e){this.plane.constant=e,this.update()}get distance(){return this.plane.constant}set world(e){this._world=e,this.camera.currentWorld=e,e&&(this.camera.projection.set("Orthographic"),this.camera.set("Plan"),this.camera.controls.dollySpeed=6,this.camera.controls.restThreshold=.005,this.update())}get world(){return this._world}set helpersVisible(e){if(!e){this._helpersVisible=e,this._planeHelper.removeFromParent(),this._farPlaneHelper.removeFromParent(),this._cameraHelper.removeFromParent();return}this.world&&(this._helpersVisible=e,this.world.scene.three.add(this._planeHelper,this._farPlaneHelper))}get helpersVisible(){return this._helpersVisible}set planesEnabled(e){const{world:t}=this;if(!t)return;const{renderer:s}=t;s&&(s.setPlane(e,this.plane),s.setPlane(e,this.farPlane),this._planesEnabled=e)}get planesEnabled(){return this._planesEnabled}dispose(){this.helpersVisible=!1;const e=this._components.get(Ot);e.destroy(this._planeHelper),e.destroy(this._farPlaneHelper),e.destroy(this._cameraHelper),this.camera.dispose(),this.onDisposed.trigger()}update(){if(this.world){const e=this._cameraPosition,t=this._planePosition;this.camera.controls.setLookAt(e.x,e.y,e.z,t.x,t.y,t.z,!1)}this.farPlane.normal.copy(this._planeNormalOpposite),this.farPlane.constant=this.range-this.plane.constant,this.onUpdated.trigger()}flip(){this.plane.normal.negate(),this.update()}}const Or=class Ba extends Ee{constructor(e){super(e),x(this,"list",new Me),x(this,"enabled",!0),x(this,"world",null),x(this,"_fragmentsUpdateEvent",()=>{this.components.get(le).core.update(!0)}),e.add(Ba.uuid,this),this.setupEvents()}get hasOpenViews(){return[...this.list.values()].some(e=>e.open)}setupEvents(){this.list.onBeforeDelete.add(({key:e,value:t})=>{t.open&&this.close(e),t.dispose()})}create(e,t,s){const i=new Ao(this.components,{id:s==null?void 0:s.id,normal:e,point:t});return i.world=(s==null?void 0:s.world)??this.world,this.list.set(i.id,i),i}createFromPlane(e,t){const s=new Ao(this.components,{id:t==null?void 0:t.id});return s.plane.copy(e),s.update(),s.world=(t==null?void 0:t.world)??this.world,this.list.set(s.id,s),s}async createFromIfcStoreys(e){const t=[],s=this.components.get(le),i=(e==null?void 0:e.offset)===void 0?.25:e.offset;for(const[n,r]of s.list){if(e&&e.modelIds&&!e.modelIds.some(u=>u.test(n)))continue;const o=Object.values(await r.getItemsOfCategories([/BUILDINGSTOREY/])).flat();if(o.length===0)continue;const l=await r.getItemsData(o),[,h]=await r.getCoordinates(),c=new N(0,-1,0);for(const u of l){if(!("value"in u.Name&&"value"in u.Elevation))continue;const{value:f}=u.Name;if(e!=null&&e.storeyNames&&!e.storeyNames.some(v=>v.test(f)))continue;const d=u.Elevation.value+h+i,g=new at(c,d),m=this.createFromPlane(g,{id:f,world:e==null?void 0:e.world});t.push(m)}}return t}createElevations(e){const t=[],s=this.components.get(le),i=(e==null?void 0:e.combine)===void 0?!1:e.combine,n=(e==null?void 0:e.namingCallback)??(o=>({front:`${i?"Front":`${o}: Front`}`,back:`${i?"Back":`${o}: Back`}`,left:`${i?"Left":`${o}: Left`}`,right:`${i?"Right":`${o}: Right`}`}));let r=[];for(const[o,l]of s.list)e&&e.modelIds&&!e.modelIds.some(h=>h.test(o))||r.push({id:o,box:l.box});if(i){const o=this.components.get(ln);o.list.clear(),o.list.add(...r.map(l=>l.box)),r=[{id:"combined",box:o.get()}]}for(const{id:o,box:l}of r){const{min:h,max:c}=l,u=Math.abs(c.x-h.x),f=Math.abs(c.z-h.z),d=new N;l.getCenter(d);const g=new at(new N(0,0,-1),c.z),m=new at(new N(0,0,1),-h.z),v=new at(new N(-1,0,0),c.x),p=new at(new N(1,0,0),-h.x),{front:_,back:b,left:E,right:S}=n(o),A=this.createFromPlane(g,{id:_,world:e==null?void 0:e.world});A.range=f;const P=this.createFromPlane(m,{id:b,world:e==null?void 0:e.world});P.range=f;const D=this.createFromPlane(v,{id:E,world:e==null?void 0:e.world});D.range=u;const I=this.createFromPlane(p,{id:S,world:e==null?void 0:e.world});I.range=u,t.push(A,P,D,I)}return t}open(e){const t=this.list.get(e);if(!t)throw new Error(`Views: the view with id ${e} doesn't exist.`);if(t.open)return;const{world:s}=t;if(!s)throw new Error(`Views: no world found for view with id ${e}.`);const{renderer:i}=s;if(!i)throw new Error(`Views: no renderer found for world with id ${s.uuid}.`);for(const[,n]of this.list)n.world===s&&this.close(n.id);i.setPlane(!0,t.plane),i.setPlane(!0,t.farPlane),t.camera.controls.addEventListener("rest",this._fragmentsUpdateEvent),s.camera=t.camera,t.open=!0}close(e){let t;if(e?t=this.list.get(e):t=[...this.list.values()].find(n=>n.open),e&&!t)throw new Error(`Views: the view with id ${e} doesn't exist.`);if(!t||!t.open)return;const{world:s}=t;if(!s)throw new Error(`Views: no world found for view with id ${e}.`);const{renderer:i}=s;if(!i)throw new Error(`Views: no renderer found for world with id ${s.uuid}.`);i.setPlane(!1,t.plane),i.setPlane(!1,t.farPlane),t.camera.controls.removeEventListener("rest",this._fragmentsUpdateEvent),s.useDefaultCamera(),t.open=!1}};x(Or,"uuid","fb22f1f5-6598-4664-a11d-de8963ae420f");x(Or,"defaultRange",15);let qd=Or;class Bs{constructor(e){x(this,"cardinality","required"),x(this,"instructions"),x(this,"evalRequirement",(t,s,i,n)=>{const r={parameter:i,currentValue:t,requiredValue:s,pass:!1};n&&this.addCheckResult(r,n);let o=!1;if(s.type==="simple"&&(o=t===s.parameter),s.type==="enumeration"&&(o=s.parameter.includes(t)),s.type==="pattern"&&(o=new RegExp(s.parameter).test(String(t))),s.type==="length"){const{min:l,length:h,max:c}=s.parameter;h!==void 0&&(o=String(t).length===h),l!==void 0&&(o=String(t).length>=l),c!==void 0&&(o=String(t).length<=c)}if(s.type==="bounds"&&typeof t=="number"){const{min:l,minInclusive:h,max:c,maxInclusive:u}=s.parameter;let f=!0,d=!0;l!==void 0&&(f=h?t>=l:t>l),c!==void 0&&(d=u?t<=c:t<c),o=f&&d}return this.cardinality==="prohibited"&&(o=!o),this.cardinality==="optional"&&(o=!0),r.pass=o,r.pass}),this._components=e}addCheckResult(e,t){const s=t.findIndex(({parameter:i})=>i===e.parameter);s!==-1?t[s]=e:t.push(e)}getItemChecks(e,t,s,i){if(!("value"in s._localId&&typeof s._localId.value=="number"))return null;let n=e.get(t);n||(n=new Me,e.set(t,n));let r=n.get(s._localId.value);if(r&&i&&!r.pass)return null;if(!r){const h=[];r={guid:Array.isArray(s._guid)?void 0:s._guid.value,pass:!1,checks:h},Object.defineProperty(r,"pass",{get:()=>h.every(({pass:c})=>c)}),n.set(s._localId.value,r)}const o=[],l={facetType:this.facetType,cardinality:this.cardinality,checks:o,pass:!1};return Object.defineProperty(l,"pass",{get:()=>o.every(({pass:h})=>h)}),r.checks.push(l),l.checks}}const Pt=(a,e)=>{let t="";if(!e)return t;if(e.type==="simple"&&(t=`<simpleValue>${e.parameter}</simpleValue>`),e.type==="enumeration"&&(t=`<xs:restriction base="xs:string">
    ${e.parameter.map(s=>`<xs:enumeration value="${s}" />`).join(`
`)}
    </xs:restriction>`),e.type==="pattern"&&(t=`<xs:restriction base="xs:string">
      <xs:pattern value="${e.parameter}" />
    </xs:restriction>`),e.type==="bounds"){const{min:s,minInclusive:i,max:n,maxInclusive:r}=e.parameter;let o="";s!==void 0&&(o=`<xs:min${i?"Inclusive":"Exclusive"} value="${s}">`);let l="";n!==void 0&&(l=`<xs:max${r?"Inclusive":"Exclusive"} value="${n}">`),t=`<xs:restriction base="xs:double">
      ${o}
      ${l}
    </xs:restriction>`}if(e.type==="length"){const{length:s,min:i,max:n}=e.parameter;let r="";s!==void 0&&i===void 0&&n===void 0&&(r=`<xs:length value="${s}" />`);let o="";i!==void 0&&s===void 0&&(o=`<xs:minLength value="${i}" />`);let l="";n!==void 0&&s===void 0&&(l=`<xs:maxLength value="${n}" />`),t=`<xs:restriction base="xs:string">
      ${r}
      ${o}
      ${l}
    </xs:restriction>`}return`<${a[0].toLowerCase()+a.slice(1)}>
    ${t}
  </${a[0].toLowerCase()+a.slice(1)}>`};class Gd extends Bs{constructor(e,t){super(e),x(this,"facetType","Attribute"),x(this,"name"),x(this,"value"),this.name=t}serialize(e){const t=Pt("Name",this.name),s=Pt("Value",this.value);let i="";return e==="requirement"&&(i+=`cardinality="${this.cardinality}"`,i+=this.instructions?`instructions="${this.instructions}"`:""),`<attribute ${i}>
  ${t}
  ${s}
</attribute>`}async getEntities(){}async test(e,t,s={skipIfFails:!0}){const i=this._components.get(le);for(const[n,r]of Object.entries(e)){const o=i.list.get(n);if(!o)continue;const l=await o.getItemsData([...r]);for(const h of l){const c=this.getItemChecks(t,n,h,s.skipIfFails);if(!c)continue;const u=Object.keys(h).filter(d=>{const g=this.evalRequirement(d,this.name,"Name");if(!g)return!1;const m=h[d];return Array.isArray(m)?!0:m===null||m.value===null?this.cardinality==="optional"||this.cardinality==="prohibited":Array.isArray(m.value)&&m.value.length===0||typeof m.value=="string"&&m.value.trim()===""?!1:g}),f=u.length>0;if(c.push({parameter:"Name",currentValue:f?u[0]:null,requiredValue:this.name,pass:this.cardinality==="prohibited"?!f:f}),this.value)if(u[0]){const d=h[u[0]];Array.isArray(d)?c.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"}):Array.isArray(d.value)?c.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"}):this.evalRequirement(d.value,this.value,"Value",c)}else c.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"})}}}}class Qd extends Bs{constructor(e,t){super(e),x(this,"facetType","Classification"),x(this,"system"),x(this,"value"),x(this,"uri"),this.system=t}serialize(e){const t=Pt("System",this.system),s=Pt("Value",this.value);let i="";return e==="requirement"&&(i+=`cardinality="${this.cardinality}"`,i+=this.uri?`uri=${this.uri}`:"",i+=this.instructions?`instructions="${this.instructions}"`:""),`<classification ${i}>
  ${t}
  ${s}
</classification>`}async getEntities(e,t){}async test(e,t){}}class dr extends Bs{constructor(e,t){super(e),x(this,"facetType","Entity"),x(this,"name"),x(this,"predefinedType"),this.name=t}serialize(e){const t=Pt("Name",this.name),s=Pt("Name",this.predefinedType);let i="";return e==="requirement"&&(i+=`cardinality="${this.cardinality}"`,i+=this.instructions?`instructions="${this.instructions}"`:""),`<entity ${i}>
  ${t}
  ${s}
</entity>`}async getEntities(e,t){const s=this._components.get(le),i=new Map;for(const[r,o]of s.list){if(!e.find(h=>h.test(r)))continue;const l=await o.getCategories();for(const h of l){if(!await this.evalName(h))continue;let c=i.get(r);c||(c=[],i.set(r,c)),c.push(h)}}const n={};if(await Promise.all(Array.from(i.entries()).map(async([r,o])=>{const l=s.list.get(r);if(!l)return;const h=o.map(f=>new RegExp(`^${f}$`)),c=await l.getItemsOfCategories(h),u=Object.values(c).flat();n[r]=new Set(u)})),!this.predefinedType){ge.add(t,n);return}for(const[r,o]of Object.entries(n)){const l=s.list.get(r);if(!l)continue;const h=await l.getItemsData([...o]);for(const c of h)"value"in c._localId&&await this.evalPredefinedType(r,c)&&ge.append(t,r,c._localId.value)}}async test(e,t,s){const i=this._components.get(le);for(const[n,r]of Object.entries(e)){const o=i.list.get(n);if(!o)continue;const l=await o.getItemsData([...r]);for(const h of l){if(!("value"in h._category))continue;const c=this.getItemChecks(t,n,h,s.skipIfFails);c&&(await this.evalName(h._category.value,c),await this.evalPredefinedType(n,h,c))}}}async evalName(e,t){return this.evalRequirement(e,this.name,"Name",t)}async evalPredefinedType(e,t,s){if(!this.predefinedType||!("value"in t.PredefinedType))return null;const i=typeof this.predefinedType.parameter=="string"&&this.predefinedType.parameter==="USERDEFINED";let n=t.PredefinedType.value;if(n==="USERDEFINED"&&!i){const r=Object.keys(t).find(o=>/^((?!Predefined).)*Type$/.test(o));if(r){const o=t[r];"value"in o&&(n=o.value)}else n="USERDEFINED"}if(!n){const r=this._components.get(le).list.get(e);if(r&&"value"in t._localId){const[o]=await r.getItemsData([t._localId.value],{relations:{IsTypedBy:{attributes:!0,relations:!1}}});if(Array.isArray(o.IsTypedBy)){const l=o.IsTypedBy[0];if(l&&"value"in l.PredefinedType&&(n=l.PredefinedType.value,n==="USERDEFINED"&&!i)){const h=Object.keys(l).find(c=>/^((?!Predefined).)*Type$/.test(c));if(h){const c=l[h];"value"in c&&(n=c.value)}else n="USERDEFINED"}}}}return this.evalRequirement(n,this.predefinedType,"PredefinedType",s)}}class Kd extends Bs{constructor(e,t,s){super(e),x(this,"facetType","Property"),x(this,"propertySet"),x(this,"baseName"),x(this,"value"),x(this,"dataType"),x(this,"uri"),x(this,"_unsupportedTypes",["IFCCOMPLEXPROPERTY","IFCPHYSICALCOMPLEXQUANTITY"]),this.propertySet=t,this.baseName=s}serialize(e){const t=Pt("PropertySet",this.propertySet),s=Pt("BaseName",this.baseName),i=Pt("Value",this.value),n=this.dataType?`dataType=${this.dataType}`:"";let r="";return e==="requirement"&&(r+=`cardinality="${this.cardinality}"`,r+=this.uri?`uri=${this.uri}`:"",r+=this.instructions?`instructions="${this.instructions}"`:""),`<property ${n} ${r}>
  ${t}
  ${s}
  ${i}
</property>`}async getEntities(e,t){const s=this._components.get(le);for(const[i,n]of s.list){if(!e.find(h=>h.test(i)))continue;const r=await n.getItemsOfCategories([/PROPERTYSET/,/ELEMENTQUANTITY/]),o=Object.values(r).flat();if(o.length===0)continue;const l=await n.getItemsData(o,{relations:{HasProperties:{attributes:!0,relations:!1},DefinesOcurrence:{attributes:!0,relations:!1}}});for(const h of l){if(!("value"in h._localId&&"value"in h._category&&"value"in h.Name&&Array.isArray(h.DefinesOcurrence))||!this.evalRequirement(h.Name.value,this.propertySet,"PropertySet"))continue;let c;if(h._category.value==="IFCPROPERTYSET"&&(c="HasProperties"),h._category.value==="IFCELEMENTQUANTITY"&&(c="Quantities"),!c)continue;const u=h[c];if(Array.isArray(u))for(const f of u){const d=Object.keys(f),g=d.find(p=>/Name/.test(p));if(!(g&&"value"in f[g]))continue;const m=f[g];if(!("value"in m)||!this.evalRequirement(m.value,this.baseName,"BaseName"))continue;if(this.value){const p=d.find(b=>/Value/.test(b));if(!p)continue;const _=f[p];if(!("value"in _)||!this.evalRequirement(_.value,this.value,"Value"))continue}const v=h.DefinesOcurrence.map(p=>"value"in p._localId&&typeof p._localId.value=="number"?p._localId.value:null).filter(p=>p!==null);ge.append(t,i,...v)}}}}async test(e,t,s={skipIfFails:!0}){const i=this._components.get(le);for(const[n,r]of Object.entries(e)){const o=i.list.get(n);if(!o)continue;const l=await o.getItemsData([...r],{relations:{IsDefinedBy:{attributes:!0,relations:!0},IsTypedBy:{attributes:!0,relations:!1},HasPropertySets:{attributes:!0,relations:!0},DefinesOcurrence:{attributes:!1,relations:!1}}});for(const h of l){const c=this.getItemChecks(t,n,h,s.skipIfFails);if(!c)continue;const u=(await this.getPsets(h)).filter(f=>!("value"in f.Name)||!this.evalRequirement(f.Name.value,this.propertySet,"PropertySet")?!1:(c.push({currentValue:f.Name.value,parameter:"PropertySet",pass:!0,requiredValue:this.propertySet}),!0));if(u.length===0){c.push({currentValue:null,parameter:"PropertySet",pass:!1,requiredValue:this.propertySet});continue}for(const f of u){const d=this.getPropertyListName(f);if(!d)continue;const g=f[d];if(!Array.isArray(g)){c.push({currentValue:null,parameter:"BaseName",pass:!1,requiredValue:this.baseName});continue}const m=g.filter(v=>!("value"in v._category&&"value"in v.Name)||this._unsupportedTypes.includes(v._category.value)||!this.evalRequirement(v.Name.value,this.baseName,"BaseName")?!1:(c.push({currentValue:v.Name.value,parameter:"BaseName",pass:!0,requiredValue:this.baseName}),!0));if(m.length===0){c.push({currentValue:null,parameter:"BaseName",pass:!1,requiredValue:this.baseName});continue}for(const v of m)this.evalValue(v,c),this.evalDataType(v,c),this.evalURI()}}}}getPropertyListName(e){let t;return"value"in e._category&&(e._category.value==="IFCPROPERTYSET"&&(t="HasProperties"),e._category.value==="IFCELEMENTQUANTITY"&&(t="Quantities")),t}getValueKey(e){return Object.keys(e).find(t=>/Value/.test(t)||/Values/.test(t))}getTypePsets(e){if(!Array.isArray(e.IsTypedBy))return[];const[t]=e.IsTypedBy;return t&&Array.isArray(t.HasPropertySets)?t.HasPropertySets:[]}async getPsets(e){const t=this.getTypePsets(e);if(!Array.isArray(e.IsDefinedBy))return t;const s=[];for(const i of e.IsDefinedBy){if(!("value"in i.Name))continue;const n=i.Name.value,r=this.getPropertyListName(i);if(!(n&&r))continue;const o=t.find(l=>"value"in l.Name?l.Name.value===n:!1);if(o&&Array.isArray(o.HasProperties)&&Array.isArray(i.HasProperties))for(const l of o.HasProperties){if(!("value"in l.Name))continue;const h=l.Name.value;i.HasProperties.find(c=>"value"in c.Name?c.Name.value===h:!1)||i.HasProperties.push(l)}s.push(i)}return s}evalValue(e,t){const s=this.getValueKey(e),i=e[s];if(!("value"in i))return!1;if(this.value){if(!s)return t==null||t.push({parameter:"Value",currentValue:null,pass:!1,requiredValue:this.value}),!1;const n=structuredClone(this.value);return i.type==="IFCLABEL"&&n.type==="simple"&&(n.parameter=String(n.parameter)),this.evalRequirement(i.value,n,"Value",t)}return s&&typeof i.value=="string"&&i.value.trim()===""?(t==null||t.push({parameter:"Value",currentValue:"",pass:!1,requiredValue:this.value}),!1):!0}evalDataType(e,t){if(!this.dataType)return!0;const s=this.getValueKey(e);if(!(s&&"value"in e[s]))return t==null||t.push({parameter:"DataType",currentValue:null,pass:!1,requiredValue:this.dataType}),!1;const i=e[s];return this.evalRequirement(i.type??null,{type:"simple",parameter:this.dataType},"DataType",t)}evalURI(){return!0}}class Jd extends Bs{constructor(){super(...arguments),x(this,"_ifcMaterialEntities",[/^IFCMATERIALLAYERSETUSAGE$/,/^IFCMATERIALCONSTITUENTSET$/,/^IFCMATERIAL$/,/^IFCMATERIALLIST$/]),x(this,"facetType","Material"),x(this,"value"),x(this,"uri")}serialize(e){if(!(this.value&&this.uri))return"<material />";const t=Pt("Value",this.value);let s="";return e==="requirement"&&(s+=`cardinality="${this.cardinality}"`,s+=this.uri?`uri=${this.uri}`:"",s+=this.instructions?`instructions="${this.instructions}"`:""),`<material ${s}>
  ${t}
</material>`}async getEntities(e,t){const s=this._components.get(le);for(const[i,n]of s.list){if(!e.find(h=>h.test(i)))continue;const r=await n.getItemsOfCategories(this._ifcMaterialEntities),o=Object.values(r).flat();if(o.length===0)continue;const l=await n.getItemsData(o,{relations:{AssociatedTo:{attributes:!0,relations:!1},MaterialConstituents:{attributes:!0,relations:!0},ForLayerSet:{attributes:!0,relations:!0},MaterialLayers:{attributes:!0,relations:!0},Materials:{attributes:!0,relations:!1}}});for(const h of l){if(!("value"in h._localId&&"value"in h._category&&Array.isArray(h.AssociatedTo))||!this.hasValidMaterial(h))continue;const c=h.AssociatedTo.map(u=>"value"in u._localId&&u._localId.value?u._localId.value:null).filter(u=>u!==null);ge.append(t,i,...c)}}}async test(e,t,s={skipIfFails:!0}){const i=this._components.get(le);for(const[n,r]of Object.entries(e)){const o=i.list.get(n);if(!o)continue;const l=await o.getItemsData([[...r][0]],{relations:{AssociatedTo:{attributes:!1,relations:!1},HasAssociations:{attributes:!0,relations:!0},MaterialConstituents:{attributes:!0,relations:!0},ForLayerSet:{attributes:!0,relations:!0},MaterialLayers:{attributes:!0,relations:!0},Materials:{attributes:!0,relations:!1}}});for(const h of l){const c=this.getItemChecks(t,n,h,s.skipIfFails);if(c){if(!Array.isArray(h.HasAssociations)){c.push({parameter:null,currentValue:null,requiredValue:this.value,pass:!1});continue}for(const u of h.HasAssociations)if(this._ifcMaterialEntities.some(f=>"value"in u._category?f.test(u._category.value):!1)&&this.hasValidMaterial(u,c))break}}}}hasValidMaterial(e,t){let s=!1;if("value"in e._category&&e._category.value==="IFCMATERIAL")this.evalValue(e,t)&&(s=!0);else for(const[i,n]of Object.entries(e))if(["ForLayerSet","MaterialLayers","Material","MaterialConstituents","Materials"].includes(i)&&Array.isArray(n)){for(const r of n)if("value"in r._category&&r._category.value==="IFCMATERIAL"){if(this.evalValue(r,t)){s=!0;break}}else if(this.hasValidMaterial(r)){s=!0;break}}return s}evalValue(e,t){if(!this.value)return t==null||t.push({parameter:null,currentValue:e.Name&&"value"in e.Name?e.Name.value:null,pass:!0}),!0;if(!("value"in e._category&&e._category.value==="IFCMATERIAL"))return null;let s=!1;return e.Name&&"value"in e.Name&&(s=this.evalRequirement(e.Name.value,this.value,"Value",t)),s||(e.Category&&"value"in e.Category&&(s=this.evalRequirement(e.Category.value,this.value,"Value",t)),s)}}class $d extends Bs{constructor(e,t){super(e),x(this,"facetType","PartOf"),x(this,"_entityFacet"),x(this,"_entity"),x(this,"relation"),x(this,"cardinality","required"),this._entity=t,this._entityFacet=new dr(e,t.name),this._entityFacet.predefinedType=t.predefinedType}set entity(e){this._entity=e;const{name:t,predefinedType:s}=e;this._entityFacet=new dr(this._components,t),this._entityFacet.predefinedType=s}get entity(){return this._entity}serialize(){return""}async getEntities(e,t){}async test(e){}}class eu{constructor(e,t,s){x(this,"name"),x(this,"ifcVersion",new Set),x(this,"identifier",Ze.create()),x(this,"description"),x(this,"instructions"),x(this,"requirementsDescription"),x(this,"applicability",new Ve),x(this,"requirements",new Ve),x(this,"components"),this.components=e,this.name=t;for(const i of s)this.ifcVersion.add(i)}set(e){const t=e,s=this;for(const i in e){if(i==="identifier")continue;const n=t[i];i in this&&(s[i]=n)}return this.components.get(tu).list.set(this.identifier,this),this}async test(e,t={skipIfFails:!0}){const s=new Me;if(this.requirements.size===0)return s;const i={},n=[];for(const o of this.applicability)n.push(o.getEntities(e,i));await Promise.all(n);const r=[];for(const o of this.requirements)r.push(o.test(i,s,t));return await Promise.all(r),s}serialize(){const e=`name="${this.name}"`,t=this.identifier?`identifier="${this.identifier}"`:"",s=this.description?`description="${this.description}"`:"",i=this.instructions?`instructions="${this.instructions}"`:"";return`<specification ifcVersion="${[...this.ifcVersion].join(" ")}" ${e} ${t} ${s} ${i}>
      <applicability minOccurs="1" maxOccurs="unbounded">
        ${[...this.applicability].map(n=>n.serialize("applicability")).join(`
`)}
      </applicability>
      <requirements>
        ${[...this.requirements].map(n=>n.serialize("requirement")).join(`
`)}
      </requirements>
    </specification>`}}const ft=a=>{if(!a)return;const e={};if("simpleValue"in a&&(e.type="simple",e.parameter=a.simpleValue),"restriction"in a){const t=a.restriction,s=Object.keys(t);if("pattern"in t&&(e.type="pattern",e.parameter=t.pattern.value),"enumeration"in t){e.type="enumeration";const i=t.enumeration.map(({value:n})=>n);e.parameter=i}if(s.some(i=>["minInclusive","minExclusive","maxInclusive","maxExclusive"].includes(i))){e.type="bounds";const i={},n=s.find(o=>o.includes("min")),r=s.find(o=>o.includes("max"));n&&(i.minInclusive=n==="minInclusive",i.min=t[n].value),r&&(i.maxInclusive=r==="maxInclusive",i.max=t[r].value),e.parameter=i}if(s.some(i=>["minLength","length","maxLength"].includes(i))){e.type="length";const i={};t.length!==void 0&&(i.length=t.length.value),t.minLength!==void 0&&(i.min=t.minLength.value),t.maxLength!==void 0&&(i.max=t.maxLength.value),e.parameter=i}}if(e.parameter!==void 0)return e},Po=(a,e)=>{const t=[];for(const s of e){const i=s.name,n=ft(i);if(!n)continue;const r=new dr(a,n);s.cardinality&&(r.cardinality=s.cardinality),r.predefinedType=ft(s.predefinedType),r.instructions=s.instructions,t.push(r)}return t},Oo=(a,e)=>{const t=[];for(const s of e){const i=s.name,n=ft(i);if(!n)continue;const r=new Gd(a,n);s.cardinality&&(r.cardinality=s.cardinality),r.value=ft(s.value),r.instructions=s.instructions,t.push(r)}return t},Do=(a,e)=>{const t=[];for(const s of e){const i=new Jd(a);s.cardinality&&(i.cardinality=s.cardinality);const n=ft(s.value);(n==null?void 0:n.type)==="enumeration"&&Array.isArray(n.parameter)&&(n.parameter=n.parameter.map(String)),i.value=n,i.uri=s.uri,i.instructions=s.instructions,t.push(i)}return t},Mo=(a,e)=>{const t=[];for(const s of e){const i=s.propertySet,n=s.baseName,r=ft(i),o=ft(n);if(!(o&&r))continue;const l=new Kd(a,r,o);s.cardinality&&(l.cardinality=s.cardinality);const h=ft(s.value);l.value=h,l.dataType=s.dataType,l.uri=s.uri,l.instructions=s.instructions,t.push(l)}return t},zo=(a,e)=>{const t=[];for(const s of e){const i=s.system,n=ft(i);if(!n)continue;const r=new Qd(a,n);s.cardinality&&(r.cardinality=s.cardinality);const o=ft(s.value);(o==null?void 0:o.type)==="simple"&&(o.parameter=String(o.parameter)),(o==null?void 0:o.type)==="enumeration"&&Array.isArray(o.parameter)&&(o.parameter=o.parameter.map(String)),r.value=o,r.uri=s.uri,r.instructions=s.instructions,t.push(r)}return t},Io=(a,e)=>{const t=[];for(const s of e){const i=ft(s.entity.name);if(!i)continue;const n=ft(s.entity.predefinedType),r=new $d(a,{name:i,predefinedType:n});r.relation=s.relation,s.cardinality&&(r.cardinality=s.cardinality),r.instructions=s.instructions,t.push(r)}return t},Dr=class ur extends Ee{constructor(e){super(e),x(this,"enabled",!0),x(this,"list",new ks),e.add(ur.uuid,this)}getModelIdMap(e){const t={},s={};for(const[i,n]of e){const r=[...n].filter(([,l])=>l.pass).map(([l])=>l);ge.append(t,i,...r);const o=[...n].filter(([,l])=>!l.pass).map(([l])=>l);ge.append(s,i,...o)}return{pass:t,fail:s}}create(e,t,s){const i=new eu(this.components,e,t);return s&&(i.identifier=s),this.list.set(i.identifier,i),i}load(e){const t=[],s=ur.xmlParser.parse(e).ids,{specifications:i}=s;if(i&&i.specification){const n=Array.isArray(i.specification)?i.specification:[i.specification];for(const r of n){const{name:o,ifcVersion:l,description:h,instructions:c,identifier:u}=r;if(!(o&&l))continue;const f=[],d=[],{applicability:g,requirements:m}=r;if(g){const{maxOccurs:_,...b}=g,E=Array.isArray(b)?b:[b];for(const S of E)for(const A in S){const P=Array.isArray(S[A])?S[A]:[S[A]];if(A==="entity"){const D=Po(this.components,P);f.push(...D)}if(A==="attribute"){const D=Oo(this.components,P);f.push(...D)}if(A==="material"){const D=Do(this.components,P);f.push(...D)}if(A==="classification"){const D=zo(this.components,P);f.push(...D)}if(A==="property"){const D=Mo(this.components,P);f.push(...D)}if(A==="partOf"){const D=Io(this.components,P);f.push(...D)}}}let v;if(m){const{maxOccurs:_,...b}=m;v=m.description;const E=Array.isArray(b)?b:[b];for(const S of E)for(const A in S){const P=Array.isArray(S[A])?S[A]:[S[A]];if(A==="entity"){const D=Po(this.components,P);d.push(...D)}if(A==="attribute"){const D=Oo(this.components,P);d.push(...D)}if(A==="material"){const D=Do(this.components,P);d.push(...D)}if(A==="classification"){const D=zo(this.components,P);d.push(...D)}if(A==="property"){const D=Mo(this.components,P);d.push(...D)}if(A==="partOf"){const D=Io(this.components,P);d.push(...D)}}}const p=this.create(o,l.split(/\s+/),u);p.description=h,p.instructions=c,p.requirementsDescription=v,p.applicability.add(...f),p.requirements.add(...d),t.push(p)}}return t}export(e,t=this.list.values()){const s=t??this.list;return`<ids xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://standards.buildingsmart.org/IDS http://standards.buildingsmart.org/IDS/1.0/ids.xsd" xmlns:ids="http://standards.buildingsmart.org/IDS">
  <!-- Made with That Open Engine ${Ma.release} (https://github.com/thatopen/engine_components) -->
  <info>
    <title>${e.title}</title>
    ${e.copyright?`<copyright>${e.copyright}</copyright>`:""}
    ${e.version?`<version>${e.version}</version>`:""}
    ${e.description?`<description>${e.description}</description>`:""}
    ${e.author?`<author>${e.author}</author>`:""}
    ${e.date?`<date>${e.date.toISOString().split("T")[0]}</date>`:""}
    ${e.purpose?`<purpose>${e.purpose}</purpose>`:""}
    ${e.milestone?`<milestone>${e.milestone}</milestone>`:""}
  </info>
  <specifications>
    ${[...s].map(i=>i.serialize()).join(`
`)}
  </specifications>
</ids>`}};x(Dr,"uuid","9f0b9f78-9b2e-481a-b766-2fbfd01f342c");x(Dr,"xmlParser",new fn.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let tu=Dr;const Ra=class Fa extends Ee{constructor(e){super(e),x(this,"enabled",!0),e.add(Fa.uuid,this)}static distanceFromPointToLine(e,t,s,i=!1){const n=new pt,r=new N;return n.set(t,s),n.closestPointToPoint(e,i,r),r.distanceTo(e)}round(e){e.x=Math.trunc(e.x*1e3)/1e3,e.y=Math.trunc(e.y*1e3)/1e3,e.z=Math.trunc(e.z*1e3)/1e3}async getVolumeFromFragments(e){return console.warn("getVolumeFromFragments is deprecated. Use getItemsVolume instead."),this.getItemsVolume(e)}async getItemsVolume(e){let t=0;const s=this.components.get(le);for(const[i,n]of Object.entries(e)){const r=s.list.get(i);r&&(t+=await r.getItemsVolume([...n]))}return t}static convertUnits(e,t,s,i=2){const n={m:1,cm:.01,mm:.001,km:1e3,m2:1,cm2:1e-4,mm2:1e-6,km2:1e6,m3:1,cm3:1e-6,mm3:1e-9,km3:1e9};if(!n[t]||!n[s])throw new Error("Invalid units provided for conversion.");if(!Number.isInteger(i)||i<0||i>5)throw new Error("Precision must be an integer between 0 and 5.");let r=n[t]/n[s];t.endsWith("2")&&s.endsWith("2")?r**=2:t.endsWith("3")&&s.endsWith("3")&&(r**=3);const o=e*r,l=10**i;return Math.round(o*l)/l}};x(Ra,"uuid","267ca032-672f-4cb0-afa9-d24e904f39d6");let Ls=Ra;const su=class Va extends Ee{constructor(e){super(e),T(this,"enabled",!0),T(this,"inputs",["OBC","BUI"]),T(this,"_requestEventID","thatOpenCompanyComponentRequested"),T(this,"_createEventID","thatOpenCompanyComponentCreated"),e.add(Va.uuid,this)}async import(e){return new Promise(t=>{const s=document.createElement("script"),i=`
        function main() {
          const { ${this.inputs} } = window.ThatOpenCompany;
        
          ${e}
        
          const onComponentRequested = () => {
            window.removeEventListener("${this._requestEventID}", onComponentRequested);
            const event = new CustomEvent("${this._createEventID}", { detail: main });
            window.dispatchEvent(event);
          };
          
          window.addEventListener("${this._requestEventID}", onComponentRequested);
        }
        
        main();
      `,n=r=>{window.removeEventListener(this._createEventID,n);const o=r.detail,l=this.components.get(o);s.remove(),t(l)};s.addEventListener("load",()=>{window.addEventListener(this._createEventID,n),window.dispatchEvent(new Event(this._requestEventID))}),s.src=URL.createObjectURL(new File([i],"temp.js")),document.head.appendChild(s)})}};T(su,"uuid","74c0c370-1af8-4ca9-900a-4a4196c0f2f5");class ja extends hi{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new ze(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof t.element.ownerDocument.defaultView.Element&&t.element.parentNode!==null&&t.element.remove()})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const Ps=new N,ko=new Te,Lo=new Te,No=new N,Uo=new N;class iu{constructor(e={}){const t=this;let s,i,n,r;const o={objects:new WeakMap},l=e.element!==void 0?e.element:document.createElement("div");l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:s,height:i}},this.render=function(g,m){g.matrixWorldAutoUpdate===!0&&g.updateMatrixWorld(),m.parent===null&&m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),ko.copy(m.matrixWorldInverse),Lo.multiplyMatrices(m.projectionMatrix,ko),c(g,g,m),d(g)},this.setSize=function(g,m){s=g,i=m,n=s/2,r=i/2,l.style.width=g+"px",l.style.height=m+"px"};function h(g){g.isCSS2DObject&&(g.element.style.display="none");for(let m=0,v=g.children.length;m<v;m++)h(g.children[m])}function c(g,m,v){if(g.visible===!1){h(g);return}if(g.isCSS2DObject){Ps.setFromMatrixPosition(g.matrixWorld),Ps.applyMatrix4(Lo);const p=Ps.z>=-1&&Ps.z<=1&&g.layers.test(v.layers)===!0,_=g.element;_.style.display=p===!0?"":"none",p===!0&&(g.onBeforeRender(t,m,v),_.style.transform="translate("+-100*g.center.x+"%,"+-100*g.center.y+"%)translate("+(Ps.x*n+n)+"px,"+(-Ps.y*r+r)+"px)",_.parentNode!==l&&l.appendChild(_),g.onAfterRender(t,m,v));const b={distanceToCameraSquared:u(v,g)};o.objects.set(g,b)}for(let p=0,_=g.children.length;p<_;p++)c(g.children[p],m,v)}function u(g,m){return No.setFromMatrixPosition(g.matrixWorld),Uo.setFromMatrixPosition(m.matrixWorld),No.distanceToSquared(Uo)}function f(g){const m=[];return g.traverseVisible(function(v){v.isCSS2DObject&&m.push(v)}),m}function d(g){const m=f(g).sort(function(p,_){if(p.renderOrder!==_.renderOrder)return _.renderOrder-p.renderOrder;const b=o.objects.get(p).distanceToCameraSquared,E=o.objects.get(_).distanceToCameraSquared;return b-E}),v=m.length;for(let p=0,_=m.length;p<_;p++)m[p].element.style.zIndex=v-p}}}class ls{constructor(e,t,s){T(this,"three"),T(this,"world"),T(this,"onDisposed",new Q),this.world=e;let i;if(t)i=t;else{i=document.createElement("div");const n="6px";i.style.color="white",i.style.height=n,i.style.width=n,i.style.borderRadius="50%",i.style.border="2px solid rgb(122, 75, 209)",i.style.zIndex="-20"}this.three=new ja(i),(s||e.scene.three).add(this.three),this.visible=!0}set visible(e){this.three.visible=e}get visible(){return this.three.visible}toggleVisibility(){this.visible=!this.visible}notDisplay(){this.visible=!1}dispose(){this.three.removeFromParent(),this.three.element.remove(),this.onDisposed.trigger(),this.onDisposed.reset()}}class nu extends _c{constructor(e,t,s){super(e,t,s),T(this,"three2D",new iu),this.onAfterUpdate.add(()=>{if(this.onBeforeUpdate.trigger(this),!this.enabled||!this.currentWorld)return;const i=this.currentWorld.scene.three,n=this.currentWorld.camera.three;i instanceof _r&&this.three2D.render(i,n)}),this.onDisposed.add(()=>{this.three2D.domElement.remove()}),this.onResize.add(({x:i,y:n})=>{this.three2D.setSize(i,n)}),this.setupHtmlRenderer(),this.resize()}setupHtmlRenderer(){this.three2D.domElement.style.position="absolute",this.three2D.domElement.style.top="0px",this.three2D.domElement.style.pointerEvents="none",this.container&&(this.container.appendChild(this.three2D.domElement),this.container.style.position="relative")}}const ru=class Ha extends Ee{constructor(e){super(e),T(this,"onDisposed",new Q),T(this,"enabled",!0),T(this,"threshold",50),T(this,"autoCluster",!0),T(this,"list",new Map),T(this,"clusterLabels",new Set),T(this,"currentKeys",new Set),T(this,"_color","white"),T(this,"_markerKey",0),T(this,"_clusterKey",0),T(this,"_worldEvents",new Map),T(this,"_setupWorlds",new Set),T(this,"clusterElementFactory",()=>{const t=document.createElement("div");return t.style.color="#000000",t.style.background="#FFFFFF",t.style.fontSize="1.2rem",t.style.fontWeight="500",t.style.borderRadius="50%",t.style.padding="5px 11px",t.style.textAlign="center",t.addEventListener("pointerover",()=>{t.style.background="#BCF124"}),t.addEventListener("pointerout",()=>{t.style.background="#FFFFFF"}),t}),e.add(Ha.uuid,this)}get color(){return this._color}set color(e){this._color=e;for(const[t,s]of this.list)for(const[i,n]of s)n.label.three.element.style.color=e}create(e,t,s,i=!1){this.setupEvents(e,!0);const n=this._markerKey.toString(),r=this.getWorldMarkerList(e);if(r.has(n))return null;const o=document.createElement("span");o.append(t);const l=new ls(e,o);return l.three.position.copy(s),r.set(n,{key:n,label:l,merged:!1,static:i}),this._markerKey++,n}delete(e){for(const[t,s]of this.list){const i=s.get(e);i&&i.label.dispose(),s.delete(e)}}getWorldMarkerList(e){return this.list.has(e.uuid)||this.list.set(e.uuid,new Map),this.list.get(e.uuid)}dispose(e){for(const[t,s]of this.list){const i=[...s.keys()];for(const n of i){const r=s.get(n);e&&r.type!==e||(r.label.dispose(),s.delete(n))}}if(!e){this.list.clear(),this._markerKey=0;for(const t of this.clusterLabels)t.label.dispose();this.clusterLabels.clear(),this._clusterKey=0,this.currentKeys.clear()}this.onDisposed.trigger()}setupEvents(e,t){if(t&&this._setupWorlds.has(e.uuid)||!e.camera.hasCameraControls())return;const s=this.getWorldEvent(e);e.camera.controls.removeEventListener("sleep",s),e.camera.controls.removeEventListener("rest",s),t&&(e.camera.controls.addEventListener("sleep",s),e.camera.controls.addEventListener("rest",s))}cluster(e){if(!this.autoCluster)return;this.resetMarkers();const t=this.list.get(e.uuid);if(t){for(const[s,i]of t)if(!i.merged&&!i.static){this.currentKeys.clear();for(const[n,r]of t)r.static||i.key!==r.key&&!r.merged&&this.distance(i.label,r.label)<this.threshold&&(this.currentKeys.add(r.key),r.merged=!0);if(this.currentKeys.size>0){this.currentKeys.add(i.key),i.merged=!0;const n=Array.from(this.currentKeys),r=this.getAveragePositionFromLabels(n),o=new ls(i.label.world,this.createClusterElement(this._clusterKey.toString())),{element:l}=o.three;l.firstChild.textContent=n.length.toString(),o.three.position.copy(r),this.clusterLabels.add({key:this._clusterKey.toString(),markerKeys:n,label:o}),this._clusterKey++}}this.removeMergeMarkers(e)}}getWorldEvent(e){if(!this._worldEvents.has(e.uuid)){const t=()=>{this.cluster(e)};this._worldEvents.set(e.uuid,t)}return this._worldEvents.get(e.uuid)}resetMarkers(){for(const[e,t]of this.list)for(const[s,i]of t)i.merged=!1;for(const e of this.clusterLabels)e.label.dispose();this.clusterLabels.clear(),this._clusterKey=0}removeMergeMarkers(e){const t=this.list.get(e.uuid);if(t){for(const[s,i]of t)i.merged?i.label.dispose():i.label.world.scene.three.add(i.label.three);for(const s of this.clusterLabels)if(s.markerKeys.length===1){for(const[i,n]of this.list){const r=n.get(s.markerKeys[0]);r&&(r.label.world.scene.three.add(r.label.three),r.merged=!1)}s.label.dispose(),this.clusterLabels.delete(s)}}}getAveragePositionFromLabels(e){const t=e.map(s=>{for(const[i,n]of this.list){const r=n.get(s);if(r)return r.label.three.position}return new N});return t.reduce((s,i)=>s.add(i),new N).divideScalar(t.length)}createClusterElement(e){const t=this.clusterElementFactory();t.textContent=e;const s=document.createElement("span");return s.append(t),s.style.pointerEvents="auto",s.style.cursor="pointer",s.addEventListener("pointerdown",()=>{this.navigateToCluster(e)}),s}getScreenPosition(e){const t=new N;if(!e.world.renderer)throw new Error("Renderer not found!");const s=e.three.position.clone();s.project(e.world.camera.three);const i=e.world.renderer.getSize();return t.x=s.x*i.x/2+i.x/2,t.y=-(s.y*i.y/2)+i.y/2,t}distance(e,t){const s=this.getScreenPosition(e),i=this.getScreenPosition(t),n=s.x-i.x,r=s.y-i.y,o=Math.sqrt(n*n+r*r)*.5;return o===0?this.threshold+1:o}navigateToCluster(e){const t=[],s=Array.from(this.clusterLabels).find(h=>h.key===e);if(!s)return;const i=s.label.world.camera;if(!i.hasCameraControls()){console.warn("Zoom to clusters only supported with Camera Controls!");return}for(const h of s.markerKeys)for(const[c,u]of this.list){const f=u.get(h);if(f){const{x:d,y:g,z:m}=f.label.three.position;t.push(d,g,m)}}s.label.dispose(),this.clusterLabels.delete(s);const n=new st,r=new Float32Array(t),o=new Lt(r,3);n.setAttribute("position",o);const l=new ie(n);l.geometry.computeBoundingSphere(),l.geometry.boundingSphere&&i.controls.fitToSphere(l,!0),n.dispose(),l.clear(),t.length=0}};T(ru,"uuid","4079eb91-79b0-4ede-bcf2-15b837129236");const nn={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Dt{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const ou=new un(-1,1,1,-1,0,1);class au extends st{constructor(){super(),this.setAttribute("position",new qt([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new qt([0,2,0,0,2,0],2))}}const lu=new au;class Qt{constructor(e){this._mesh=new ie(lu,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,ou)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class hu extends Dt{constructor(e,t="tDiffuse"){super(),this.textureID=t,this.uniforms=null,this.material=null,e instanceof Xe?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=lt.clone(e.uniforms),this.material=new Xe({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this._fsQuad=new Qt(this.material)}render(e,t,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=s.texture),this._fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class Bo extends Dt{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,s){const i=e.getContext(),n=e.state;n.buffers.color.setMask(!1),n.buffers.depth.setMask(!1),n.buffers.color.setLocked(!0),n.buffers.depth.setLocked(!0);let r,o;this.inverse?(r=0,o=1):(r=1,o=0),n.buffers.stencil.setTest(!0),n.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),n.buffers.stencil.setFunc(i.ALWAYS,r,4294967295),n.buffers.stencil.setClear(o),n.buffers.stencil.setLocked(!0),e.setRenderTarget(s),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),n.buffers.color.setLocked(!1),n.buffers.depth.setLocked(!1),n.buffers.color.setMask(!0),n.buffers.depth.setMask(!0),n.buffers.stencil.setLocked(!1),n.buffers.stencil.setFunc(i.EQUAL,1,4294967295),n.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),n.buffers.stencil.setLocked(!0)}}class cu extends Dt{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class du{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const s=e.getSize(new ze);this._width=s.width,this._height=s.height,t=new Ut(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:ci}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new hu(nn),this.copyPass.material.blending=Mt,this.clock=new Wo}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let s=!1;for(let i=0,n=this.passes.length;i<n;i++){const r=this.passes[i];if(r.enabled!==!1){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),r.render(this.renderer,this.writeBuffer,this.readBuffer,e,s),r.needsSwap){if(s){const o=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}Bo!==void 0&&(r instanceof Bo?s=!0:r instanceof cu&&(s=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new ze);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const s=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(s,i),this.renderTarget2.setSize(s,i);for(let n=0;n<this.passes.length;n++)this.passes[n].setSize(s,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}const Hi={defines:{PERSPECTIVE_CAMERA:1,SAMPLES:16,NORMAL_VECTOR_TYPE:1,DEPTH_SWIZZLING:"x",SCREEN_SPACE_RADIUS:0,SCREEN_SPACE_RADIUS_SCALE:100,SCENE_CLIP_BOX:0},uniforms:{tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},resolution:{value:new ze},cameraNear:{value:null},cameraFar:{value:null},cameraProjectionMatrix:{value:new Te},cameraProjectionMatrixInverse:{value:new Te},cameraWorldMatrix:{value:new Te},radius:{value:.25},distanceExponent:{value:1},thickness:{value:1},distanceFallOff:{value:1},scale:{value:1},sceneBoxMin:{value:new N(-1,-1,-1)},sceneBoxMax:{value:new N(1,1,1)}},vertexShader:`

		varying vec2 vUv;

		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`
		varying vec2 vUv;
		uniform highp sampler2D tNormal;
		uniform highp sampler2D tDepth;
		uniform sampler2D tNoise;
		uniform vec2 resolution;
		uniform float cameraNear;
		uniform float cameraFar;
		uniform mat4 cameraProjectionMatrix;
		uniform mat4 cameraProjectionMatrixInverse;
		uniform mat4 cameraWorldMatrix;
		uniform float radius;
		uniform float distanceExponent;
		uniform float thickness;
		uniform float distanceFallOff;
		uniform float scale;
		#if SCENE_CLIP_BOX == 1
			uniform vec3 sceneBoxMin;
			uniform vec3 sceneBoxMax;
		#endif

		#include <common>
		#include <packing>

		#ifndef FRAGMENT_OUTPUT
		#define FRAGMENT_OUTPUT vec4(vec3(ao), 1.)
		#endif

		vec3 getViewPosition(const in vec2 screenPosition, const in float depth) {
			vec4 clipSpacePosition = vec4(vec3(screenPosition, depth) * 2.0 - 1.0, 1.0);
			vec4 viewSpacePosition = cameraProjectionMatrixInverse * clipSpacePosition;
			return viewSpacePosition.xyz / viewSpacePosition.w;
		}

		float getDepth(const vec2 uv) {
			return textureLod(tDepth, uv.xy, 0.0).DEPTH_SWIZZLING;
		}

		float fetchDepth(const ivec2 uv) {
			return texelFetch(tDepth, uv.xy, 0).DEPTH_SWIZZLING;
		}

		float getViewZ(const in float depth) {
			#if PERSPECTIVE_CAMERA == 1
				return perspectiveDepthToViewZ(depth, cameraNear, cameraFar);
			#else
				return orthographicDepthToViewZ(depth, cameraNear, cameraFar);
			#endif
		}

		vec3 computeNormalFromDepth(const vec2 uv) {
			vec2 size = vec2(textureSize(tDepth, 0));
			ivec2 p = ivec2(uv * size);
			float c0 = fetchDepth(p);
			float l2 = fetchDepth(p - ivec2(2, 0));
			float l1 = fetchDepth(p - ivec2(1, 0));
			float r1 = fetchDepth(p + ivec2(1, 0));
			float r2 = fetchDepth(p + ivec2(2, 0));
			float b2 = fetchDepth(p - ivec2(0, 2));
			float b1 = fetchDepth(p - ivec2(0, 1));
			float t1 = fetchDepth(p + ivec2(0, 1));
			float t2 = fetchDepth(p + ivec2(0, 2));
			float dl = abs((2.0 * l1 - l2) - c0);
			float dr = abs((2.0 * r1 - r2) - c0);
			float db = abs((2.0 * b1 - b2) - c0);
			float dt = abs((2.0 * t1 - t2) - c0);
			vec3 ce = getViewPosition(uv, c0).xyz;
			vec3 dpdx = (dl < dr) ? ce - getViewPosition((uv - vec2(1.0 / size.x, 0.0)), l1).xyz : -ce + getViewPosition((uv + vec2(1.0 / size.x, 0.0)), r1).xyz;
			vec3 dpdy = (db < dt) ? ce - getViewPosition((uv - vec2(0.0, 1.0 / size.y)), b1).xyz : -ce + getViewPosition((uv + vec2(0.0, 1.0 / size.y)), t1).xyz;
			return normalize(cross(dpdx, dpdy));
		}

		vec3 getViewNormal(const vec2 uv) {
			#if NORMAL_VECTOR_TYPE == 2
				return normalize(textureLod(tNormal, uv, 0.).rgb);
			#elif NORMAL_VECTOR_TYPE == 1
				return unpackRGBToNormal(textureLod(tNormal, uv, 0.).rgb);
			#else
				return computeNormalFromDepth(uv);
			#endif
		}

		vec3 getSceneUvAndDepth(vec3 sampleViewPos) {
			vec4 sampleClipPos = cameraProjectionMatrix * vec4(sampleViewPos, 1.);
			vec2 sampleUv = sampleClipPos.xy / sampleClipPos.w * 0.5 + 0.5;
			float sampleSceneDepth = getDepth(sampleUv);
			return vec3(sampleUv, sampleSceneDepth);
		}

		void main() {
			float depth = getDepth(vUv.xy);
			if (depth >= 1.0) {
				discard;
				return;
			}
			vec3 viewPos = getViewPosition(vUv, depth);
			vec3 viewNormal = getViewNormal(vUv);

			float radiusToUse = radius;
			float distanceFalloffToUse = thickness;
			#if SCREEN_SPACE_RADIUS == 1
				float radiusScale = getViewPosition(vec2(0.5 + float(SCREEN_SPACE_RADIUS_SCALE) / resolution.x, 0.0), depth).x;
				radiusToUse *= radiusScale;
				distanceFalloffToUse *= radiusScale;
			#endif

			#if SCENE_CLIP_BOX == 1
				vec3 worldPos = (cameraWorldMatrix * vec4(viewPos, 1.0)).xyz;
				float boxDistance = length(max(vec3(0.0), max(sceneBoxMin - worldPos, worldPos - sceneBoxMax)));
				if (boxDistance > radiusToUse) {
					discard;
					return;
				}
			#endif

			vec2 noiseResolution = vec2(textureSize(tNoise, 0));
			vec2 noiseUv = vUv * resolution / noiseResolution;
			vec4 noiseTexel = textureLod(tNoise, noiseUv, 0.0);
			vec3 randomVec = noiseTexel.xyz * 2.0 - 1.0;
			vec3 tangent = normalize(vec3(randomVec.xy, 0.));
			vec3 bitangent = vec3(-tangent.y, tangent.x, 0.);
			mat3 kernelMatrix = mat3(tangent, bitangent, vec3(0., 0., 1.));

			const int DIRECTIONS = SAMPLES < 30 ? 3 : 5;
			const int STEPS = (SAMPLES + DIRECTIONS - 1) / DIRECTIONS;
			float ao = 0.0;
			for (int i = 0; i < DIRECTIONS; ++i) {

				float angle = float(i) / float(DIRECTIONS) * PI;
				vec4 sampleDir = vec4(cos(angle), sin(angle), 0., 0.5 + 0.5 * noiseTexel.w);
				sampleDir.xyz = normalize(kernelMatrix * sampleDir.xyz);

				vec3 viewDir = normalize(-viewPos.xyz);
				vec3 sliceBitangent = normalize(cross(sampleDir.xyz, viewDir));
				vec3 sliceTangent = cross(sliceBitangent, viewDir);
				vec3 normalInSlice = normalize(viewNormal - sliceBitangent * dot(viewNormal, sliceBitangent));

				vec3 tangentToNormalInSlice = cross(normalInSlice, sliceBitangent);
				vec2 cosHorizons = vec2(dot(viewDir, tangentToNormalInSlice), dot(viewDir, -tangentToNormalInSlice));

				for (int j = 0; j < STEPS; ++j) {
					vec3 sampleViewOffset = sampleDir.xyz * radiusToUse * sampleDir.w * pow(float(j + 1) / float(STEPS), distanceExponent);

					vec3 sampleSceneUvDepth = getSceneUvAndDepth(viewPos + sampleViewOffset);
					vec3 sampleSceneViewPos = getViewPosition(sampleSceneUvDepth.xy, sampleSceneUvDepth.z);
					vec3 viewDelta = sampleSceneViewPos - viewPos;
					if (abs(viewDelta.z) < thickness) {
						float sampleCosHorizon = dot(viewDir, normalize(viewDelta));
						cosHorizons.x += max(0., (sampleCosHorizon - cosHorizons.x) * mix(1., 2. / float(j + 2), distanceFallOff));
					}

					sampleSceneUvDepth = getSceneUvAndDepth(viewPos - sampleViewOffset);
					sampleSceneViewPos = getViewPosition(sampleSceneUvDepth.xy, sampleSceneUvDepth.z);
					viewDelta = sampleSceneViewPos - viewPos;
					if (abs(viewDelta.z) < thickness) {
						float sampleCosHorizon = dot(viewDir, normalize(viewDelta));
						cosHorizons.y += max(0., (sampleCosHorizon - cosHorizons.y) * mix(1., 2. / float(j + 2), distanceFallOff));
					}
				}

				vec2 sinHorizons = sqrt(1. - cosHorizons * cosHorizons);
				float nx = dot(normalInSlice, sliceTangent);
				float ny = dot(normalInSlice, viewDir);
				float nxb = 1. / 2. * (acos(cosHorizons.y) - acos(cosHorizons.x) + sinHorizons.x * cosHorizons.x - sinHorizons.y * cosHorizons.y);
				float nyb = 1. / 2. * (2. - cosHorizons.x * cosHorizons.x - cosHorizons.y * cosHorizons.y);
				float occlusion = nx * nxb + ny * nyb;
				ao += occlusion;
			}

			ao = clamp(ao / float(DIRECTIONS), 0., 1.);
		#if SCENE_CLIP_BOX == 1
			ao = mix(ao, 1., smoothstep(0., radiusToUse, boxDistance));
		#endif
			ao = pow(ao, scale);

			gl_FragColor = FRAGMENT_OUTPUT;
		}`},Wi={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:`
		varying vec2 vUv;

		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`
		uniform sampler2D tDepth;
		uniform float cameraNear;
		uniform float cameraFar;
		varying vec2 vUv;

		#include <packing>

		float getLinearDepth( const in vec2 screenPosition ) {
			#if PERSPECTIVE_CAMERA == 1
				float fragCoordZ = texture2D( tDepth, screenPosition ).x;
				float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
				return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );
			#else
				return texture2D( tDepth, screenPosition ).x;
			#endif
		}

		void main() {
			float depth = getLinearDepth( vUv );
			gl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );

		}`},jn={uniforms:{tDiffuse:{value:null},intensity:{value:1}},vertexShader:`
		varying vec2 vUv;

		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`
		uniform float intensity;
		uniform sampler2D tDiffuse;
		varying vec2 vUv;

		void main() {
			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = vec4(mix(vec3(1.), texel.rgb, intensity), texel.a);
		}`};function uu(a=5){const e=Math.floor(a)%2===0?Math.floor(a)+1:Math.floor(a),t=pu(e),s=t.length,i=new Uint8Array(s*4);for(let r=0;r<s;++r){const o=t[r],l=2*Math.PI*o/s,h=new N(Math.cos(l),Math.sin(l),0).normalize();i[r*4]=(h.x*.5+.5)*255,i[r*4+1]=(h.y*.5+.5)*255,i[r*4+2]=127,i[r*4+3]=255}const n=new Qo(i,e,e);return n.wrapS=an,n.wrapT=an,n.needsUpdate=!0,n}function pu(a){const e=Math.floor(a)%2===0?Math.floor(a)+1:Math.floor(a),t=e*e,s=Array(t).fill(0);let i=Math.floor(e/2),n=e-1;for(let r=1;r<=t;){if(i===-1&&n===e?(n=e-2,i=0):(n===e&&(n=0),i<0&&(i=e-1)),s[i*e+n]!==0){n-=2,i++;continue}else s[i*e+n]=r++;n++,i--}return s}const Xi={defines:{SAMPLES:16,SAMPLE_VECTORS:Wa(16,2,1),NORMAL_VECTOR_TYPE:1,DEPTH_VALUE_SOURCE:0},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},resolution:{value:new ze},cameraProjectionMatrixInverse:{value:new Te},lumaPhi:{value:5},depthPhi:{value:5},normalPhi:{value:5},radius:{value:4},index:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`

		varying vec2 vUv;

		uniform sampler2D tDiffuse;
		uniform sampler2D tNormal;
		uniform sampler2D tDepth;
		uniform sampler2D tNoise;
		uniform vec2 resolution;
		uniform mat4 cameraProjectionMatrixInverse;
		uniform float lumaPhi;
		uniform float depthPhi;
		uniform float normalPhi;
		uniform float radius;
		uniform int index;

		#include <common>
		#include <packing>

		#ifndef SAMPLE_LUMINANCE
		#define SAMPLE_LUMINANCE dot(vec3(0.2125, 0.7154, 0.0721), a)
		#endif

		#ifndef FRAGMENT_OUTPUT
		#define FRAGMENT_OUTPUT vec4(denoised, 1.)
		#endif

		float getLuminance(const in vec3 a) {
			return SAMPLE_LUMINANCE;
		}

		const vec3 poissonDisk[SAMPLES] = SAMPLE_VECTORS;

		vec3 getViewPosition(const in vec2 screenPosition, const in float depth) {
			vec4 clipSpacePosition = vec4(vec3(screenPosition, depth) * 2.0 - 1.0, 1.0);
			vec4 viewSpacePosition = cameraProjectionMatrixInverse * clipSpacePosition;
			return viewSpacePosition.xyz / viewSpacePosition.w;
		}

		float getDepth(const vec2 uv) {
		#if DEPTH_VALUE_SOURCE == 1
			return textureLod(tDepth, uv.xy, 0.0).a;
		#else
			return textureLod(tDepth, uv.xy, 0.0).r;
		#endif
		}

		float fetchDepth(const ivec2 uv) {
			#if DEPTH_VALUE_SOURCE == 1
				return texelFetch(tDepth, uv.xy, 0).a;
			#else
				return texelFetch(tDepth, uv.xy, 0).r;
			#endif
		}

		vec3 computeNormalFromDepth(const vec2 uv) {
			vec2 size = vec2(textureSize(tDepth, 0));
			ivec2 p = ivec2(uv * size);
			float c0 = fetchDepth(p);
			float l2 = fetchDepth(p - ivec2(2, 0));
			float l1 = fetchDepth(p - ivec2(1, 0));
			float r1 = fetchDepth(p + ivec2(1, 0));
			float r2 = fetchDepth(p + ivec2(2, 0));
			float b2 = fetchDepth(p - ivec2(0, 2));
			float b1 = fetchDepth(p - ivec2(0, 1));
			float t1 = fetchDepth(p + ivec2(0, 1));
			float t2 = fetchDepth(p + ivec2(0, 2));
			float dl = abs((2.0 * l1 - l2) - c0);
			float dr = abs((2.0 * r1 - r2) - c0);
			float db = abs((2.0 * b1 - b2) - c0);
			float dt = abs((2.0 * t1 - t2) - c0);
			vec3 ce = getViewPosition(uv, c0).xyz;
			vec3 dpdx = (dl < dr) ?  ce - getViewPosition((uv - vec2(1.0 / size.x, 0.0)), l1).xyz
									: -ce + getViewPosition((uv + vec2(1.0 / size.x, 0.0)), r1).xyz;
			vec3 dpdy = (db < dt) ?  ce - getViewPosition((uv - vec2(0.0, 1.0 / size.y)), b1).xyz
									: -ce + getViewPosition((uv + vec2(0.0, 1.0 / size.y)), t1).xyz;
			return normalize(cross(dpdx, dpdy));
		}

		vec3 getViewNormal(const vec2 uv) {
		#if NORMAL_VECTOR_TYPE == 2
			return normalize(textureLod(tNormal, uv, 0.).rgb);
		#elif NORMAL_VECTOR_TYPE == 1
			return unpackRGBToNormal(textureLod(tNormal, uv, 0.).rgb);
		#else
			return computeNormalFromDepth(uv);
		#endif
		}

		void denoiseSample(in vec3 center, in vec3 viewNormal, in vec3 viewPos, in vec2 sampleUv, inout vec3 denoised, inout float totalWeight) {
			vec4 sampleTexel = textureLod(tDiffuse, sampleUv, 0.0);
			float sampleDepth = getDepth(sampleUv);
			vec3 sampleNormal = getViewNormal(sampleUv);
			vec3 neighborColor = sampleTexel.rgb;
			vec3 viewPosSample = getViewPosition(sampleUv, sampleDepth);

			float normalDiff = dot(viewNormal, sampleNormal);
			float normalSimilarity = pow(max(normalDiff, 0.), normalPhi);
			float lumaDiff = abs(getLuminance(neighborColor) - getLuminance(center));
			float lumaSimilarity = max(1.0 - lumaDiff / lumaPhi, 0.0);
			float depthDiff = abs(dot(viewPos - viewPosSample, viewNormal));
			float depthSimilarity = max(1. - depthDiff / depthPhi, 0.);
			float w = lumaSimilarity * depthSimilarity * normalSimilarity;

			denoised += w * neighborColor;
			totalWeight += w;
		}

		void main() {
			float depth = getDepth(vUv.xy);
			vec3 viewNormal = getViewNormal(vUv);
			if (depth == 1. || dot(viewNormal, viewNormal) == 0.) {
				discard;
				return;
			}
			vec4 texel = textureLod(tDiffuse, vUv, 0.0);
			vec3 center = texel.rgb;
			vec3 viewPos = getViewPosition(vUv, depth);

			vec2 noiseResolution = vec2(textureSize(tNoise, 0));
			vec2 noiseUv = vUv * resolution / noiseResolution;
			vec4 noiseTexel = textureLod(tNoise, noiseUv, 0.0);
      		vec2 noiseVec = vec2(sin(noiseTexel[index % 4] * 2. * PI), cos(noiseTexel[index % 4] * 2. * PI));
    		mat2 rotationMatrix = mat2(noiseVec.x, -noiseVec.y, noiseVec.x, noiseVec.y);

			float totalWeight = 1.0;
			vec3 denoised = texel.rgb;
			for (int i = 0; i < SAMPLES; i++) {
				vec3 sampleDir = poissonDisk[i];
				vec2 offset = rotationMatrix * (sampleDir.xy * (1. + sampleDir.z * (radius - 1.)) / resolution);
				vec2 sampleUv = vUv + offset;
				denoiseSample(center, viewNormal, viewPos, sampleUv, denoised, totalWeight);
			}

			if (totalWeight > 0.) {
				denoised /= totalWeight;
			}
			gl_FragColor = FRAGMENT_OUTPUT;
		}`};function Wa(a,e,t){const s=fu(a,e,t);let i="vec3[SAMPLES](";for(let n=0;n<a;n++){const r=s[n];i+=`vec3(${r.x}, ${r.y}, ${r.z})${n<a-1?",":")"}`}return i}function fu(a,e,t){const s=[];for(let i=0;i<a;i++){const n=2*Math.PI*e*i/a,r=Math.pow(i/(a-1),t);s.push(new N(Math.cos(n),Math.sin(n),r))}return s}class mu{constructor(e=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let t=0;t<256;t++)this.p[t]=Math.floor(e.random()*256);this.perm=[];for(let t=0;t<512;t++)this.perm[t]=this.p[t&255];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}noise(e,t){let s,i,n;const r=.5*(Math.sqrt(3)-1),o=(e+t)*r,l=Math.floor(e+o),h=Math.floor(t+o),c=(3-Math.sqrt(3))/6,u=(l+h)*c,f=l-u,d=h-u,g=e-f,m=t-d;let v,p;g>m?(v=1,p=0):(v=0,p=1);const _=g-v+c,b=m-p+c,E=g-1+2*c,S=m-1+2*c,A=l&255,P=h&255,D=this.perm[A+this.perm[P]]%12,I=this.perm[A+v+this.perm[P+p]]%12,k=this.perm[A+1+this.perm[P+1]]%12;let V=.5-g*g-m*m;V<0?s=0:(V*=V,s=V*V*this._dot(this.grad3[D],g,m));let C=.5-_*_-b*b;C<0?i=0:(C*=C,i=C*C*this._dot(this.grad3[I],_,b));let z=.5-E*E-S*S;return z<0?n=0:(z*=z,n=z*z*this._dot(this.grad3[k],E,S)),70*(s+i+n)}noise3d(e,t,s){let i,n,r,o;const l=(e+t+s)*.3333333333333333,h=Math.floor(e+l),c=Math.floor(t+l),u=Math.floor(s+l),f=1/6,d=(h+c+u)*f,g=h-d,m=c-d,v=u-d,p=e-g,_=t-m,b=s-v;let E,S,A,P,D,I;p>=_?_>=b?(E=1,S=0,A=0,P=1,D=1,I=0):p>=b?(E=1,S=0,A=0,P=1,D=0,I=1):(E=0,S=0,A=1,P=1,D=0,I=1):_<b?(E=0,S=0,A=1,P=0,D=1,I=1):p<b?(E=0,S=1,A=0,P=0,D=1,I=1):(E=0,S=1,A=0,P=1,D=1,I=0);const k=p-E+f,V=_-S+f,C=b-A+f,z=p-P+2*f,w=_-D+2*f,B=b-I+2*f,G=p-1+3*f,X=_-1+3*f,te=b-1+3*f,W=h&255,se=c&255,R=u&255,U=this.perm[W+this.perm[se+this.perm[R]]]%12,ne=this.perm[W+E+this.perm[se+S+this.perm[R+A]]]%12,ee=this.perm[W+P+this.perm[se+D+this.perm[R+I]]]%12,J=this.perm[W+1+this.perm[se+1+this.perm[R+1]]]%12;let pe=.6-p*p-_*_-b*b;pe<0?i=0:(pe*=pe,i=pe*pe*this._dot3(this.grad3[U],p,_,b));let ve=.6-k*k-V*V-C*C;ve<0?n=0:(ve*=ve,n=ve*ve*this._dot3(this.grad3[ne],k,V,C));let ae=.6-z*z-w*w-B*B;ae<0?r=0:(ae*=ae,r=ae*ae*this._dot3(this.grad3[ee],z,w,B));let ce=.6-G*G-X*X-te*te;return ce<0?o=0:(ce*=ce,o=ce*ce*this._dot3(this.grad3[J],G,X,te)),32*(i+n+r+o)}noise4d(e,t,s,i){const n=this.grad4,r=this.simplex,o=this.perm,l=(Math.sqrt(5)-1)/4,h=(5-Math.sqrt(5))/20;let c,u,f,d,g;const m=(e+t+s+i)*l,v=Math.floor(e+m),p=Math.floor(t+m),_=Math.floor(s+m),b=Math.floor(i+m),E=(v+p+_+b)*h,S=v-E,A=p-E,P=_-E,D=b-E,I=e-S,k=t-A,V=s-P,C=i-D,z=I>k?32:0,w=I>V?16:0,B=k>V?8:0,G=I>C?4:0,X=k>C?2:0,te=V>C?1:0,W=z+w+B+G+X+te,se=r[W][0]>=3?1:0,R=r[W][1]>=3?1:0,U=r[W][2]>=3?1:0,ne=r[W][3]>=3?1:0,ee=r[W][0]>=2?1:0,J=r[W][1]>=2?1:0,pe=r[W][2]>=2?1:0,ve=r[W][3]>=2?1:0,ae=r[W][0]>=1?1:0,ce=r[W][1]>=1?1:0,be=r[W][2]>=1?1:0,we=r[W][3]>=1?1:0,Ue=I-se+h,Ie=k-R+h,y=V-U+h,Z=C-ne+h,H=I-ee+2*h,M=k-J+2*h,O=V-pe+2*h,L=C-ve+2*h,Y=I-ae+3*h,q=k-ce+3*h,F=V-be+3*h,K=C-we+3*h,re=I-1+4*h,$=k-1+4*h,oe=V-1+4*h,_e=C-1+4*h,ue=v&255,Be=p&255,mt=_&255,Ye=b&255,$t=o[ue+o[Be+o[mt+o[Ye]]]]%32,Pe=o[ue+se+o[Be+R+o[mt+U+o[Ye+ne]]]]%32,ps=o[ue+ee+o[Be+J+o[mt+pe+o[Ye+ve]]]]%32,Rs=o[ue+ae+o[Be+ce+o[mt+be+o[Ye+we]]]]%32,gt=o[ue+1+o[Be+1+o[mt+1+o[Ye+1]]]]%32;let Rt=.6-I*I-k*k-V*V-C*C;Rt<0?c=0:(Rt*=Rt,c=Rt*Rt*this._dot4(n[$t],I,k,V,C));let es=.6-Ue*Ue-Ie*Ie-y*y-Z*Z;es<0?u=0:(es*=es,u=es*es*this._dot4(n[Pe],Ue,Ie,y,Z));let ts=.6-H*H-M*M-O*O-L*L;ts<0?f=0:(ts*=ts,f=ts*ts*this._dot4(n[ps],H,M,O,L));let ss=.6-Y*Y-q*q-F*F-K*K;ss<0?d=0:(ss*=ss,d=ss*ss*this._dot4(n[Rs],Y,q,F,K));let Ft=.6-re*re-$*$-oe*oe-_e*_e;return Ft<0?g=0:(Ft*=Ft,g=Ft*Ft*this._dot4(n[gt],re,$,oe,_e)),27*(c+u+f+d+g)}_dot(e,t,s){return e[0]*t+e[1]*s}_dot3(e,t,s,i){return e[0]*t+e[1]*s+e[2]*i}_dot4(e,t,s,i,n){return e[0]*t+e[1]*s+e[2]*i+e[3]*n}}class tt extends Dt{constructor(e,t,s=512,i=512,n,r,o){super(),this.width=s,this.height=i,this.clear=!0,this.camera=t,this.scene=e,this.output=0,this._renderGBuffer=!0,this._visibilityCache=new Map,this.blendIntensity=1,this.pdRings=2,this.pdRadiusExponent=2,this.pdSamples=16,this.gtaoNoiseTexture=uu(),this.pdNoiseTexture=this._generateNoise(),this.gtaoRenderTarget=new Ut(this.width,this.height,{type:ci}),this.pdRenderTarget=this.gtaoRenderTarget.clone(),this.gtaoMaterial=new Xe({defines:Object.assign({},Hi.defines),uniforms:lt.clone(Hi.uniforms),vertexShader:Hi.vertexShader,fragmentShader:Hi.fragmentShader,blending:Mt,depthTest:!1,depthWrite:!1}),this.gtaoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.gtaoMaterial.uniforms.tNoise.value=this.gtaoNoiseTexture,this.gtaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.normalMaterial=new Al,this.normalMaterial.blending=Mt,this.pdMaterial=new Xe({defines:Object.assign({},Xi.defines),uniforms:lt.clone(Xi.uniforms),vertexShader:Xi.vertexShader,fragmentShader:Xi.fragmentShader,depthTest:!1,depthWrite:!1}),this.pdMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.pdMaterial.uniforms.tNoise.value=this.pdNoiseTexture,this.pdMaterial.uniforms.resolution.value.set(this.width,this.height),this.pdMaterial.uniforms.lumaPhi.value=10,this.pdMaterial.uniforms.depthPhi.value=2,this.pdMaterial.uniforms.normalPhi.value=3,this.pdMaterial.uniforms.radius.value=8,this.depthRenderMaterial=new Xe({defines:Object.assign({},Wi.defines),uniforms:lt.clone(Wi.uniforms),vertexShader:Wi.vertexShader,fragmentShader:Wi.fragmentShader,blending:Mt}),this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new Xe({uniforms:lt.clone(nn.uniforms),vertexShader:nn.vertexShader,fragmentShader:nn.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:Br,blendDst:_i,blendEquation:vi,blendSrcAlpha:Ur,blendDstAlpha:_i,blendEquationAlpha:vi}),this.blendMaterial=new Xe({uniforms:lt.clone(jn.uniforms),vertexShader:jn.vertexShader,fragmentShader:jn.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blending:Pl,blendSrc:Br,blendDst:_i,blendEquation:vi,blendSrcAlpha:Ur,blendDstAlpha:_i,blendEquationAlpha:vi}),this._fsQuad=new Qt(null),this._originalClearColor=new fe,this.setGBuffer(n?n.depthTexture:void 0,n?n.normalTexture:void 0),r!==void 0&&this.updateGtaoMaterial(r),o!==void 0&&this.updatePdMaterial(o)}setSize(e,t){this.width=e,this.height=t,this.gtaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.pdRenderTarget.setSize(e,t),this.gtaoMaterial.uniforms.resolution.value.set(e,t),this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.pdMaterial.uniforms.resolution.value.set(e,t),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse)}dispose(){this.gtaoNoiseTexture.dispose(),this.pdNoiseTexture.dispose(),this.normalRenderTarget.dispose(),this.gtaoRenderTarget.dispose(),this.pdRenderTarget.dispose(),this.normalMaterial.dispose(),this.pdMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this._fsQuad.dispose()}get gtaoMap(){return this.pdRenderTarget.texture}setGBuffer(e,t){e!==void 0?(this.depthTexture=e,this.normalTexture=t,this._renderGBuffer=!1):(this.depthTexture=new Ol,this.depthTexture.format=Dl,this.depthTexture.type=Ml,this.normalRenderTarget=new Ut(this.width,this.height,{minFilter:on,magFilter:on,type:ci,depthTexture:this.depthTexture}),this.normalTexture=this.normalRenderTarget.texture,this._renderGBuffer=!0);const s=this.normalTexture?1:0,i=this.depthTexture===this.normalTexture?"w":"x";this.gtaoMaterial.defines.NORMAL_VECTOR_TYPE=s,this.gtaoMaterial.defines.DEPTH_SWIZZLING=i,this.gtaoMaterial.uniforms.tNormal.value=this.normalTexture,this.gtaoMaterial.uniforms.tDepth.value=this.depthTexture,this.pdMaterial.defines.NORMAL_VECTOR_TYPE=s,this.pdMaterial.defines.DEPTH_SWIZZLING=i,this.pdMaterial.uniforms.tNormal.value=this.normalTexture,this.pdMaterial.uniforms.tDepth.value=this.depthTexture,this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture}setSceneClipBox(e){e?(this.gtaoMaterial.needsUpdate=this.gtaoMaterial.defines.SCENE_CLIP_BOX!==1,this.gtaoMaterial.defines.SCENE_CLIP_BOX=1,this.gtaoMaterial.uniforms.sceneBoxMin.value.copy(e.min),this.gtaoMaterial.uniforms.sceneBoxMax.value.copy(e.max)):(this.gtaoMaterial.needsUpdate=this.gtaoMaterial.defines.SCENE_CLIP_BOX===0,this.gtaoMaterial.defines.SCENE_CLIP_BOX=0)}updateGtaoMaterial(e){e.radius!==void 0&&(this.gtaoMaterial.uniforms.radius.value=e.radius),e.distanceExponent!==void 0&&(this.gtaoMaterial.uniforms.distanceExponent.value=e.distanceExponent),e.thickness!==void 0&&(this.gtaoMaterial.uniforms.thickness.value=e.thickness),e.distanceFallOff!==void 0&&(this.gtaoMaterial.uniforms.distanceFallOff.value=e.distanceFallOff,this.gtaoMaterial.needsUpdate=!0),e.scale!==void 0&&(this.gtaoMaterial.uniforms.scale.value=e.scale),e.samples!==void 0&&e.samples!==this.gtaoMaterial.defines.SAMPLES&&(this.gtaoMaterial.defines.SAMPLES=e.samples,this.gtaoMaterial.needsUpdate=!0),e.screenSpaceRadius!==void 0&&(e.screenSpaceRadius?1:0)!==this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS&&(this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS=e.screenSpaceRadius?1:0,this.gtaoMaterial.needsUpdate=!0)}updatePdMaterial(e){let t=!1;e.lumaPhi!==void 0&&(this.pdMaterial.uniforms.lumaPhi.value=e.lumaPhi),e.depthPhi!==void 0&&(this.pdMaterial.uniforms.depthPhi.value=e.depthPhi),e.normalPhi!==void 0&&(this.pdMaterial.uniforms.normalPhi.value=e.normalPhi),e.radius!==void 0&&e.radius!==this.radius&&(this.pdMaterial.uniforms.radius.value=e.radius),e.radiusExponent!==void 0&&e.radiusExponent!==this.pdRadiusExponent&&(this.pdRadiusExponent=e.radiusExponent,t=!0),e.rings!==void 0&&e.rings!==this.pdRings&&(this.pdRings=e.rings,t=!0),e.samples!==void 0&&e.samples!==this.pdSamples&&(this.pdSamples=e.samples,t=!0),t&&(this.pdMaterial.defines.SAMPLES=this.pdSamples,this.pdMaterial.defines.SAMPLE_VECTORS=Wa(this.pdSamples,this.pdRings,this.pdRadiusExponent),this.pdMaterial.needsUpdate=!0)}render(e,t,s){switch(this._renderGBuffer&&(this._overrideVisibility(),this._renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this._restoreVisibility()),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.gtaoMaterial.uniforms.cameraWorldMatrix.value.copy(this.camera.matrixWorld),this._renderPass(e,this.gtaoMaterial,this.gtaoRenderTarget,16777215,1),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this._renderPass(e,this.pdMaterial,this.pdRenderTarget,16777215,1),this.output){case tt.OUTPUT.Off:break;case tt.OUTPUT.Diffuse:this.copyMaterial.uniforms.tDiffuse.value=s.texture,this.copyMaterial.blending=Mt,this._renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case tt.OUTPUT.AO:this.copyMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.copyMaterial.blending=Mt,this._renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case tt.OUTPUT.Denoise:this.copyMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.copyMaterial.blending=Mt,this._renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case tt.OUTPUT.Depth:this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this._renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case tt.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=Mt,this._renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case tt.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=s.texture,this.copyMaterial.blending=Mt,this._renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.blendMaterial.uniforms.intensity.value=this.blendIntensity,this.blendMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this._renderPass(e,this.blendMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.GTAOPass: Unknown output type.")}}_renderPass(e,t,s,i,n){e.getClearColor(this._originalClearColor);const r=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(s),e.autoClear=!1,i!=null&&(e.setClearColor(i),e.setClearAlpha(n||0),e.clear()),this._fsQuad.material=t,this._fsQuad.render(e),e.autoClear=o,e.setClearColor(this._originalClearColor),e.setClearAlpha(r)}_renderOverride(e,t,s,i,n){e.getClearColor(this._originalClearColor);const r=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(s),e.autoClear=!1,i=t.clearColor||i,n=t.clearAlpha||n,i!=null&&(e.setClearColor(i),e.setClearAlpha(n||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=o,e.setClearColor(this._originalClearColor),e.setClearAlpha(r)}_overrideVisibility(){const e=this.scene,t=this._visibilityCache;e.traverse(function(s){t.set(s,s.visible),(s.isPoints||s.isLine)&&(s.visible=!1)})}_restoreVisibility(){const e=this.scene,t=this._visibilityCache;e.traverse(function(s){const i=t.get(s);s.visible=i}),t.clear()}_generateNoise(e=64){const t=new mu,s=e*e*4,i=new Uint8Array(s);for(let r=0;r<e;r++)for(let o=0;o<e;o++){const l=r,h=o;i[(r*e+o)*4]=(t.noise(l,h)*.5+.5)*255,i[(r*e+o)*4+1]=(t.noise(l+e,h)*.5+.5)*255,i[(r*e+o)*4+2]=(t.noise(l,h+e)*.5+.5)*255,i[(r*e+o)*4+3]=(t.noise(l+e,h+e)*.5+.5)*255}const n=new Qo(i,e,e,di,Ko);return n.wrapS=an,n.wrapT=an,n.needsUpdate=!0,n}}tt.OUTPUT={Off:-1,Default:0,Diffuse:1,Depth:2,Normal:3,AO:4,Denoise:5};const Zi={name:"OutputShader",uniforms:{tDiffuse:{value:null},toneMappingExposure:{value:1}},vertexShader:`
		precision highp float;

		uniform mat4 modelViewMatrix;
		uniform mat4 projectionMatrix;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		precision highp float;

		uniform sampler2D tDiffuse;

		#include <tonemapping_pars_fragment>
		#include <colorspace_pars_fragment>

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );

			// tone mapping

			#ifdef LINEAR_TONE_MAPPING

				gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );

			#elif defined( REINHARD_TONE_MAPPING )

				gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );

			#elif defined( CINEON_TONE_MAPPING )

				gl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );

			#elif defined( ACES_FILMIC_TONE_MAPPING )

				gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );

			#elif defined( AGX_TONE_MAPPING )

				gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );

			#elif defined( NEUTRAL_TONE_MAPPING )

				gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );

			#elif defined( CUSTOM_TONE_MAPPING )

				gl_FragColor.rgb = CustomToneMapping( gl_FragColor.rgb );

			#endif

			// color space

			#ifdef SRGB_TRANSFER

				gl_FragColor = sRGBTransferOETF( gl_FragColor );

			#endif

		}`};class gu extends Dt{constructor(){super(),this.uniforms=lt.clone(Zi.uniforms),this.material=new zl({name:Zi.name,uniforms:this.uniforms,vertexShader:Zi.vertexShader,fragmentShader:Zi.fragmentShader}),this._fsQuad=new Qt(this.material),this._outputColorSpace=null,this._toneMapping=null}render(e,t,s){this.uniforms.tDiffuse.value=s.texture,this.uniforms.toneMappingExposure.value=e.toneMappingExposure,(this._outputColorSpace!==e.outputColorSpace||this._toneMapping!==e.toneMapping)&&(this._outputColorSpace=e.outputColorSpace,this._toneMapping=e.toneMapping,this.material.defines={},Il.getTransfer(this._outputColorSpace)===kl&&(this.material.defines.SRGB_TRANSFER=""),this._toneMapping===Ll?this.material.defines.LINEAR_TONE_MAPPING="":this._toneMapping===Nl?this.material.defines.REINHARD_TONE_MAPPING="":this._toneMapping===Ul?this.material.defines.CINEON_TONE_MAPPING="":this._toneMapping===Bl?this.material.defines.ACES_FILMIC_TONE_MAPPING="":this._toneMapping===Rl?this.material.defines.AGX_TONE_MAPPING="":this._toneMapping===Fl?this.material.defines.NEUTRAL_TONE_MAPPING="":this._toneMapping===Vl&&(this.material.defines.CUSTOM_TONE_MAPPING=""),this.material.needsUpdate=!0),this.renderToScreen===!0?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}const Yi={defines:{SMAA_THRESHOLD:"0.1"},uniforms:{tDiffuse:{value:null},resolution:{value:new ze(1/1024,1/512)}},vertexShader:`

		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[ 3 ];

		void SMAAEdgeDetectionVS( vec2 texcoord ) {
			vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 ); // WebGL port note: Changed sign in W component
			vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 ); // WebGL port note: Changed sign in W component
			vOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 ); // WebGL port note: Changed sign in W component
		}

		void main() {

			vUv = uv;

			SMAAEdgeDetectionVS( vUv );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;

		varying vec2 vUv;
		varying vec4 vOffset[ 3 ];

		vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
			vec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );

			// Calculate color deltas:
			vec4 delta;
			vec3 C = texture2D( colorTex, texcoord ).rgb;

			vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
			vec3 t = abs( C - Cleft );
			delta.x = max( max( t.r, t.g ), t.b );

			vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
			t = abs( C - Ctop );
			delta.y = max( max( t.r, t.g ), t.b );

			// We do the usual threshold:
			vec2 edges = step( threshold, delta.xy );

			// Then discard if there is no edge:
			if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
				discard;

			// Calculate right and bottom deltas:
			vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
			t = abs( C - Cright );
			delta.z = max( max( t.r, t.g ), t.b );

			vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
			t = abs( C - Cbottom );
			delta.w = max( max( t.r, t.g ), t.b );

			// Calculate the maximum delta in the direct neighborhood:
			float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

			// Calculate left-left and top-top deltas:
			vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
			t = abs( C - Cleftleft );
			delta.z = max( max( t.r, t.g ), t.b );

			vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
			t = abs( C - Ctoptop );
			delta.w = max( max( t.r, t.g ), t.b );

			// Calculate the final maximum delta:
			maxDelta = max( max( maxDelta, delta.z ), delta.w );

			// Local contrast adaptation in action:
			edges.xy *= step( 0.5 * maxDelta, delta.xy );

			return vec4( edges, 0.0, 0.0 );
		}

		void main() {

			gl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );

		}`},qi={defines:{SMAA_MAX_SEARCH_STEPS:"8",SMAA_AREATEX_MAX_DISTANCE:"16",SMAA_AREATEX_PIXEL_SIZE:"( 1.0 / vec2( 160.0, 560.0 ) )",SMAA_AREATEX_SUBTEX_SIZE:"( 1.0 / 7.0 )"},uniforms:{tDiffuse:{value:null},tArea:{value:null},tSearch:{value:null},resolution:{value:new ze(1/1024,1/512)}},vertexShader:`

		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[ 3 ];
		varying vec2 vPixcoord;

		void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
			vPixcoord = texcoord / resolution;

			// We will use these offsets for the searches later on (see @PSEUDO_GATHER4):
			vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 ); // WebGL port note: Changed sign in Y and W components
			vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 ); // WebGL port note: Changed sign in Y and W components

			// And these for the searches, they indicate the ends of the loops:
			vOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );

		}

		void main() {

			vUv = uv;

			SMAABlendingWeightCalculationVS( vUv );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )

		uniform sampler2D tDiffuse;
		uniform sampler2D tArea;
		uniform sampler2D tSearch;
		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[3];
		varying vec2 vPixcoord;

		#if __VERSION__ == 100
		vec2 round( vec2 x ) {
			return sign( x ) * floor( abs( x ) + 0.5 );
		}
		#endif

		float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
			// Not required if searchTex accesses are set to point:
			// float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);
			// e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +
			//     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;
			e.r = bias + e.r * scale;
			return 255.0 * texture2D( searchTex, e, 0.0 ).r;
		}

		float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
			/**
				* @PSEUDO_GATHER4
				* This texcoord has been offset by (-0.25, -0.125) in the vertex shader to
				* sample between edge, thus fetching four edges in a row.
				* Sampling with different offsets in each direction allows to disambiguate
				* which edges are active from the four fetched ones.
				*/
			vec2 e = vec2( 0.0, 1.0 );

			for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for
				e = texture2D( edgesTex, texcoord, 0.0 ).rg;
				texcoord -= vec2( 2.0, 0.0 ) * resolution;
				if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
			}

			// We correct the previous (-0.25, -0.125) offset we applied:
			texcoord.x += 0.25 * resolution.x;

			// The searches are bias by 1, so adjust the coords accordingly:
			texcoord.x += resolution.x;

			// Disambiguate the length added by the last step:
			texcoord.x += 2.0 * resolution.x; // Undo last step
			texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);

			return texcoord.x;
		}

		float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
			vec2 e = vec2( 0.0, 1.0 );

			for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for
				e = texture2D( edgesTex, texcoord, 0.0 ).rg;
				texcoord += vec2( 2.0, 0.0 ) * resolution;
				if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
			}

			texcoord.x -= 0.25 * resolution.x;
			texcoord.x -= resolution.x;
			texcoord.x -= 2.0 * resolution.x;
			texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );

			return texcoord.x;
		}

		float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
			vec2 e = vec2( 1.0, 0.0 );

			for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for
				e = texture2D( edgesTex, texcoord, 0.0 ).rg;
				texcoord += vec2( 0.0, 2.0 ) * resolution; // WebGL port note: Changed sign
				if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
			}

			texcoord.y -= 0.25 * resolution.y; // WebGL port note: Changed sign
			texcoord.y -= resolution.y; // WebGL port note: Changed sign
			texcoord.y -= 2.0 * resolution.y; // WebGL port note: Changed sign
			texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 ); // WebGL port note: Changed sign

			return texcoord.y;
		}

		float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
			vec2 e = vec2( 1.0, 0.0 );

			for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for
				e = texture2D( edgesTex, texcoord, 0.0 ).rg;
				texcoord -= vec2( 0.0, 2.0 ) * resolution; // WebGL port note: Changed sign
				if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
			}

			texcoord.y += 0.25 * resolution.y; // WebGL port note: Changed sign
			texcoord.y += resolution.y; // WebGL port note: Changed sign
			texcoord.y += 2.0 * resolution.y; // WebGL port note: Changed sign
			texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 ); // WebGL port note: Changed sign

			return texcoord.y;
		}

		vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
			// Rounding prevents precision errors of bilinear filtering:
			vec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;

			// We do a scale and bias for mapping to texel space:
			texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );

			// Move to proper place, according to the subpixel offset:
			texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;

			return texture2D( areaTex, texcoord, 0.0 ).rg;
		}

		vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
			vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );

			vec2 e = texture2D( edgesTex, texcoord ).rg;

			if ( e.g > 0.0 ) { // Edge at north
				vec2 d;

				// Find the distance to the left:
				vec2 coords;
				coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
				coords.y = offset[ 1 ].y; // offset[1].y = texcoord.y - 0.25 * resolution.y (@CROSSING_OFFSET)
				d.x = coords.x;

				// Now fetch the left crossing edges, two at a time using bilinear
				// filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to
				// discern what value each edge has:
				float e1 = texture2D( edgesTex, coords, 0.0 ).r;

				// Find the distance to the right:
				coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
				d.y = coords.x;

				// We want the distances to be in pixel units (doing this here allow to
				// better interleave arithmetic and memory accesses):
				d = d / resolution.x - pixcoord.x;

				// SMAAArea below needs a sqrt, as the areas texture is compressed
				// quadratically:
				vec2 sqrt_d = sqrt( abs( d ) );

				// Fetch the right crossing edges:
				coords.y -= 1.0 * resolution.y; // WebGL port note: Added
				float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;

				// Ok, we know how this pattern looks like, now it is time for getting
				// the actual area:
				weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
			}

			if ( e.r > 0.0 ) { // Edge at west
				vec2 d;

				// Find the distance to the top:
				vec2 coords;

				coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
				coords.x = offset[ 0 ].x; // offset[1].x = texcoord.x - 0.25 * resolution.x;
				d.x = coords.y;

				// Fetch the top crossing edges:
				float e1 = texture2D( edgesTex, coords, 0.0 ).g;

				// Find the distance to the bottom:
				coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
				d.y = coords.y;

				// We want the distances to be in pixel units:
				d = d / resolution.y - pixcoord.y;

				// SMAAArea below needs a sqrt, as the areas texture is compressed
				// quadratically:
				vec2 sqrt_d = sqrt( abs( d ) );

				// Fetch the bottom crossing edges:
				coords.y -= 1.0 * resolution.y; // WebGL port note: Added
				float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;

				// Get the area for this direction:
				weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );
			}

			return weights;
		}

		void main() {

			gl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );

		}`},Hn={uniforms:{tDiffuse:{value:null},tColor:{value:null},resolution:{value:new ze(1/1024,1/512)}},vertexShader:`

		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[ 2 ];

		void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
			vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 ); // WebGL port note: Changed sign in W component
			vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 ); // WebGL port note: Changed sign in W component
		}

		void main() {

			vUv = uv;

			SMAANeighborhoodBlendingVS( vUv );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform sampler2D tColor;
		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[ 2 ];

		vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
			// Fetch the blending weights for current pixel:
			vec4 a;
			a.xz = texture2D( blendTex, texcoord ).xz;
			a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
			a.w = texture2D( blendTex, offset[ 1 ].xy ).a;

			// Is there any blending weight with a value greater than 0.0?
			if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
				return texture2D( colorTex, texcoord, 0.0 );
			} else {
				// Up to 4 lines can be crossing a pixel (one through each edge). We
				// favor blending by choosing the line with the maximum weight for each
				// direction:
				vec2 offset;
				offset.x = a.a > a.b ? a.a : -a.b; // left vs. right
				offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs

				// Then we go in the direction that has the maximum weight:
				if ( abs( offset.x ) > abs( offset.y )) { // horizontal vs. vertical
					offset.y = 0.0;
				} else {
					offset.x = 0.0;
				}

				// Fetch the opposite color and lerp by hand:
				vec4 C = texture2D( colorTex, texcoord, 0.0 );
				texcoord += sign( offset ) * resolution;
				vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
				float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );

				// WebGL port note: Added gamma correction
				C.xyz = pow(C.xyz, vec3(2.2));
				Cop.xyz = pow(Cop.xyz, vec3(2.2));
				vec4 mixed = mix(C, Cop, s);
				mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));

				return mixed;
			}
		}

		void main() {

			gl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );

		}`};class vu extends Dt{constructor(){super(),this._edgesRT=new Ut(1,1,{depthBuffer:!1,type:ci}),this._edgesRT.texture.name="SMAAPass.edges",this._weightsRT=new Ut(1,1,{depthBuffer:!1,type:ci}),this._weightsRT.texture.name="SMAAPass.weights";const e=this,t=new Image;t.src=this._getAreaTexture(),t.onload=function(){e._areaTexture.needsUpdate=!0},this._areaTexture=new Rr,this._areaTexture.name="SMAAPass.area",this._areaTexture.image=t,this._areaTexture.minFilter=It,this._areaTexture.generateMipmaps=!1,this._areaTexture.flipY=!1;const s=new Image;s.src=this._getSearchTexture(),s.onload=function(){e._searchTexture.needsUpdate=!0},this._searchTexture=new Rr,this._searchTexture.name="SMAAPass.search",this._searchTexture.image=s,this._searchTexture.magFilter=on,this._searchTexture.minFilter=on,this._searchTexture.generateMipmaps=!1,this._searchTexture.flipY=!1,this._uniformsEdges=lt.clone(Yi.uniforms),this._materialEdges=new Xe({defines:Object.assign({},Yi.defines),uniforms:this._uniformsEdges,vertexShader:Yi.vertexShader,fragmentShader:Yi.fragmentShader}),this._uniformsWeights=lt.clone(qi.uniforms),this._uniformsWeights.tDiffuse.value=this._edgesRT.texture,this._uniformsWeights.tArea.value=this._areaTexture,this._uniformsWeights.tSearch.value=this._searchTexture,this._materialWeights=new Xe({defines:Object.assign({},qi.defines),uniforms:this._uniformsWeights,vertexShader:qi.vertexShader,fragmentShader:qi.fragmentShader}),this._uniformsBlend=lt.clone(Hn.uniforms),this._uniformsBlend.tDiffuse.value=this._weightsRT.texture,this._materialBlend=new Xe({uniforms:this._uniformsBlend,vertexShader:Hn.vertexShader,fragmentShader:Hn.fragmentShader}),this._fsQuad=new Qt(null)}render(e,t,s){this._uniformsEdges.tDiffuse.value=s.texture,this._fsQuad.material=this._materialEdges,e.setRenderTarget(this._edgesRT),this.clear&&e.clear(),this._fsQuad.render(e),this._fsQuad.material=this._materialWeights,e.setRenderTarget(this._weightsRT),this.clear&&e.clear(),this._fsQuad.render(e),this._uniformsBlend.tColor.value=s.texture,this._fsQuad.material=this._materialBlend,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this._fsQuad.render(e))}setSize(e,t){this._edgesRT.setSize(e,t),this._weightsRT.setSize(e,t),this._materialEdges.uniforms.resolution.value.set(1/e,1/t),this._materialWeights.uniforms.resolution.value.set(1/e,1/t),this._materialBlend.uniforms.resolution.value.set(1/e,1/t)}dispose(){this._edgesRT.dispose(),this._weightsRT.dispose(),this._areaTexture.dispose(),this._searchTexture.dispose(),this._materialEdges.dispose(),this._materialWeights.dispose(),this._materialBlend.dispose(),this._fsQuad.dispose()}_getAreaTexture(){return"data:image/png;base64,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"}_getSearchTexture(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}}class _u extends Dt{constructor(e,t,s=1){super(),T(this,"_edgeMaterial"),T(this,"_combineMaterial"),T(this,"_fsQuad"),T(this,"_edgeRenderTarget"),T(this,"_vertexColorRenderTarget"),T(this,"_fragments"),T(this,"_renderer"),T(this,"_overrideMaterial",new us({vertexColors:!0,side:Nt})),this._renderer=e,this._fragments=t,this._edgeMaterial=new Xe({uniforms:{tDiffuse:{value:null},width:{value:s}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `,fragmentShader:`
        uniform sampler2D tDiffuse;
        uniform float width;
        varying vec2 vUv;

        void main() {
          vec2 texel = vec2(1.0 / float(textureSize(tDiffuse, 0).x), 1.0 / float(textureSize(tDiffuse, 0).y));
          vec2 offset = texel * width;
          
          vec4 center = texture2D(tDiffuse, vUv);
          vec4 right = texture2D(tDiffuse, vUv + vec2(offset.x, 0.0));
          vec4 up = texture2D(tDiffuse, vUv + vec2(0.0, offset.y));
          
          float diff = 0.0;
          diff += distance(center.rgb, right.rgb);
          diff += distance(center.rgb, up.rgb);
          gl_FragColor = vec4(vec3(step(0.0001, diff)), 1.0);
        }
      `}),this._combineMaterial=new Xe({uniforms:{tDiffuse:{value:null},tEdges:{value:null},edgeColor:{value:new fe(8947848)}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `,fragmentShader:`
        uniform sampler2D tDiffuse;
        uniform sampler2D tEdges;
        uniform vec3 edgeColor;
        varying vec2 vUv;

        void main() {
          vec4 color = texture2D(tDiffuse, vUv);
          vec4 edges = texture2D(tEdges, vUv);
          
          // Combine color with edges (edges are black, so we multiply)
          gl_FragColor = mix(color, vec4(edgeColor, 1.0), edges.r);
        }
      `}),this._fsQuad=new Qt(this._edgeMaterial),this._edgeRenderTarget=new Ut(1,1,{minFilter:It,magFilter:It,format:di}),this._vertexColorRenderTarget=new Ut(1,1,{minFilter:It,magFilter:It,format:di})}get width(){return this._edgeMaterial.uniforms.width.value}set width(e){this._edgeMaterial.uniforms.width.value=e}get color(){return this._combineMaterial.uniforms.edgeColor.value}set color(e){this._combineMaterial.uniforms.edgeColor.value=e}setSize(e,t){this._edgeRenderTarget.setSize(e,t),this._vertexColorRenderTarget.setSize(e,t)}setWidth(e){this._edgeMaterial.uniforms.width.value=e}render(e,t,s){const i=this._renderer.currentWorld,n=i.scene.three,r=i.scene.three,o=r.fog;r.fog=null;const l=n.overrideMaterial;n.overrideMaterial=this._overrideMaterial,e.setRenderTarget(this._vertexColorRenderTarget),e.render(n,i.camera.three),n.overrideMaterial=l,r.fog=o,this._edgeMaterial.uniforms.tDiffuse.value=this._vertexColorRenderTarget.texture,this._fsQuad.material=this._edgeMaterial,e.setRenderTarget(this._edgeRenderTarget),this._fsQuad.render(e),this._combineMaterial.uniforms.tDiffuse.value=s.texture,this._combineMaterial.uniforms.tEdges.value=this._edgeRenderTarget.texture,this._fsQuad.material=this._combineMaterial,this.renderToScreen?e.setRenderTarget(null):e.setRenderTarget(t),this._fsQuad.render(e)}dispose(){this._edgeMaterial.dispose(),this._combineMaterial.dispose(),this._fsQuad.dispose(),this._edgeRenderTarget.dispose(),this._vertexColorRenderTarget.dispose()}}class yu extends Dt{constructor(e,t,s){super(),T(this,"outlineColor",new fe(16762880)),T(this,"thickness",2),T(this,"fillColor",new fe(16776960)),T(this,"fillOpacity",.3),T(this,"debugShowMask",!1),T(this,"scene",new _r),T(this,"_maskTarget"),T(this,"_fsQuad"),T(this,"_world"),T(this,"_debugQuad",null),this._world=s,this.scene.background=new fe(0),this._maskTarget=new Ut(e,t,{minFilter:It,magFilter:It,format:di,type:Ko}),this._fsQuad=new Qt(new Xe({uniforms:{tDiffuse:{value:null},tMask:{value:null},outlineColor:{value:new fe(65280)},thickness:{value:2},resolution:{value:new ze(e,t)},fillColor:{value:new fe(16776960)},fillOpacity:{value:.3}},vertexShader:`
          varying vec2 vUv;
          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
        `,fragmentShader:`
          uniform sampler2D tDiffuse;
          uniform sampler2D tMask;
          uniform vec3 outlineColor;
          uniform float thickness;
          uniform vec2 resolution;
          uniform vec3 fillColor;
          uniform float fillOpacity;
          varying vec2 vUv;

          void main() {
            float mask = texture2D(tMask, vUv).r;
            float outline = 0.0;
            float t = thickness;
            vec2 texel = 1.0 / resolution;
            for (float x = -t; x <= t; x++) {
              for (float y = -t; y <= t; y++) {
                vec2 offset = vec2(x, y) * texel;
                float neighbor = texture2D(tMask, vUv + offset).r;
                if (neighbor > 0.5) outline = 1.0;
              }
            }
            vec4 sceneColor = texture2D(tDiffuse, vUv);
            // Fill inside
            if (mask > 0.5) {
              sceneColor.rgb = mix(sceneColor.rgb, fillColor, fillOpacity);
            }
            // Only draw outline where mask is not set but neighbor is
            if (outline > 0.5 && mask < 0.5) {
              gl_FragColor = vec4(outlineColor, 1.0);
            } else {
              gl_FragColor = sceneColor;
            }
          }
        `})),this._debugQuad=new Qt(new Xe({uniforms:{tMask:{value:null}},vertexShader:`
          varying vec2 vUv;
          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
        `,fragmentShader:`
          uniform sampler2D tMask;
          varying vec2 vUv;
          void main() {
            float mask = texture2D(tMask, vUv).r;
            gl_FragColor = vec4(vec3(mask), 1.0);
          }
        `}))}setSize(e,t){this._maskTarget.setSize(e,t),this._fsQuad.material.uniforms.resolution.value.set(e,t)}render(e,t,s){const i=this._world.camera.three,n=e.getClearColor(new fe),r=e.getClearAlpha();if(e.setClearColor(0,0),e.setRenderTarget(this._maskTarget),e.clear(),e.render(this.scene,i),e.setClearColor(n,r),this.debugShowMask){const l=this._debugQuad.material;l.uniforms.tMask.value=this._maskTarget.texture,this.renderToScreen?e.setRenderTarget(null):e.setRenderTarget(t),this._debugQuad.render(e);return}const o=this._fsQuad.material;o.uniforms.tDiffuse.value=s.texture,o.uniforms.tMask.value=this._maskTarget.texture,o.uniforms.outlineColor.value.copy(this.outlineColor),o.uniforms.thickness.value=this.thickness,o.uniforms.fillColor.value.copy(this.fillColor),o.uniforms.fillOpacity.value=this.fillOpacity,this.renderToScreen?e.setRenderTarget(null):e.setRenderTarget(t),this._fsQuad.render(e)}dispose(){this._maskTarget.dispose(),this._fsQuad.dispose();const e=[...this.scene.children];for(const t of e)t.removeFromParent()}}class wu extends Dt{constructor(e,t){super(),T(this,"materialToExclude",new us({color:0})),T(this,"_excludedMaterials",new Set),T(this,"_originalMaterials",new Map),T(this,"_renderer"),T(this,"_world"),T(this,"_fsQuad"),T(this,"_combineMaterial"),T(this,"_excludedRenderTarget"),this._renderer=e,this._world=t,this._excludedRenderTarget=new Ut(1,1,{minFilter:It,magFilter:It,format:di}),this._combineMaterial=new Xe({uniforms:{tDiffuse:{value:null},tExcluded:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `,fragmentShader:`
        uniform sampler2D tDiffuse;
        uniform sampler2D tExcluded;
        varying vec2 vUv;

        void main() {
          vec4 inputColor = texture2D(tDiffuse, vUv);
          vec4 excludedColor = texture2D(tExcluded, vUv);
          
          // If excluded pixel is black (or very dark), use input color
          // Otherwise, use excluded color
          float excludedLuminance = (excludedColor.r + excludedColor.g + excludedColor.b) / 3.0;
          float threshold = 0.01; // Adjust this threshold as needed
          
          if (excludedLuminance < threshold) {
            gl_FragColor = inputColor;
          } else {
            gl_FragColor = excludedColor;
          }
        }
      `}),this._fsQuad=new Qt(this._combineMaterial)}addExcludedMaterial(e){this._excludedMaterials.add(e)}removeExcludedMaterial(e){this._excludedMaterials.delete(e)}clearExcludedMaterials(){this._excludedMaterials.clear()}get excludedMaterials(){return Array.from(this._excludedMaterials)}setSize(e,t){this._excludedRenderTarget.setSize(e,t)}render(e,t,s){const i=this._world.scene.three,n=this._world.camera.three,r=e.getClearColor(new fe),o=e.getClearAlpha();e.setClearColor(0,0),this._substituteMaterials(i),e.setRenderTarget(this._excludedRenderTarget),e.render(i,n),this._restoreMaterials(),this._combineMaterial.uniforms.tDiffuse.value=s.texture,this._combineMaterial.uniforms.tExcluded.value=this._excludedRenderTarget.texture,this.renderToScreen?e.setRenderTarget(null):e.setRenderTarget(t),this._fsQuad.render(e),e.setClearColor(r,o)}_substituteMaterials(e){if(e instanceof ie){const t=e.material;if(Array.isArray(t)){for(const s of t)if("isLodMaterial"in s)return}else if("isLodMaterial"in t)return;this._excludedMaterials.has(t)||(this._originalMaterials.set(e,t),e.material=this.materialToExclude)}for(const t of e.children)this._substituteMaterials(t)}_restoreMaterials(){for(const[e,t]of this._originalMaterials)e.material=t;this._originalMaterials.clear()}dispose(){this.materialToExclude.dispose(),this._combineMaterial.dispose(),this._fsQuad.dispose(),this._excludedRenderTarget.dispose(),this._excludedMaterials.clear(),this._originalMaterials.clear()}}class bu extends Dt{constructor(e,t,s=null,i=null,n=null){super(),T(this,"scene"),T(this,"camera"),T(this,"overrideMaterial"),T(this,"clearColor"),T(this,"clearAlpha"),T(this,"clearDepth"),T(this,"needsSwap"),T(this,"isolatedMaterials",[]),T(this,"_oldClearColor"),this.scene=e,this.camera=t,this.overrideMaterial=s,this.clearColor=i,this.clearAlpha=n,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new fe}render(e,t,s){for(const o of this.isolatedMaterials)o.userData.wasVisibleBasePass!==void 0&&(o.visible=o.userData.wasVisibleBasePass);const i=e.autoClear;e.autoClear=!1;let n,r;this.overrideMaterial!==null&&(r=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(n=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth===!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:s),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(n),this.overrideMaterial!==null&&(this.scene.overrideMaterial=r),e.autoClear=i;for(const o of this.isolatedMaterials)o.userData.wasVisibleBasePass=o.visible,o.visible=!1}}var xu=(a=>(a[a.COLOR=0]="COLOR",a[a.PEN=1]="PEN",a[a.PEN_SHADOWS=2]="PEN_SHADOWS",a[a.COLOR_PEN=3]="COLOR_PEN",a[a.COLOR_SHADOWS=4]="COLOR_SHADOWS",a[a.COLOR_PEN_SHADOWS=5]="COLOR_PEN_SHADOWS",a))(xu||{});class Eu{constructor(e,t){T(this,"invisibleMaterials",new Set),T(this,"_enabled",!1),T(this,"_initialized",!1),T(this,"_composer"),T(this,"_basePass"),T(this,"_aoPass"),T(this,"_outputPass"),T(this,"_edgeDetectionPass"),T(this,"_smaaPass"),T(this,"_simpleOutlinePass"),T(this,"_excludedObjectsPass"),T(this,"_style",0),T(this,"_outlinesEnabled",!1),T(this,"_excludedObjectsEnabled",!1),T(this,"_components"),T(this,"_renderer"),this._components=e,this._renderer=t}get basePass(){if(!this._basePass)throw new Error("Base pass not initialized");return this._basePass}get enabled(){return this._enabled}set enabled(e){if(this._enabled=e,e&&!this._initialized&&this.initialize(),!e)for(const t of this.basePass.isolatedMaterials)t.visible=!0}get aoPass(){if(!this._aoPass)throw new Error("AO pass not initialized");return this._aoPass}get outlinePass(){if(!this._simpleOutlinePass)throw new Error("Outline pass not initialized");return this._simpleOutlinePass}get edgesPass(){if(!this._edgeDetectionPass)throw new Error("Edge detection pass not initialized");return this._edgeDetectionPass}get excludedObjectsPass(){if(!this._excludedObjectsPass)throw new Error("Excluded objects pass not initialized");return this._excludedObjectsPass}get outlinesEnabled(){return this._outlinesEnabled}set outlinesEnabled(e){this._outlinesEnabled=e,this.style=this._style}get excludedObjectsEnabled(){return this._excludedObjectsEnabled}set excludedObjectsEnabled(e){this._excludedObjectsEnabled=e,this.style=this._style}get style(){return this._style}set style(e){this._composer&&(!this._composer||!this._basePass||!this._smaaPass||!this._outputPass||!this._aoPass||!this._edgeDetectionPass||!this._simpleOutlinePass||!this._excludedObjectsPass||(this._style=e,this.clearPasses(),this.clearComposer(),e===0&&(this._composer.addPass(this._basePass),this._outlinesEnabled&&this._composer.addPass(this._simpleOutlinePass),this._excludedObjectsEnabled&&this._composer.addPass(this._excludedObjectsPass),this._composer.addPass(this._outputPass)),e===1&&(this._composer.addPass(this._edgeDetectionPass),this._outlinesEnabled&&this._composer.addPass(this._simpleOutlinePass),this._excludedObjectsEnabled&&this._composer.addPass(this._excludedObjectsPass)),e===2&&(this._composer.addPass(this._basePass),this._composer.addPass(this._aoPass),this._aoPass.output=tt.OUTPUT.AO,this._composer.addPass(this._edgeDetectionPass),this._outlinesEnabled&&this._composer.addPass(this._simpleOutlinePass),this._excludedObjectsEnabled&&this._composer.addPass(this._excludedObjectsPass),this._composer.addPass(this._outputPass)),e===3&&(this._composer.addPass(this._basePass),this._composer.addPass(this._edgeDetectionPass),this._outlinesEnabled&&this._composer.addPass(this._simpleOutlinePass),this._excludedObjectsEnabled&&this._composer.addPass(this._excludedObjectsPass),this._composer.addPass(this._outputPass)),e===4&&(this._composer.addPass(this._basePass),this._composer.addPass(this._aoPass),this._aoPass.output=tt.OUTPUT.Default,this._outlinesEnabled&&this._composer.addPass(this._simpleOutlinePass),this._excludedObjectsEnabled&&this._composer.addPass(this._excludedObjectsPass),this._composer.addPass(this._outputPass)),e===5&&(this._composer.addPass(this._basePass),this._composer.addPass(this._aoPass),this._aoPass.output=tt.OUTPUT.Default,this._composer.addPass(this._edgeDetectionPass),this._outlinesEnabled&&this._composer.addPass(this._simpleOutlinePass),this._excludedObjectsEnabled&&this._composer.addPass(this._excludedObjectsPass),this._composer.addPass(this._outputPass))))}update(){if(this._composer){for(const e of this.invisibleMaterials)e.userData.wasVisibleForPostproduction=e.visible,e.visible=!1;this._composer.render();for(const e of this.invisibleMaterials)e.visible=e.userData.wasVisibleForPostproduction}}dispose(){var e,t,s,i,n,r,o;(e=this._composer)==null||e.dispose(),(t=this._aoPass)==null||t.dispose(),(s=this._outputPass)==null||s.dispose(),(i=this._edgeDetectionPass)==null||i.dispose(),(n=this._smaaPass)==null||n.dispose(),(r=this._simpleOutlinePass)==null||r.dispose(),(o=this._excludedObjectsPass)==null||o.dispose()}setSize(e,t){e===0||t===0||(this._composer&&this._composer.setSize(e,t),this._simpleOutlinePass&&this._simpleOutlinePass.setSize(e,t),this._excludedObjectsPass&&this._excludedObjectsPass.setSize(e,t))}updateCamera(){const e=this._renderer.currentWorld.camera.three;this._basePass&&(this._basePass.camera=e),this._aoPass&&(this._aoPass.camera=e)}clearPasses(){if(!this._composer)return;const e=[...this._composer.passes];for(const t of e)this._composer.removePass(t)}clearComposer(){this._composer&&(this._renderer.three.setClearColor(0,0),this._renderer.three.setRenderTarget(this._composer.renderTarget1),this._renderer.three.clear(),this._renderer.three.setRenderTarget(this._composer.renderTarget2),this._renderer.three.clear(),this._renderer.three.setRenderTarget(null))}initialize(){this._initialized=!0;const e=this._renderer.currentWorld.scene.three,t=this._renderer.currentWorld.camera.three;this._renderer.three.setClearColor(0,0),this._composer=new du(this._renderer.three);const s=new bu(e,t);this._basePass=s,this._smaaPass=new vu,this._aoPass=new tt(e,t,this._renderer.three.domElement.width,this._renderer.three.domElement.height),this._aoPass.output=tt.OUTPUT.Default;const i=this._components.get(le);this._edgeDetectionPass=new _u(this._renderer,i),this._outputPass=new gu,this._simpleOutlinePass=new yu(this._renderer.three.domElement.width,this._renderer.three.domElement.height,this._renderer.currentWorld),this._excludedObjectsPass=new wu(this._renderer,this._renderer.currentWorld),this.style=0}}class Vu extends nu{constructor(e,t,s){super(e,t,s),T(this,"_postproduction"),this.onResize.add(i=>{this.setPostproductionSize(i)}),this.onWorldChanged.add(()=>{this.currentWorld&&(this._postproduction&&this._postproduction.dispose(),this._postproduction=new Eu(e,this),this.setPostproductionSize())})}get postproduction(){if(!this._postproduction)throw new Error("Renderer not initialized yet with a world!");return this._postproduction}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger();const e=this.currentWorld.scene.three,t=this.currentWorld.camera.three;this.postproduction.enabled?this.postproduction.update():this.three.render(e,t),e instanceof _r&&this.three2D.render(e,t),this.onAfterUpdate.trigger()}dispose(){super.dispose(),this.postproduction.dispose()}setPostproductionSize(e){if(e&&(e.x===0||e.y===0)||!this.container||!this._postproduction)return;const t=Math.min(window.devicePixelRatio,2),s=(e==null?void 0:e.x)??this.container.clientWidth*t,i=(e==null?void 0:e.y)??this.container.clientHeight*t;s===0||i===0||this.postproduction.setSize(s,i)}}const Ro=new Le,Gi=new N;class Mr extends vl{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],s=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(s),this.setAttribute("position",new qt(e,3)),this.setAttribute("uv",new qt(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,s=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),s.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const s=new Qn(t,6,1);return this.setAttribute("instanceStart",new Ms(s,3,0)),this.setAttribute("instanceEnd",new Ms(s,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const s=new Qn(t,6,1);return this.setAttribute("instanceColorStart",new Ms(s,3,0)),this.setAttribute("instanceColorEnd",new Ms(s,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new _l(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Le);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),Ro.setFromBufferAttribute(t),this.boundingBox.union(Ro))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ds),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const s=this.boundingSphere.center;this.boundingBox.getCenter(s);let i=0;for(let n=0,r=e.count;n<r;n++)Gi.fromBufferAttribute(e,n),i=Math.max(i,s.distanceToSquared(Gi)),Gi.fromBufferAttribute(t,n),i=Math.max(i,s.distanceToSquared(Gi));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}}Ji.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new ze(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};$i.line={uniforms:lt.merge([Ji.common,Ji.fog,Ji.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class zr extends Xe{constructor(e){super({type:"LineMaterial",uniforms:lt.clone($i.line.uniforms),vertexShader:$i.line.vertexShader,fragmentShader:$i.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const Wn=new Ns,Fo=new N,Vo=new N,je=new Ns,He=new Ns,St=new Ns,Xn=new N,Zn=new Te,We=new pt,jo=new N,Qi=new Le,Ki=new ds,Tt=new Ns;let At,hs;function Ho(a,e,t){return Tt.set(0,0,-e,1).applyMatrix4(a.projectionMatrix),Tt.multiplyScalar(1/Tt.w),Tt.x=hs/t.width,Tt.y=hs/t.height,Tt.applyMatrix4(a.projectionMatrixInverse),Tt.multiplyScalar(1/Tt.w),Math.abs(Math.max(Tt.x,Tt.y))}function Su(a,e){const t=a.matrixWorld,s=a.geometry,i=s.attributes.instanceStart,n=s.attributes.instanceEnd,r=Math.min(s.instanceCount,i.count);for(let o=0,l=r;o<l;o++){We.start.fromBufferAttribute(i,o),We.end.fromBufferAttribute(n,o),We.applyMatrix4(t);const h=new N,c=new N;At.distanceSqToSegment(We.start,We.end,c,h),c.distanceTo(h)<hs*.5&&e.push({point:c,pointOnLine:h,distance:At.origin.distanceTo(c),object:a,face:null,faceIndex:o,uv:null,uv1:null})}}function Tu(a,e,t){const s=e.projectionMatrix,i=a.material.resolution,n=a.matrixWorld,r=a.geometry,o=r.attributes.instanceStart,l=r.attributes.instanceEnd,h=Math.min(r.instanceCount,o.count),c=-e.near;At.at(1,St),St.w=1,St.applyMatrix4(e.matrixWorldInverse),St.applyMatrix4(s),St.multiplyScalar(1/St.w),St.x*=i.x/2,St.y*=i.y/2,St.z=0,Xn.copy(St),Zn.multiplyMatrices(e.matrixWorldInverse,n);for(let u=0,f=h;u<f;u++){if(je.fromBufferAttribute(o,u),He.fromBufferAttribute(l,u),je.w=1,He.w=1,je.applyMatrix4(Zn),He.applyMatrix4(Zn),je.z>c&&He.z>c)continue;if(je.z>c){const p=je.z-He.z,_=(je.z-c)/p;je.lerp(He,_)}else if(He.z>c){const p=He.z-je.z,_=(He.z-c)/p;He.lerp(je,_)}je.applyMatrix4(s),He.applyMatrix4(s),je.multiplyScalar(1/je.w),He.multiplyScalar(1/He.w),je.x*=i.x/2,je.y*=i.y/2,He.x*=i.x/2,He.y*=i.y/2,We.start.copy(je),We.start.z=0,We.end.copy(He),We.end.z=0;const d=We.closestPointToPointParameter(Xn,!0);We.at(d,jo);const g=Go.lerp(je.z,He.z,d),m=g>=-1&&g<=1,v=Xn.distanceTo(jo)<hs*.5;if(m&&v){We.start.fromBufferAttribute(o,u),We.end.fromBufferAttribute(l,u),We.start.applyMatrix4(n),We.end.applyMatrix4(n);const p=new N,_=new N;At.distanceSqToSegment(We.start,We.end,_,p),t.push({point:_,pointOnLine:p,distance:At.origin.distanceTo(_),object:a,face:null,faceIndex:u,uv:null,uv1:null})}}}class Xa extends ie{constructor(e=new Mr,t=new zr({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,s=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let r=0,o=0,l=t.count;r<l;r++,o+=2)Fo.fromBufferAttribute(t,r),Vo.fromBufferAttribute(s,r),i[o]=o===0?0:i[o-1],i[o+1]=i[o]+Fo.distanceTo(Vo);const n=new Qn(i,2,1);return e.setAttribute("instanceDistanceStart",new Ms(n,1,0)),e.setAttribute("instanceDistanceEnd",new Ms(n,1,1)),this}raycast(e,t){const s=this.material.worldUnits,i=e.camera;i===null&&!s&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const n=e.params.Line2!==void 0&&e.params.Line2.threshold||0;At=e.ray;const r=this.matrixWorld,o=this.geometry,l=this.material;hs=l.linewidth+n,o.boundingSphere===null&&o.computeBoundingSphere(),Ki.copy(o.boundingSphere).applyMatrix4(r);let h;if(s)h=hs*.5;else{const u=Math.max(i.near,Ki.distanceToPoint(At.origin));h=Ho(i,u,l.resolution)}if(Ki.radius+=h,At.intersectsSphere(Ki)===!1)return;o.boundingBox===null&&o.computeBoundingBox(),Qi.copy(o.boundingBox).applyMatrix4(r);let c;if(s)c=hs*.5;else{const u=Math.max(i.near,Qi.distanceToPoint(At.origin));c=Ho(i,u,l.resolution)}Qi.expandByScalar(c),At.intersectsBox(Qi)!==!1&&(s?Su(this,t):Tu(this,i,t))}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(Wn),this.material.uniforms.resolution.value.set(Wn.z,Wn.w))}}class Cu{constructor(e,t){T(this,"_components"),T(this,"_modelStyleGeometries",new Me),T(this,"onDisposed",new Q),T(this,"three",new pi),T(this,"plane"),T(this,"items",new Me),T(this,"world",null),T(this,"_visible",!1),this._components=e,this.plane=t,this.setupEvents()}set visible(e){e?this.world&&(this.world.scene.three.add(this.three),this._visible=!0):(this.three.removeFromParent(),this._visible=!1)}get visible(){return this._visible}setupEvents(){const e=this._components.get(Yn);this.items.guard=(t,{style:s})=>!!e.styles.get(s),this.items.onItemSet.add(({value:t})=>{const{style:s,data:i}=t;this.create(s,i)})}getStyleMeshes(e,t){const s=this._components.get(Yn).styles.get(t);if(!s)throw new Error(`ClipStyler: "${t}" style not found.`);const i=this._components.get(le).list.get(e);if(!i)throw new Error(`ClipEdges: model with id "${e}" not found.`);const{linesMaterial:n,fillsMaterial:r}=s;let o=this._modelStyleGeometries.get(e);o||(o=new Me,this._modelStyleGeometries.set(e,o));let l=o.get(t);if(!l){let h;n&&(h=new Xa(new Mr,n),h.frustumCulled=!1,i&&h.applyMatrix4(i.object.matrixWorld),this.three.add(h));let c;r&&(c=new ie(new st,r),i&&c.applyMatrix4(i.object.matrixWorld),this.three.add(c)),l={edges:h,fills:c},o.set(t,l)}return l}async updateMeshes(e,t,s){const i=this._components.get(le).list.get(e);if(!i)return;const n=this._components.get(Ot),r=this.plane.clone();r.constant-=.01;const o=await i.getSection(r,s),{buffer:l,index:h,fillsIndices:c}=o,u=this.getStyleMeshes(e,t),{edges:f,fills:d}=u,g=new Lt(l,3,!1);if(f){g.setUsage(ml);const m=new st;m.setAttribute("position",g),m.setDrawRange(0,h);const v=new Zo(m);f.geometry.fromLineSegments(v),n.destroy(v)}d&&(d.geometry.attributes.position=g,d.geometry.setIndex(c))}async create(e,t){if(!this._components.get(Yn).styles.get(e))throw new Error(`ClipEdges: "${e}" style not found.`);const s=this._components.get(mc);let i=null;t&&(i=await s.find(t));const n=this._components.get(le);if(i)for(const[r,o]of Object.entries(i))n.list.get(r)&&this.updateMeshes(r,e,[...o]);else for(const[r]of n.list)this.updateMeshes(r,e)}async update(e){for(const[t,{data:s,style:i}]of this.items)e&&!e.includes(t)||this.create(i,s)}dispose(){this._components.get(Ot).destroy(this.three,!0,!0),this._modelStyleGeometries.clear()}}const Za=class pr extends Ee{constructor(e){super(e),T(this,"onDisposed",new Q),T(this,"enabled",!0),T(this,"world",null),T(this,"styles",new Me),T(this,"list",new Me),T(this,"_visible",!0),this.components.list.set(pr.uuid,this),this.setEvents()}get visible(){return this._visible}set visible(e){this._visible=e;for(const[,t]of this.list)t.visible=e}setEvents(){this.list.onBeforeDelete.add(({value:e})=>e.dispose())}setEdgesConfig(e,t){if(e.world=(t==null?void 0:t.world)??this.world,t!=null&&t.items)for(const[i,n]of Object.entries(t.items))e.items.set(i,n);const s=(t==null?void 0:t.id)??Ze.create();this.list.set(s,e)}create(e,t){const s=new Cu(this.components,e);return t&&this.setEdgesConfig(s,t),s}createFromView(e,t){const s=this.create(e.plane,t);return((t==null?void 0:t.link)===void 0||t.link)&&(e.onDisposed.add(()=>s.dispose()),e.onUpdated.add(()=>s.update()),e.onStateChanged.add(()=>s.visible=e.open)),s}createFromClipping(e,t){const s=this.components.get(Zt).list.get(e);if(!s)throw new Error(`ClipStyler: Clipping plane with ID ${e} not found.`);const i=this.create(s.three,t);return i.visible=!0,((t==null?void 0:t.link)===void 0||t.link)&&(s.onDraggingEnded.add(()=>i.update()),s.onDisposed.add(()=>i.dispose())),i}dispose(){this.styles.clear(),this.list.clear(),this.onDisposed.trigger(pr.uuid)}};T(Za,"uuid","24dfc306-a3c4-410f-8071-babc4afa5e4d");let Yn=Za;const Ya=class fr extends Ee{constructor(e){super(e),T(this,"onDisposed",new Q),T(this,"onBeforeUpdate",new Q),T(this,"onAfterUpdate",new Q),T(this,"onSetup",new Q),T(this,"isSetup",!1),T(this,"enabled",!0),T(this,"events",{}),T(this,"multiple","ctrlKey"),T(this,"zoomFactor",1.5),T(this,"zoomToSelection",!1),T(this,"backupColor",null),T(this,"selection",{}),T(this,"config",{selectName:"select",selectionColor:null,autoHighlightOnClick:!0,world:null,selectEnabled:!0,selectMaterialDefinition:{color:new fe("#BCF124"),renderedFaces:Xo.ONE,opacity:1,transparent:!1}}),T(this,"styles",new Me),T(this,"autoToggle",new Set),T(this,"mouseDownPosition",{x:0,y:0}),T(this,"mouseMoveThreshold",5),T(this,"selectable",{}),T(this,"eventManager",new hc),T(this,"_mouseState",{down:!1,moved:!1}),T(this,"_fromHighlight",!1),T(this,"restorePreviousColors",(t=this.selection.select)=>{for(const[s,i]of Object.entries(this.selection))if(!(s===this.config.selectName||!this.styles.get(s)))for(const[n,r]of Object.entries(t)){const o=i[n];if(!o)continue;const l=[...r].filter(h=>o.has(h));l.length!==0&&new Set(l)}}),T(this,"onMouseDown",t=>{this.enabled&&(this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.mouseDownPosition={x:t.clientX,y:t.clientY},this._mouseState.down=!0)}),T(this,"debounceTimeout",null),T(this,"onMouseUp",async t=>{if(!this.enabled)return;const{world:s,autoHighlightOnClick:i,selectEnabled:n}=this.config;if(!s)throw new Error("No world found!");if(!s.renderer)throw new Error("This world doesn't have a renderer!");if(t.target===s.renderer.three.domElement){if(this._mouseState.down=!1,this._mouseState.moved||t.button!==0){this._mouseState.moved=!1;return}if(this._mouseState.moved=!1,i&&n){const r=this.multiple==="none"?!0:!t[this.multiple];await this.highlight(this.config.selectName,r,this.zoomToSelection)}}}),T(this,"onMouseMove",async t=>{if(!this.enabled)return;const s=t.clientX-this.mouseDownPosition.x,i=t.clientY-this.mouseDownPosition.y,n=Math.sqrt(s*s+i*i);this._mouseState.moved||n>this.mouseMoveThreshold&&(this._mouseState.moved=this._mouseState.down)}),this.components.add(fr.uuid,this),this.eventManager.list.add(this.onSetup),this.eventManager.list.add(this.onDisposed),this.setStyleEvents()}setStyleEvents(){this.styles.onBeforeDelete.add(async({key:e})=>{if(await this.clear(e),delete this.selection[e],!(e in this.events))return;const{onClear:t,onHighlight:s,onBeforeHighlight:i}=this.events[e];this.eventManager.list.delete(t),this.eventManager.list.delete(s),this.eventManager.list.delete(i),delete this.events[e]}),this.styles.onItemSet.add(({key:e})=>{this.selection[e]={};const t=new Q,s=new Q,i=new Q;this.events[e]={onHighlight:t,onClear:i,onBeforeHighlight:s},this.eventManager.add([i,t,s])})}async dispose(){this.setupEvents(!1),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.selection={},this.styles.clear(),this.onDisposed.trigger(fr.uuid),this.eventManager.reset(),this.isSetup=!1}add(e){if(console.warn("highlighter.add() is deprecated, use highlighter.styles.set() instead"),typeof e=="string")this.styles.set(e,null);else{const{customId:t}=e;this.styles.set(t,e)}}async remove(e){console.warn("highlighter.remove() is deprecated, use highlighter.styles.delete() instead"),this.styles.delete(e)}async highlight(e,t=!0,s=this.zoomToSelection,i=null){if(!this.enabled)return;if(!this.config.world)throw new Error("No world found in config!");const n=this.config.world;if(!this.selection[e])throw new Error(`Selection ${e} does not exist.`);const r=await this.components.get(it).get(n).castRay();if(!r||r.localId===void 0||r.localId===null){t&&this.clear(e);return}const{localId:o,fragments:{modelId:l}}=r,h={[l]:new Set([o])};await this.highlightByID(e,h,t,s,i,!0)}async highlightByID(e,t,s=!0,i=this.zoomToSelection,n=null,r=!1){var o;if(!this.enabled)return;this._fromHighlight=!0,this.events[e].onBeforeHighlight.trigger(this.selection[e]),s&&await this.clear(e);let l=ge.clone(t);const h=this.components.get(le);for(const[u,f]of Object.entries(t)){const d=h.list.get(u);d!=null&&d.isDeltaModel&&d.parentModelId&&ge.add(l,{[d.parentModelId]:f})}const c=(o=this.selectable)==null?void 0:o[e];if(c){const u=ge.clone(c);for(const[f,d]of Object.entries(u)){const g=h.list.get(f);g!=null&&g.deltaModelId&&ge.add(u,{[g.deltaModelId]:d})}l=ge.intersect([l,u])}if(n){const u=ge.clone(n);for(const[f,d]of Object.entries(u)){const g=h.list.get(f);g!=null&&g.deltaModelId&&ge.add(u,{[g.deltaModelId]:d})}l=ge.intersect([l,n])}if(r&&this.autoToggle.has(e)){const u={};let f=!1;for(const d in l){const g=this.selection[e][d];if(!g)continue;const m=l[d];for(const v of m)if(g.has(v)){g.delete(v);let p=u[d];p||(p=new Set,u[d]=p),p.add(v),f=!0}else g.add(v);l[d]=g}f&&(this.events[e].onClear.trigger(u),e===this.config.selectName&&this.restorePreviousColors(u))}this.updateStyleMap(e,l),this.events[e].onHighlight.trigger(this.selection[e]),this._fromHighlight=!1,await this.updateColors(),i&&await this.zoomSelection(l)}async updateColors(){const e=this.components.get(le),t=[e.resetHighlight()];for(const[s,i]of Object.entries(this.selection)){const n=this.styles.get(s);if(!n)continue;const r=s==="select"||!this.styles.get(this.config.selectName)?i:this.getMapWithoutSelection(s);r&&t.push(e.highlight({...n,customId:s},r))}t.push(e.core.update(!0)),await Promise.allSettled(t)}updateStyleMap(e,t){const s=this.selection[e];for(const i in t){let n=s[i];n||(n=new Set,s[i]=n);const r=t[i];for(const o of r)n.add(o)}if(e!==this.config.selectName)for(const[i,n]of Object.entries(this.selection)){if(i===this.config.selectName||i===e)continue;const r=n;for(const[o,l]of Object.entries(s)){const h=r[o];if(h)for(const c of l)h.delete(c)}}}getMapWithoutSelection(e,t){const s=this.selection[e];if(!s)throw new Error(`Style ${e} does not exist.`);const i=this.selection[this.config.selectName]??{},n={};for(const r in s){const o=s[r],l=e===this.config.selectName?new Set:i[r]??new Set,h=Array.from(o).filter(c=>{var u;return!l.has(c)&&(!t||((u=t[r])==null?void 0:u.has(c)))});h.length>0&&(n[r]=new Set(h))}return Object.keys(n).length>0?n:null}async clear(e,t){const s=e?[e]:Object.keys(this.selection),i=t??void 0;for(const n of s){const r=this.selection[n]??{},o=i??r;n===this.config.selectName&&this.restorePreviousColors();const l={};for(const[h,c]of Object.entries(o)){const u=r[h];if(u)for(const f of c){if(!u.delete(f))continue;let d=l[h];d||(d=new Set,l[h]=d),d.add(f)}}Object.keys(l).length>0&&this.events[n].onClear.trigger(l),this.selection[n]={}}this._fromHighlight||await this.updateColors()}setup(e){if(this.isSetup)return;this.config={...this.config,...e};const{selectName:t,selectionColor:s,selectMaterialDefinition:i}=this.config;this.config.world&&this.components.get(it).get(this.config.world),i?(s&&(console.warn("highlighter.config.selectionColor is deprecated, use selectMaterialDefinition instead"),i.color=s),this.styles.set(t,i)):this.styles.set(t,null),this.autoToggle.add(this.config.selectName),this.setupEvents(!0),this.enabled=!0,this.isSetup=!0,this.onSetup.trigger(this)}async zoomSelection(e){if(!this.config.world)throw new Error("No world found in config!");const t=this.config.world;let s=!1;for(const m in e)if(e[m].size>0){s=!0;break}if(!s||!t.camera.hasCameraControls())return;const i=await this.components.get(le).getBBoxes(e),n=new ds,r=new Le;for(const m of i)r.union(m);r.getBoundingSphere(n);const o=1/0,l=-1/0,{x:h,y:c,z:u}=n.center,f=n.radius===o||h===o||c===o||u===o,d=n.radius===l||h===l||c===l||u===l,g=n.radius===0;f||d||g||(n.radius*=this.zoomFactor,await t.camera.controls.fitToSphere(n,!0))}setupEvents(e){if(!this.config.world){console.log("No world found while setting up events!");return}if(this.config.world.isDisposing)return;if(!this.config.world.renderer)throw new Error("The given world doesn't have a renderer!");const t=this.config.world.renderer.three.domElement;t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("mouseup",this.onMouseUp),t.removeEventListener("pointermove",this.onMouseMove),e&&(t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("mouseup",this.onMouseUp),t.addEventListener("pointermove",this.onMouseMove))}};T(Ya,"uuid","cb8a76f2-654a-4b50-80c6-66fd83cafd77");let qn=Ya;const qa=class Ga extends Ee{constructor(){super(...arguments),T(this,"enabled",!0),T(this,"geometries",new Me),T(this,"onDisposed",new Q)}async get(e,t){const{material:s,applyTransformation:i}={applyTransformation:!0,...t},n=this.components.get(le),r=new Me;for(const[o,l]of Object.entries(e)){const h=n.list.get(o);if(!h)continue;const c=this.getModelMeshes(o);for(const u of l){let f=r.get(o);f||(f=new Me,r.set(o,f));let d=c.get(u);if(d&&d.length>0){const v=[];for(const[p,{geometry:_,transform:b}]of d.entries()){const E=await this.createMesh(h,_,b,{material:s,applyTransformation:i});v.push(E)}f.set(u,v);continue}else d=[],c.set(u,d);const[g]=await h.getItemsGeometry([u]);if(!g)continue;const m=[];for(const v of g){const p=this.createGeometry(v);if(!p)continue;const{geometry:_,transform:b}=p;d.push(p);const E=await this.createMesh(h,_,b,{material:s,applyTransformation:i});m.push(E)}f.set(u,m)}}return r}getModelMeshes(e){let t=this.geometries.get(e);return t||(t=new Me,this.geometries.set(e,t)),t}remove(e=[...this.geometries.keys()]){for(const t of e){const s=this.geometries.get(t);if(s){for(const[i,n]of s)for(const{geometry:r}of n)r.dispose();this.geometries.delete(t)}}}dispose(e=!0){this.remove(),e&&this.geometries.dispose(),this.onDisposed.trigger(Ga.uuid)}getMeshesFromResult(e){const t=[];for(const s of e.values())for(const i of s.values())t.push(...i);return t}createGeometry(e){const{positions:t,indices:s,normals:i,transform:n}=e;if(!(t&&s&&i))return null;const r=new st;return r.setAttribute("position",new Lt(t,3)),r.setAttribute("normal",new Lt(i,3,!0)),r.setIndex(new Lt(s,1)),{geometry:r,transform:n}}async createMesh(e,t,s,i){const{material:n,applyTransformation:r}={applyTransformation:!0,...i},o=new ie(t,n);return o.applyMatrix4(s),o.applyMatrix4(e.object.matrixWorld),r||(o.position.set(0,0,0),o.rotation.set(0,0,0)),o}};T(qa,"uuid","ab45d0a7-feea-4afc-927c-80832dae76dd");let cn=qa;const Au=class mr extends Ee{constructor(e){super(e),T(this,"_world"),T(this,"styles",new Ve),T(this,"outlinePositions",!1),T(this,"_mesh",null),T(this,"onDisposed",new Q),T(this,"_meshes",[]),T(this,"_map",{}),T(this,"_activeStyles",new Set),T(this,"_styleCallbacks",{}),e.add(mr.uuid,this),this.setupEvents()}set world(e){this._world=e,e&&this.getRenderer().postproduction.excludedObjectsPass.addExcludedMaterial(this._points.material)}get world(){return this._world}get _points(){return this._mesh||(this._mesh=new cl(new st,new dl({size:10,sizeAttenuation:!1,depthTest:!1}))),this._mesh}get enabled(){return!this.world||this.world.isDisposing?!1:this.getRenderer().postproduction.outlinesEnabled}set enabled(e){if(!this.world||this.world.isDisposing)return;const t=this.getRenderer();t.postproduction.outlinesEnabled=e,this.outlinePositions&&(this._points.material.color=this.color,this.world.scene.three.add(this._points))}get color(){return this.getRenderer().postproduction.outlinePass.outlineColor}set color(e){this.getRenderer().postproduction.outlinePass.outlineColor.copy(e),this._points.material.color.copy(e)}get thickness(){return this.getRenderer().postproduction.outlinePass.thickness}set thickness(e){this.getRenderer().postproduction.outlinePass.thickness=e}get fillColor(){return this.getRenderer().postproduction.outlinePass.fillColor}set fillColor(e){this.getRenderer().postproduction.outlinePass.fillColor.copy(e)}get fillOpacity(){return this.getRenderer().postproduction.outlinePass.fillOpacity}set fillOpacity(e){const t=this.getRenderer().postproduction;t.outlinePass.fillOpacity=e}setupEvents(){const e=this.components.get(qn);this.styles.guard=t=>e.styles.has(t),this.styles.onItemAdded.add(t=>{const s=this.components.get(qn),i=()=>{this._activeStyles.add(t),this.updateFromStyles()},n=()=>{this._activeStyles.delete(t),this.updateFromStyles()};this._styleCallbacks[t]={onHighlight:i,onClear:n},s.events[t].onHighlight.add(i),s.events[t].onClear.add(n)}),this.styles.onBeforeDelete.add(t=>{const{onHighlight:s,onClear:i}=this._styleCallbacks[t];e.events[t].onHighlight.remove(s),e.events[t].onClear.remove(i),this._activeStyles.delete(t),delete this._styleCallbacks[t]}),e.styles.onItemDeleted.add(t=>this.styles.delete(t))}async updateFromStyles(){const e=this.components.get(qn),t=[];for(const i of this._activeStyles){const n=e.selection[i];n&&t.push(n)}const s=ge.join(t);this._map=s,await this.update()}async update(e=this._map){if(e===this._map&&this.cleanMeshes(),this.outlinePositions&&this.updatePoints(),Object.keys(e).length===0)return;const t=this.components.get(le),s=this.getRenderer().postproduction.outlinePass,i=await this.components.get(cn).get(e);for(const n of Object.keys(e))if(t.list.get(n))for(const[r,o]of i.entries()){const l=[...o.values()].flat();for(const h of l)this._meshes.push(h),s.scene.add(h)}}async addItems(e){ge.add(this._map,e),await this.update(e)}async removeItems(e){ge.remove(this._map,e),await this.update()}clean(){this._map={},this._activeStyles.clear(),this.cleanMeshes(),this._mesh&&this.components.get(Ot).destroy(this._mesh,!0,!0),this._mesh=null}dispose(){this.styles.clear(),this.clean(),this.onDisposed.trigger(mr.uuid)}cleanMeshes(){for(const e of this._meshes)e.removeFromParent();this._meshes=[]}async updatePoints(){let e=0;for(const[s,i]of Object.entries(this._map))e+=i.size;this._points.geometry.setAttribute("position",new qt(new Float32Array(e*3),3));const t=await this.components.get(le).getPositions(this._map);for(let s=0;s<t.length;s++){const{x:i,y:n,z:r}=t[s];this._points.geometry.attributes.position.array[s*3]=i,this._points.geometry.attributes.position.array[s*3+1]=n,this._points.geometry.attributes.position.array[s*3+2]=r}this._points.geometry.attributes.position.needsUpdate=!0}getRenderer(){if(!this.world)throw new Error("You must set a world to use the outliner!");const e=this.world.renderer;if(!e.postproduction)throw new Error("The world given to the outliner must use the postproduction renderer.");return e}};T(Au,"uuid","2fd3bcc5-b3b6-4ded-9f64-f47a02854a10");const Qa=class Ka extends Ee{constructor(e){super(e),T(this,"HOVERER_OPACITY_KEY","_maxHoverOpacity"),T(this,"_hoverTimeout",null),T(this,"_meshes",new Ve),T(this,"_localId",null),T(this,"_fadeAnimation",null),T(this,"_world",null),T(this,"_enabled",!1),T(this,"_material",new us({color:16777215,transparent:!0,opacity:.5,depthTest:!1,userData:{[this.HOVERER_OPACITY_KEY]:.5}})),T(this,"onDisposed",new Q),T(this,"duration",200),T(this,"animation",!0),T(this,"mouseStopTimeout",null),T(this,"onMouseMove",()=>{this.mouseStopTimeout!==null&&clearTimeout(this.mouseStopTimeout),this.mouseStopTimeout=window.setTimeout(()=>this.hover(),50)}),T(this,"onMouseLeave",()=>{this._meshes.clear()}),T(this,"animate",()=>{if(!(this._fadeAnimation&&this.animation&&this.material.transparent))return;const{startTime:t,duration:s,fadeIn:i}=this._fadeAnimation,n=Date.now()-t,r=Math.min(n/s,1),o=i?r:1-r,l=this.material.userData[this.HOVERER_OPACITY_KEY],h=o*(l!==void 0?l:1);this.material.opacity=h,r<1?requestAnimationFrame(this.animate):(i||this._meshes.clear(),this._fadeAnimation=null)}),e.add(Ka.uuid,this),this._meshes.onBeforeDelete.add(t=>{t.removeFromParent(),t.geometry.dispose()}),this._meshes.onItemAdded.add(t=>{this.world&&this.world.scene.three.add(t)}),this._meshes.onCleared.add(()=>{this._localId=null,this._hoverTimeout&&(clearTimeout(this._hoverTimeout),this._hoverTimeout=null)})}set world(e){if(e){this.components.get(it).get(e),this._world=e,this.setupEvents(!0);for(const t of this._meshes)e.scene.three.add(t)}else{this.setupEvents(!1),this._world=null;for(const t of this._meshes)t.removeFromParent()}}get world(){return this._world}set enabled(e){this.setupEvents(e),this._enabled=e}get enabled(){return this._enabled}set material(e){e.userData[this.HOVERER_OPACITY_KEY]=e.opacity;for(const t of this._meshes)t.material=e;this._material.dispose(),this._material=e}get material(){return this._material}setupEvents(e){if(!this.world||this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The given world doesn't have a renderer!");const t=this.world.renderer.three.domElement;t.removeEventListener("mousemove",this.onMouseMove),t.removeEventListener("mouseleave",this.onMouseMove),e&&(t.addEventListener("mousemove",this.onMouseMove),t.addEventListener("mouseleave",this.onMouseLeave))}async hover(){if(!this.enabled||!this.world)return;const e=await this.components.get(it).get(this.world).castRay();if(!e){this._meshes.clear();return}const{fragments:t,localId:s}=e;this._localId!==s&&(this._meshes.clear(),this._localId=s,this._hoverTimeout=window.setTimeout(async()=>{const i={[t.modelId]:new Set([s])},n=await this.components.get(cn).get(i);for(const[r,o]of n.entries()){const l=[...o.values()].flat();for(const h of l)h.material=this.material,this._meshes.add(h)}this._fadeAnimation={startTime:Date.now(),duration:this.duration,fadeIn:!0},this.animate()},100))}clear(){this._meshes.clear()}dispose(){this._enabled=!1,this._meshes.clear(),this._fadeAnimation=null,this._hoverTimeout=null,this.onDisposed.trigger()}};T(Qa,"uuid","26fbd870-b1b2-4b71-b747-4063d484de1b");let Pu=Qa;class Ou{constructor(e){T(this,"alignments",[]),T(this,"enabled",!0),T(this,"world",null),T(this,"_raycastable",[]),T(this,"_components"),this._components=e}update(){this.dispose();for(const e of this.alignments)for(const t of e.children){const s=t;s.updateWorldMatrix(!0,!0);for(const i of s.children){const n=i;if(n.isLine2&&n.userData.points){const r=new st,o=new Ct;o.geometry.setIndex(n.geometry.index);const l=new Float32Array(n.userData.points),h=new Lt(l,3);r.setAttribute("position",h),o.geometry=r,o.userData.curve=n,o.applyMatrix4(n.matrixWorld),o.updateMatrixWorld(),this._raycastable.push(o)}}}}dispose(){for(const e of this._raycastable)e.geometry.dispose(),e.geometry=void 0;this._raycastable=[]}castRay(){if(!this.enabled||!this.world)return null;const e=this._components.get(it).get(this.world).castRayToObjects(this._raycastable);if(!e)return null;const t=e.object,s=t.geometry,i=e.index,n=s.attributes.position.array[i*3],r=s.attributes.position.array[i*3+1],o=s.attributes.position.array[i*3+2],l=s.attributes.position.array[i*3+3],h=s.attributes.position.array[i*3+4],c=s.attributes.position.array[i*3+5],u=new N(l-n,h-r,c-o).normalize();return{point:e.point,normal:u,curve:t.userData.curve,alignment:t.userData.curve.parent}}}class Gn{static alignmentPercentageToPoint(e,t){const s=new N,i=new N,n=this.alignmentLength(e),r=t*n;let o=0;if(e.updateWorldMatrix(!0,!0),t===1)for(let l=e.children.length-1;l>=0;l--){const h=e.children[l],c=h.userData.points;if(!c)continue;const u=new N(c[c.length-3],c[c.length-2],c[c.length-1]);return u.applyMatrix4(h.matrixWorld),{normal:new N,point:u,curve:h,alignment:e}}for(const l of e.children){const h=l.userData.points;if(h)for(let c=0;c<h.length-3;c+=3){const u=s.set(h[c],h[c+1],h[c+2]),f=i.set(h[c+3],h[c+4],h[c+5]),d=u.distanceTo(f);if(o+d>=r){const g=r-o,m=f.clone().sub(u).normalize(),v=m.clone().multiplyScalar(g);return u.add(v),u.applyMatrix4(l.matrixWorld),{normal:m,point:u,curve:l,alignment:e}}o+=d}}return null}static curvePercentageToPoint(e,t,s){const i=new N,n=new N,r=this.curveLength(t),o=s*r;let l=0;const h=t.userData.points;if(!h)throw new Error("No points found in curve");for(let c=0;c<h.length-3;c+=3){const u=i.set(h[c],h[c+1],h[c+2]),f=n.set(h[c+3],h[c+4],h[c+5]),d=u.distanceTo(f);if(l+d>=o){const g=o-l,m=f.clone().sub(u).normalize(),v=m.clone().multiplyScalar(g);return u.add(v),{normal:m,point:u,curve:t,alignment:e}}l+=d}return null}static alignmentLength(e){let t=0;if(e.userData.length!==void 0)return e.userData.length;for(const s of e.children)"isLine2"in s&&(t+=this.curveLength(s));return e.userData.length=t,t}static curveLength(e){let t=0;if(e.userData.length!==void 0)return e.userData.length;const s=new N,i=new N,n=e.userData.points;if(!n)throw new Error("No points found in curve");for(let r=0;r<n.length-2-3;r+=3){const o=s.set(n[r],n[r+1],n[r+2]),l=i.set(n[r+3],n[r+4],n[r+5]);t+=o.distanceTo(l)}return e.userData.length=t,t}static curvePointToAlignmentPercentage(e,t,s){const i=new N,n=new N,r=this.alignmentLength(e);let o=0;e.updateWorldMatrix(!0,!0);for(const l of e.children){const h=l.userData.points;if(h)for(let c=0;c<h.length-3;c+=3){const u=i.set(h[c],h[c+1],h[c+2]),f=n.set(h[c+3],h[c+4],h[c+5]);u.applyMatrix4(l.matrixWorld),f.applyMatrix4(l.matrixWorld);const d=u.distanceTo(f),g=u.distanceTo(t)<.001,m=f.distanceTo(t)<.001,v=this.isPointbetweenTwoOthers(u,f,t);if(l===s&&(g||m||v)){const p=u.distanceTo(t);return(o+p)/r}o+=d}}return null}static isPointbetweenTwoOthers(e,t,s){const i=new N;i.subVectors(t,e).normalize();const n=new N;n.subVectors(s,e).normalize();const r=new N;r.subVectors(s,t).normalize();const o=1-.0016;return i.dot(n)>o&&i.dot(r)<-.9984}}class Du{constructor(e,t){T(this,"onDisposed",new Q),T(this,"alignments",[]),T(this,"components"),T(this,"onMarkerChange",new Q),T(this,"enabled",!0),T(this,"highlightMaterial"),T(this,"increments",20),T(this,"screenDistanceLimit",.1),T(this,"fadeInTime",500),T(this,"_mouseMarkers"),T(this,"_highlighted",new Set),T(this,"_stationPoints",new Map),T(this,"_originalHighlightMaterialId","originalHighlightMaterial"),T(this,"_world",null),T(this,"_raycaster"),T(this,"_stationLabelColor",new fe(16777215)),T(this,"_stationLabelBackgroundColor",new fe(8014801)),T(this,"_stationPointerColor",new fe(16777215)),T(this,"_stationPointerBackgroundColor",new fe(4803766)),T(this,"_pointerDown",performance.now()),T(this,"_pointerDownTime",150),T(this,"onPointerDown",()=>{this._pointerDown=performance.now()}),T(this,"onPointerUp",()=>{if(performance.now()-this._pointerDown>this._pointerDownTime)return;const s=this.setMarkerToMouse("select");s&&this.onMarkerChange.trigger(s)}),T(this,"onMouseMove",()=>{this.setMarkerToMouse("hover")}),this.components=e,this.highlightMaterial=t,this._raycaster=new Ou(e),this._raycaster.alignments=this.alignments}get world(){return this._world}set world(e){var t,s,i,n;if(e===this._world||(this._world&&this.setupEvents(!1),this._world=e,(t=this._mouseMarkers)==null||t.hover.removeFromParent(),(s=this._mouseMarkers)==null||s.select.removeFromParent(),(i=this._mouseMarkers)==null||i.hover.element.remove(),(n=this._mouseMarkers)==null||n.select.element.remove(),!e))return;this._raycaster.world=e;const r=this.newCivilLabel(0,"stationPointer");e.scene.three.add(r),r.visible=!1,r.element.style.transition="";const o=this.newCivilLabel(0,"stationPointer");o.element.style.transition="",o.element.style.opacity="0.5",e.scene.three.add(o),o.visible=!1,this._mouseMarkers={select:r,hover:o},this.setupEvents(!0)}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(e){this._stationLabelColor=e;const t=`#${e.getHexString()}`;for(const[,{labels:s}]of this._stationPoints){const i=[...s.children];for(const n of i){const r=this.getLabel(n);r.style.color=t;const o=this.getPoint(n);o.style.backgroundColor=t}}}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(e){this._stationLabelBackgroundColor=e;const t=`#${e.getHexString()}`;for(const[,{labels:s}]of this._stationPoints){const i=[...s.children];for(const n of i){const r=this.getLabel(n);r.style.backgroundColor=t;const o=this.getPoint(n);o.style.border=`2px solid ${t}`}}}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(e){this._stationPointerColor=e;const t=`#${e.getHexString()}`;if(this._mouseMarkers){const s=this._mouseMarkers.select,i=this.getLabel(s);i.style.color=t;const n=this.getPoint(s);n.style.backgroundColor=t}}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(e){this._stationPointerBackgroundColor=e;const t=`#${e.getHexString()}`;if(this._mouseMarkers){const s=this._mouseMarkers.select,i=this.getLabel(s);i.style.backgroundColor=t;const n=this.getPoint(s);n.style.border=`2px solid ${t}`}}dispose(){var e,t,s,i;this.clearHighlight(),this.clearStations(),this.alignments=[],(e=this._mouseMarkers)==null||e.hover.removeFromParent(),(t=this._mouseMarkers)==null||t.select.removeFromParent(),(s=this._mouseMarkers)==null||s.hover.element.remove(),(i=this._mouseMarkers)==null||i.select.element.remove(),this._raycaster.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){this._raycaster.update()}setMarkerAtPoint(e,t){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");this.updateMarkerValue(e,t),this._mouseMarkers[t].visible=!0,this._mouseMarkers[t].position.copy(e.point)}highlight(e,t=!0){t&&this.clearHighlight(this._highlighted);for(const s of e.children)"isLineSegments2"in s&&"material"in s&&(s.userData[this._originalHighlightMaterialId]=s.material,s.material=this.highlightMaterial);this._highlighted.add(e)}clearHighlight(e=this._highlighted){for(const t of e)for(const s of t.children)"isLineSegments2"in s&&"material"in s&&(s.material=s.userData[this._originalHighlightMaterialId],delete s.userData[this._originalHighlightMaterialId]);this._highlighted.clear()}createStations(e){if(!this.world||this._stationPoints.has(e.uuid))return;const t=new pi;this.world.scene.three.add(t),this._stationPoints.set(e.uuid,{alignment:e,labels:t})}clearStations(e=this._stationPoints.keys()){for(const t of e){const s=this._stationPoints.get(t);s&&(this.clearLabels(s.labels),this._stationPoints.delete(t))}}updateStations(){if(!this.world)throw new Error("No world found!");if(!this.world.renderer)throw new Error("No renderer found!");const e=this.world.camera.three,t=this.world.renderer.three,s=new gl,i=t.clippingPlanes,n=new N,r=new N;let o=!0;const l=new N;for(const[,{alignment:h,labels:c}]of this._stationPoints){this.clearLabels(c),h.updateWorldMatrix(!0,!0);const u=h.userData.initialStation;let f=u||0;const d=f%this.increments;let g=u+this.increments-d;for(const m of h.children){if(!("isLine2"in m))continue;const v=m;if(v.geometry.boundingBox||v.geometry.computeBoundingBox(),s.setFromProjectionMatrix(new Te().multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse)),!s.intersectsBox(v.geometry.boundingBox)){const k=Gn.curveLength(m);f+=k;const V=f%this.increments;g=f+this.increments-V;continue}const p=m.userData.points,_=p[0],b=p[1],E=p[2];if(l.set(_,b,E),l.applyMatrix4(m.matrixWorld),!this.isLabelClipped(i,l)){if(o){o=!1,n.set(l.x,l.y,l.z),n.project(e),n.z=0;const k=this.newCivilLabel(f,"stationLabel");k.position.set(l.x,l.y,l.z),c.children.push(k)}else if(r.set(l.x,l.y,l.z),r.project(e),r.z=0,n.distanceTo(r)>this.screenDistanceLimit){const k=this.newCivilLabel(f,"stationLabel");k.position.set(l.x,l.y,l.z),c.children.push(k),n.copy(r)}}const S=new N,A=new N;for(let k=0;k<p.length-3;k+=3){S.set(p[k],p[k+1],p[k+2]),A.set(p[k+3],p[k+4],p[k+5]);const V=S.distanceTo(A),C=f+V,z=A.clone().sub(S).normalize();for(;C>g;){const w=g-f,B=z.clone();B.multiplyScalar(w);const{x:G,y:X,z:te}=S.clone().add(B);if(l.set(G,X,te),l.applyMatrix4(m.matrixWorld),!this.isLabelClipped(i,l)&&s.containsPoint(l)&&(r.set(l.x,l.y,l.z),r.project(e),r.z=0,n.distanceTo(r)>this.screenDistanceLimit)){const W=this.newCivilLabel(g,"stationLabel");W.position.set(l.x,l.y,l.z),c.children.push(W),n.copy(r)}g+=this.increments}f+=V}const P=p[p.length-3],D=p[p.length-2],I=p[p.length-1];if(l.set(P,D,I),l.applyMatrix4(m.matrixWorld),!(this.isLabelClipped(i,l)||!s.containsPoint(l))&&(r.set(l.x,l.y,l.z),r.project(e),r.z=0,n.distanceTo(r)>this.screenDistanceLimit)){const k=this.newCivilLabel(f,"stationLabel");k.position.set(l.x,l.y,l.z),c.children.push(k),n.copy(r)}}}}getCursorValue(){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");return this._mouseMarkers.select.element.children[0].children[0].innerText}setCursorValue(e,t){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");const s=this._mouseMarkers[t].element.children[0].children[0];s.innerText=e}isLabelClipped(e,t){for(const s of e)if(!(s.distanceToPoint(t)>0))return!0;return!1}clearLabels(e){const t=[...e.children];for(const s of t)s.element.style.opacity="0";setTimeout(()=>{for(const s of t)s.removeFromParent(),s.element.remove(),s.visible=!1},this.fadeInTime)}newCivilLabel(e,t){const s=document.createElement("div"),i=t==="stationLabel"?this.stationLabelColor:this.stationPointerColor,n=t==="stationLabel"?this.stationLabelBackgroundColor:this.stationPointerBackgroundColor,r=document.createElement("div");r.style.width="4px",r.style.height="4px",r.style.borderRadius="50%",r.style.backgroundColor=`#${i.getHexString()}`,r.style.border=`2px solid #${n.getHexString()}`,r.style.display="flex",r.style.justifyContent="center";const o=this.getFormattedStation(e),l=document.createElement("div");l.innerText=o,l.style.backgroundColor=`#${n.getHexString()}`,l.style.color=`#${i.getHexString()}`,l.style.padding="0.3rem",l.style.position="absolute",l.style.bottom="1rem",l.style.borderRadius="6px",l.style.boxShadow="rgba(0, 0, 0, 0.6) 0px 4px 6px",r.appendChild(l);const h=new ja(s);return s.appendChild(r),t==="stationLabel"&&(s.style.transition=`opacity ${this.fadeInTime}ms ease-in-out`,s.style.opacity="0",setTimeout(()=>{s.style.opacity="1"})),h}setupEvents(e){if(!this.world)throw new Error("No world found!");if(this.world.isDisposing||!this.world.renderer)return;const t=this.world.renderer.three.domElement,s=this.components.get(it).get(this.world);s.three.params.Line||(s.three.params.Line={threshold:10}),t.removeEventListener("pointerdown",this.onPointerDown),t.removeEventListener("pointerup",this.onPointerUp),t.removeEventListener("pointermove",this.onMouseMove),e&&(t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointerup",this.onPointerUp),t.addEventListener("pointermove",this.onMouseMove))}setMarkerToMouse(e){if(!this.enabled||!this._mouseMarkers)return null;if(!this.world)throw new Error("No world found!");const t=this._raycaster.castRay();if(!t)return this._mouseMarkers[e].visible=!1,null;this._mouseMarkers[e].visible=!0;const s=t.point;return this._mouseMarkers[e].position.copy(s),this.updateMarkerValue(t,e),t}updateMarkerValue(e,t){if(!this._mouseMarkers)return;const{alignment:s,curve:i,point:n}=e,r=Gn.curvePointToAlignmentPercentage(s,n,i);if(r===null)throw new Error("Point is not on the curve");const o=r*Gn.alignmentLength(s)+s.userData.initialStation,l=this.getFormattedStation(o);this.setCursorValue(l,t)}getFormattedStation(e){const t=Math.floor(e/1e3),s=Math.round(e-t*1e3);return`${t}+${s}`}getLabel(e){return e.element.children[0].children[0]}getPoint(e){return e.element.children[0]}}const Mu=class Ja extends Ee{constructor(e){super(e),T(this,"onDisposed",new Q),T(this,"list",new Map),T(this,"enabled",!0),T(this,"highlightMaterial",new zr({color:8014801,linewidth:5,depthTest:!1})),T(this,"_increments",20),T(this,"_screenDistanceLimit",.1),T(this,"_fadeInTime",500),T(this,"_stationLabelColor",new fe(16777215)),T(this,"_stationLabelBackgroundColor",new fe(8014801)),T(this,"_stationPointerColor",new fe(16777215)),T(this,"_stationPointerBackgroundColor",new fe(4803766)),this.components.add(Ja.uuid,this)}get increments(){return this._increments}set increments(e){this._increments=e;for(const[,t]of this.list)t.increments=e}get screenDistanceLimit(){return this._screenDistanceLimit}set screenDistanceLimit(e){this._screenDistanceLimit=e;for(const[,t]of this.list)t.screenDistanceLimit=e}get fadeInTime(){return this._fadeInTime}set fadeInTime(e){this._fadeInTime=e;for(const[,t]of this.list)t.fadeInTime=e}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(e){this._stationLabelColor=e;for(const[,t]of this.list)t.stationLabelColor=e}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(e){this._stationLabelBackgroundColor=e;for(const[,t]of this.list)t.stationLabelBackgroundColor=e}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(e){this._stationPointerColor=e;for(const[,t]of this.list)t.stationPointerColor=e}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(e){this._stationPointerBackgroundColor=e;for(const[,t]of this.list)t.stationPointerBackgroundColor=e}create(e){const t=new Du(this.components,this.highlightMaterial);return this.list.set(e,t),t}delete(e){const t=this.list.get(e);t&&(t.dispose(),this.list.delete(e))}dispose(){for(const[,e]of this.list)e.dispose();this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){for(const[,e]of this.list)e.updateAlignments()}};T(Mu,"uuid","0a59c09e-2b49-474a-9320-99f51f40f182");const zu=class $a extends Ee{constructor(e){super(e),T(this,"enabled",!0),T(this,"onDisposed",new Q),T(this,"_world",null),T(this,"_flip",!1),T(this,"_plane"),T(this,"_point",new N),T(this,"_edgeMeshes",[]),T(this,"_sectionVisible",!1),T(this,"_sectionOffset",.1),T(this,"edgeMaterial",new zr({color:0,linewidth:5,depthTest:!1})),this.components.add($a.uuid,this)}get plane(){if(!this._plane)throw new Error("Plane is not set. You must give a world.");return this._plane}set plane(e){this._plane=e}get sectionVisible(){return this._sectionVisible}set sectionVisible(e){this._sectionVisible=e;for(const t of this._edgeMeshes)t.visible=e}get world(){return this._world}set world(e){var t;if(this._world=e,(t=this._plane)==null||t.dispose(),!e)return;const s=this.components.get(Zt),i=s.createFromNormalAndCoplanarPoint(e,new N(1,0,0),new N);this.plane=s.list.get(i),this.plane.visible=!1,this.plane.enabled=!1}get flip(){return this._flip}set flip(e){var t;if(e===this._flip)return;this._flip=e;const s=(t=this.plane)==null?void 0:t.normal.clone().multiplyScalar(-1);for(const i of this._edgeMeshes)i.position.add(s.clone().multiplyScalar(this._sectionOffset));this.plane.setFromNormalAndCoplanarPoint(s,this._point),this.plane.update()}dispose(){var e;this.clearMeshes(),(e=this.plane)==null||e.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}async set(e,t){this.flip&&t.multiplyScalar(-1),this.plane.setFromNormalAndCoplanarPoint(t,e),this._point.copy(e)}async update(){this.clearMeshes();const e=this.components.get(le);this.plane.update();const t=[];for(const[,s]of e.list)t.push(this.generateModelSection(s));await Promise.all(t)}async generateModelSection(e){if(!this.world)return;const t=this.plane.three.clone();t.constant-=.01;const{buffer:s}=await e.getSection(t),i=new st,n=new Lt(s,3,!1);i.setAttribute("position",n);const r=new Zo(i),o=new Mr;o.fromLineSegments(r);const l=new Xa(o,this.edgeMaterial);l.frustumCulled=!1,this.world.scene.three.add(l),this._edgeMeshes.push(l),l.renderOrder=3,r.geometry.dispose()}clearMeshes(){for(const e of this._edgeMeshes)e.removeFromParent(),e.geometry.dispose(),e.material=void 0;this._edgeMeshes=[]}};T(zu,"uuid","96b2c87e-d90b-4639-8257-8f01136fe324");const Os=class Ds{constructor(e){T(this,"onDisposed",new Q),T(this,"marker",null),T(this,"world",null),T(this,"_enabled",!1),T(this,"_components"),T(this,"_preview",document.createElement("div")),T(this,"_pointerVisible",!1),T(this,"_intersectionFound",!1),this._components=e;for(const t in Ds.baseSnappingStyle){const s=Ds.baseSnappingStyle[t];this._preview.style[t]=s}this._preview.style.zIndex="999",this._preview.style.pointerEvents="none",this._preview.style.position="fixed",this._preview.style.top="0",this._preview.style.left="0"}set enabled(e){this._enabled=e,this.marker&&(this.marker.visible=e),e&&this.get()}get enabled(){return this._enabled}dispose(){this.marker&&this.marker.dispose()}async get(e){const t=(e==null?void 0:e.world)??this.world;if(!t)throw new Error("GraphicVertexPicker: a world is need to get a casting result.");const s=await this._components.get(it).get(t).castRay({snappingClasses:e==null?void 0:e.snappingClasses});if(this._intersectionFound=!!s,s){const{point:i}=s;if(!this.marker){const n=document.createElement("div");this.marker=new ls(t,n)}if(this.marker.world!==t&&(this.marker.world=t,this.marker.three.removeFromParent(),t.scene.three.add(this.marker.three)),this.hidePointer(),this.marker.visible=!0,this.marker.three.position.copy(i),"snappingClass"in s&&typeof s.snappingClass=="number"&&(s.snappingClass===0||s.snappingClass===1||s.snappingClass===2)){const n=Ds.snappingStyles[s.snappingClass]??Ds.baseSnappingStyle;Object.assign(this.marker.three.element.style,n)}else Object.assign(this.marker.three.element.style,Ds.baseSnappingStyle)}else this.marker&&(this.marker.visible=!1);return s}updatePointer(){if(!this.world||!this.marker)return;if(!this._intersectionFound){this.hidePointer();return}this.showPointer(),this.marker.visible&&(this.marker.visible=!1);const e=this._components.get(it).get(this.world).mouse.rawPosition;this._preview.style.transform=`translate(-50%, -50%) translate(${e.x}px, ${e.y}px)`}showPointer(){var e;!this.world||this._pointerVisible||(this._pointerVisible=!0,(e=this.world.renderer.three.domElement.parentElement)==null||e.appendChild(this._preview))}hidePointer(){var e;!this.world||!this._pointerVisible||(this._pointerVisible=!1,(e=this.world.renderer.three.domElement.parentElement)==null||e.removeChild(this._preview))}};T(Os,"baseSnappingStyle",{height:"6px",width:"6px",borderRadius:"100%",borderWidth:"2px",borderColor:"rgb(122, 75, 209)",borderStyle:"solid",zIndex:"-20"}),T(Os,"snappingStyles",{[Is.FACE]:{...Os.baseSnappingStyle},[Is.POINT]:{...Os.baseSnappingStyle,borderColor:"#e25959",borderRadius:"0"},[Is.LINE]:{...Os.baseSnappingStyle,borderColor:"#2d2d2d",borderRadius:"0"}});let Iu=Os;function el(){const a=document.createElement("div");return a.style.backgroundColor="blue",a.style.color="white",a.style.padding="6px",a.style.borderRadius="6px",a.style.boxShadow="0px 4px 6px rgba(0, 0, 0, 0.6)",a.style.zIndex="-10",a}function ku(a={}){const{color:e="white",size:t="4px",border:s="2px solid blue",background:i="white"}=a,n=document.createElement("div");return n.style.backgroundColor=i,n.style.color=e,n.style.height=t,n.style.width=t,n.style.borderRadius="50%",n.style.border=s,n.style.zIndex="-20",n}class cs extends pt{constructor(){super(...arguments),T(this,"id",Ze.create()),T(this,"_units","m"),T(this,"_rounding",2)}set units(e){this._units=e}get units(){return this._units}set rounding(e){this._rounding=e}get rounding(){return this._rounding}get value(){const e=this.distance();return Ls.convertUnits(e,"m",this.units,this.rounding)}}class dn{constructor(e,t,s,i=2,n="m"){T(this,"label"),T(this,"boundingBox",new ie),T(this,"world"),T(this,"_components"),T(this,"_units","m"),T(this,"_rounding",2),T(this,"startNormal",null),T(this,"line"),T(this,"rectangleComponentLines",[]),T(this,"projectionComponentLines",[]),T(this,"_visible",!0),T(this,"_root",new pi),T(this,"_endpoints",new Ve),T(this,"lineElement"),T(this,"rectangleDimensions",new Ve),T(this,"projectionDimensions",new Ve),T(this,"isSelected",!1),T(this,"_latestRectangularInversion",!1),T(this,"_endpointElement",ku()),T(this,"_material"),T(this,"_componentsMaterial",new wl({depthTest:!1,gapSize:.2,dashSize:.2,transparent:!0,opacity:.5,color:3026478})),T(this,"valueFormatter",null),this._components=e,this.world=t,this._material=s.lineMaterial,this._rounding=i,this._units=n,this.line=s.line,this.startNormal=s.startNormal??null,this.rectangleComponentLines=[new cs,new cs],this.updateRectangleComponents(),this.updateProjectionComponents(),this.lineElement=this.createLine(s),this._endpoints.onItemAdded.add(r=>{this._root.add(r.three);const o=this._endpoints.size===1?this.line.start:this.line.end;r.three.position.copy(o)}),this._endpoints.onBeforeDelete.add(r=>r.dispose()),this.createEndpoints();for(const r of this._endpoints)r.three.element.style.borderColor=`#${s.lineMaterial.color.getHexString()}`;this.label=this.newText(),this.label.three.element.style.backgroundColor=`#${s.lineMaterial.color.getHexString()}`,this.label.three.renderOrder=1,this._root.renderOrder=2,this.world.scene.three.add(this._root),this.setupEvents()}set units(e){for(const t of this.rectangleDimensions)t.units=e;for(const t of this.projectionDimensions)t.units=e;this._units=e,this.updateLabel()}get units(){return this._units}set rounding(e){for(const t of this.rectangleDimensions)t.rounding=e;for(const t of this.projectionDimensions)t.rounding=e;this._rounding=e,this.updateLabel()}get rounding(){return this._rounding}get visible(){return this._visible}set visible(e){for(const o of this.rectangleDimensions)o.visible=e;for(const o of this.projectionDimensions)o.visible=e;this._visible=e,this.label.visible=e;for(const o of this._endpoints)o.visible=e;const[t,s]=this._endpoints,i=t.three,n=s.three,r=this.label.three;e?(this.world.scene.three.add(this._root),this._root.add(r,i,n)):(r.removeFromParent(),i.removeFromParent(),n.removeFromParent(),this._root.removeFromParent())}set end(e){this.line.end=e;const t=this.lineElement.geometry.attributes.position;t.setXYZ(1,e.x,e.y,e.z),t.needsUpdate=!0,this.update()}set start(e){this.line.start=e;const t=this.lineElement.geometry.attributes.position;t.setXYZ(0,e.x,e.y,e.z),t.needsUpdate=!0,this.update()}setupEvents(){this.rectangleDimensions.onBeforeDelete.add(e=>e.dispose()),this.projectionDimensions.onBeforeDelete.add(e=>e.dispose())}dispose(){this.visible=!1;const e=this._components.get(Ot);e.destroy(this._root),e.destroy(this.lineElement),this._endpoints.clear(),this.label.dispose(),this.boundingBox&&e.destroy(this.boundingBox),this.rectangleDimensions.clear(),this.projectionDimensions.clear(),this._components=null}createBoundingBox(){const e=new N;this.line.getCenter(e);const t=this.line.distance();this.boundingBox.geometry=new qe(1,1,t),this.boundingBox.position.copy(e),this.boundingBox.lookAt(this.line.end),this.boundingBox.visible=!1,this._root.add(this.boundingBox)}invertRectangularDimensions(){this.rectangleDimensions.size!==0&&(this.rectangleDimensions.clear(),this._latestRectangularInversion=!this._latestRectangularInversion,this.updateRectangleComponents(this._latestRectangularInversion),this.displayRectangularDimensions())}displayRectangularDimensions(){this.rectangleDimensions.clear();for(const e of this.rectangleComponentLines){const t=new dn(this._components,this.world,{line:e,lineMaterial:this._componentsMaterial,endpointElement:this.endpointElement});t.lineElement.computeLineDistances(),this.rectangleDimensions.add(t)}}displayProjectionDimensions(){this.projectionDimensions.clear();for(const e of this.projectionComponentLines){const t=new dn(this._components,this.world,{line:e,lineMaterial:this._componentsMaterial,endpointElement:this.endpointElement});t.lineElement.computeLineDistances(),this.projectionDimensions.add(t)}}set endpointElement(e){for(const t of this.rectangleDimensions)t.endpointElement=e;for(const t of this.projectionDimensions)t.endpointElement=e;this._endpointElement=e,this.createEndpoints()}get endpointElement(){return this._endpointElement}createEndpoints(){this._endpoints.clear();const e=new ls(this.world,this._endpointElement),t=new ls(this.world,this._endpointElement.cloneNode(!0));this._endpoints.add(e,t)}updateProjectionComponents(){if(!this.startNormal)return;const e=new at().setFromNormalAndCoplanarPoint(this.startNormal,this.line.start),t=new N;e.projectPoint(this.line.end,t);let[s]=this.projectionComponentLines;s||(s=new cs,this.projectionComponentLines.push(s)),s.set(this.line.end,t),s.distance()<.01&&this.projectionComponentLines.shift();for(const i of this.projectionDimensions)i&&i.update()}updateRectangleComponents(e=!1){const t=e?this.line.end:this.line.start,s=e?this.line.start:this.line.end,i=new N;i.subVectors(s,t),Math.abs(s.y-t.y)>=.1?i.y=0:i.x=0;const n=t.clone().add(i),[r,o]=this.rectangleComponentLines;r.set(n,t),o.set(n,s);for(const l of this.rectangleDimensions)l.update()}updateLabel(){this.label.three.element.textContent=this.getTextContent();const e=new N;this.line.getCenter(e),this.label.three.position.copy(e)}updateGeometry(){this.updateRectangleComponents(),this.updateProjectionComponents(),[...this._endpoints][0].three.position.copy(this.line.start),[...this._endpoints][1].three.position.copy(this.line.end),this.lineElement.geometry.computeBoundingSphere()}update(){this.updateGeometry(),this.updateLabel()}set material(e){this._material.dispose(),this._material=e,this.lineElement.material=e}get material(){return this._material}createLine(e){const t=new st;t.setFromPoints([e.line.start,e.line.end]);const s=new Ct(t,e.lineMaterial);return this._root.add(s),s}newText(){const e=el();e.textContent=this.getTextContent();const t=new ls(this.world,e),s=new N;return this.line.getCenter(s),t.three.position.copy(s),this._root.add(t.three),t}getTextContent(e=this.line.distance()){const t=Ls.convertUnits(e,"m",this._units,this.rounding);return`${Kt.valueFormatter?Kt.valueFormatter(t):t.toFixed(this.rounding)} ${this._units}`}set color(e){const t=`#${e.getHexString()}`;this.label.three.element.style.backgroundColor=t;for(const s of this._endpoints)s.three.element.style.borderColor=t;this._material.color.set(e)}}class fi{constructor(e){T(this,"id",Ze.create()),T(this,"points",new Ve),T(this,"tolerance",.005),T(this,"_plane",null),T(this,"_rounding",2),T(this,"_units","m2"),this.points.guard=t=>{const s=[...this.points].some(n=>n.equals(t)),i=this.isPointInPlane(t);return!s&&i},this.points.onItemAdded.add(t=>{if(this.plane){const s=new N;this.plane.projectPoint(t,s),t.copy(s)}this.points.size<3||this.points.size===3&&this.computePlane()}),this.points.onItemDeleted.add(()=>{this.points.size>=3||(this._plane=null)}),this.points.onCleared.add(()=>{this._plane=null}),e&&this.points.add(...e)}get plane(){return this._plane}get _coordinateSystem(){if(!this.plane)return null;const e=this.plane.normal,t=new N,s=new N;return Math.abs(e.x)>Math.abs(e.z)?t.set(-e.y,e.x,0).normalize():t.set(0,-e.z,e.y).normalize(),s.crossVectors(e,t).normalize(),{normal:e.clone(),x:t.clone(),y:s.clone()}}get points2D(){if(!this.plane)if(this.points.size>=3)this.computePlane();else return null;return[...this.points].map(e=>this.convertPointTo2D(e)).filter(e=>e!==null)}get center(){if(!this.plane||this.points.size<3)return null;const e=this.points2D;if(!e||e.length===0)return null;const t=e.reduce((s,i)=>s.add(i),new ze).divideScalar(e.length);return this.convertPointTo3D(t)}get value(){return Ls.convertUnits(this.rawValue,"m2",this.units,this.rounding)}get rawValue(){const e=this.points2D;return e?Math.abs(yl.area(e)):0}get boundingBox(){if(this.points.size===0)return null;const e=new Le;for(const t of this.points)e.expandByPoint(t);return e}get perimeter(){const e=this.points2D;if(!e||e.length<2)return 0;let t=0;for(let s=0;s<e.length;s++){const i=e[s],n=e[(s+1)%e.length];t+=i.distanceTo(n)}return t}set rounding(e){this._rounding=e}get rounding(){return this._rounding}set units(e){this._units=e}get units(){return this._units}isPointInPlane(e){if(!this.plane)return!0;const t=this.plane.distanceToPoint(e);return Math.abs(t)<this.tolerance}clone(){const e=new fi([...this.points]);return e.units=this.units,e.rounding=this.rounding,e.tolerance=this.tolerance,e}computePlane(){const[e,t,s]=this.points;if(!(e&&t&&s))return null;const i=new N().subVectors(t,e),n=new N().subVectors(s,e),r=new N().crossVectors(i,n).normalize();return this._plane=new at().setFromNormalAndCoplanarPoint(r,e),this.plane}convertPointTo2D(e){if(!this.isPointInPlane(e)||!this.plane)return null;const t=this._coordinateSystem;if(!t)return null;const s=new N;this.plane.projectPoint(e,s);const i=s.dot(t.x),n=s.dot(t.y);return new ze(i,n)}convertPointTo3D(e){if(!this.plane)return null;const t=this._coordinateSystem;if(!t)return null;const{x:s,y:i,normal:n}=t;return new N().addScaledVector(s,e.x).addScaledVector(i,e.y).addScaledVector(n,-this.plane.constant)}}class yn{constructor(e){T(this,"_components"),T(this,"id",Ze.create()),T(this,"onItemsChanged",new Q),T(this,"_items",{}),T(this,"_units","m3"),T(this,"_rounding",2),this._components=e}set items(e){this._items=e,this.onItemsChanged.trigger()}get items(){return this._items}set units(e){this._units=e}get units(){return this._units}set rounding(e){this._rounding=e}get rounding(){return this._rounding}async getRawValue(){return await this._components.get(Ls).getItemsVolume(this.items)}async getValue(){const e=await this.getRawValue();return Ls.convertUnits(e,"m3",this.units,this.rounding)}async getCenter(){return await this._components.get(ln).getCenter(this.items)}async getBox(){const e=this._components.get(ln);e.list.clear(),await e.addFromModelIdMap(this.items);const t=e.get();return e.list.clear(),t}clone(){const e=new yn(this._components);return e.items=ge.clone(this.items),e}}class tl extends ls{constructor(e){const t=document.createElement("div");t.style.backgroundColor="blue",t.style.color="white",t.style.padding="6px",t.style.borderRadius="6px",t.style.boxShadow="0px 4px 6px rgba(0, 0, 0, 0.6)",t.style.zIndex="-10",super(e,t),T(this,"_value",0),T(this,"_units","m2"),T(this,"_worldUnits","m2"),T(this,"_color",new fe),T(this,"_textColor",new fe),T(this,"_rounding",2),this.three.renderOrder=1,t.textContent=this.formattedValue}set value(e){this._value=e,this.three.element.textContent=this.formattedValue}get value(){return this._value}set units(e){this._units=e,this.three.element.textContent=this.formattedValue}get units(){return this._units}set worldUnits(e){this._worldUnits=e,this.three.element.textContent=this.formattedValue}get worldUnits(){return this._worldUnits}set color(e){this._color=e;const t=`#${e.getHexString()}`;this.three.element.style.backgroundColor=t}get color(){return this._color}set textColor(e){this._textColor=e;const t=`#${e.getHexString()}`;this.three.element.style.color=t}get textColor(){return this._textColor}set rounding(e){this._rounding=e,this.three.element.textContent=this.formattedValue}get rounding(){return this._rounding}get formattedValue(){const e=Ls.convertUnits(this.value,this.worldUnits,this.units,this.rounding);return`${Kt.valueFormatter?Kt.valueFormatter(e):e.toFixed(this.rounding)} ${this.units}`}}class Lu{constructor(e,t,s=new fi){T(this,"_root",new pi),T(this,"_components"),T(this,"_material",new rn({color:"red",transparent:!0,opacity:.5,side:Nt,depthTest:!1})),T(this,"_visible",!0),T(this,"_color",new fe),T(this,"label"),T(this,"three",new ie),T(this,"world"),T(this,"area"),T(this,"_triggerUpdate",()=>this.update()),this._components=e,this.world=t,this.area=s,this.world.scene.three.add(this.three),this.label=new tl(t),this._root.renderOrder=2,this.visible=!0,this.update(),s.points.onItemAdded.add(this._triggerUpdate),s.points.onItemDeleted.add(this._triggerUpdate),s.points.onCleared.add(this._triggerUpdate)}set material(e){this._material.dispose(),this._material=e,this.three.material=e}get material(){return this._material}set visible(e){this._visible=e,this.label.visible=e;const t=this.label.three;e?(this._root.add(t,this.three),this.world.scene.three.add(this._root)):(t.removeFromParent(),this._root.removeFromParent())}get visible(){return this._visible}set rounding(e){this.label.rounding=e}get rounding(){return this.label.rounding}set units(e){this.label.units=e}get units(){return this.label.units}set color(e){this._color=e,this.label.color=e,this._material.color.set(e)}get color(){return this._color}updateMesh(){if(this.area.points.size<3)return;const e=[...this.area.points],t=e.flatMap(n=>[n.x,n.y,n.z]),s=[];for(let n=1;n<e.length-1;n++)s.push(0,n,n+1);this.three.geometry.dispose();const i=new st;i.setAttribute("position",new qt(t,3)),i.setIndex(s),this.three.geometry=i,this.three.material=this.material}update(){if(this.updateMesh(),this.area.value===0)this.label.visible=!1;else{this.label.value=this.area.rawValue,this.label.visible=!0;const e=this.area.center;e&&this.label.three.position.copy(e)}}dispose(){this.label.dispose(),this._components.get(Ot).destroy(this._root,!0,!0),this.area.points.clear()}}const Nu={length:"m",area:"m2",volume:"m3"};class sl{constructor(e,t,s=new yn(e)){T(this,"_root",new pi),T(this,"_components"),T(this,"_material",new rn({color:"red",transparent:!0,opacity:.75,side:Nt,depthTest:!1})),T(this,"_visible",!0),T(this,"_color",new fe),T(this,"label"),T(this,"world"),T(this,"volume"),T(this,"meshes",[]),this._components=e,this.world=t,this.volume=s,this.label=new tl(t),this._root.renderOrder=2,this.visible=!0,this.update(),this.volume.onItemsChanged.add(()=>this.update())}set material(e){this._material.dispose(),this._material=e;for(const t of this.meshes)t.material=e}get material(){return this._material}set visible(e){this._visible=e,this.label.visible=e;for(const t of this.meshes)e?this.world.scene.three.add(t):t.removeFromParent()}get visible(){return this._visible}set rounding(e){this.label.rounding=e}get rounding(){return this.label.rounding}set units(e){this.label.units=e}get units(){return this.label.units}set color(e){this._color=e,this.label.color=e,this._material.color.set(e)}get color(){return this._color}async updateMesh(){this.cleanMeshes();const e=this._components.get(cn),t=await e.get(this.volume.items,{material:this.material});this.meshes=e.getMeshesFromResult(t);for(const s of this.meshes)this.world.scene.three.add(s)}async update(){this.updateMesh();const e=await this.volume.getRawValue();this.label.visible=e!==0,this.label.value=e;const t=await this.volume.getCenter();t&&this.label.three.position.copy(t)}cleanMeshes(){const e=this._components.get(Ot);for(const t of this.meshes)e.destroy(t,!0,!0);this._components.get(cn).remove(),this.meshes=[]}dispose(){this.label.dispose(),this.cleanMeshes(),this.volume.items={}}}class Kt extends Ee{constructor(e,t){super(e),T(this,"list",new Ve),T(this,"onDisposed",new Q),T(this,"snappings",[Is.LINE,Is.POINT,Is.FACE]),T(this,"lines",new Ve),T(this,"fills",new Ve),T(this,"labels",new Ve),T(this,"volumes",new Ve),T(this,"delay",300),T(this,"_world",null),T(this,"measureType"),T(this,"onPointerStop",new Q),T(this,"onPointerMove",new Q),T(this,"onStateChanged",new Q),T(this,"pointerStopTimeout",null),T(this,"onMove",()=>{this.enabled&&(this._vertexPicker.updatePointer(),this.pointerStopTimeout!==null&&clearTimeout(this.pointerStopTimeout),this.pointerStopTimeout=window.setTimeout(()=>{this.onPointerStop.trigger()},this.delay),this.onPointerMove.trigger())}),T(this,"onKeydown",s=>{this.enabled&&s.key==="Escape"&&this.cancelCreation()}),T(this,"onEnabledChange",new Q),T(this,"_enabled",!1),T(this,"onVisibilityChange",new Q),T(this,"_visible",!0),T(this,"_units"),T(this,"_rounding",2),T(this,"_linesEndpointElement",el()),T(this,"_linesMaterial",new Yo({color:"#0000FF",depthTest:!1})),T(this,"_fillsMaterial",new rn({color:2392594,side:Nt,transparent:!0,opacity:.3,depthTest:!1})),T(this,"_volumesMaterial",new rn({color:2392594,side:Nt,transparent:!0,opacity:.3,depthTest:!1})),T(this,"_color",new fe),T(this,"_vertexPicker",new Iu(this.components)),T(this,"create",s=>{}),T(this,"endCreation",s=>{}),T(this,"cancelCreation",()=>{}),T(this,"delete",s=>{}),this.measureType=t,this._units=Nu[this.measureType],this.lines.onBeforeDelete.add(s=>s.dispose()),this.fills.onBeforeDelete.add(s=>s.dispose()),this.labels.onBeforeDelete.add(s=>s.dispose()),this.volumes.onBeforeDelete.add(s=>s.dispose()),this.list.onCleared.add(()=>{this.lines.clear(),this.fills.clear(),this.labels.clear(),this.volumes.clear()})}set world(e){this._world=e,this._vertexPicker.world=e}get world(){return this._world}get unitsList(){let e=[];return this.measureType==="length"?e=["mm","cm","m","km"]:this.measureType==="area"?e=["mm2","cm2","m2","km2"]:e=["mm3","cm3","m3","km3"],e}setEvents(e){if(!this.world)throw new Error("Measurement: you must specify a world first!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("Measurement: the world needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;t&&(t.removeEventListener("pointermove",this.onMove),window.removeEventListener("keydown",this.onKeydown),e&&(t.addEventListener("pointermove",this.onMove),window.addEventListener("keydown",this.onKeydown)))}set enabled(e){this._enabled=e,this._vertexPicker.enabled=e,this.setEvents(e),this.cancelCreation(),this.onEnabledChange.trigger(e),this.onStateChanged.trigger(["enabled"])}get enabled(){return this._enabled}set visible(e){this._visible=e;for(const t of this.lines)t.visible=e;for(const t of this.fills)t.visible=e;for(const t of this.volumes)t.visible=e;this.onVisibilityChange.trigger(e),this.onStateChanged.trigger(["visibility"])}get visible(){return this._visible}set units(e){this._units=e;let t;e.endsWith("2")?t="area":e.endsWith("3")?t="volume":t="length";for(const s of this.list)(s instanceof cs||s instanceof fi||s instanceof yn)&&(s.units=e);if(t==="length")for(const s of this.lines)s.units=e;else if(t==="area")for(const s of this.fills)s.units=e;else if(t==="volume")for(const s of this.volumes)s.units=e;this.onStateChanged.trigger(["units"])}get units(){return this._units}set rounding(e){this._rounding=e;for(const t of this.list)"rounding"in t&&typeof t.rounding=="number"&&(t.rounding=e);for(const t of this.lines)t.rounding=e;for(const t of this.fills)t.rounding=e;for(const t of this.volumes)t.rounding=e;this.onStateChanged.trigger(["rounding"])}get rounding(){return this._rounding}set linesEndpointElement(e){this._linesEndpointElement=e;for(const t of this.lines)t.endpointElement=e}get linesEndpointElement(){return this._linesEndpointElement}set linesMaterial(e){this._linesMaterial.dispose(),this._linesMaterial=e;for(const t of this.lines)t.material=e}get linesMaterial(){return this._linesMaterial}set fillsMaterial(e){this._fillsMaterial.dispose(),this._fillsMaterial=e;for(const t of this.fills)t.material=e}get fillsMaterial(){return this._fillsMaterial}set volumesMaterial(e){this._volumesMaterial.dispose(),this._volumesMaterial=e;for(const t of this.volumes)t.material=e}get volumesMaterial(){return this._volumesMaterial}set color(e){this._color=e,this._linesMaterial.color.set(e),this._fillsMaterial.color.set(e),this._volumesMaterial.color.set(e);for(const t of this.lines)t.color=e;for(const t of this.fills)t.color=e;for(const t of this.volumes)t.color=e;this.onStateChanged.trigger(["color"])}get color(){return this._color}dispose(){this._vertexPicker.dispose(),this.list.clear(),this.linesMaterial.dispose(),this.fillsMaterial.dispose(),this.volumesMaterial.dispose(),this.onDisposed.trigger()}createLineElement(e,t=null){if(!this.world)throw new Error("Measurement: world is need!");return new dn(this.components,this.world,{line:e,startNormal:t??void 0,lineMaterial:this.linesMaterial,endpointElement:this.linesEndpointElement},this.rounding,this.units)}createFillElement(e){if(!this.world)throw new Error("Measurement: world is need!");const t=new Lu(this.components,this.world,e);return t.rounding=this.rounding,(this.units.endsWith("2")?"area":void 0)==="area"&&(t.units=this.units),t}createVolumeElement(e){if(!this.world)throw new Error("Measurement: world is need!");const t=new sl(this.components,this.world,e);return t.rounding=this.rounding,(this.units.endsWith("3")?"volume":void 0)==="volume"&&(t.units=this.units),t}addLineElementsFromPoints(e){for(let t=0;t<e.length;t++){const s=e[t],i=e[(t+1)%e.length],n=new cs(s,i),r=this.createLineElement(n);r.label.visible=!1,this.lines.add(r)}}getLineBoxes(){const e=[];for(const t of this.lines)e.push(t.boundingBox);return e}getFillBoxes(){const e=[];for(const t of this.fills)e.push(t.three);return e}async getVolumeBoxes(){const e=[];for(const t of this.volumes)e.push(t.meshes);return e}}T(Kt,"valueFormatter",null);const Uu=class il extends Kt{constructor(e){super(e,"area"),T(this,"pickTolerance",.1),T(this,"tolerance",.005),T(this,"modes",["free","square"]),T(this,"_mode","free"),T(this,"_temp",{isDragging:!1,area:new fi,lines:new Ve,point:new N}),T(this,"computeLineElements",()=>{this._temp.lines.clear();const t=[...this._temp.area.points];if(this._temp.area.isPointInPlane(this._temp.point)&&t.push(this._temp.point),!(t.length<2||!this.world))for(let s=0;s<t.length;s++){const i=t[s],n=t[(s+1)%t.length],r=new cs(i,n),o=this.createLineElement(r);this._temp.lines.add(o)}}),T(this,"create",async()=>{if(!this.enabled)return;if(!this.world)throw new Error("Area Measurement: world is not defined!");const t=await this._vertexPicker.get({snappingClasses:this.snappings});if(!(t&&t.point))return;const{area:s,point:i}=this._temp;if(this._temp.isDragging||(s.tolerance=this.tolerance,s.points.clear(),this._temp.isDragging=!0),s.points.size===0&&i.copy(t.point),s.points.add(i.clone()),this.mode==="square"&&s.points.size===2&&t.normal){const[n,r]=s.points,o=new N().subVectors(r,n),l=o.clone(),h=o.clone().negate();Math.abs(o.y)>=.1?(l.y=0,h.y=0):(l.x=0,h.x=0);const c=n.clone().add(l),u=r.clone().add(h);s.points.clear(),s.points.add(n,c,r,u),this.endCreation()}}),T(this,"endCreation",()=>{this.enabled&&(this._temp.isDragging=!1,this._temp.area.points.size>=3&&this.list.add(this._temp.area.clone()),this._temp.area.points.clear(),this._temp.lines.clear())}),T(this,"cancelCreation",()=>{this.enabled&&(this._temp.isDragging=!1,this._temp.area.points.clear(),this._temp.lines.clear())}),T(this,"delete",()=>{if(!this.enabled||this.list.size===0||!this.world)return;const t=this.getFillBoxes(),s=this.components.get(it).get(this.world).castRayToObjects(t),i=this.components.get(Ot);for(const r of t)i.destroy(r);if(!s)return;const n=[...this.fills].find(r=>r.three===s.object);n&&(this.list.delete(n.area),this.lines.clear())}),e.add(il.uuid,this),this.initHandlers(),this.color=new fe("#6528d7")}get mode(){return this._mode}set mode(e){this._mode=e,this.cancelCreation(),this.onStateChanged.trigger(["mode"])}initHandlers(){this.onVisibilityChange.add(()=>{for(const e of this.lines)e.label.visible=!1}),this.list.onItemAdded.add(e=>{if(!this.world)return;const t=this.createFillElement(e);t.color=this.color,this.fills.add(t),this.addLineElementsFromPoints([...e.points])}),this.list.onBeforeDelete.add(e=>{const t=[...this.fills].find(s=>s.area===e);t&&this.fills.delete(t)}),this.onPointerStop.add(()=>this.updatePreview()),this._temp.lines.onItemAdded.add(e=>e.label.visible=!1),this._temp.lines.onBeforeDelete.add(e=>e.dispose()),this._temp.area.points.onItemAdded.add(()=>{this.computeLineElements()}),this._temp.area.points.onItemDeleted.add(()=>{this._temp.lines.clear()}),this.onStateChanged.add(e=>{e.includes("rounding")&&(this._temp.area.rounding=this.rounding),e.includes("units")&&(this._temp.area.units=this.units)})}async updatePreview(){if(!this.enabled||!this.world)throw new Error("Measurement is not enabled or world is not defined!");const e=await this._vertexPicker.get({snappingClasses:this.snappings});if(!(e&&e.point&&this._temp.isDragging))return;const t=e.point.clone(),{plane:s}=this._temp.area;if(s){const i=s.distanceToPoint(t);if(Math.abs(i)<.1){const n=new N;s.projectPoint(t,n),t.copy(n)}}this._temp.point.copy(t),this.computeLineElements()}};T(Uu,"uuid","09b78c1f-0ff1-4630-a818-ceda3d878c75");const Bu=class nl extends Kt{constructor(e){super(e,"length"),T(this,"_temp",{isDragging:!1,line:new cs}),T(this,"modes",["free","edge"]),T(this,"_mode","free"),T(this,"create",()=>{if(this.enabled){if(!this._temp.isDragging){this.initPreview();return}this.endCreation()}}),T(this,"endCreation",()=>{this.enabled&&this._temp.dimension&&(this.list.add(this._temp.line.clone()),this.mode==="free"&&(this._temp.dimension.dispose(),this._temp.dimension=void 0,this._temp.isDragging=!1,this._temp.startNormal=void 0))}),T(this,"cancelCreation",()=>{var t;this.enabled&&(this._temp.isDragging=!1,this._temp.dimension&&((t=this._temp.dimension)==null||t.dispose(),this._temp.dimension=void 0))}),T(this,"delete",()=>{if(!this.enabled||this.list.size===0||!this.world)return;const t=this.getLineBoxes(),s=this.components.get(it).get(this.world).castRayToObjects(t);if(!s)return;const i=[...this.lines].find(n=>n.boundingBox===s.object);i&&this.list.delete(i.line)}),e.add(nl.uuid,this),this.initHandlers()}get mode(){return this._mode}set mode(e){this._mode=e,this.cancelCreation(),e==="edge"&&this.initPreview(),this.onStateChanged.trigger(["mode"])}initHandlers(){this.list.onItemAdded.add(e=>{const t=this.createLineElement(e,this._temp.startNormal);t.createBoundingBox(),this.lines.add(t)}),this.list.onBeforeDelete.add(e=>{const t=[...this.lines].find(s=>s.line===e);t&&this.lines.delete(t)}),this.onPointerStop.add(()=>this.updatePreviewLine()),this.onEnabledChange.add(e=>{e&&this.mode==="edge"&&this.initPreview()})}async initPreview(){if(!this.world)throw new Error("Measurement: world is need!");const e=await this._vertexPicker.get({snappingClasses:this.snappings});if(this.mode==="free"){if(!(e!=null&&e.point))return;const t=e.point;this._temp.line.set(t,t.clone()),this._temp.isDragging=!0,this._temp.dimension=this.createLineElement(this._temp.line),this._temp.startNormal=e.normal??void 0}else if(this.mode==="edge"){const t=e==null?void 0:e.snappedEdgeP1,s=e==null?void 0:e.snappedEdgeP2,i=t||new N,n=i||s;this._temp.line.set(i,n),this._temp.isDragging=!0,this._temp.dimension=this.createLineElement(this._temp.line),this._temp.dimension.visible=!!(t&&s)}}async updatePreviewLine(){if(!this.world)throw new Error("Measurement: world is need!");const e=await this._vertexPicker.get({snappingClasses:this.snappings});if(this.mode==="free"){if(!(e!=null&&e.point)||(this._temp.line.end.copy(e.point),!this._temp.dimension))return;this._temp.dimension.end=this._temp.line.end}else if(this.mode==="edge"){const t=e==null?void 0:e.snappedEdgeP1,s=e==null?void 0:e.snappedEdgeP2;if(this._temp.dimension&&(this._temp.dimension.visible=!!(t&&s)),!(t&&s)||(this._temp.line.start.copy(t),this._temp.line.end.copy(s),!this._temp.dimension))return;this._temp.dimension.start=this._temp.line.start,this._temp.dimension.end=this._temp.line.end}}};T(Bu,"uuid","2f9bcacf-18a9-4be6-a293-e898eae64ea1");const Ru=class rl extends Kt{constructor(e){super(e,"volume"),T(this,"_temp",{}),T(this,"modes",["free"]),T(this,"_mode","free"),T(this,"_previousHovererState",!1),T(this,"create",async()=>{if(!this.enabled)return;const t=await this._vertexPicker.get();t&&(this._temp.preview||this.initPreview(),this._temp.preview.volume.items=ge.join([this._temp.preview.volume.items,{[t.fragments.modelId]:new Set([t.localId])}]))}),T(this,"endCreation",()=>{if(!this._temp.preview||ge.isEmpty(this._temp.preview.volume.items))return;const t=this._temp.preview.volume.clone();this.list.add(t),this._temp.preview.dispose(),delete this._temp.preview}),T(this,"cancelCreation",()=>{var t;(t=this._temp.preview)==null||t.dispose(),delete this._temp.preview}),T(this,"delete",async()=>{if(this.list.size===0||!this.world)return;const t=await this.getVolumeBoxes(),s=this.components.get(it).get(this.world);for(const i of t){const n=s.castRayToObjects(i);if(!n)continue;const r=[...this.volumes].find(o=>o.meshes.some(l=>l===n.object));if(!r)return;this.list.delete(r.volume)}}),e.add(rl.uuid,this),this.initHandlers()}get mode(){return this._mode}set mode(e){this._mode=e,this.cancelCreation(),this.onStateChanged.trigger(["mode"])}initHandlers(){this.list.onItemAdded.add(e=>{const t=this.createVolumeElement(e);t.color=this.color,t.rounding=this.rounding,t.units=this.units,this.volumes.add(t)}),this.list.onBeforeDelete.add(e=>{const t=[...this.volumes].find(s=>s.volume===e);t&&this.volumes.delete(t)}),this.onStateChanged.add(e=>{if(e.includes("color")){if(!this._temp.preview)return;this._temp.preview.color=this.color}if(e.includes("units")){if(!this._temp.preview)return;this._temp.preview.units=this.units}if(e.includes("rounding")){if(!this._temp.preview)return;this._temp.preview.rounding=this.rounding}if(e.includes("enabled")){const t=this.components.get(Pu);t.world=this.world,this.enabled?(this._previousHovererState=t.enabled,t.enabled=!0):(t.clear(),t.enabled=this._previousHovererState),t.hover()}})}async initPreview(){if(this.enabled){if(!this.world)throw new Error("Measurement: world is need!");this._temp.preview=new sl(this.components,this.world),this._temp.preview.color=this.color,this._temp.preview.rounding=this.rounding,this._temp.preview.units=this.units}}};T(Ru,"uuid","01f885ab-ec4e-4e6c-a853-9dfc0d6766ed");export{xu as r,Yn as t,Vu as x};
