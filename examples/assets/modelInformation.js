import{C as R,W as U,S as P,a as q,b as j,G as V,fI as _,fJ as H,fE as T,fB as W,fy as D,fH as Y}from"./virtual-memory-controller-CejF-vhY.js";import{a as Q,R as $,m as L,Q as F,F as z}from"./index-CWj6LyOo.js";import{S as J}from"./stats.min-Cj8wREqt.js";import{R as X}from"./rendered-faces-DtNZp-Dg.js";import{F as K}from"./index-ClKYDA-N.js";const y=new R,Z=y.get(U),c=Z.create();c.scene=new P(y);c.scene.setup();c.scene.three.background=null;const B=document.getElementById("container");c.renderer=new q(y,B);c.camera=new j(y);c.camera.controls.setLookAt(58,22,-25,13,0,4.2);y.init();const ee=y.get(V);ee.create(c);const te="https://thatopen.github.io/engine_fragment/resources/worker.mjs",ae=await fetch(te),oe=await ae.blob(),ne=new File([oe],"worker.mjs",{type:"text/javascript"}),se=URL.createObjectURL(ne),f=new K(se);c.camera.controls.addEventListener("update",()=>f.update());f.models.list.onItemSet.add(({value:e})=>{e.useCamera(c.camera.three),c.scene.three.add(e.object),f.update(!0)});f.models.materials.list.onItemSet.add(({value:e})=>{"isLodMaterial"in e&&e.isLodMaterial||(e.polygonOffset=!0,e.polygonOffsetUnits=1,e.polygonOffsetFactor=Math.random())});const re=await fetch("https://thatopen.github.io/engine_fragment/resources/frags/school_arq.frag"),ie=await re.arrayBuffer(),n=await f.load(ie,{modelId:"example"}),le={color:new _("gold"),renderedFaces:X.TWO,opacity:1,transparent:!1};let i=null;const ce=async()=>{i&&await n.highlight([i],le)},A=async()=>{i&&await n.resetHighlight([i])};let M=()=>{},E=()=>{};const k=new H;B.addEventListener("click",async e=>{k.x=e.clientX,k.y=e.clientY;const o=await n.raycast({camera:c.camera.three,mouse:k,dom:c.renderer.three.domElement}),s=[];o?(s.push(A()),i=o.localId,M(),s.push(ce())):(s.push(A()),i=null,E()),s.push(f.update(!0)),Promise.all(s)});const G=async e=>{if(!i)return null;const[o]=await n.getItemsData([i],{attributesDefault:!e,attributes:e});return o},me=async()=>{const e=await G(["Name"]),o=e==null?void 0:e.Name;return o&&"value"in o?o.value:null},ue=async()=>{if(!i)return null;const[e]=await n.getItemsData([i],{attributesDefault:!1,attributes:["Name","NominalValue"],relations:{IsDefinedBy:{attributes:!0,relations:!0},DefinesOcurrence:{attributes:!1,relations:!1}}});return e.IsDefinedBy??[]},de=e=>{const o={};for(const[s,m]of e.entries()){const{Name:b,HasProperties:u}=m;if(!("value"in b&&Array.isArray(u)))continue;const l={};for(const[g,N]of u.entries()){const{Name:w,NominalValue:t}=N;if(!("value"in w&&"value"in t))continue;const a=w.value,r=t.value;a&&r!==void 0&&(l[a]=r)}o[b.value]=l}return o},be=async(e,o=!1)=>{const m=(await n.getItemsOfCategories([new RegExp(`^${e}$`)]))[e],u=(await n.getItemsData(m,{attributesDefault:!1,attributes:["Name"]})).map(l=>{const{Name:g}=l;return g&&!Array.isArray(g)?g.value:null}).filter(l=>l);return o?[...new Set(u)]:u},fe=async()=>await n.getSpatialStructure(),ge=async()=>{const o=(await n.getItemsOfCategories([/BUILDINGSTOREY/])).IFCBUILDINGSTOREY,s=await n.getItemsData(o,{attributesDefault:!1,attributes:["Name"]});let m=null;for(const[u,l]of s.entries())"Name"in l&&"value"in l.Name&&l.Name.value==="01 - Entry Level"&&(m=o[u]);return m===null?null:await n.getItemsChildren([m])},pe=async()=>{if(!i)return null;const[e]=await n.getItemsGeometry([i]);return e},ye=async e=>{const o=await n.getItemsOfCategories([new RegExp(`^${e}$`)]),s=Object.values(o).flat(),m=await n.getItemsGeometry(s);return{localIds:s,geometries:m}};let x=[];const he=new T({color:"purple"}),we=e=>{const{positions:o,indices:s,normals:m,transform:b}=e;if(!(o&&s&&m))return null;const u=new W;u.setAttribute("position",new D(o,3)),u.setAttribute("normal",new D(m,3)),u.setIndex(Array.from(s));const l=new Y(u,he);return l.applyMatrix4(b),x.push(l),l};Q.init();const Ie=await n.getCategories(),C=$.create(()=>L`<bim-dropdown name="categories">
    ${Ie.map(e=>L`<bim-option label=${e}></bim-option>`)}
  </bim-dropdown>`),[v,O]=$.create(e=>{const o=async()=>{const t=await G();t&&console.log(t)},s=async()=>{const t=await ue();if(!t)return;const a=document.getElementById("controls-panel"),r=a==null?void 0:a.querySelector('[name="format"]'),d=r!=null&&r.value?de(t):t;console.log(d)},m=async({target:t})=>{t.loading=!0;const a=await pe();if(!a){t.loading=!1;return}t.loading=!1,console.log(a)},b=async({target:t})=>{const a=document.getElementById("controls-panel"),[r]=C.value;if(!r)return;t.loading=!0;const d=a==null?void 0:a.querySelector('[name="unique"]'),I=await be(r,d==null?void 0:d.value);t.loading=!1,console.log(I)},u=async({target:t})=>{const[a]=C.value;if(!a)return;t.loading=!0;const{localIds:r,geometries:d}=await ye(a);for(const I of d)for(const S of I){const p=we(S);p&&c.scene.three.add(p)}await n.setVisible(r,!1),await f.update(!0),t.loading=!1,console.log(d)},l=async()=>{for(const t of x){t.removeFromParent(),t.geometry.dispose();const a=Array.isArray(t.material)?t.material:[t.material];for(const r of a)r.dispose()}x=[],await n.setVisible(void 0,!0),await f.update(!0)},g=async t=>{if(!t)return;const a=t;a.textContent=await me()},N=async({target:t})=>{t.loading=!0;const a=await fe();console.log(a),t.loading=!1},w=async({target:t})=>{t.loading=!0;const a=await ge();if(!a){t.loading=!1;return}const r=document.getElementById("controls-panel");if(r==null?void 0:r.querySelector('[name="displayNames"]')){const S=(await n.getItemsData(a,{attributesDefault:!1,attributes:["Name"]})).map(p=>"Name"in p&&"value"in p.Name?p.Name.value:null);console.log(S)}else console.log(a);t.loading=!1};return L`
    <bim-panel id="controls-panel" active label="Model Information" class="options-menu">
      <bim-panel-section fixed label="Info">
        <bim-label style="white-space: normal;">ðŸ’¡ To better experience this tutorial, open your browser console to see the data logs.</bim-label>
      </bim-panel-section>
      <bim-panel-section label="Selected Item">
        <bim-label style=${F({whiteSpace:"normal",display:i?"none":"unset"})}>ðŸ’¡ Click any element in the viewer to activate the data log options.</bim-label>
        <bim-label ${z(g)} style=${F({whiteSpace:"normal",display:i?"unset":"none"})}></bim-label>
        <bim-button ?disabled=${!i} label="Log Attributes" @click=${o}></bim-button>
        <div style="display: flex; gap: 0.5rem">
          <bim-button ?disabled=${!i} label="Log Psets" @click=${s}></bim-button>
          <bim-checkbox name="format" label="Format" inverted checked></bim-checkbox>
        </div>
          <bim-button ?disabled=${!i} label="Log Geometry" @click=${m}></bim-button>
      </bim-panel-section>
      <bim-panel-section label="Categories">
        ${C}
        <div style="display: flex; gap: 0.5rem">
          <bim-button label="Log Names" @click=${b}></bim-button>
          <bim-checkbox name="unique" label="Unique" inverted></bim-checkbox>
        </div>
        <bim-button label="Log Geometries" @click=${u}></bim-button>
        <bim-button label="Dispose Meshes" @click=${l}></bim-button>
      </bim-panel-section>
      <bim-panel-section label="Spatial Structure">
        <bim-button label="Log Spatial Structure" @click=${N}></bim-button>
        <div style="display: flex; gap: 0.5rem">
          <bim-button label="Log First Level Items" @click=${w}></bim-button>
          <bim-checkbox name="displayNames" label="Names" inverted></bim-checkbox>
        </div>
      </bim-panel-section>
    </bim-panel>
  `},{});M=()=>O();E=()=>O();document.body.append(v);const ve=$.create(()=>L`
    <bim-button class="phone-menu-toggler" icon="solar:settings-bold"
      @click=${()=>{v.classList.contains("options-menu-visible")?v.classList.remove("options-menu-visible"):v.classList.add("options-menu-visible")}}>
    </bim-button>
  `);document.body.append(ve);const h=new J;h.showPanel(2);document.body.append(h.dom);h.dom.style.left="0px";h.dom.style.zIndex="unset";c.renderer.onBeforeUpdate.add(()=>h.begin());c.renderer.onAfterUpdate.add(()=>h.end());
